@using Portal.Consultoras.Web.Areas.Mobile.Models
@using Portal.Consultoras.Web.CustomHelpers
@using Portal.Consultoras.Common

@{

    var layout = ViewContext.MobileLayout();
    Layout = string.Format("~/Areas/Mobile/Views/Shared/{0}.cshtml", layout);
    MobileAppConfiguracionModel mobileConfiguracion = Html.MobileAppConfiguracion();
    var dic = new Dictionary<int, decimal>();
    //calular el total de detalle trueque
    if (ViewBag.Origen == "1")
    {
        var listado = ViewBag.ListaDetalle;


        var total = 0;

        if (listado != null)
        {
            foreach (var item in listado)
            {
                if (item.CodigoOperacion.Equals("T") && item.DetalleReemplazo != null)
                {
                    foreach (var obj in item.DetalleReemplazo)
                    {
                        total += Convert.ToDecimal(obj.Precio) * Convert.ToInt32(obj.Cantidad);
                    }
                    dic.Add(item.CDRWebDetalleID, total);
                }
            }
        }

    }
}

@section styles
{
    @if (System.Configuration.ConfigurationManager.AppSettings.Get("PaisesEsika").Contains(ViewBag.PaisAnalytics))
    {
        <link href="@Url.Content("~/Content/Css/Mobile/esika/cdr.css")" rel="stylesheet" />
    }
    else
    {
        <link href="@Url.Content("~/Content/Css/Mobile/lbel/cdr.css")" rel="stylesheet" />
    }

    <style type="text/css">
        .footer-page {
            display: none;
        }
    </style>
}

@{
    if (!mobileConfiguracion.EsAppMobile)
    {
        <div class="titulo_mobile fijarTituloMobile">
            <a href="@Request.UrlReferrer" class="enlace_regresar catalogosR" title="Regresar"></a>
            CAMBIOS Y DEVOLUCIONES
        </div>

        <div class="pestana_esika"></div>
        <div class="pestana_lbel"></div>
    }
}

<input type="hidden" id="hdPedidoIdActual" value="@ViewBag.Pedido_ID" />
<input type="hidden" id="hdCDRWebID" value="@ViewBag.CDR_ID" />

@if (ViewBag.Origen == "0")
{
    <div class="wrapper_resumen_mobile tipografia_lato bloqueCDRRegistro pt-50">

        <div class="content_mensaje_solicitud_enviada">
            <div class="icono_solicitud_enviada">
                <img src="@Url.Content("~/Content/Images/Esika/icono_check_esika.svg")" alt="Solicitud Enviada">
            </div>
            <div class="titulo_solicitud_enviada tipografia_lato_regular">
                ¡SOLICITUD <span class="tipografia_lato_bold">ENVIADA!</span>
            </div>
            <div class="mensaje_solicitud_enviada tipografia_lato_regular">
                Vamos a evaluarla y en un plazo de 30 minutos te enviaremos una respuesta a tu correo electrónico.
            </div>
        </div>

        <div class="detalle_solicitud_cdr">
            <div class="text-bold titulo_detalle_solicitud_cdr">
                Solicitud de Cambio y devolución
            </div>
            <div class="text-thin info_detalle_cdr">
                <div class="info_fecha_solicitud">
                    Fecha: <span class="tipografia_lato_regular">10/10/2016</span>
                </div>
                <div class="info_num_solicitud">
                    Solicitud: <span class="tipografia_lato_regular">Nº 12345678</span>
                </div>
                <div class="info_campania_solicitud">
                    Campaña: <span class="tipografia_lato_regular">2016-15</span>
                </div>
            </div>
            <div class="detalle_solicitud_listado">
                <div class="text-bold detalle_tipo_solicitud_titulo">
                    Solicitud de cambio
                </div>
                <div class="detalle_tipo_solicitud">
                    <div class="detalle_producto_cdr">
                        <span class="detalle_cod_producto tipografia_lato_regular">
                            00411
                        </span>
                        <span class="text-bold detalle_nom_producto">
                            Berrylicious shampoo rojo 375ml.
                        </span>
                        <span class="detalle_cantidad_producto tipografia_lato_regular">
                            x2 unidades
                        </span>
                        <span class="detalle_precio_producto tipografia_lato_regular">
                            S/.15.00
                        </span>
                    </div>
                    <div class="detalle_cdr_solucion">
                        <span class="text-bold detalle_cdr_solucion_titulo color_marca">
                            Cambiar por:
                        </span>
                        <span class="detalle_cod_producto tipografia_lato_regular">
                            98765
                        </span>
                        <span class="text-bold detalle_nom_producto">
                            Máscara Full Size Negro.
                        </span>
                        <span class="detalle_cantidad_producto tipografia_lato_regular">
                            x2 unidades
                        </span>
                        <span class="detalle_precio_producto tipografia_lato_regular">
                            S/.15.00
                        </span>
                    </div>
                </div>
                <div class="text-bold detalle_tipo_solicitud_titulo">
                    Solicitud de reenvío
                </div>
                <div class="detalle_tipo_solicitud">
                    <div class="detalle_producto_cdr">
                        <span class="detalle_cod_producto tipografia_lato_regular">
                            00411
                        </span>
                        <span class="text-bold detalle_nom_producto">
                            Berrylicious shampoo rojo 375ml.
                        </span>
                        <span class="detalle_cantidad_producto tipografia_lato_regular">
                            x2 unidades
                        </span>
                    </div>
                    <div class="detalle_cdr_solucion">
                        <span class="text-bold detalle_cdr_solucion_titulo color_marca">
                            Reenviar:
                        </span>
                        <span class="detalle_cdr_solucion_titulo tipografia_lato_regular">
                            el mismo producto
                        </span>
                    </div>
                </div>
                <div class="text-bold detalle_tipo_solicitud_titulo">
                    Solicitud de devolución
                </div>
                <div class="detalle_tipo_solicitud">
                    <div class="detalle_producto_cdr">
                        <span class="detalle_cod_producto tipografia_lato_regular">
                            00411
                        </span>
                        <span class="text-bold detalle_nom_producto">
                            Berrylicious shampoo rojo 375ml.
                        </span>
                        <span class="detalle_cantidad_producto tipografia_lato_regular">
                            x2 unidades
                        </span>
                    </div>
                    <div class="detalle_cdr_solucion">
                        <span class="text-bold detalle_cdr_solucion_titulo color_marca">
                            Devolución:
                        </span>
                        <span class="detalle_cdr_monto_devolucion tipografia_lato_regular">
                            S/.15
                        </span>
                    </div>
                </div>
            </div>
        </div>
        <a href="#" class="enlace_solicitudes_anteriores tipografia_lato tipografia_lato_regular" title="Ver solicitudes">
            <span class="icono_arrow_left">
                <img src="@Url.Content("~/Content/Images/mobile/left-arrow.png")" alt="Ver tus solicitudes" />
            </span>
            <span>VER TUS SOLICITUDES</span>
        </a>

    </div>
}
else if (ViewBag.Origen == "1")
{
    <div class="datos_solicitud_cdr_consulta tipografia_lato bloqueCDRDetalle">
        <div class="wrapper_resumen_mobile">
            <div class="text-bold datos_solicitud_cdr_titulo">
                Solicitud de cambios y devoluciones
            </div>
            <div class="dato_fecha_solicitud_cdr">
                <span class="text-thin">Fecha</span>
                <span class="tipografia_lato_regular">@ViewBag.FormatoFechaCulminado</span>
            </div>
            <div class="dato_num_solicitud_cdr">
                <span class="text-thin">Solicitud</span>
                <span class="tipografia_lato_regular">Nº @ViewBag.CDR_ID</span>
            </div>
            <div class="dato_campania_solicitud_cdr">
                <span class="text-thin">Campaña</span>
                <span class="tipografia_lato_regular">@ViewBag.FormatoCampania</span>
            </div>
            <div class="estado_productos_cdr">
                <span class="tipografia_lato_regular">@ViewBag.EstadoProductos</span>
            </div>
        </div>
    </div>

    <div class="wrapper_resumen_mobile tipografia_lato bloqueCDRDetalle">
        <div id="MiDetalleCDR" class="detalle_solicitud_listado mb-60">
            @{ foreach (var item in ViewBag.ListaDetalle)
                {
                    <div class="d-flex text-bold detalle_tipo_solicitud_titulo">
                        <span class="d-inline-block detalle_tipo_solicitud_icono">
                            @if (item.CodigoOperacion.Equals("D"))
                            {
                                <img src="@Url.Content("~/Content/Images/opcion_devolucion_cdr.svg")" alt="" class="opcion_cdr_icono opcion_cdr_icono--solicitudReclamo" />
                            }
                            else if (item.CodigoOperacion.Equals("T"))
                            {
                                <img src="@Url.Content("~/Content/Images/opcion_cambio_otro_producto_cdr.svg")" alt="" class="opcion_cdr_icono opcion_cdr_icono--solicitudReclamo" />
                            }
                            else if (item.CodigoOperacion.Equals("C"))
                            {
                                <img src="@Url.Content("~/Content/Images/opcion_cambio_mismo_producto_cdr.svg")" alt="" class="opcion_cdr_icono opcion_cdr_icono--solicitudReclamo" />
                            }
                            else if (item.CodigoOperacion.Equals("F"))
                            {
                                <img src="@Url.Content("~/Content/Images/opcion_cambio_mismo_producto_cdr.svg")" alt="" class="opcion_cdr_icono opcion_cdr_icono--solicitudReclamo" />
                            }
                            else if (item.CodigoOperacion.Equals("G"))
                            {
                                <img src="@Url.Content("~/Content/Images/opcion_devolucion_cdr.svg")" alt="" class="opcion_cdr_icono opcion_cdr_icono--solicitudReclamo" />
                            }
                        </span>
                        <span class="d-inline-block text-uppercase">
                            @item.SolucionSolicitada
                        </span>
                    </div>
                    <div class="detalle_tipo_solicitud">
                        <div class="detalle_producto_cdr detalle_producto_cdr--flex">
                            <div class="d-flex detalle_productos_solicitud_cdr detalle_productos_solicitud_cdr--otrosTipoDeSolicitud">
                                <div>
                                    @if (item.GrupoID != "" && item.GrupoID != null)
                                    {
                                        <span class="text-bold text-center tag_sb tag_sb--standard">Set o Pack</span>
                                    }
                                    <span class="detalle_cod_producto">
                                        @item.CUV
                                    </span>
                                    <span class="text-bold detalle_nom_producto">
                                        @item.Descripcion
                                    </span>
                                    <span class="detalle_cantidad_producto">
                                        x @item.Cantidad unidades
                                    </span>
                                    <span class="detalle_precio_producto detalle_precio_producto--relative">
                                        @ViewBag.Simbolo @item.FormatoPrecio1
                                    </span>
                                </div>
                                @if (item.CodigoOperacion.Equals("C") || item.CodigoOperacion.Equals("D") || item.CodigoOperacion.Equals("F") || item.CodigoOperacion.Equals("G"))
                                {
                                    if (item.Estado == 3)
                                    {
                                        <div>
                                            <span class="d-block text-center text-bold text-uppercase tag_sb tag__sb--estadoSolicitud estado_aprobado">
                                                Aprobado
                                            </span>
                                        </div>
                                    }
                                }
                            </div>
                        </div>
                        <div class="detalle_cdr_solucion">
                            @if (item.CodigoOperacion.Equals("C") || item.CodigoOperacion.Equals("D") || item.CodigoOperacion.Equals("F") || item.CodigoOperacion.Equals("G"))
                            {
                                @*<div class="text-bold detalle_cdr_solucion_titulo detalle_cdr_solucion_titulo_trueque">
                                    @item.Solicitud :
                                </div>*@
                                <div class="d-flex detalle_productos_solicitud_cdr detalle_productos_solicitud_cdr--otrosTipoDeSolicitud">
                                    @if (item.Estado == 4)
                                    {
                                        <div>
                                            <span class="d-block text-center text-bold text-uppercase tag_sb tag__sb--estadoSolicitud estado_rechazado">
                                                Rechazado
                                            </span>
                                        </div>
                                        <div class="d-flex w-100 border-radius-4 acciones_detalle_productos_solicitud_cdr">
                                            <div class="d-flex descripcion_acciones">
                                                <span class="d-inline-block descripcion_acciones_icono_alerta">
                                                    <img src="@Url.Content("~/Content/Images/icono_alerta_cierre_sesion.svg")" alt="" />
                                                </span>
                                                <span class="d-inline-block">
                                                    @item.Observacion
                                                    @*Eliminar este producto para procesar nuevamente tu solicitud.*@
                                                </span>
                                            </div>
                                            <div class="d-flex w-100">
                                                <a data-pedidodetalleid="@item.CDRWebDetalleID"
                                                   data-detalle-grupoid="@item.GrupoID"
                                                   data-cuv=""
                                                   href="javascript:void(0);"
                                                   onclick="misReclamos.Funciones.PreEliminarDetalle(this);"
                                                   title="Eliminar producto"
                                                   class="d-flex enlace_eliminar_producto">
                                                    <span class="d-inline-block enlace_eliminar_producto_icono">
                                                        <img src="@Url.Content("~/Content/Images/Esika/icons-trash.svg")" alt="Eliminar producto" />
                                                    </span>
                                                    <span class="d-inline-block text-underline">
                                                        Eliminar producto
                                                    </span>
                                                </a>
                                            </div>
                                        </div>
                                    }
                                </div>
                            }
                            else if (item.CodigoOperacion.Equals("T"))
                            {
                                <div class="text-bold detalle_cdr_solucion_titulo detalle_cdr_solucion_titulo_trueque">
                                    @item.Solicitud :
                                </div>
                                if (item.DetalleReemplazo != null)
                                {
                                    foreach (var el in item.DetalleReemplazo)
                                    {
                                        <div class="d-flex detalle_productos_solicitud_cdr detalle_productos_solicitud_cdr--trueque">
                                            <div class="producto_solicitud">
                                                <span class="detalle_cod_producto">
                                                    @el.CUV
                                                </span>
                                                <span class="text-bold detalle_nom_producto">
                                                    @el.Descripcion
                                                </span>
                                                <span class="detalle_cantidad_producto">
                                                    x <span name="cantidad">@el.Cantidad</span> unidades
                                                </span>
                                                <span class="detalle_precio_producto detalle_precio_producto--relative" name="precio" data-precio="@el.Precio">
                                                    @el.Simbolo @el.PrecioFormato
                                                </span>
                                            </div>
                                            @if (el.Estado == 4)
                                            {
                                                <div>
                                                    <span class="d-block text-center text-bold text-uppercase tag_sb tag__sb--estadoSolicitud estado_rechazado">
                                                        Rechazado
                                                    </span>
                                                </div>
                                                <div class="d-flex w-100 border-radius-4 acciones_detalle_productos_solicitud_cdr">
                                                    <div class="d-flex descripcion_acciones">
                                                        <span class="d-inline-block descripcion_acciones_icono_alerta">
                                                            <img src="@Url.Content("~/Content/Images/icono_alerta_cierre_sesion.svg")" alt="" />
                                                        </span>
                                                        <span class="d-inline-block">
                                                            @el.Observacion
                                                        </span>
                                                    </div>
                                                    <div class="d-flex w-100 acciones_solicitud">
                                                        <div data-cantidad-contenedor="" class="d-flex control_cantidad_producto_cdr">
                                                            <input type="tel"
                                                                   size="2"
                                                                   name="cantidad"
                                                                   data-input="cantidad"
                                                                   data-item-values='{"item_type" : "grupal", "pedido_detalle_id" : "@item.CDRWebDetalleID", "codigo_cuv" : "@el.CUV"}'
                                                                   value="@el.Cantidad"
                                                                   data-cantidad="@el.Cantidad"
                                                                   onchange="misReclamos.Funciones.ActualizarCantidad(event);"
                                                                   maxlength="2"
                                                                   class="cls_cantidad d-flex text-bold rango_cantidad_pedido ValidaNumeral ValidaPasteNumeral">
                                                            <a class="d-flex cantidad_menos_home" onclick="misReclamos.Funciones.AgregarODisminuirCantidad(event,2)"><img src="/Content/Images/Mobile/Esika/menos.png" alt=""></a>
                                                            <a class="d-flex cantidad_mas_home" onclick="misReclamos.Funciones.AgregarODisminuirCantidad(event,1)"><img src="/Content/Images/Mobile/Esika/mas.png" alt=""></a>
                                                        </div>
                                                        <a data-pedidodetalleid="@item.CDRWebDetalleID"
                                                           data-detalle-grupoid="@item.GrupoID"
                                                           data-cuv="@el.CUV"
                                                           href="javascript:void(0);"
                                                           onclick="misReclamos.Funciones.PreEliminarDetalle(this);"
                                                           title="Eliminar producto"
                                                           class="d-flex enlace_eliminar_producto">
                                                            <span class="d-inline-block enlace_eliminar_producto_icono">
                                                                <img src="@Url.Content("~/Content/Images/Esika/icons-trash.svg")" alt="Eliminar producto" />
                                                            </span>
                                                            <span class="d-inline-block text-underline">
                                                                Eliminar producto
                                                            </span>
                                                        </a>
                                                    </div>
                                                </div>
                                            }
                                            else if (el.Estado == 3)
                                            {
                                                <div>
                                                    <span class="d-block text-center text-bold text-uppercase tag_sb tag__sb--estadoSolicitud estado_aprobado">
                                                        Aprobado
                                                    </span>
                                                </div>
                                            }
                                        </div>
                                    }
                                    <div class="cls_total text-bold text-uppercase total_precio_productos_trueque">
                                        Total: <span name="total">
                                            @ViewBag.Simbolo @Util.DecimalToStringFormat(dic[item.CDRWebDetalleID],ViewBag.CodigoISODL)                                           
                                        </span>
                                    </div>
                                }
                                else if (item.Estado == 4)
                                {
                                    <div class="d-flex detalle_productos_solicitud_cdr detalle_productos_solicitud_cdr--trueque">
                                        <div class="producto_solicitud">
                                            <span class="detalle_cod_producto">
                                                @item.CUV
                                            </span>
                                            <span class="text-bold detalle_nom_producto">
                                                @item.Descripcion
                                            </span>
                                            <span class="detalle_cantidad_producto">
                                                x  <span name="cantidad">@item.Cantidad</span>  unidades
                                            </span>
                                            <span class="detalle_precio_producto detalle_precio_producto--relative" name="precio" data-precio="@item.Precio2">
                                                @ViewBag.Simbolo @item.FormatoPrecio1
                                            </span>
                                        </div>
                                        <div>
                                            <span class="d-block text-center text-bold text-uppercase tag_sb tag__sb--estadoSolicitud estado_rechazado">
                                                Rechazado
                                            </span>
                                        </div>
                                        <div class="d-flex w-100 border-radius-4 acciones_detalle_productos_solicitud_cdr">
                                            <div class="d-flex descripcion_acciones">
                                                <span class="d-inline-block descripcion_acciones_icono_alerta">
                                                    <img src="@Url.Content("~/Content/Images/icono_alerta_cierre_sesion.svg")" alt="" />
                                                </span>
                                                <span class="d-inline-block">
                                                    @item.Observacion
                                                </span>
                                            </div>
                                            <div class="d-flex w-100 acciones_solicitud">
                                                <div data-cantidad-contenedor="" class="d-flex control_cantidad_producto_cdr">
                                                    <input type="tel"
                                                           size="2"
                                                           name="cantidad"
                                                           data-input="cantidad"
                                                           data-item-values='{"item_type" : "indivudial", "pedido_detalle_id" : "@item.CDRWebDetalleID", "codigo_cuv" : "@item.CUV2"}'
                                                           value="@item.Cantidad2"
                                                           data-cantidad="@item.Cantidad2"
                                                           onchange="misReclamos.Funciones.ActualizarCantidad(event);"
                                                           maxlength="2"
                                                           class="cls_cantidad d-flex text-bold rango_cantidad_pedido ValidaNumeral ValidaPasteNumeral">
                                                    <a class="d-flex cantidad_menos_home" onclick="misReclamos.Funciones.AgregarODisminuirCantidad(event,2)"><img src="/Content/Images/Mobile/Esika/menos.png" alt=""></a>
                                                    <a class="d-flex cantidad_mas_home" onclick="misReclamos.Funciones.AgregarODisminuirCantidad(event,1)"><img src="/Content/Images/Mobile/Esika/mas.png" alt=""></a>
                                                </div>
                                                <a data-pedidodetalleid="@item.CDRWebDetalleID"
                                                   data-detalle-grupoid="@item.GrupoID"
                                                   data-cuv=""
                                                   href="javascript:void(0);"
                                                   onclick="misReclamos.Funciones.PreEliminarDetalle(this);"
                                                   title="Eliminar producto"
                                                   class="d-flex enlace_eliminar_producto">
                                                    <span class="d-inline-block enlace_eliminar_producto_icono">
                                                        <img src="@Url.Content("~/Content/Images/Esika/icons-trash.svg")" alt="Eliminar producto" />
                                                    </span>
                                                    <span class="d-inline-block text-underline">
                                                        Eliminar producto
                                                    </span>
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                }
                                else if (item.Estado == 3)
                                {
                                    <div class="d-flex detalle_productos_solicitud_cdr detalle_productos_solicitud_cdr--trueque">
                                        <div class="producto_solicitud">
                                            <span class="detalle_cod_producto">
                                                @item.CUV2
                                            </span>
                                            <span class="text-bold detalle_nom_producto">
                                                @item.Descripcion2
                                            </span>
                                            <span class="detalle_cantidad_producto">
                                                x @item.Cantidad2 unidades
                                            </span>
                                            <span class="detalle_precio_producto detalle_precio_producto--relative">
                                                @ViewBag.Simbolo @item.FormatoPrecio2
                                            </span>
                                        </div>
                                        <div>
                                            <span class="d-block text-center text-bold text-uppercase tag_sb tag__sb--estadoSolicitud estado_aprobado">
                                                Aprobado
                                            </span>
                                        </div>
                                    </div>
                                }
                                else
                                {
                                    <div class="d-flex detalle_productos_solicitud_cdr detalle_productos_solicitud_cdr--trueque">
                                        <div class="detalle_productos_solicitud_cdr">
                                            <span class="detalle_cod_producto">
                                                @item.CUV2
                                            </span>
                                            <span class="text-bold detalle_nom_producto">
                                                @item.Descripcion2
                                            </span>
                                            <span class="detalle_cantidad_producto">
                                                x @item.Cantidad2 unidades
                                            </span>
                                            <span class="detalle_precio_producto detalle_precio_producto--relative">
                                                @ViewBag.Simbolo @item.FormatoPrecio2
                                            </span>
                                        </div>
                                    </div>
                                }
                            }
                            else
                            {
                                <div class="text-bold detalle_cdr_solucion_titulo">
                                    @item.Solicitud
                                </div>
                            }
                        </div>
                    </div>
                }
            }
            @if (ViewBag.CantidadObservados > 0 || ViewBag.MostrarBotonActualizar == true)
            {
                <div class="btn_cta_wrapper">
                    <button id="btnActualizarSolicitud"
                            class="d-block text-uppercase text-bold tipografia_lato border-radius-4 btn__sb btn__sb__primary--multimarca btn__sb--continuarEnvio">
                        Actualizar solicitud
                    </button>
                </div>
            }


        </div>

    </div>
}
@section scripts{
    <script src="@Url.Content("~/Scripts/PortalConsultoras/Mobile/MisReclamos/Index.js")?v1"></script>
    <script src="@Url.Content("~/Scripts/PortalConsultoras/EstrategiaAgregar/EstrategiaAgregar.js")?v1"></script>
    <script type="text/javascript">
    var UrlDetalleEliminar = '@Url.Action("DetalleEliminar", "MisReclamos", new { area = "" })';
    var urlReclamo = '@Url.Action("Reclamo", "MisReclamos", new { area = "Mobile" } )';
      var UrlDetalleActualizarObservado = '@Url.Action("DetalleActualizarObservado", "MisReclamos", new { area = "" } )';
    </script>
}