@model Portal.Consultoras.Web.Areas.Mobile.Models.PedidoWebClientePrincipalMobilModel
@{
    Layout = "~/Areas/Mobile/Views/Shared/_MobileLayout.cshtml";
}
<div class="titulo_mobile">
    <a href="@Request.UrlReferrer" class="enlace_regresar catalogosR" title="Regresar"></a>
    PEDIDO FACTURADO
</div>

@if (Model.ListaPedidoCliente.Count == 0)
{
    <div class="">
        <div class="pestana_esika"></div><!--PESTANA ESIKA-->
        <div class="pestana_lbel"></div><!--PESTANA LBEL-->
        <div class="alert-top-icon text-success">
            <i class="icon-exclamation-circle"></i>
            <div>Hasta el momento no tienes ningún pedido facturado.</div>
        </div>
    </div>
}
else
{
    <div class="fondo_f2f2f2">
        <div class="pestana_esika"></div><!--PESTANA ESIKA-->
        <div class="pestana_lbel"></div><!--PESTANA LBEL-->
        <div class="tabs-link tab-primary upper">
            @for (int i = 0; i < Model.ListaPedidoCliente.Count; i++)
            {
                var pedidoCliente = Model.ListaPedidoCliente[i];

                <a href="javascript:;" class="mytab @( i == 0 ? "active" : "")" data-campania="@pedidoCliente.CampaniaID" style="width: @(100.00 / Model.ListaPedidoCliente.Count)%">
                    <small>Campaña</small>
                    <br />
                    <b>@pedidoCliente.CampaniaID.ToString().Substring(4)</b>
                    @pedidoCliente.CampaniaID.ToString().Substring(0, 4)
                </a>
            }
        </div>
        @for (int i = 0; i < Model.ListaPedidoCliente.Count; i++)
        {
            <div class="col-xs-12">
                <div id="divListaPedidoDetalle_@Model.ListaPedidoCliente[i].CampaniaID" style="@( i > 0 ? "display:none;" : "" )">
                </div>
            </div>
        }
    </div>
}

@section scripts{
    <script type="text/javascript">

        var primerEnvio = 0;
        var campaniaActual = "";
        var campaniasCargadas = new Array();

        $(document).ready(function () {

            $(".mytab").click(function () {

                $('.mytab.active').removeClass("active");
                $(this).addClass("active");

                var campaniaSeleccionada = $(this).attr("data-campania");

                if (campaniaActual != campaniaSeleccionada) {
                    $("#divListaPedidoDetalle_" + campaniaActual).hide();
                    $("#divListaPedidoDetalle_" + campaniaSeleccionada).show();

                    if (campaniasCargadas.indexOf(campaniaSeleccionada) > -1) {
                        campaniaActual = campaniaSeleccionada;
                        dataLayer.push({ 'event': 'virtualPage', 'pageUrl': '@Url.Action("", "PedidosFacturados", new { area = "Mobile" })' + '/' + campaniaSeleccionada, 'pageName': 'Pedidos Facturados - ' + campaniaSeleccionada });
                    } else {
                        cargarDetallePedido(campaniaSeleccionada);
                    }
                }
            });
            $('.mytab.active').trigger("click");
        });

        function cargarDetallePedido(campaniaID) {
            ShowLoading();
            jQuery.ajax({
                type: 'POST',
                url: '@Url.Action("Detalle", "PedidosFacturados", new { area = "Mobile" })',
                dataType: 'html',
                contentType: 'application/json; charset=utf-8',
                data: JSON.stringify({ campaniaID: campaniaID }),
                async: true,
                success: function (html) {
                    $("#divListaPedidoDetalle_" + campaniaID).html(html);
                    campaniaActual = campaniaID;
                    if (primerEnvio != 0) {
                        dataLayer.push({ 'event': 'virtualPage', 'pageUrl': '@Url.Action("", "PedidosFacturados", new { area = "Mobile" })' + '/' + campaniaActual, 'pageName': 'Pedidos Facturados - ' + campaniaActual });

                    }
                    primerEnvio++;
                    campaniasCargadas.push(campaniaID);
                    CloseLoading();
                },
                error: function (data, error) {
                    if (checkTimeout(data)) {
                        CloseLoading();
                        console.log(data);
                    }
                }
            });
        }
    </script>
}
