@using Portal.Consultoras.Common
@using Portal.Consultoras.Web.Areas.Mobile.Models

@model PedidoDetalleMobileModel

@{
    Layout = "~/Areas/Mobile/Views/Shared/_MobileLayout.cshtml";
}

<div class="contenedor_producto">
    <div class="content_320 ingresoPedidom">

        <div class="contenedor_detalle_pedidoIngresado">
            <div class="contenedor_resumenPedido">
                <h2 class="nombre_campania_pedido">
                    MI PEDIDO
                    <span>@Model.DescripcionCampaniaActual</span>
                </h2>

                <div id="divProductosDetalle">
                    <div class="text-center">
                        <img alt="Cargando..." src="@Url.Content("~/Content/images/Loading.gif")" />
                    </div>
                </div>
            </div>
        </div>

        <div class="tooltip_noOlvidesGuardarTuPedido" style="display: none;">
            <h2>¡Es importante que guardes tu pedido!</h2>
            <span>Puedes realizar cambios hasta el @Model.FechaFacturacionPedido</span>
        </div>

    </div>
</div>

<div class="btn_guardarPedido">
    <input type="submit" value="GUARDAR PEDIDO" id="btnGuardarPedido" name="btnGuardarPedido" onclick="EjecutarPROL();" />
</div>

<!-- START Popup para Eliminar Item -->
<div class="modal fade" id="popup-eliminar-item">
    <div class="modal-dialog modal-alert ">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true"><i class="icon-close-belcorp"></i></button>
            </div>
            <div class="modal-body">
                <div class="text-lg">
                    ¿Estás segura que quieres eliminar el producto?
                </div>
                <br />
                <div>
                    <a href="javascript:;" onclick="ConfirmaEliminarPedido();" data-dismiss="modal" class="btn btn-line">ACEPTAR</a>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- END Popup para Eliminar Item -->
<!-- START Popup para Observaciones PROL -->
<div class="modal fade" id="popup-observaciones-prol">
    <div class="modal-dialog modal-alert ">
        <div class="modal-content">
            <div class="modal-body">
                <h3 id="modal-prol-titulo" class="text-primary text-lg"></h3>
                <div id="modal-prol-contenido"></div>
                <br />
                <div id="modal-prol-botonesAceptarCancelar" style="display: none;">
                    <a href="javascript:;" onclick="AceptarObsInformativas();" class="btn btn-line btn-aceptar">ACEPTAR</a>
                    <a href="javascript:;" style="padding: 5px;"></a>
                    <a href="javascript:;" onclick="CancelarObsInformativas();" class="btn btn-line btn-aceptar">CANCELAR</a>
                </div>
                <div id="modal-prol-botoneAceptar">
                    <a href="javascript:;" data-dismiss="modal" class="btn btn-line btn-aceptar">ACEPTAR</a>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- END Popup para Observaciones PROL -->
<!-- START POPUP PERSONALIZADO 2 SEGUNDOS SE OCULTA -->
<div id="popup-eliminar-mensaje" class="modal fade" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog modal-alert ">
        <div class="modal-content">
            <div class="modal-body">
                <div id="mensajeInformacionEliminar" class="text-lg"></div>
            </div>
        </div>
    </div>
</div>
<!-- END POPUP PERSONALIZADO 2 SEGUNDOS SE OCULTA -->

<!-- START Popup para Eliminar Todo Pedido -->
<div class="modal fade" id="divConfirmEliminarTotal">
    <div class="modal-dialog modal-alert ">
        <div class="modal-content">
            <div class="modal-body">
                <h3 id="modal-prol-titulo" class="text-primary text-lg">IMPORTANTE</h3>
                <div id="modal-prol-contenido">¿Deseas eliminar el pedido completo?.</div>
                <br />
                <div id="modal-prol-botonesAceptarCancelar">
                    <a href="javascript:;" onclick="EliminarPedidoTotalNo();" class="btn btn-line btn-aceptar">NO</a>
                    <a href="javascript:;" style="padding: 5px;"></a>
                    <a href="javascript:;" onclick="EliminarPedidoTotalSi();" class="btn btn-line btn-aceptar">SI</a>
                </div>
            </div>
        </div>
    </div>
</div>

<input id="hdfPROLSinStock" type="hidden" value="0" />
<input id="hdfModificaPedido" type="hidden" value="0" />

<script id="template-Detalle" type="text/x-handlebars-template">
    <div>
        <div class="textos_resumen">
            <span>HE AGREGADO :</span>
            <span>MONTO TOTAL :</span>
            <span>MI GANANCIA :</span>
        </div>
        <div class="montos_resumen">
            <span><b class="lblCantidadProducto">{{this.CantidadProductos}}</b>&nbsp;&nbsp;PRODUCTOS</span>
            <span><b>{{Simbolo}}&nbsp;&nbsp;</b><b class="lblDescripcionTotal">{{DescripcionTotal}}</b></span>
            <span><b>{{Simbolo}}&nbsp;&nbsp;</b><b class="lblDescripcionGanancia">{{GananciaFormat}}</b></span>
        </div>
    </div>
    <div class="detalle_pedido_ingresado">
        <span class="titulo_detalle">DETALLE</span>
    </div>

    {{#IsNullOrEmpty this.MensajeCierreCampania '!='}}
    <div class="alert-top-icon text-success">
        <i class="icon-exclamation-circle"></i> <div id="divMensajeCierreCampania">{{MensajeCierreCampania}}</div>
    </div>
    {{/IsNullOrEmpty}}
    <div id="divContenidoDetalle">
        {{#each this.Detalle as |detalle|}}
        <div class="contenedor_items_pedido">
            <div class="bloque_descripcion_items_ingresados">
                <div class="descripcion_item_pedido">
                    <span class="mensaje_tipoProd">
                        {{#iff detalle.TipoPedido '==' 'M'}}
                        <br />
                        <small><span class="text-success">App móvil</span></small>
                        {{/iff}}

                        {{#iff detalle.ConfiguracionOfertaID '==' @Constantes.TipoOferta.Liquidacion}}
                        <br />
                        <small><span class="text-success">Oferta Liquidación</span></small>
                        {{else iff detalle.ConfiguracionOfertaID '==' @Constantes.TipoOferta.Flexipago}}
                        <br />
                        <small><span class="text-success">Oferta Flexipago</span></small>
                        {{else iff detalle.TipoOfertaSisID '==' @Constantes.ConfiguracionOferta.ShowRoom}}
                        <br />
                        <small><span class="text-success">Pre-venta Digital</span></small>
                        {{else}}
                        {{#IsNullOrEmpty detalle.DescripcionOferta '!='}}
                        <br />
                        <label for="{{detalle.DescripcionOferta}}">{{Replace (Replace detalle.DescripcionOferta '[' '') ']' ''}}</label>
                        {{/IsNullOrEmpty}}
                        {{/iff}}
                    </span>
                    <span class="cod_prod">{{detalle.CUV}}</span>
                    <span class="desc_prod">
                        {{#iff detalle.IndicadorMontoMinimo '==' 0}}
                        <span class="texto_rojo">*</span>
                        {{/iff}}
                        <span id="DescripcionProducto_{{detalle.PedidoDetalleID}}">{{Split detalle.DescripcionProd '|' 0}}</span>
                    </span>
                    <span class="nom_cliente">Cliente: {{detalle.Nombre}}</span>
                </div>
                <div class="icono_eliminar_item_pedido">
                    <a href="javascript:;" title="Eliminar" onclick="EliminarPedidoEvento(event)" data-pedidodetalleid="{{detalle.PedidoDetalleID}}">
                        <img src="@Url.Content("~/Content/Images/Esika/tacho-copy.png")" alt="Eliminar" />
                    </a>
                </div>
            </div>
            <div style="display: none;">
                <input type="hidden" id="PrecioUnidad_{{detalle.PedidoDetalleID}}" name="PrecioUnidad_{{detalle.PedidoDetalleID}}" value="{{detalle.PrecioUnidad}}">
                <input type="hidden" id="ClienteID_{{detalle.PedidoDetalleID}}" name="ClienteID_{{detalle.PedidoDetalleID}}" value="{{detalle.ClienteID}}">
                <input type="hidden" id="ClienteNombre_{{detalle.PedidoDetalleID}}" name="ClienteNombre_{{detalle.PedidoDetalleID}}" value="{{detalle.Nombre}}">
                <input type="hidden" id="CantidadTemporal_{{detalle.PedidoDetalleID}}" name="CantidadTemporal_{{detalle.PedidoDetalleID}}" value="{{detalle.Cantidad}}">

                <input type="hidden" id="CampaniaID_{{detalle.PedidoDetalleID}}" name="CampaniaID_{{detalle.PedidoDetalleID}}" value="{{detalle.CampaniaID}}">
                <input type="hidden" id="PedidoID_{{detalle.PedidoDetalleID}}" name="PedidoID_{{detalle.PedidoDetalleID}}" value="{{detalle.PedidoID}}">
                <input type="hidden" id="TipoOfertaSisID_{{detalle.PedidoDetalleID}}" name="TipoOfertaSisID_{{detalle.PedidoDetalleID}}" value="{{detalle.TipoOfertaSisID}}">
                <input type="hidden" id="CUV_{{detalle.PedidoDetalleID}}" name="CUV_{{detalle.PedidoDetalleID}}" value="{{detalle.CUV}}">

                <input type="hidden" id="DescripcionProd_{{detalle.PedidoDetalleID}}" name="DescripcionProd_{{detalle.PedidoDetalleID}}" value="{{Split detalle.DescripcionProd '|' 0}}">
                <input type="hidden" id="PrecioUnidad_{{detalle.PedidoDetalleID}}" name="PrecioUnidad_{{detalle.PedidoDetalleID}}" value="{{detalle.PrecioUnidad}}">
                <input type="hidden" id="MarcaID_{{detalle.PedidoDetalleID}}" name="MarcaID_{{detalle.PedidoDetalleID}}" value="{{detalle.MarcaID}}">
                <input type="hidden" id="DescripcionOferta_{{detalle.PedidoDetalleID}}" name="DescripcionOferta_{{detalle.PedidoDetalleID}}" value="{{detalle.DescripcionOferta}}">
            </div>
            <div class="bloque_cantidades_precios_items_ingresados">
                <div class="contenedor_cantidadProductos">
                    <div data-cantidad-contenedor="">
                        @*<span class="signo_menos" data-cantidad-agregar="-">
                            <img src="/Content/Images/Mobile/Esika/menos.png">
                        </span>*@
                        <div class="campo_cantidadProductos">
                            {{#iff detalle.TipoEstrategiaID '==' 1}}
                            <input type="text"
                                   class="ValidaNumeral"
                                   id="Cantidad_{{detalle.PedidoDetalleID}}"
                                   maxlength="2"
                                   name="Cantidad_{{detalle.PedidoDetalleID}}"
                                   onblur="UpdateLiquidacionEvento(event)"
                                   onkeypress="return FuncionesGenerales.ValidarSoloNumeros(event);"
                                   value="{{detalle.Cantidad}}"
                                   data-pedidodetalleid="{{detalle.PedidoDetalleID}}"
                                   data-cantidad-input="-"
                                   readonly="readonly">
                            {{else}}
                            <input type="text"
                                   class="ValidaNumeral"
                                   id="Cantidad_{{detalle.PedidoDetalleID}}"
                                   maxlength="2"
                                   name="Cantidad_{{detalle.PedidoDetalleID}}"
                                   onblur="UpdateLiquidacionEvento(event)"
                                   onkeypress="return FuncionesGenerales.ValidarSoloNumeros(event);"
                                   value="{{detalle.Cantidad}}"
                                   data-pedidodetalleid="{{detalle.PedidoDetalleID}}"
                                   data-cantidad-input="-">
                            {{/iff}}
                        </div>
                        @*<span class="signo_mas" data-cantidad-agregar="+">
                            <img src="/Content/Images/Mobile/Esika/mas.png">
                        </span>*@
                        <div class="clear"></div>
                    </div>
                </div>
                <div class="precios_item">
                    <span class="precio_normal_pedido">
                        <span>{{../Simbolo}} {{detalle.PrecioUnidad}}</span>
                    </span>
                    <span class="precio_oferta_pedido">
                        <!-- ICONO ADVERTENCIA -->
                        {{#if detalle.IndicadorOfertaCUV}}
                        {{#if detalle.PedidoConDescuentoCuv}}
                        <span class="icono_advertencia_notificacion"></span>
                        {{/if}}
                        {{/if}}
                        <!-- FIN ICONO ADVERTENCIA -->
                        <span>{{../Simbolo}} <label id="ImporteTotal_{{detalle.PedidoDetalleID}}">{{detalle.ImporteTotal}}</label></span>
                    </span>
                </div>
            </div>

            @*{{#if detalle.IndicadorOfertaCUV}}
                    {{#if detalle.PedidoConDescuentoCuv}}
                        <div class="alert-top-icon text-success">
                            <div class="text-left">
                                El precio total no incluye el descuento para ofertas con más de
                                un precio (1x, 2x). Al validar tu pedido, el sistema elegirá la
                                mejor combinación de precios posibles para ti.
                            </div>
                        </div>
                    {{/if}}
                {{/if}}*@

            {{#IsNullOrEmpty detalle.Mensaje '!='}}
            <div class="notificacion_productoAgotado">
                <small>
                    {{#iff detalle.TipoObservacion '!=' 0}}
                    {{{Replace detalle.Mensaje '¿Deseas aceptar el reemplazo?' ''}}}
                    {{else}}
                    {{detalle.Mensaje}}
                    {{/iff}}
                </small>
            </div>
            {{/IsNullOrEmpty}}
        </div>
        {{/each}}
    </div>

    <div class="separador"></div>
    <div>
        <div class="textos_resumen">
            <span>HE AGREGADO :</span>
            <span>MONTO TOTAL :</span>
            <span>MI GANANCIA :</span>
        </div>
        <div class="montos_resumen">
            <span><b class="lblCantidadProducto">{{CantidadProductos}}</b>&nbsp;&nbsp;PRODUCTOS</span>
            <span><b>{{Simbolo}}&nbsp;&nbsp;</b><b class="lblDescripcionTotal">{{DescripcionTotal}}</b></span>
            <span><b>{{Simbolo}}&nbsp;&nbsp;</b><b>{{GananciaFormat}}</b></span>
        </div>
    </div>

    <div class="mensajes_adicionales_ingresoPedido" id="iconoAdvertenciaNotificacion" style="display: none;">
        <!-- ICONO ADVERTENCIA -->
        <span class="icono_advertencia_notificacion"></span>
        <!-- FIN ICONO ADVERTENCIA -->
        <span class="detalle_mensajeAdicional">
            El precio total no incluye el descuento para ofertas con más de un precio (1x, 2x).<br />
            Al validar tu pedido, el sistema elegirá la mejor combinación de precios posibles para ti.
        </span>
    </div>
    <div class="mensaje_eliminarPedido">
        <span>
            Para eliminar el pedido completo
            <a href="javascript:;" title="Haz click aquí" onclick="PedidoDetalleEliminarTodoConfirmar()">haz click aquí</a>
        </span>
    </div>
</script>

@section Scripts{
<script type="text/javascript" src="@Url.Content("~/Scripts/handlebars.min.js")"></script>
    <script type="text/javascript">

        var codigoIsoPais = '@Model.CodigoISO';
        var mensajeGuardarCO = '@Model.MensajeGuardarCO';
        var menuNotificaciones = '@ViewBag.MenuNotificaciones';
        var falgValidacionPedido = '@Model.FlagValidacionPedido';
        var ofertaLiquidacion = '@Constantes.ConfiguracionOferta.Liquidacion';
        var ofertaShowRoom = '@Constantes.ConfiguracionOferta.ShowRoom';
        var ofertaAccesorizate = '@Constantes.ConfiguracionOferta.Accesorizate';

        var urlEjecutarServicioPROL = '@Url.Action("EjecutarServicioPROL", "Pedido", new {area = "Mobile"})';
        var urlPedidoValidado = '@Url.Action("Validado", "Pedido", new {area = "Mobile"})';
        var urlHorarioRestringido = '@Url.Action("EnHorarioRestringido", "Pedido", new {area = ""})';

        var urlValidarUnidadesPermitidasPedidoProductoShowRoom = '@Url.Action("ValidarUnidadesPermitidasPedidoProducto", "ShowRoom", new {area = ""})';
        var urlObtenerStockActualProductoShowRoom = '@Url.Action("ObtenerStockActualProducto", "ShowRoom", new {area = ""})';
        var urlValidarUnidadesPermitidasPedidoProducto = '@Url.Action("ValidarUnidadesPermitidasPedidoProducto", "OfertaLiquidacion", new {area = ""})';
        var urlObtenerStockActualProducto = '@Url.Action("ObtenerStockActualProducto", "OfertaLiquidacion", new {area = ""})';
        var urlValidarUnidadesPermitidasPedidoProducto2 = '@Url.Action("ValidarUnidadesPermitidasPedidoProducto", "Accesorizate", new {area = ""})';
        var urlObtenerStockActualProducto2 = '@Url.Action("ObtenerStockActualProducto", "Accesorizate", new {area = ""})';

        var urlValidarStockEstrategia = '@Url.Action("ValidarStockEstrategia", "Pedido", new {area = ""})';
        var urlPedidoUpdate = '@Url.Action("Update", "Pedido", new {area = ""})';
        var urlPedidoDelete = '@Url.Action("Delete", "Pedido", new {area = ""})';
        var urlPedidoDeleteAll = '@Url.Action("DeleteAll", "Pedido", new { area = "" })';
        var urlInsertarDesglose = '@Url.Action("InsertarDesglose", "Pedido", new {area = ""})';
        var urlDeshacerReservaPedidoReservado = '@Url.Action("DeshacerReservaPedidoReservado", "Pedido", new {area = ""})';
        var urlActualizarCantidadTotalPedido = '@Url.Action("CalcularTotal", "Pedido", new {area = "Mobile"})';
        
        var urlDetallePedido = '@Url.Action("CargarDetallePedido", "Pedido", new { area = "Mobile" })';
        var urlReservadoOEnHorarioRestringido = '@Url.Action("ReservadoOEnHorarioRestringido", "Pedido", new { area = "" })';
        var fnEliminarProducto = null;
        
    </script>
<script src="@Url.Content("~/Scripts/PortalConsultoras/Mobile/Pedido/Detalle.js")"></script>
}