@using Portal.Consultoras.Common
@using Portal.Consultoras.Web.Areas.Mobile.Models

@model PedidoMobileModel

@{
    Layout = "~/Areas/Mobile/Views/Shared/_MobileLayout.cshtml";
}
@section styles
{
    <link href="@Url.Content("~/Content/Css/Site/slick.css")" rel="stylesheet" />
}
<div class="wrapper_resumen_mobile sin_padding">
    <!-- BANNERS INGRESO DE PEDIDO -->
    <div class="banner_ingresoPedido">
        <div class="content_320 ingresoPedido">
            <h1>INGRESA TU PEDIDO C@(Model.CampaniaNro)</h1>
            <form>
                <input type="text" name="codigoProducto" value="" placeholder="Ingresa el código del producto" id="txtCodigoProducto" />
            </form>
        </div>
    </div>
    <!-- FIN BANNERS INGRESO DE PEDIDO -->

    <div class="franja_inferior_banner_pedido"></div>

    <!-- MENSAJES CUV -->
    <div style="display:none;" class="mensaje_ingreso_cuvs" id="divMensajeCUV">
        <span id="divIcono" class="icono_aprobacion"></span>
        <span id="divMensaje" class="mensaje_productoCUV">
        </span>
    </div>
    <!-- FIN MENSAJES CUV -->

    <div class="contenedor_producto">
        <div class="content_320 ingresoPedidom">

            <!-- SECCIÓN CONTENIDO INGRESO DE PEDIDO -->
            <div id="divProductoMantenedor" style="display: none;">
                <div style="display: none;">
                    <input type="hidden" id="hdfCUV" />
                    <input type="hidden" id="hdTipoOfertaSisID" />
                    <input type="hidden" id="hdConfiguracionOfertaID" />
                    <input type="hidden" id="hdfDescripcionCategoria" />
                    <input type="hidden" id="hdfDescripcionEstrategia" />
                    <input type="hidden" id="hdfDescripcionMarca" />
                    <input type="hidden" id="hdfIndicadorMontoMinimo" />
                    <input type="hidden" id="hdfMarcaID" />
                    <input type="hidden" id="hdfPrecioUnidad" />
                    <input type="hidden" id="hdfDescripcionProd" />
                    <input type="hidden" id="hdCuvRecomendado" />
                    <input type="hidden" id="hdTipoEstrategiaID" />
                    <input type="hidden" id="hdCuvEnSession" value="@Session["CUVProductoDesctacado"]" />
                    <input type="hidden" id="hdfValorFlagNueva" />
                    <input type="hidden" id="hdLimiteVenta" />
                </div>
                <div id="divProductoObservaciones"></div>
                <div id="divProductoInformacion">
                    <div class="nombreProducto" id="divNombreProducto"></div>
                    <div class="precioProducto">
                        <span id="spnTextoPrecio"></span>
                        @*<span class="precioNormal">S/. 00.00</span>*@
                        <span class="precioOferta" id="spnPrecio"></span>
                    </div>
                    <div class="contenedor_cantidadProductos">
                        <span class="textoCantidad">CANTIDAD:</span>
                        <div>
                            <span class="signo_menos" id="resta">
                                <img src="/Content/Images/Mobile/Esika/menos.png">
                            </span>
                            <div class="campo_cantidadProductos">
                                <input type="text" name="cantidad" value="1" id="txtCantidad" />
                            </div>
                            <span class="signo_mas" id="suma">
                                <img src="/Content/Images/Mobile/Esika/mas.png">
                            </span>
                            <div class="clear"></div>
                        </div>
                    </div>
                    <div class="contenedor_seleccionCliente">
                        @Html.DropDownListFor(model => model.Nombre, new SelectList(Model.ListaClientes, "ClienteID", "Nombre"), new { id = "ddlClientes", @required = "required" })
                        <a href="#" class="btn_agregarCliente" id="linkAgregarCliente">
                            AGREGAR CLIENTE <span>+</span>
                        </a>
                    </div>
                </div>
            </div>
            <!-- FIN CONTENIDO INGRESO DE PEDIDO -->
            <!-- SECCIÓN CONTENIDO RESUMEN DE PEDIDO -->
            <div id="divResumenPedido">
                <div class="contenedor_resumenPedido">
                    <div class="textos_resumen">
                        <span>HE AGREGADO :</span>
                        <span>MONTO TOTAL :</span>
                        <span>MI GANANCIA :</span>
                    </div>
                    <div class="montos_resumen">
                        <span><b id="spnCantidadProductos">@Model.CantidadProductos</b>&nbsp;&nbsp;PRODUCTOS</span>
                        <span><b>@Model.Simbolo&nbsp;&nbsp;</b><b id="spnDescripcionTotal">@Model.DescripcionTotal</b></span>
                        <span><b>@Model.Simbolo&nbsp;&nbsp;</b><b data-ganancia="">@Model.GananciaFormat</b></span>
                    </div>
                </div>
                <button type="button" class="btn_verMiPedido">
                    VER MI PEDIDO
                </button>
            </div>
            <!-- FIN CONTENIDO RESUMEN DE PEDIDO -->

        </div>
    </div>
    <!--INICIO CARRUSEL-->
    <div class="fondo_gris" id="divListaEstrategias">
        <div class="titulo_ofertas_home">
            OFERTAS <b>PARA TI @(Model.NombreConsultora.ToUpper())</b>
            <div class="texto_exclusivo">
                EXCLUSIVO SÓLO POR WEB
            </div>
        </div>
        <div class="contenedor_carrusel_home">
            <!--CONTENEDOR ITEM CARRUSEL-->
            <div id="divContenidoEstrategias">
                <div style="text-align: center;">Cargando Productos Destacados<br><img src="@Url.Content("~/Content/Images/Loading.gif")" /><br /></div>
            </div>
        </div>
    </div>
    <!--FIN CARRUSEL-->

    <div class="btn_agregarPedido">
        <input type="submit" value="AGREGALO A TU PEDIDO" id="btnAgregarProducto" name="btnAgregarProducto" style="display:none;" />
    </div>

    <div class="alert alert-success alert-full" style="display: none;" id="divMensajeProductoAgregado">
        <img src="@Url.Content("~/Content/Images/mobile/img-icon/alert-success.png")" alt="Alert" class="img-responsive" />
        <p>Producto <br /> Agregado</p>
    </div>
</div>
<input type="hidden" id="hdTipoEstrategiaID" value="0" />

<!-- DIV PARA FUNCIONALIDAD DE AGREGAR PRODUCTO DESDE CAROUSEL HORIZONTAL-->
<div id="divVistaPrevia" class="Content_modal_ZE" style="display: none; background-color: #fff; overflow: hidden;">
    <div class="Content_modal_ZE texto-centrado" style="overflow: hidden;">
        <div style="position: absolute; width: 100%;">
            <img id="imgTipoOfertaEdit" style="float: left;" src="">
        </div>
        <div style="position: absolute; width: 100%;">
            <img id="imgEstrellaEdit" style="float:left; margin-top:10px; width:23px; height:23px; margin-left:10px" src="">
        </div>
        <img id="imgZonaEstrategiaEdit" style="height: 200px; margin: 5px;" src="" alt="Imagen Producto" />
    </div>
    <br />
    <div class="zona0Edit pedidos_datos_titulo"></div>
    <div class="zona1Edit pedidos_datos_info texto-centrado" style="width:100%"></div>
    <div class="zona2Edit texto-centrado"></div>
    <div class="zona3Edit_1 pedidos_para_ti texto-centrado"></div>
    <div class="zona3Edit_2 liquidacion_precio texto-centrado"></div>
    <br />
    <ul id="OfertasResultados" class="listaOfertas"></ul>
    <div class="zona4Edit zona_estrategia_4 texto-centrado"></div>
    <div class="zonaCantidad texto-centrado">
        <table style="margin: 0 auto;" cellpadding="10" cellspacing="10">
            <tr>
                <td style="vertical-align: middle;">Unidades: &nbsp;&nbsp;</td>
                <td>
                    <div class="liquidacion_rango_home">
                        <input type="text" value="1" size="2" maxlength="2" class="liquidacion_rango_cantidad_pedido ValidaNumeral" name="txtCantidadZE" id="txtCantidadZE" />
                        <div class="liquidacion_rango_right_pedido">
                            <a class="mas"><img src="" alt="" /></a>
                            <a class="menos"><img src="" alt="" /></a>
                        </div>
                    </div>
                </td>
            </tr>
            <tr class="tallaColor">
                <td style="vertical-align: middle;">Talla/Color: &nbsp;&nbsp;</td>
                <td>
                    <select id="ddlTallaColor" style="width: 130px; height: 30px; border: 1px solid #cccccc;"></select>
                </td>
            </tr>
        </table>
    </div>
</div>
<!-- DIV PARA FUNCIONALIDAD DE AGREGAR PRODUCTO DESDE CAROUSEL HORIZONTAL-->

<script id="html-estrategia" type="text/x-handlebars-template">
    {{#each this.ListaEstrategias as |detalle|}}
    <div class="content_item_home" data-item="item">
        <input type="hidden" class="valorCuv" value="{{detalle.CUV2}}" />
        <input type="hidden" class="valorPosicion" value="{{detalle.ID}}" />
        <input type="hidden" class="valorPosicionCarrusel" value="{{detalle.PosicionCarrusel}}" />
        <input type="hidden" class="valorFlagNueva" value="{{detalle.FlagNueva}}" />

        <div class="producto_img_mobile">
            <img src="{{detalle.FotoProducto01}}" alt="{{detalle.DescripcionCUV2}}">
        </div>
        {{#if_eq FlagMostrarImg '1'}}
        {{#if_eq TipoEstrategiaImagenMostrar '@Portal.Consultoras.Common.Constantes.TipoEstrategia.PackNuevas'}}
        {{#iff EtiquetaID 'ContainsArray' '[1,2,3]'}}      <!--SB20-351 -->
        <div class="etiqueta_producto">
            <img src="{{ImagenURL}}" alt="Etiqueta Producto" />
        </div>
        {{/iff}}
        {{else if_eq TipoEstrategiaImagenMostrar '@Portal.Consultoras.Common.Constantes.TipoEstrategia.Lanzamiento'}}
        <div class="etiqueta_producto">
            <img src="{{ImagenURL}}" alt="Etiqueta Producto" />
        </div>

        {{else if_eq TipoEstrategiaImagenMostrar '@Portal.Consultoras.Common.Constantes.TipoEstrategia.OfertaParaTi'}}
        {{#if_eq FlagEstrella '1' }}
        <div class="etiqueta_producto">
            <img src="@Url.Content("~/Content/Images/oferta-ultimo-minuto.png")" alt="Etiqueta Producto" />
        </div>
        {{/if_eq}}
        {{/if_eq}}
        {{/if_eq}}
        <div class="producto_nombre_descripcion">
            <h6>LBel</h6>
            {{#if_eq FlagNueva '1'}}
            <p class="nombre_producto">
                {{detalle.DescripcionCUVSplit}}
            </p>
            {{else}}
            <p class="nombre_producto">
                {{detalle.DescripcionCUV2}}
            </p>
            {{/if_eq}}
            <div class="producto_precio">
                <span class="producto_precio_oferta"><b>{{detalle.Simbolo}} {{detalle.PrecioString}}</b></span>
            </div>

            <div class="liquidacion_rango_home">
                <a class="cantidad_menos_home"><img src="/Content/Images/Mobile/Esika/menos.png" alt=""></a>
                <input type="text" value="1" size="2" maxlength="2" id="txtCantidad" class="rango_cantidad_pedido ValidaNumeral">
                <a class="cantidad_mas_home"><img src="/Content/Images/Mobile/Esika/mas.png" alt=""></a>
            </div>
            <div class="clear"></div>
            <a class="boton_Agregalo_home btnAgregarEstrategia" onclick="javascript:CargarProductoDestacado({ EstrategiaID: '{{EstrategiaID}}' , TipoEstrategiaID: '{{TipoEstrategiaID}}' , Posicion: 0 , FlagNueva: '{{FlagNueva}}' }, this); ">
                AGRÉGALO
            </a>
        </div>
    </div>
    {{/each}}
</script>

@section scripts
{
    <script type="text/javascript" src="@Url.Content("~/Scripts/slick-vertical.min.js")"></script>
    <script type="text/javascript">

        //Mensajes CUV
        var mensajeCUVNoExiste = "Lo sentimos, el producto solicitado no existe.";
        var mensajeCUVAgotado = "Lo sentimos, se nos agotó este producto.";
        if (isEsika) {
            var mensajeCUVOfertaEspecial = "Este producto está en la Guía de Negocio Ésika con oferta especial."
        } else {
            var mensajeCUVOfertaEspecial = "Este producto está en la revista <b>Somos Belcorp</b> con oferta especial."
        }
        var mensajeCUVLiquidacion = "Este producto solo lo puedes agregar a tu pedido desde la página de <a href=" + '@(Url.Action("Index", "OfertaLiquidacion", new { area = "Mobile"}))' + ">Liquidación Web.</a>";
        var mensajeCUVCantidadMaxima = "Ya ingresaste la cantidad máxima permitida de este producto (#)";

        var cantProductosLoad = 'Model.ListaEstrategias.Count';
        var posicion = -1;
        var posicionAnteriorPrimeraEstrategia = 0;
        var posicionAnteriorUltimaEstrategia = 0;
        var esTipoDrag = 0;
        var ofertaLiquidacion = '@Constantes.ConfiguracionOferta.Liquidacion';
        var ofertaAccesorizate = '@Constantes.ConfiguracionOferta.Accesorizate';

        var urlFindByCUV = '@Url.Action("FindByCUV", "Pedido", new {area = ""})';
        var urlObtenerMarcaEstrategia = '@Url.Action("ObtenerMarcaEstrategia", "Pedido", new {area = "Mobile"})';
        var urlIngresoFAD = '@Url.Action("IngresoFAD", "Pedido", new {area = ""})';
        var urlValidarStockEstrategia = '@Url.Action("ValidarStockEstrategia", "Pedido", new {area = ""})';
        var urlReservadoOEnHorarioRestringido = '@Url.Action("ReservadoOEnHorarioRestringido", "Pedido", new { area = "" })';
        var urlInsertOfertaNueva = '@Url.Action("AgregarProductoZE", "Pedido", new {area = ""})';
        var urlInsert = '@Url.Action("Insert", "Pedido", new {area = ""})';
        var urlRefrescarPedidoOfertaNuevaActual = '@Url.Action("RefrescarPedidoOfertaNuevaActual", "Pedido", new {area = "Mobile"})';
        var urlCargarListaEstrategia = '@Url.Action("CargarListaEstrategias", "Pedido", new { area = "Mobile" })';
        var urlCalcularTotal = '@Url.Action("CalcularTotal", "Pedido", new {area = "Mobile"})';

        var urlCarruselPrev = "@Url.Content("~/Content/Images/mobile/Esika/previous_ofertas_home.png")";
        var urlCarruselNext = "@Url.Content("~/Content/Images/mobile/Esika/next.png")";

        var urlValidarUnidadesPermitidasPedidoProducto = '@Url.Action("ValidarUnidadesPermitidasPedidoProducto", "Accesorizate", new {area = ""})';
        var urlObtenerStockActualProducto = '@Url.Action("ObtenerStockActualProducto", "Accesorizate", new {area = ""})';
        var urlEnHorarioRestringido = '@Url.Action("EnHorarioRestringido", "Pedido", new {area = ""})';
        var urlSesionExperirada = '@Url.Content("~/SesionExpirada.html")';
        var paisIDSesion = '@Model.PaisId';
        var urlValidarExistenciaOfertaNueva = '@Url.Action("ValidarExistenciaOfertaNuevaAnterior", "Pedido", new {area = "Mobile"})';

        var urlValidadoPedido = '@Url.Action("Validado", "Pedido", new { area = "Mobile" })';
        var urlFiltrarEstrategiasPedido = '@Url.Action("FiltrarEstrategiaPedido", "AdministrarEstrategia", new { area = "" })';
        var urlAgregarProducto = '@Url.Action("AgregarProductoZE", "Pedido", new { area = "" })';

        var esShowRoom = '@Session["EsShowRoom"]';
        var simbolo = '@Model.Simbolo';
        var urlLoad = '@Url.Content("~/Content/Images/Loading.gif")';
    </script>
    <script src="@Url.Content("~/Scripts/PortalConsultoras/Mobile/Pedido/index.js")"></script>
}
