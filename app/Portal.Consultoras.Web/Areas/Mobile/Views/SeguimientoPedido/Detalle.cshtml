@using Portal.Consultoras.Web.Areas.Mobile.Models
@model SeguimientoMobileModel

@if (ViewBag.MensajeError == null)
{
    if (Model.ListaEstadoSeguimiento.Count == 0)
    {
        <div class="col-xs-12">
            <div class="icono_alerta exclamacion_icono_mobile"></div>
            <div class="mensaje_alerta">Hasta el momento no tienes ningún seguimiento de pedido.</div>
        </div>
    }
    else
    {
        var anioCampania = Model.Campana.ToString().Substring(0, 4);
        var mesCampania = Model.Campana.ToString().Substring(4, 2);
        var fecha = Model.Fecha.HasValue ? Model.Fecha.Value.ToString("dd/MM/yyyy") : "Sin Fecha";
        var estado01Recibido = Model.ListaEstadoSeguimiento.FirstOrDefault(p => p.Etapa == 1);
        var estado02Facturado = Model.ListaEstadoSeguimiento.FirstOrDefault(p => p.Etapa == 2);
        var estado03Armado = Model.ListaEstadoSeguimiento.FirstOrDefault(p => p.Etapa == 3);
        var estado04Embarque = Model.ListaEstadoSeguimiento.FirstOrDefault(p => p.Etapa == 5);
        var estado05EntregaProyectada = Model.ListaEstadoSeguimiento.FirstOrDefault(p => p.Etapa == 6);
        var estado06Entregado = Model.ListaEstadoSeguimiento.FirstOrDefault(p => p.Etapa == 7);
        var contador = 0;

        <div class="block-seguimiento">
            <div class="title-seg"><span class="num-camp-seg"><strong> C-@mesCampania </strong></span></div>
            <div class="text-right info-seg">
                Estado <strong>@Model.Estado</strong><br />
                Nro. de pedido <strong>@Model.NumeroPedido</strong><br />
                Pedido recibido <strong>@fecha</strong>
            </div>
        </div>

        <div class="block-seguimiento-content block-seguimiento-content--mobile">
            <div class="col-xs-12" style="padding-left: 0px; padding-right: 0px">
                @if (estado01Recibido != null)
                {
                    var esActual01 = Model.Estado == "PENDIENTE A FACTURAR";
                    var estaActivo01 = estado01Recibido.Fecha.HasValue;
                    var claseIcono01 = esActual01 ? "seg-current" : estaActivo01 ? "seg-active" : "";
                    contador += 1;

                    <div class="col-xs-4">
                        <div class="seg-item seg-next-icon @claseIcono01">
                            <h3 class="seg-title text-center">@contador<br />Recibido</h3>
                            <span class="seg-icon">
                                <i class="icon-seg icon-caja-open"></i>
                            </span>
                            <div class="seg-hora-fecha">
                                <div class="seg-fecha">
                                    @if (estaActivo01)
                                    {
                                        @estado01Recibido.DiaMes
                                    }
                                </div>
                                <div class="seg-hora">
                                    @if (estaActivo01)
                                    {
                                        @estado01Recibido.HoraMinuto
                                    }
                                </div>
                            </div>
                        </div>
                    </div>
                }

                @if (estado02Facturado != null)
                {
                    var esActual02 = Model.Estado == "SIN ARMAR";
                    var estaActivo02 = estado02Facturado.Fecha.HasValue;
                    var claseIcono02 = esActual02 ? "seg-current" : estaActivo02 ? "seg-active" : "";
                    contador += 1;

                    <div class="col-xs-4">
                        <div class="seg-item seg-next-icon @claseIcono02">
                            <h3 class="seg-title text-center">@contador<br />Facturado</h3>
                            <span class="seg-icon">
                                <i class="icon-seg icon-factura"></i>
                            </span>
                            <div class="seg-hora-fecha">
                                <div class="seg-fecha">
                                    @if (estaActivo02)
                                    {
                                        @estado02Facturado.DiaMes
                                    }
                                </div>
                                <div class="seg-hora">
                                </div>
                            </div>
                        </div>
                    </div>
                }

                @if (estado03Armado != null)
                {
                    var esActual03 = Model.Estado == "EN ARMADO";
                    var estaActivo03 = estado03Armado.Fecha.HasValue;
                    var claseIcono03 = esActual03 ? "seg-current" : estaActivo03 ? "seg-active" : "";
                    contador += 1;

                    <div class="col-xs-4">
                        <div class="seg-item @claseIcono03">
                            <h3 class="seg-title text-center">@contador<br />Armado</h3>
                            <span class="seg-icon">
                                <i class="icon-seg icon-caja-armar"></i>
                            </span>
                            <div class="seg-hora-fecha">
                                <div class="seg-fecha">
                                    @if (estaActivo03)
                                    {
                                        @estado03Armado.DiaMes
                                    }
                                </div>
                                <div class="seg-hora">
                                    @if (estaActivo03)
                                    {
                                        @estado03Armado.HoraMinuto
                                    }
                                </div>
                            </div>
                        </div>
                    </div>
                }
            </div>
            <div class="col-xs-12" style="padding-left: 0px; padding-right: 0px">
                @if (estado04Embarque != null)
                {
                    var esActual04 = Model.Estado == "EN TRANSPORTE";
                    var estaActivo04 = estado04Embarque.Fecha.HasValue;
                    var claseIcono04 = esActual04 ? "seg-current" : estaActivo04 ? "seg-active" : "";
                    contador += 1;

                    <div class="col-xs-4">
                        <div class="seg-item seg-next-icon @claseIcono04">
                            <h3 class="seg-title text-center">@contador<br />Embarque</h3>
                            <span class="seg-icon">
                                <i class="icon-seg icon-pedido-envio"></i>
                            </span>
                            <div class="seg-hora-fecha">
                                <div class="seg-fecha">
                                    @if (estaActivo04)
                                    {
                                        @estado04Embarque.DiaMes
                                    }
                                </div>
                                <div class="seg-hora">
                                    @if (estaActivo04)
                                    {
                                        @estado04Embarque.HoraMinuto
                                    }
                                </div>
                            </div>
                        </div>
                    </div>
                }

                @if (estado05EntregaProyectada != null)
                {
                    var esActual05 = Model.Estado == "EN CHEQUEO";
                    var estaActivo05 = estado05EntregaProyectada.Fecha.HasValue;
                    estado05EntregaProyectada.ValorTurno = estado05EntregaProyectada.ValorTurno ?? "";
                    var turno = estado05EntregaProyectada.ValorTurno.ToUpper().Equals("AM") || estado05EntregaProyectada.ValorTurno.ToUpper().Equals("PM") ? estado05EntregaProyectada.ValorTurno : string.Empty;
                    var claseIcono05 = esActual05 ? "seg-current" : estaActivo05 ? "seg-active" : "";
                    contador += 1;

                    <div class="col-xs-4">
                        <div class="seg-item seg-next-icon @claseIcono05">
                            <h3 class="seg-title text-center">@contador<br />Entrega Proyectada</h3>
                            <span class="seg-icon">
                                <i class="icon-seg icon-hora-entrega"></i>
                            </span>
                            <div class="seg-hora-fecha">
                                <div class="seg-fecha">
                                    @if (estaActivo05)
                                    {
                                        @estado05EntregaProyectada.DiaMes
                                    }
                                    @if (!string.IsNullOrEmpty(turno))
                                    {
                                        <br />
                                        <span class="texto_valorTurno">
                                            <b>@turno</b>
                                        </span>
                                    }
                                    @if (!string.IsNullOrEmpty(estado05EntregaProyectada.HoraEstimadaDesdeHasta))
                                    {
                                        <div class="seg-hora seg-hora--entregaProyectada">@estado05EntregaProyectada.HoraEstimadaDesdeHasta</div>
                                    }
                                </div>
                                <div class="seg-hora">
                                </div>
                            </div>
                        </div>
                    </div>
                }

                @if (estado06Entregado != null)
                {
                    var esActual06 = Model.Estado == "ENTREGADO";
                    var estaActivo06 = estado06Entregado.Fecha.HasValue;
                    var claseIcono06 = esActual06 ? "seg-active" : estaActivo06 ? "seg-active" : "";
                    contador += 1;

                    <div class="col-xs-4">
                        <div class="seg-item @claseIcono06">
                            <h3 class="seg-title text-center">@contador<br />Entregado</h3>
                            <span class="seg-icon">
                                <i class="icon-seg icon-caja-close"></i>
                            </span>
                            <div class="seg-hora-fecha">
                                <div class="seg-fecha">
                                    @if (estaActivo06)
                                    {
                                        @estado06Entregado.DiaMes
                                    }
                                </div>
                                <div class="seg-hora">
                                    @if (estaActivo06)
                                    {
                                        @estado06Entregado.HoraMinuto
                                    }
                                </div>
                            </div>
                        </div>
                    </div>
                }
            </div>
            <div class="clear"></div>
        </div>
    }
}
else
{
    <div class="col-xs-12">
        <div class="simple-alert text-danger">
            <span class="alert-icon"><i class="icon-exclamation-circle"></i></span>
            <small>
                @ViewBag.MensajeError
            </small>
        </div>
        <div class="simple-alert">
            <small>
                <a href="javascript:recargarPedidoActual()">Recargar Pedido</a>
            </small>
        </div>
    </div>
}