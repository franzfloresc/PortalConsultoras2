@using Portal.Consultoras.Common
@using Portal.Consultoras.Web.Helpers
@model Portal.Consultoras.Web.Models.ShowRoomOfertaModel

@{
    var mobileConfiguracion = Html.MobileAppConfiguracion();
    Layout = "~/Areas/Mobile/Views/Shared/_MobileLayoutContenedor.cshtml";
}
@section styles
{
    @if (ViewContext.GetUniqueSession("IngresoExterno") != null)
    {
        <style>
            #content {
                margin-top: 0px !important;
            }
        </style>
    }
}
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
</head>
<div class="titulo_mobile hideTituloMobileDetalleOferta">
    @{
        if (mobileConfiguracion.MostrarBotonAtras)
        {
            <a href="@Request.UrlReferrer" class="enlace_regresar catalogosP" title="Regresar"></a>
        }
    }
    &nbsp;&nbsp;&nbsp;&nbsp;VOLVER

</div>
<div class="pestana_esika hideTituloMobileDetalleOferta"></div>
<div class="pestana_lbel hideTituloMobileDetalleOferta"></div>

<div class="content_room_product_sheet content_detalle_s">
    @if (mobileConfiguracion.MostrarBotonAtras)
    {
        <a href="@Request.UrlReferrer" class="btn_volver_detalle_oferta" title="Volver">
            <span class="icono_flecha_volver">
                <img src="@Url.Content("~/Content/Images/mobile/flecha-volver-detalle.svg")" alt="Volver" />
            </span>
            <span class="texto_enlace_volver_detalle">VOLVER</span>
        </a>
    }

    <div class="product_sheet_image" data-img="" style="background: url(@ViewBag.ImagenFondoProductPage) no-repeat top center; background-size: 100% auto;">

        <img src="@Model.ImagenProducto" width="236" style="margin-top: 20px;">
    </div>
    <div class="wrapper_resumen_mobile" style="margin-top: 10px;">
        <h1>@Model.Descripcion</h1>
        <input type="hidden" id="swdetdescripcion" value="@Model.Descripcion" />
        <input type="hidden" id="swdetmarca" value="@Model.DescripcionMarca" />
        <input type="hidden" id="swdetprecio" value="@Model.PrecioOferta" />
        <input type="hidden" id="swdeteventoofertaid" value="@Model.OfertaShowRoomID" />
        <div class="price_product">
            <s class="price_offer">@Model.Simbolo @Model.FormatoPrecioValorizado</s>
            <span class="price">Precio para ti <b>@Model.Simbolo @Model.FormatoPrecioOferta</b></span>
            <span class="comment">Gana @Model.Simbolo @Model.FormatoGana</span>
        </div>
        <div class="item_product">
            <div class="description_item" data-item>
                <div class="detail detailItem">
                    <div class="" >
                        <div style="display:none;"><div data-estrategia="@Json.Encode(Model)"></div></div>
                        @{
                            var btnDesabled = 0;
                            var btnDesabledClass = "";
                        }
                        <hr class="clear">
                        @if (Model.CodigoProducto != "")
                        {
                            <div data-estrategia="@Model.CodigoEstrategia">
                                @if (@Model.CodigoEstrategia == Constantes.TipoEstrategiaSet.IndividualConTonos)
                                {
                                    if ((Model.ProductoTonos.Any()))
                                    {
                                        btnDesabled = 1;
                                        <div class="content_tonos_producto content_detalle_set_showroom" data-tono="" data-tono-select="" data-tono-digitable="1">
                                            <div class="tono_select_opt">
                                                <div class="content_tono_elegido texto_sin_tono" data-tono-change="1">
                                                    <div class="tono_seleccionado" style="display:none;"><img src="~/Content/Images/showroom/no_disponible.png" /></div>
                                                    <div class="texto_tono_seleccionado">ELIGE  TU TONO</div>
                                                    <hr class="clear" />
                                                </div>
                                                <div class="content_tonos_select" style="display:none;">
                                                    @foreach (var Hermano in Model.ProductoTonos)
                                                    {
                                                        <div class="content_tono_elegido" data-tono-change="2" data-tono-cuv="@Hermano.CUV" data-tono-nombre="@Hermano.NombreBulk" data-tono-descripcion="@Hermano.NombreComercial">
                                                            <div class="tono_seleccionado"><img src="@Hermano.ImagenBulk" alt=""></div>
                                                            <div class="texto_tono_seleccionado">@Hermano.NombreBulk</div>
                                                            <hr class="clear" />
                                                        </div>
                                                    }
                                                </div>
                                            </div>
                                            <hr class="clear">
                                            <div data-tono-div="">
                                                @foreach (var Hermano in Model.ProductoTonos)
                                                {
                                                    <div style="display: none;">
                                                        <input type="hidden" name="nameMarcaID" id="Estrategia_hd_MarcaID" value="@Hermano.MarcaID" />
                                                        <input type="hidden" name="namePrecioCatalogo" id="Estrategia_hd_PrecioCatalogo" value="@Hermano.PrecioCatalogo" />
                                                    </div>
                                                    <div class="content_tono_detalle" data-tono-cuv="@Hermano.CUV" data-tono-change="2" data-tono-nombre="@Hermano.NombreBulk">
                                                        <img src="@Hermano.ImagenBulk" alt="">
                                                    </div>
                                                }
                                            </div>
                                            <hr class="clear">
                                        </div>
                                    }
                                }
                                else if (@Model.CodigoEstrategia == Constantes.TipoEstrategiaSet.CompuestaFija || @Model.CodigoEstrategia == Constantes.TipoEstrategiaSet.CompuestaVariable)
                                {
                                    var claseItem = Model.CodigoEstrategia == Constantes.TipoEstrategiaSet.CompuestaFija ? "content_producto_individual" : "";
                                    var claseItem3 = Model.CodigoEstrategia == Constantes.TipoEstrategiaSet.CompuestaVariable ? "content_producto_compuesto" : "";
                                    if (Model.ProductoTonos != null && Model.ProductoTonos.Any())
                                    {
                                        <div class="@claseItem">
                                            @foreach (var Hermano in Model.ProductoTonos)
                                            {
                                                if ((Hermano.NombreComercial ?? "") == "" && Hermano.Digitable != 1)
                                                {
                                                    continue;
                                                }
                                                <div>
                                                    <div class="@claseItem3 content_detalle_set_showroom" data-tono="" data-tono-select="" data-tono-digitable="@Hermano.Digitable">
                                                        <div style="display: none;">
                                                            <input type="hidden" name="nameMarcaID" id="Estrategia_hd_MarcaID" value="@Hermano.MarcaID" />
                                                            <input type="hidden" name="namePrecioCatalogo" id="Estrategia_hd_PrecioCatalogo" value="@Hermano.PrecioCatalogo" />
                                                        </div>
                                                        @if (@Hermano.DescripcionMarca != "")
                                                        {
                                                            <span class="brand">@Hermano.DescripcionMarca</span>
                                                        }
                                                        <div class="content_imagen_individual">
                                                            <img src="@Hermano.Imagen">
                                                        </div>
                                                        <div class="content_descripcion_set">
                                                            @if (@Hermano.Cantidad > 0)
                                                            {
                                                                <span class="cantidad_producto_opt">x @Hermano.Cantidad </span>
                                                            }
                                                            <span class="product_name" data-tono-cuv-producto="@Hermano.CUV" data-tono-select-nombrecomercial="">@Hermano.NombreComercial</span>
                                                            <span class="price">@Hermano.Descripcion</span>@*DescripcionComercial*@
                                                        </div>
                                                        <hr class="clear">
                                                        @if (Hermano.Digitable == 1)
                                                        {
                                                            <div class="content_tonos_producto">
                                                                <div class="tono_select_opt">
                                                                    <div class="content_tono_elegido texto_sin_tono" data-tono-change="1">
                                                                        <div class="tono_seleccionado" style="display: none;"><img src="~/Content/Images/showroom/no_disponible.png" alt=""></div>
                                                                        <div class="texto_tono_seleccionado">ELIGE  TU TONO</div>
                                                                        <hr class="clear" />
                                                                    </div>
                                                                    <div class="content_tonos_select" style="display:none;">
                                                                        @foreach (var Tono in Hermano.Hermanos)
                                                                        {
                                                                            btnDesabled = 1;
                                                                            <div class="content_tono_elegido" data-tono-change="2" data-tono-cuv="@Tono.CUV" data-tono-nombre="@Tono.NombreBulk" data-tono-descripcion="@Tono.NombreComercial">
                                                                                <div class="tono_seleccionado"><img src="@Tono.ImagenBulk" alt=""></div>
                                                                                <div class="texto_tono_seleccionado">@Tono.NombreBulk</div>
                                                                                <hr class="clear" />
                                                                            </div>
                                                                        }
                                                                    </div>
                                                                </div>
                                                                <hr class="clear">
                                                            </div>
                                                        }
                                                        <hr class="clear" />
                                                    </div>
                                                </div>
                                            }
                                        </div>
                                    }

                                }
                            </div>
                        }
                    </div>
                </div>
            </div>
            <div class="variants" style="display: none;">
                <a href="#" class="select_variant">
                    <span class="color" style="background-color: #C31727;"></span>
                    <span class="title_variant">
                        Rojo Pimienta
                    </span>
                </a>
                <span class="variants_items">
                    <a href="#" data-color="#D44F82" data-title="Pimienta Caliente">
                        <span class="color" style="background-color: #D44F82;"></span>
                        <span class="title_variant">
                            Pimienta Caliente
                        </span>
                    </a>
                    <a href="#" data-color="#B02F48" data-title="Café Habano">
                        <span class="color" style="background-color: #B02F48;"></span>
                        <span class="title_variant">
                            Café Habano
                        </span>
                    </a>
                    <a href="#" data-color="#E9316D" data-title="Ciruela Glam">
                        <span class="color" style="background-color: #E9316D;"></span>
                        <span class="title_variant">
                            Ciruela Glam
                        </span>
                    </a>
                    <a href="#" data-color="#C31727" data-title="Coral Ensueño">
                        <span class="color" style="background-color: #C31727;"></span>
                        <span class="title_variant">
                            Coral Ensueño
                        </span>
                    </a>
                    <a href="#" data-color="#DB2020" data-title="Frambuesa Encanto">
                        <span class="color" style="background-color: #DB2020;"></span>
                        <span class="title_variant">
                            Frambuesa Encanto
                        </span>
                    </a>
                    <a href="#" data-color="#95494C" data-title="Fucsia Vibrante">
                        <span class="color" style="background-color: #95494C;"></span>
                        <span class="title_variant">
                            Fucsia Vibrante
                        </span>
                    </a>
                    <a href="#" data-color="#982218" data-title="Magenta Sweet">
                        <span class="color" style="background-color: #982218;"></span>
                        <span class="title_variant">
                            Magenta Sweet
                        </span>
                    </a>
                    <a href="#" data-color="#EE7389" data-title="Melon Intense">
                        <span class="color" style="background-color: #EE7389;"></span>
                        <span class="title_variant">
                            Melon Intense
                        </span>
                    </a>
                    <a href="#" data-color="#DE5C52" data-title="Pimienta Caliente">
                        <span class="color" style="background-color: #DE5C52;"></span>
                        <span class="title_variant">
                            Pimienta Caliente
                        </span>
                    </a>
                    <a href="#" data-color="#CE7869" data-title="Café Habano">
                        <span class="color" style="background-color: #CE7869;"></span>
                        <span class="title_variant">
                            Café Habano
                        </span>
                    </a>
                </span>
                <div class="variants_colors">
                    <a href="#" class="variant" style="background-color: #D44F82;" data-color="#D44F82" data-title="Pimienta Caliente"></a>
                    <a href="#" class="variant" style="background-color: #B02F48;" data-color="#B02F48" data-title="Café Habano"></a>
                    <a href="#" class="variant" style="background-color: #E9316D;" data-color="#E9316D" data-title="Ciruela Glam"></a>
                    <a href="#" class="variant" style="background-color: #C31727;" data-color="#C31727" data-title="Coral Ensueño"></a>
                    <a href="#" class="variant" style="background-color: #DB2020;" data-color="#DB2020" data-title="Frambuesa Encanto"></a>
                    <a href="#" class="variant" style="background-color: #95494C;" data-color="#95494C" data-title="Fucsia Vibrante"></a>
                    <a href="#" class="variant" style="background-color: #982218;" data-color="#982218" data-title="Magenta Sweet"></a>
                    <a href="#" class="variant" style="background-color: #EE7389;" data-color="#EE7389" data-title="Melon Intense"></a>
                    <a href="#" class="variant" style="background-color: #DE5C52;" data-color="#DE5C52" data-title="Pimienta Caliente"></a>
                    <a href="#" class="variant" style="background-color: #CE7869;" data-color="#CE7869" data-title="Café Habano"></a>
                </div>
            </div>
        </div>
    </div>

    @if (Model.TieneCompraXcompra)
    {
        if (Model.ListaShowRoomCompraPorCompra != null && Model.ListaShowRoomCompraPorCompra.Count > 0)
        {
            <div style="max-width: 250px; margin: 0 auto;">
                <div class="box_promotions">
                    <div class="titulo_compra_carrusel">PROMOCIÓN</div>
                    <div class="content_compra_carrusel">
                        @{ var posicionCpc = 1; }
                        @foreach (var item in Model.ListaShowRoomCompraPorCompra)
                        {
                            var descripcion = item.Descripcion;
                            if (descripcion != null && descripcion.Length > 41)
                            {
                                descripcion = descripcion.Substring(0, 40) + " ...";
                            }
                            <div data-posicion="@posicionCpc" data-item="@item.OfertaShowRoomID">
                                <div data-campos="">
                                    <input type="hidden" class="hdOfertaShowRoomID" value="@item.OfertaShowRoomID" />
                                    <input type="hidden" class="valorCuv" value="@item.CUV" />
                                    <input type="hidden" class="claseMarcaID" value="@item.MarcaID" />
                                    <input type="hidden" class="clasePrecioUnidad" value="@item.PrecioOferta" />
                                    <input type="hidden" class="DescripcionProd" value="@item.Descripcion" />
                                    <input type="hidden" class="DescripcionMarca" value="@item.DescripcionMarca" />
                                    <input type="hidden" class="posicionEstrategia" value="@posicionCpc" />
                                </div>
                                <div class="nombre_producto_pop_compra">@descripcion</div>
                                <div class="precio_set_compra">A SÓLO @item.Simbolo @item.FormatoPrecioOferta</div>
                                <div class="descripcion_compra">Valorizado en @item.Simbolo @item.FormatoPrecioValorizado</div>
                                <div class="content_imagen_carrusel_compra">
                                    @if (item.ImagenProducto != "")
                                    {
                                        <img data-src="@item.ImagenProducto" class="imagen_producto" data-img-lazy="1" />
                                    }
                                    else
                                    {
                                        <img data-src="@Url.Content("~/Content/Images/showroom/no_disponible.png")" style="width: auto; height: 100%;" class="imagen_producto" data-img-lazy="1" />
                                    }
                                </div>
                                <div style="height: 50px;">
                                    <div class="texto_banner_compra" style="text-align: center">
                                        <span>@Model.TextoCondicionCompraCpc</span>
                                    </div>
                                </div>

                                <a class="btn_agrega_compra verDetalleCompraPorCompra">VER PROMOCIÓN</a>
                            </div>
                            {
                                posicionCpc++;
                            }
                        }
                    </div>
                </div>
            </div>

        }
    }


    <div class="other_consultants">
        <div class="oc_title">
            <b>VER MÁS SETS</b> EXCLUSIVOS PARA TI
        </div>
        <div class="content_carrusel_intriga" id="divEstrategias">
            @{ var posicionx = 0; }
            <div class="variable-width">
                @foreach (var oferta in Model.ListaOfertaShowRoom)
                {
                    var descripcion = oferta.Descripcion;
                    if (descripcion != null && descripcion.Length > 41)
                    {
                        descripcion = descripcion.Substring(0, 40) + " ...";
                    }

                    posicionx++;
                    <div class="slider_item" data-posicion="@posicionx" data-item="@oferta.OfertaShowRoomID" data-position="@posicionx">
                        <div data-campos="" style="display: none;">
                            <input type="hidden" class="hdOfertaShowRoomID" value="@oferta.OfertaShowRoomID" />
                            <input type="hidden" class="valorCuv" value="@oferta.CUV" />
                            <input type="hidden" class="claseMarcaID" value="@oferta.MarcaID" />
                            <input type="hidden" class="clasePrecioUnidad" value="@oferta.PrecioOferta" />
                            <input type="hidden" class="claseConfiguracionOfertaID" value="@oferta.ConfiguracionOfertaID" />
                            <input type="hidden" class="DescripcionProd" value="@oferta.Descripcion" />
                            <input type="hidden" class="DescripcionMarca" value="@oferta.DescripcionMarca" />
                            <input type="hidden" class="posicionEstrategia" value="@posicionx" />
                        </div>
                        <a href="@Url.Action("DetalleOferta", "ShowRoom", new {id = oferta.OfertaShowRoomID, area = "Mobile"})" class="slider_item_content">
                            <div data-img="">
                                <img src="@oferta.ImagenProducto" data-img-lazy="1" />
                            </div>
                            <span class="title">@descripcion</span>
                            <span class="precio_tachado_carrusel_set">@oferta.Simbolo @oferta.FormatoPrecioValorizado</span>
                            <span class="price"><b>@oferta.Simbolo @oferta.FormatoPrecioOferta </b></span>
                        </a>
                    </div>
                }
            </div>
            <div class="content_orden_carrusel" data-posicion-set="">
                <div class="orden_listado_numero"><span data-posicion-current=""></span> / @posicionx</div>
                <div class="linea_separadora_mobile" style="margin-top: -7px;"></div>
                <div class="orden_flecha">
                    <img src="@Url.Content("~/Content/Images/Esika/flecha_orden.png")" alt="flecha" />
                </div>
                <div class="orden_flecha" style="right: 0;">
                    <img src="@Url.Content("~/Content/Images/Esika/flecha_orden_right.png")" alt="flecha" />
                </div>
            </div>


        </div>

    </div>
    @if (!string.IsNullOrEmpty(Model.TipNegocio))
    {
        <div class="business_tips">
            <h3 class="title">tip de negocio</h3>
            <div class="content">@Model.TipNegocio</div>
        </div>
    }
    <div class="share_social_nertwoks" data-posicion="0" data-item="@Model.OfertaShowRoomID">
        <div data-compartir-campos="" style="display: none;">
            <input type="hidden" class="CUV" value="@Model.CUV" />
            <input type="hidden" class="rsFBMensaje" value="@Model.FBMensaje" />
            <input type="hidden" class="rsFBRuta" value="@Model.FBRuta" />
            <input type="hidden" class="rsWAMensaje" value="@Model.FBMensaje" />
            <input type="hidden" class="rsWARuta" value="@Model.FBRuta" />
            <input type="hidden" class="rsFBRutaImagen" value="@Model.ImagenProducto" />
            <input type="hidden" class="rsWARutaImagen" value="@Model.ImagenProducto" />
            <input type="hidden" class="Nombre" value="@Model.Descripcion" />
            <input type="hidden" class="MarcaID" value="@Model.MarcaID" />
            <input type="hidden" class="MarcaNombre" value="@Model.DescripcionMarca" />
            <input type="hidden" class="ProductoDescripcion" value="@Model.Descripcion" />
            <input type="hidden" class="Palanca" value="SR" />
        </div>
        @if (mobileConfiguracion.MostrarBotonAtras)
        {
            <div class="title">Comparte este producto con tus clientes:</div>
            <div class="content_redes_ficha">
                <a class="btn_compartir_ofertas" href="javascript: void(0);" data-compartir="WA">
                    <img src="/Content/Images/Mobile/Esika/catalogo_ws.png" alt="">
                </a>
                <a class="btn_compartir_ofertas" href="javascript: void(0);" data-compartir="FB">
                    <img src="/Content/Images/Mobile/Esika/facebook.png">
                </a>
            </div>
        }
    </div>
</div>
<div class="content_btn_agregar" data-posicion="0" data-item="@Model.OfertaShowRoomID">
    <div data-campos="" style="display:none;">
        <input type="hidden" class="hdOfertaShowRoomID" value="@Model.OfertaShowRoomID" />
        <input type="hidden" class="valorCuv" value="@Model.CUV" />
        <input type="hidden" class="claseMarcaID" value="@Model.MarcaID" />
        <input type="hidden" class="clasePrecioUnidad" value="@Model.PrecioOferta" />
        <input type="hidden" class="claseConfiguracionOfertaID" value="@Model.ConfiguracionOfertaID" />
        <input type="hidden" class="DescripcionProd" value="@Model.Descripcion" />
        <input type="hidden" class="DescripcionMarca" value="@Model.DescripcionMarca" />
        <input type="hidden" class="posicionEstrategia" value="0" />
    </div>
    <div class="content_320">
        <div class="content_cantidad_ficha_producto">
            <a class="cantidad_menos_home" href="javascript: void(0);"><img src="/Content/Images/Mobile/Esika/menos.png" alt=""></a>
            <input type="tel" value="1" size="2" maxlength="2" id="txtCantidad" class="rango_cantidad_pedido ValidaNumeral ValidaPasteNumeral" onkeypress="return FuncionesGenerales.ValidarSoloNumeros(event);" data-input="cantidad">
            <a class=" cantidad_mas_home" href="javascript: void(0);"><img src="/Content/Images/Mobile/Esika/mas.png" alt=""></a>
        </div>
        @if (btnDesabled == 1)
        {
            btnDesabledClass = "btn_desactivado_general";
        }
        <a id="btnAgregalo" class="btn_agregar_ficha_producto @btnDesabledClass" @*data-btn-agregar-sr=""*@  onclick="javascript:EstrategiaAgregar(event, true); ">AGRÉGALO</a>
        <hr class="clear">
    </div>
</div>

<div class="PopMobile1" id="PopCompra" data-popup-main="">
    <div class="content_popMobile" data-popup-body="" style="max-width: 450px;">
        <a class="cerrar_popMobile" id="CerrarPopCompra" style="position:absolute;right: 10px;top: 10px;">
            <img src="/Content/Images/cerrar_04_blanco.png" alt="-">
        </a>
        <div style="margin:-20px -20px 0 -20px;">
            <div class="titulo_compra_POP">PROMOCIÓN</div>
        </div>

        @if (Model.TieneCompraXcompra)
        {
            if (Model.ListaShowRoomCompraPorCompra != null && Model.ListaShowRoomCompraPorCompra.Count > 0)
            {
                <div class="content_pop_compra">
                    @{ var posicionCpc = 1; }
                    @foreach (var item in Model.ListaShowRoomCompraPorCompra)
                    {
                        var descripcion = item.Descripcion;
                        if (descripcion != null && descripcion.Length > 41)
                        {
                            descripcion = descripcion.Substring(0, 40) + " ...";
                        }
                        <div data-posicion="@posicionCpc" data-item="@item.OfertaShowRoomID">
                            <div data-campos="">
                                <input type="hidden" class="hdOfertaShowRoomID" value="@item.OfertaShowRoomID" />
                                <input type="hidden" class="valorCuv" value="@item.CUV" />
                                <input type="hidden" class="claseMarcaID" value="@item.MarcaID" />
                                <input type="hidden" class="clasePrecioUnidad" value="@item.PrecioOferta" />
                                <input type="hidden" class="DescripcionProd" value="@item.Descripcion" />
                                <input type="hidden" class="DescripcionMarca" value="@item.DescripcionMarca" />
                                <input type="hidden" class="posicionEstrategia" value="@posicionCpc" />
                            </div>
                            <div class="set_dia_compra_pop">
                                @Model.TextoCondicionCompraCpc
                            </div>
                            <div class="content_imagen_carrusel_compra">
                                @if (item.ImagenProducto != "")
                                {
                                    <img data-src="@item.ImagenProducto" class="imagen_producto" data-img-lazy="1" />
                                }
                                else
                                {
                                    <img data-src="@Url.Content("~/Content/Images/showroom/no_disponible.png")" style="width: auto; height: 100%;" class="imagen_producto" data-img-lazy="1" />
                                }
                            </div>
                            <div style="height: 130px;">
                                <div class="nombre_producto_pop_compra">@descripcion</div>
                                <div class="precio_set_compra">
                                    A SÓLO @item.Simbolo @item.FormatoPrecioOferta
                                </div>
                                <div class="descripcion_compra">Valorizado en @item.Simbolo @item.FormatoPrecioValorizado</div>
                                <div class="precio_producto_compra">@item.DescripcionLegal</div>
                            </div>
                            <div>
                                <div class="content_cantidad_ficha_producto">
                                    <a class="cantidad_menos_home" href="javascript: void(0);"><img src="/Content/Images/Mobile/Esika/menos.png" alt=""></a>
                                    <input type="tel" value="1" size="2" maxlength="2" id="txtCantidad" class="rango_cantidad_pedido ValidaNumeral ValidaPasteNumeral" onkeypress="return FuncionesGenerales.ValidarSoloNumeros(event);" data-input="cantidad">
                                    <a class=" cantidad_mas_home" href="javascript: void(0);"><img src="/Content/Images/Mobile/Esika/mas.png" alt=""></a>
                                </div>
                                <a class="btn_agregar_ficha_producto" data-btn-agregar-cpc="" style="background:black;" href="javascript: void(0);">AGRÉGALO</a>
                                <hr class="clear">
                            </div>
                        </div>
                        {
                            posicionCpc++;
                        }
                    }
                </div>
            }
        }
        <div class="legal_footer_compra">
            @Model.TextoDescripcionLegalCpc
        </div>
    </div>
</div>

@section scripts{
    <script type="text/javascript" src="@Url.Content("~/Scripts/PortalConsultoras/ShowRoom/ShowRoom.js")"></script>
    <script type="text/javascript">
        var tipoOrigenPantalla = 21;

        var urlCarruselPrev = "@Url.Content("~/Content/Images/mobile/Esika/previous_ofertas_home.png")";
        var urlCarruselNext = "@Url.Content("~/Content/Images/mobile/Esika/next.png")";
        var origenPedidoWeb = '@Constantes.OrigenPedidoWeb.MobileShowRoomProductPage';
        var origenPedidoWebTactica = '@Constantes.OrigenPedidoWeb.MobileShowRoomProductPageTactica';
        var origenPedidoWebCarrusel = '@Constantes.OrigenPedidoWeb.MobileShowRoomProductPageCarrusel';
    </script>
}


<script type="text/javascript">

   var _campania = "";

    function EstrategiaAgregar(event, popup, limite) {
        

        var padre = $('#btnAgregalo').parents("[data-item]");
        var article = $(padre).find("[data-campos]").eq(0);
        var cantidad = $(padre).find("[data-input='cantidad']").val();
        var estrategia = EstrategiaObtenerObj(event);
        var objInput = $('.detailItem');
        var origenPedidoWebEstrategia = "";
        var campania = estrategia.CampaniaID;
        var posicion = $(article).find(".posicionEstrategia").val();
        var esSubCampania = $(article).parents('.content_set_oferta_especial').length > 0;
        var CUV = $(article).find(".valorCuv").val();
        var PrecioUnidad = $(article).find(".clasePrecioUnidad").val();
        var cuvs = "";
        var origen = '';

        if (EstrategiaValidarSeleccionTono(objInput)) {
            return false;
        }

        if (!ValidacionesPreOperacion(cantidad))
        {
            return false;
        }


        if (!esSubCampania) {
            esSubCampania = $(article).parents('div#contenedor-showroom-subcampanias-mobile').length > 0;
        }        

        AbrirLoad();
            
        estrategia.Cantidad = cantidad;

        cuvs = GenerarCadenaCuvs(objInput);

        origen = ObtenerCodigoPedidoWeb(article, posicion);

     
        $.ajaxSetup({
            cache: false
        });

        $.getJSON(baseUrl + 'ShowRoom/ValidarUnidadesPermitidasPedidoProducto', { CUV: CUV, PrecioUnidad: PrecioUnidad, Cantidad: cantidad }, function (data) {
   
            

            if (ValidarUnidadesPermitidas(data, cantidad))
            {

                var params = ({
                    listaCuvTonos: $.trim(cuvs),
                    EstrategiaID: $.trim(estrategia.EstrategiaId),
                    FlagNueva: "0",  
                    Cantidad: $.trim(cantidad),
                    OrigenPedidoWeb: $.trim(origen),
                    ClienteID_: '-1',
                    tipoEstrategiaImagen: "0"  
                });
                $.ajaxSetup({ cache: false });

             
                jQuery.ajax({
                    type: 'POST',
                    url: baseUrl + 'Pedido/AgregarProducto',
                    dataType: 'json',
                    contentType: 'application/json; charset=utf-8',
                    data: JSON.stringify(params),
                    async: true,
                    success: function (data) {

                        
                        CerrarLoad();
                        response = data;
                        if (response.success == true) {

                            if ($.trim(tipoOrigenPantalla)[0] == '1') {
                                CargarResumenCampaniaHeader(true);

                                $(article).parents("[data-item]").find(".product-add").css("display", "block");
                            }

                            if ($.trim(tipoOrigenPantalla)[0] == '2') {
                                CargarCantidadProductosPedidos();
                            }

                            var padre = $(article).parents("[data-item]");
                            $(padre).find("[data-input='cantidad']").val(1);

                            AgregarProductoAlCarrito($(article).parents("[data-item]"));
                        }
                        else {

                            AbrirPopupPedidoReservado(response.message, tipoOrigenPantalla);
                        }
                        window.location = '/Mobile';

                    },
                    error: function (data, error) {
                        console.log(data, error);
                        CerrarLoad();
                    }
                });
            }
            else
                CerrarLoad();

 
        });
        

    }


 
    function EstrategiaObtenerObj(e) {

        var objHtmlEvent = $(e.target);
        if (objHtmlEvent.length == 0) objHtmlEvent = $(e);
        var objHtml = $('.detailItem').parents("[data-item]");
        var objAux = $.trim($(objHtml).find("[data-estrategia]").attr("data-estrategia"));
        var estrategia = (objAux != "") ? JSON.parse(objAux) : {};
        return estrategia;
    }





    function EstrategiaValidarBloqueada(objInput, estrategia) {
        if ($.trim($(objInput).attr("data-bloqueada")) == "") {
            return false;
        }

        if (isMobile()) {
            EstrategiaVerDetalleMobile(estrategia);
            return true;
        }

        var divMensaje = $("#divMensajeBloqueada");
        if (divMensaje.length > 0) {
            var itemClone = EstrategiaObtenerObjHtmlLanding(objInput);
            if (itemClone.length > 0) {
                divMensaje.find("[data-item-html]").html(itemClone.html());
                divMensaje = divMensaje.find("[data-item-html]");
                divMensaje.find('[data-item-tag="body"]').removeAttr("data-estrategia");
                divMensaje.find('[data-item-tag="body"]').css("min-height", "auto");
                divMensaje.find('[data-item-tag="body"]').css("float", "none");
                divMensaje.find('[data-item-tag="body"]').css("margin", "0 auto");
                divMensaje.find('[data-item-tag="body"]').css("background-color", "#fff");
                divMensaje.find('[data-item-tag="body"]').attr("class", "");
                divMensaje.find('[data-item-tag="agregar"]').remove();
                divMensaje.find('[data-item-tag="fotofondo"]').remove();
                divMensaje.find('[data-item-tag="verdetalle"]').remove();
                divMensaje.find('[data-item-accion="verdetalle"]').remove();
                divMensaje.find('[data-item-tag="contenido"]').removeAttr("onclick");
                divMensaje.find('[data-item-tag="contenido"]').css("position", "initial");
                divMensaje.find('[data-item-tag="contenido"]').attr("class", "");
            }
            $(".contenedor_popup_detalleCarousel").hide();
            $("#divMensajeBloqueada").show();
        }
        return true;
    }

 

    function ValidacionesPreOperacion()
    {
        var padre = $('#btnAgregalo').parents("[data-item]"); 
        var cantidad = $(padre).find("[data-input='cantidad']").val();


        if ($('#btnAgregalo').hasClass('btn_desactivado_general')) {
            return false;
        }
        if (cantidad == "" || cantidad == 0) {
            AbrirMensaje("La cantidad ingresada debe ser mayor que 0, verifique.");
            return false;
        }

        if (!$.isNumeric(cantidad)) {
            AbrirMensaje("Ingrese un valor numérico.");
            $('#txtCantidad').val(1);      
            return false;
        }
        if (parseInt(cantidad) <= 0) {
            AbrirMensaje("La cantidad debe ser mayor a cero.");
            $('#txtCantidad').val(1);
            return false;
        }

        return true;
    }
    function GenerarCadenaCuvs(objInput)
    {
        
        var cuvs = '';
        var CodigoVariante = '@Model.CodigoEstrategia';
        if ((CodigoVariante == "2001" || CodigoVariante == "2003")) {
            var listaCuvs = $(objInput).parents("[data-item]").find("[data-tono][data-tono-select]");
            if (listaCuvs.length > 0) {
                $.each(listaCuvs, function (i, item) {
                    var cuv = $(item).attr("data-tono-select");
                    if (cuv != "") {
                        cuvs = cuvs + (cuvs == "" ? "" : "|") + cuv;
                        if (CodigoVariante == "2003") {
                            cuvs = cuvs + ";" + $(item).find("#Estrategia_hd_MarcaID").val();
                            cuvs = cuvs + ";" + $(item).find("#Estrategia_hd_PrecioCatalogo").val();
                        }
                    }
                });
            }
        }
         
        return cuvs;
    }


    function ObtenerCodigoPedidoWeb(article, posicion)
    { 
        var origen = $(article).find(".origenPedidoWeb").val() || 0;
        if (origen == 0) {
            if (posicion != "0") {
                if (origenPedidoWebCarrusel != -1)
                    origen = origenPedidoWebCarrusel;
                else if (tipoOrigenPantalla == 1) {
                    origen = showRoomOrigenInsertar == 0 ? origenPedidoWeb : showRoomOrigenInsertar;
                }
                else
                    origen = origenPedidoWeb;
            } else {
                origen = origenPedidoWeb;
            }
        }

        return origen;

    }
  
    function ValidarUnidadesPermitidas(data, cantidad) {


        if (parseInt(data.Saldo) < parseInt(cantidad)) {
            var Saldo = data.Saldo;
            var UnidadesPermitidas = data.UnidadesPermitidas;

            CerrarLoad();

            if (Saldo == UnidadesPermitidas)
                AbrirMensaje("Lamentablemente, la cantidad solicitada sobrepasa las Unidades Permitidas de Venta (" + UnidadesPermitidas + ") del producto.");
            else {
                if (Saldo == "0")
                    AbrirMensaje("Las Unidades Permitidas de Venta son solo (" + UnidadesPermitidas + "), pero Usted ya no puede adicionar más, debido a que ya agregó este producto a su pedido, verifique.");
                else
                    AbrirMensaje("Las Unidades Permitidas de Venta son solo (" + UnidadesPermitidas + "), pero Usted solo puede adicionar (" + Saldo + ") más, debido a que ya agregó este producto a su pedido, verifique.");
            }

            return false;
        }
        else
            return true;

    }

    function EstrategiaValidarSeleccionTono(objInput) {
        
        var attrClass = $.trim($(objInput).attr("class"));
        if ((" " + attrClass + " ").indexOf(" btn_desactivado_general ") >= 0) {
            $(objInput).parents("[data-item]").find("[data-tono-select='']").find("[data-tono-change='1']").parent().addClass("tono_no_seleccionado");
            setTimeout(function () {
                $(objInput).parents("[data-item]").find("[data-tono-change='1']").parent().removeClass("tono_no_seleccionado");
            }, 500);
            return true;
        }
        return false;
    }

</script>