@{
    ViewBag.Title = "Index";
    Layout = "~/Areas/Mobile/Views/Shared/_MobileLayout.cshtml";
}


@using Newtonsoft.Json
@using Portal.Consultoras.Common
@model Portal.Consultoras.Web.Models.ShowRoomOfertaModel


@section styles{
    <style type="text/css">
        body {
            overflow-x:hidden;
        }
    </style>

    <link href="@Url.Content("~/Content/Css/Mobile/esika/slick.css")" rel="stylesheet" />
}
<div class="content_banner_header_showroom">
    <div class="content_titulo"><div class="titulo_intriga">GRAN VENTA ONLINE</div></div>
    <div class="faltan_dias_header"><b>@ViewBag.LetrasDias</b></div>
    <img src="@ViewBag.ImagenBannerShowroomIntriga" alt="Solo Hoy" />
</div>
<div class="fondo_gris" style="padding-top:20px; padding-bottom:15px; display:none;">   
    <div class="titulo_mensaje_landing">¡no te quedes fuera!</div>
    <div class="mensaje_landing">Confirma tu correo y entérate primero</div>
    <div class="correo_showroon"><input type="text" value="ashimabukuro@belcorp.biz"/></div>
    <a href="#" class="btn_correo_showroom">QUIERO ENTERARME PRIMERO</a>
    <div class="termino_condiciones_intriga">Estoy de acuerdo con los términos y condiciones.</div>
</div>   
<div class="texto_adelanto">Mira el adelanto…</div>
<div class="content_carrusel_intriga">
    <div class="variable-width">
        <div>
            <div class="producto_faltante">
                <img src="@Url.Content("~/Content/Images/Mobile/img-showroom/pronto2.png")" alt="Solo Hoy" />
            </div>
            <div class="linea_separadora_intriga"></div>
        </div>
        <div>
           
            <div class="content_imagen_intriga"><img src="@ViewBag.ImagenProducto"></div>
            <div class="linea_separadora_intriga"></div>
            <div class="titulo_ficha_producto">@ViewBag.Descripcion </div>
            <div class="precio_ficha_producto">
                <span class="precio_tachado_ficha">@ViewBag.Simbolo @ViewBag.PrecioCatalogo </span>@ViewBag.Simbolo @ViewBag.PrecioOferta
            </div>
            <div class="liquidacion_rango_home">
                <a class="cantidad_menos_home" tabindex="0"><img src="/Content/Images/Mobile/Esika/menos.png" alt=""></a>
                <input type="tel" value="1" size="2" maxlength="2" id="txtCantidad" class="rango_cantidad_pedido ValidaNumeral ValidaPasteNumeral" onkeypress="return FuncionesGenerales.ValidarSoloNumeros(event);" tabindex="0">
                <a class="cantidad_mas_home" tabindex="0"><img src="/Content/Images/Mobile/Esika/mas.png" alt=""></a>
            </div>
            <hr class="clear" />
            <input id="hdCampaniaCodigo" type="hidden" value="@ViewBag.CodigoCampania" />
            <input id="hdProductoNombre" type="hidden" value="@ViewBag.Descripcion" />
            <input id="hdMarcaDescripcion" type="hidden" value="@ViewBag.DescripcionMarca == null ? '' : @ViewBag.DescripcionMarca" />
            <a class="boton_Agregalo_home">
                AGRÉGALO
            </a>
        </div>       
        <div>
            <div class="producto_faltante">
                <img src="@Url.Content("~/Content/Images/Mobile/img-showroom/pronto2.png")" alt="Solo Hoy" />
            </div>
            <div class="linea_separadora_intriga"></div>
        </div>
    </div>
</div>


@section scripts{
    <script type="text/javascript" src="@Url.Content("~/Scripts/slick.min.js")"></script>
    <script type="text/javascript">
        var urlInsertOfertaWebPortal = '@Url.Action("InsertOfertaWebPortal", "ShowRoom", new {area = ""})';
        var urlObtenerStockActualProducto = '@Url.Action("ObtenerStockActualProducto", "ShowRoom", new {area = ""})';
        $(document).ready(function () {
            $(".termino_condiciones_intriga").click(function () {
                $(this).toggleClass('check_intriga');
            });
            $('.variable-width').on('init', function (event, slick) {
                setTimeout(function () {
                    slick.setPosition();
                    slick.slickGoTo(1);
                }, 500);
            });

            $('.variable-width').slick({
                dots: true,
                infinite: false,
                speed: 300,
                slidesToShow: 2,
                centerPadding: '0px',
                centerMode: true,
                variableWidth: true,
                slidesToScroll: 1,
                centerMode: true,
                arrows: false,
                dots: false,
            });

            $("body").on("click", ".boton_Agregalo_home", function(e) {
                var cantidad = $("#txtCantidad").val();

                AgregarOfertaShowRoomIntriga(cantidad);
                e.preventDefault();
                (this).blur();
            });

           

        });

        function AgregarOfertaShowRoomIntriga(cantidad) {
            var CUV = @ViewBag.CUV;
            var MarcaID =@ViewBag.MarcaID;
            var PrecioUnidad = @ViewBag.PrecioCatalogo;
            var ConfiguracionOfertaID = @ViewBag.ConfiguracionOfertaID;
            var nombreProducto = $("#hdProductoNombre").val();
            var posicion = 1;
            var descripcionMarca = $("#hdMarcaDescripcion").val();

            if (cantidad == "" || cantidad == 0) {
                messageInfo("La cantidad ingresada debe ser mayor que 0, verifique.");
            } else {
                var Item = {
                    MarcaID: MarcaID,
                    Cantidad: cantidad,
                    PrecioUnidad: PrecioUnidad,
                    CUV: CUV,
                    ConfiguracionOfertaID: ConfiguracionOfertaID
                };

                $.ajaxSetup({ cache: false });
                $.getJSON(urlObtenerStockActualProducto, { CUV: CUV }, function(data) {
                    if (parseInt(data.Stock) < parseInt(cantidad)) {
                        CloseLoading();
                        messageInfo("Lamentablemente, la cantidad solicitada sobrepasa el stock actual (" + data.Stock + ") del producto, verifique.");
                    } else {
                        jQuery.ajax({
                            type: 'POST',
                            url: urlInsertOfertaWebPortal,
                            dataType: 'json',
                            contentType: 'application/json; charset=utf-8',
                            data: JSON.stringify(Item),
                            async: true,
                            success: function(response) {
                                CloseLoading();

                                if (response.success == true) {

                                    var stockRestante = parseInt(data.Stock) - parseInt(cantidad);
                                    if (stockRestante < 1) {
                                        $("#txtCantidad").val("0");
                                    } else {
                                        $("#txtCantidad").val("1");
                                    }

                                    ShowLoading();

                                    AgregarTagManagerProductoAgregado(CUV, nombreProducto, PrecioUnidad, cantidad, descripcionMarca);
                                    CargarCantidadProductosPedidos();
                                    TrackingJetloreAdd(cantidad, $("#hdCampaniaCodigo").val(), CUV);
                                    CloseLoading();
                                }
                                else messageInfoError(response.message);
                            },
                            error: function(response, error) {
                                if (checkTimeout(response)) {
                                    CloseLoading();
                                    console.log(response);
                                }
                            }
                        });
                    }

                });
            }
        }

        function AgregarTagManagerProductoAgregado(CUV, nombreProducto, PrecioUnidad, cantidad, descripcionMarca) {
            dataLayer.push({
                'event': 'addToCart',
                'ecommerce': {
                    'add': {
                        'products': [{
                            'name': nombreProducto,
                            'id': CUV,
                            'price': PrecioUnidad,
                            'brand': descripcionMarca,
                            'variant': 'Ofertas Showroom',
                            'category': 'NO DISPONIBLE',
                            'quantity': cantidad
                        }]
                    }
                }
            });
        }

    </script> 
   
}