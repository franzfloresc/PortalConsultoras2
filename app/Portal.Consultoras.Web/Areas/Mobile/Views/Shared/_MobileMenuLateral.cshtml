@using Portal.Consultoras.Common
@using Portal.Consultoras.Web.Areas.Mobile.Models
@using Portal.Consultoras.Web.Areas.Mobile.Helpers

@{
    var items = (List<MenuMobileModel>)ViewBag.MenuMobile;
    var itemsMenu = items == null ? new List<MenuMobileModel>() : items.Where(p => p.Posicion.ToLower().Equals("menu")).ToList();
    var urlDomain = Util.GetUrlHost(Request);
}

<ul>
    @foreach (var item in itemsMenu)
    {
        if (item.SubMenu.Count == 0)
        {
            var target = item.PaginaNueva ? "_blank" : "_self";
            var url = item.Version == "Completa"
                ? item.UrlItem.StartsWith("http") ? item.UrlItem : string.Format("{0}Mobile/Menu/Ver?url={1}", urlDomain, item.UrlItem)
                : item.UrlItem.StartsWith("http") ? item.UrlItem : string.Format("{0}{1}", urlDomain, item.UrlItem);

            if (item.Descripcion.ToLower().Trim() == "mi comunidad")
            {
                <li>
                    @if (ViewBag.EsUsuarioComunidad == 0)
                    {
                        <a href="javascript:;" onclick="return ShowComunidad();" role="menu" region="Principal" parent="@item.MenuPadreDescripcion" title="@item.Descripcion" id="lnk-prin-@item.Descripcion.GenerateLinkForGoogleTagManager()" target="@target">
                            <figure><img class="icon" src="@Url.Content(item.UrlImagen)" alt="-" /></figure>
                            <span>@item.Descripcion</span>
                        </a>
                    }
                    else
                    {
                        <a href="@url" role="menu" region="Principal" parent="@item.MenuPadreDescripcion" title="@item.Descripcion" id="lnk-prin-@item.Descripcion.GenerateLinkForGoogleTagManager()" target="@target">
                            <figure><img class="icon" src="@Url.Content(item.UrlImagen)" alt="-" /></figure>
                            <span>@item.Descripcion</span>
                        </a>
                    }
                </li>
            }
            else
            {
                <li>
                    <a href="@url" role="menu" region="Principal" parent="@item.MenuPadreDescripcion" title="@item.Descripcion" id="lnk-prin-@item.Descripcion.GenerateLinkForGoogleTagManager()" target="@target">
                        @if (item.Descripcion.ToLower().Trim() == "consultora online")
                        {
                            <div id="divPedidosOnlineSinLeer" class="circulo cir-l circlemenu-success" style="display: none;">0</div>
                        }
                        @if (item.Descripcion.ToLower().Trim() == "mis notificaciones")
                        {
                            <div id="divNotificacionesSinLeer" class="circulo cir-l" style="display:none;">0</div>
                        }
                        <figure><img class="icon" src="@Url.Content(item.UrlImagen)" alt="-" /></figure>
                        <span>@item.Descripcion</span>
                    </a>
                </li>
            }
        }
        else
        {
            <li class="has-sub">
                <a href="javascript:;">
                    <figure>
                        <img class="icon" src="@Url.Content(item.UrlImagen)" alt="-" />
                    </figure>
                    <span>@item.Descripcion</span>
                    <div class="clear"></div>
                </a>
                <ul>
                    @foreach (var subItem in item.SubMenu)
                    {
                        var target = subItem.PaginaNueva ? "_blank" : "_self";
                        var url = subItem.Version == "Completa"
                            ? subItem.UrlItem.StartsWith("http") ? subItem.UrlItem : string.Format("{0}Mobile/Menu/Ver?url={1}", urlDomain, subItem.UrlItem)
                            : subItem.UrlItem.StartsWith("http") ? subItem.UrlItem : string.Format("{0}{1}", urlDomain, subItem.UrlItem);

                        <li class="sub_tab">
                            <a href="@url" role="menu" region="Principal" parent="@subItem.MenuPadreDescripcion" title="@subItem.Descripcion" id="lnk-prin-@subItem.Descripcion.GenerateLinkForGoogleTagManager()" target="@target" class="pull-left">
                                <span>@subItem.Descripcion</span>
                            </a>
                            <span class="pull-right"><i class="icon-angle-next-belcorp"></i></span>
                        </li>
                    }
                </ul>
            </li>
        }
    }
</ul>
