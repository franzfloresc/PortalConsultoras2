@using Portal.Consultoras.Web.Areas.Mobile.Models
@using System.Globalization
@using Portal.Consultoras.Web.CustomHelpers
@model NotificacionesMobileModel
@{
    var layout = ViewContext.MobileLayout();
    Layout = string.Format("~/Areas/Mobile/Views/Shared/{0}.cshtml", layout);
}

@section styles{
    <style type="text/css">
        body {
            background: #FFF !important;
        }
    </style>
}

<div class="titulo_mobile">
    @{ var mobileConfiguracion = Html.MobileAppConfiguracion();
        if (mobileConfiguracion.MostrarBotonAtras)
        {
            <a href="@Request.UrlReferrer" class="enlace_regresar catalogosR" title="Regresar"></a>
        } }
    &nbsp;&nbsp;&nbsp;&nbsp;MIS NOTIFICACIONES
</div>
<div class="pestana_esika"></div>
<div class="pestana_lbel"></div>

<div class="col-xs-12">
    <ul class="list-notificaciones noti-detalle">
        <li>
            <div class="text-noti">
                <div class="sub_titulo_noti">
                    <span>@Model.Asunto</span>
                    <span>CAMPAÑA @Model.Campania.ToString().Substring(4) @Model.Campania.ToString().Substring(0, 4)</span>
                </div>
                <span>@Model.FechaFacturacion</span>
            </div>
        </li>
    </ul>
</div>
<br />

<div class="col-xs-12 notificaciones_detalle_mobile">
    <p class="consultora_saludo_noti"><b>Hola  @Model.NombreConsultora</b></p>
    <input type="hidden" id="estadoValue" value="@Model.estado" />
    <input type="hidden" id="fechafacturacion" value="@Model.FechaFacturacion" />
    <input type="hidden" id="fechaFacturacionDia" value="@Model.FechaFacturacion.Day" />
    <input type="hidden" id="fechaFacturacionMes" value="@Model.FechaFacturacion.Month" />
    <input type="hidden" id="observaciones" value="@Model.Observaciones" />

    <p id="sFelicitaciones"></p>
    <span id="sMensajePedidoPROL"></span>
    <br />
    <br />
    @if (Model.ListaNotificacionesDetalle.Count != 0)
    {
        <ul style='padding: 0px 0px 0px 15px; margin-top: 0px; text-align: left;'>
            @foreach (var item in Model.ListaNotificacionesDetalle)
            {
                <li>
                    @Html.DisplayTextFor(modelItem => item.MensajePROL)
                </li>
            }
        </ul>
    }
    <span id="sMensajeFacturacion"></span>
    <h3 class="title-line">Detalle</h3>
    @foreach (var item in Model.ListaNotificacionesDetallePedido)
    {
        <div class="detalle_notificaciones">
            <div class="left_reservado" style="width:235px;">
                <div class="datos_Reservado">
                    <span> @item.CUV </span>
                    <span>@item.Descripcion</span>
                </div>
            </div>
            <div class="right_reservado">
                <div class="texto_reservado">CANT</div>
                <div class="datos_Reservado"><b>@item.Cantidad</b></div>
            </div>
            @if (!string.IsNullOrEmpty(item.ObservacionPROL))
            {
                <div class="left_reservado">
                    @{string[] obser = item.ObservacionPROL.Split('|');}
                    @if (obser != null)
                    {
                        foreach (string ob in obser)
                        {
                            if (!string.IsNullOrEmpty(ob))
                            {
                                <div class="observacion_notificacion">@ob</div>
                            }
                        }
                    }
                </div>
            }
            <hr class="clear" /><br />
            <div class="left_reservado">
                <div class="texto_reservado">
                    <span>Precio Unitario</span>
                </div>
                @if (item.DescuentoProl > 0)
                {
                    <div class="texto_reservado">
                        <span style="display:inline-block;">Descuento</span>
                        <span class="icono_advertencia_notificacion" style="margin-top: -7px;"></span>
                    </div>
                }

                <div class="importe_reservado">SUBTOTAL</div>
            </div>
            <div class="right_reservado">
                <div class="texto_reservado">
                    <span>@ViewBag.Simbolo @string.Format("{0:N2}", item.PrecioUnidad)</span>
                </div>
                @if (item.DescuentoProl > 0)
                {
                    <div class="texto_reservado">
                        <span>@ViewBag.Simbolo @string.Format("{0:N2}", item.DescuentoProl)</span>
                    </div>
                }

                <div class="importe_reservado">@ViewBag.Simbolo @string.Format("{0:N2}", item.ImporteTotal)</div>
            </div>
            
        </div>
    }

    <hr class="clear" />
    <div class="left_reservado">
        <div class="importe_final">
            <b>MONTO TOTAL</b>
        </div>
        @if (Model.ListaNotificacionesDetallePedido.Sum(p => p.DescuentoProl) > 0)
        {
            <div class="importe_final">
                <b>DESCUENTO</b>
                <span class="icono_advertencia_notificacion" style="margin-top: -7px;"></span>
            </div>
        }

    </div>
    <div class="right_reservado">
        <div class="importe_final" style="font-size:15px"><b> @ViewBag.Simbolo @string.Format("{0:N2}", Model.ListaNotificacionesDetallePedido.Sum(p => p.ImporteTotal))</b></div>
        @if (Model.ListaNotificacionesDetallePedido.Sum(p => p.DescuentoProl) > 0)
        {
            <div class="importe_final" style="font-size:15px"><b> @ViewBag.Simbolo @string.Format("{0:N2}", Model.ListaNotificacionesDetallePedido.Sum(p => p.DescuentoProl))</b></div>
        }
    </div>
    <hr class="clear" />
    <p class="firma_notificaciones">

        Gracias,
        <br />
        Equipo de Belcorp.

    </p>
    <br />
</div>


@section scripts
{
    <script type="text/javascript">

        $(document).ready(function () {
            var estado = $('#estadoValue').val();
            var Observaciones = $('#observaciones').val();
            var FacturaHoy = $('#fechafacturacion').val();
            var DiaFact = $('#fechaFacturacionDia').val();
            var MesFact = $('#fechaFacturacionMes').val();

            switch (estado) {
                case "2":
                    $('#sMensajePedidoPROL').html(Observaciones);
                    $('#sMensajeFacturacion').html('Añade más productos a tu pedido y no pierdas la oportunidad de seguir ganando.');
                    break;
                case "3":
                    $('#sMensajePedidoPROL').html(Observaciones);
                    $('#sMensajeFacturacion').html('Añade más productos a tu pedido y no pierdas la oportunidad de seguir ganando.');
                    break;
                case "4":
                    $('#sFelicitaciones').html('¡Felicitaciones!');
                    $('#sMensajePedidoPROL').html(Observaciones);
                    var Mensaje = "Será enviado " + DescripcionFacturacion(FacturaHoy, DiaFact, MesFact) + ", siempre y cuando cumplas con el monto mínimo y no tengas deuda.";
                    $('#sMensajeFacturacion').html(Mensaje);
                    break;
                case "5":
                    $('#sFelicitaciones').html('¡Felicitaciones!');
                    $('#sMensajePedidoPROL').html(Observaciones);
                    var Mensaje = "Será enviado a Belcorp " + DescripcionFacturacion(FacturaHoy, DiaFact, MesFact) + ", siempre y cuando cumplas con el monto mínimo y no tengas deuda pendiente.";
                    $('#sMensajeFacturacion').html(Mensaje);
                    break;
            }
        });

        function DescripcionFacturacion(FacturaHoy, DiaFact, MesFact) {
            Result = "el día de hoy";
            return Result;
        }

    </script>
}