var actualizarMatrizCampaniaModule=function(){"use strict";var _initializer=function(){_bindEvents()},_bindEvents=function(){$("#txtPrecioNuevo").keypress(function(e){var theEvent=e||window.event,key=theEvent.keyCode||theEvent.which,character=8!=key?String.fromCharCode(key):"",newValue=this.value+character;if(isNaN(newValue)||hasDecimalPlace(newValue,3))return!1}),$("#txtFactorRepeticionNuevo").keyup(function(e){var theEvent=e||window.event,key=theEvent.keyCode||theEvent.which;key=String.fromCharCode(key),/[0-9]|\./.test(key)||(theEvent.returnValue=!1,theEvent.preventDefault&&theEvent.preventDefault())}),$("#txtFactorRepeticionNuevo").keypress(function(e){if(8!=e.which&&0!=e.which&&(e.which<48||e.which>57))return!1}),$("#btnBuscar").click(function(){_preBuscar()}),$("#btnGrabar").click(function(){var vMessage="";return""==$.trim($("#txtDescripcion").val())?(vMessage+="- Debe ingresar descripción el producto.\n",$("#btnBuscar").focus(),alert(vMessage),!1):"Buscar"==$("#btnBuscar")[0].value?(vMessage+="- Debe realizar la busqueda de la descripción primero.\n",$("#btnBuscar").focus(),alert(vMessage),!1):void _grabar()}),$("#txtCodVenta").keypress(function(evt){var charCode=evt.which?evt.which:window.event.keyCode;if(charCode<=13&&_preBuscar(),charCode<=13)return!1;var keyChar=String.fromCharCode(charCode);return/[0-9]/.test(keyChar)}),$("#txtDescripcion").keypress(function(evt){var charCode=evt.which?evt.which:window.event.keyCode;if(charCode<=13)return!1;var keyChar=String.fromCharCode(charCode);return/[a-zA-Z0-9ñÑáéíóúÁÉÍÓÚ ]/.test(keyChar)}),$("#ddlPais").change(function(){var Id=$(this).val();null!=Id&&(waitingDialog({}),$.ajaxSetup({cache:!1}),$.getJSON(baseUrl+"MatrizCampania/CargarCampania",{paisId:""==Id?0:Id},function(data){if(checkTimeout(data)){if(_limpiarDependencias(Id),""!=Id){var ddlCampania=$("#ddlCampania");if(data.DropDownListCampania.length>0)for(var item in data.DropDownListCampania)data.DropDownListCampania[item].CampaniaID&&ddlCampania.append($("<option/>",{value:data.DropDownListCampania[item].CampaniaID,text:data.DropDownListCampania[item].Codigo}))}closeWaitingDialog()}}))}),$(document).keydown(function(e){8==e.keyCode&&"INPUT"!=e.target.tagName&&"TEXTAREA"!=e.target.tagName&&e.preventDefault()})},_preBuscar=function(){if("Buscar"==$("#btnBuscar")[0].value){var vMessage="";return""==$.trim($("#ddlPais").val())?(vMessage+="- Debe seleccionar el país.\n",$("#ddlPais").focus(),alert(vMessage),!1):""==$.trim($("#ddlCampania").val())?(vMessage+="- Debe seleccionar la campaña.\n",$("#ddlCampania").focus(),alert(vMessage),!1):""==$.trim($("#txtCodVenta").val())?(vMessage+="- Debe ingresar código único de venta.\n",alert(vMessage),$("#txtCodVenta").focus(),!1):(_buscar(),!1)}return $("#btnBuscar")[0].value="Buscar",$("#ddlPais")[0].disabled=!1,$("#ddlCampania")[0].disabled=!1,$("#txtCodVenta")[0].disabled=!1,_limpiarFormulario(),!1},_limpiarFormulario=function(){$("#txtDescripcion").val(""),$("#txtCodVenta").val(""),$("#txtPrecio").val(""),$("#txtFactorRepeticion").val(""),$("#txtDescripcionNueva").val(""),$("#txtPrecioNuevo").val(""),$("#txtFactorRepeticionNuevo").val("")},_buscar=function(){waitingDialog({}),$.ajax({type:"POST",url:baseUrl+"MatrizCampania/ConsultarDescripcion",dataType:"json",contentType:"application/json; charset=utf-8",data:JSON.stringify({CUV:$("#txtCodVenta").val(),IDCampania:$("#ddlCampania").val(),paisID:$("#ddlPais").val()}),async:!0,cache:!1,success:function(data){checkTimeout(data)&&(closeWaitingDialog(),1==data.success?(1==data.lstProducto.length?($("#txtDescripcion").val(data.lstProducto[0].Descripcion),$("#txtPrecio").val(data.lstProducto[0].PrecioProducto),$("#txtFactorRepeticion").val(data.lstProducto[0].FactorRepeticion)):($("#txtDescripcion").val(data.lstProducto[0].Descripcion),$("#txtPrecio").val(data.lstProducto[0].PrecioProducto),$("#txtFactorRepeticion").val(data.lstProducto[0].FactorRepeticion),$("#txtDescripcionNueva").val(data.lstProducto[1].Descripcion),$("#txtPrecioNuevo").val(data.lstProducto[1].PrecioProducto),$("#txtFactorRepeticionNuevo").val(data.lstProducto[1].FactorRepeticion)),$("#btnBuscar")[0].value="Buscar Otro",$("#ddlPais")[0].disabled=!0,$("#ddlCampania")[0].disabled=!0,$("#txtCodVenta")[0].disabled=!0):alert(data.message))},error:function(data,error){checkTimeout(data)&&(closeWaitingDialog(),alert("ERROR"))}})},_grabar=function(){var msj="";if(""==$("#txtDescripcionNueva").val()&&(msj+="- Debe ingresar la nueva Descripción del Producto \n"),""==$("#txtPrecioNuevo").val()&&(msj+="- Debe ingresar el Nuevo Precio del Producto \n"),""==$("#txtFactorRepeticionNuevo").val()&&(msj+="- Debe ingresar el Nuevo Factor Repetición del Producto \n"),""!=msj)return alert(msj),!1;waitingDialog({});var item={CUV:$("#txtCodVenta").val(),CampaniaID:$("#ddlCampania").val(),Descripcion:$("#txtDescripcionNueva").val(),PaisID:$("#ddlPais").val(),PrecioProducto:$("#txtPrecioNuevo").val(),FactorRepeticion:$("#txtFactorRepeticionNuevo").val()};$.ajax({type:"POST",url:baseUrl+"MatrizCampania/InsertarProductoDescripcion",dataType:"json",contentType:"application/json; charset=utf-8",data:JSON.stringify(item),async:!0,success:function(data){checkTimeout(data)&&(closeWaitingDialog(),1==data.success?(_limpiarFormulario(),$("#btnBuscar")[0].value="Buscar",$("#ddlPais")[0].disabled=!1,$("#ddlCampania")[0].disabled=!1,$("#txtCodVenta")[0].disabled=!1,alert(data.message)):alert(data.message))},error:function(data,error){checkTimeout(data)&&(closeWaitingDialog(),alert("ERROR"))}})},_limpiarDependencias=function(id){var ddlCampania=$("#ddlCampania");ddlCampania.empty(),ddlCampania.append($("<option/>",{value:"",text:"-- Seleccionar --"}))};return{ini:function(){alert(),_initializer()}}}();