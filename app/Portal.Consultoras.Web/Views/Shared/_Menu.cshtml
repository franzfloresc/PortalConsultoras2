@{
    // Asignar permisosList con los elementos solo de la cabecera
    var permisoList = (List<Portal.Consultoras.Web.Models.PermisoModel>)ViewBag.Permiso;
    var programasBelcorpMenu = (List<Portal.Consultoras.Web.Models.ServicioCampaniaModel>)ViewBag.ProgramasBelcorpMenu;
    permisoList = permisoList != null
        ? permisoList.Where(x => x.Posicion.ToLower().Equals("header") && x.Mostrar).OrderBy(p => p.OrdenItem).ToList()
        : new List<Portal.Consultoras.Web.Models.PermisoModel>();
    string urlProgramaNuevas = "";
    programasBelcorpMenu = programasBelcorpMenu ?? new List<Portal.Consultoras.Web.Models.ServicioCampaniaModel>();
    foreach (var item in programasBelcorpMenu) 
    {
        if (item.Descripcion.ToLower().Trim() == "programa nuevas")
        {
            urlProgramaNuevas = item.Url;
        }
    }
    
    //var programasNuevas = programaNuevas != null ? permisoList.Where(p => p.Descripcion.ToLower().Equals("programa nuevas")).ToList()[0] : Portal.Consultoras.Web.Models.ServicioCampaniaModel;
    var claseSociaEmpresaria = (ViewBag.Lider == 1 && ViewBag.PortalLideres) ? "menu_socia_empresaria" : "";
}

@if (permisoList.Count > 0)
{
    <ul id="ulNavPrincipal" class="nav_principal @(claseSociaEmpresaria)">
        <!--AÑADIR CLASE "menu_socia_empresaria" SI LLEVA SOCIA EMPRESARIA -->       
        @foreach (var menuPadre in permisoList)
        {
            <li class="new_menu" style="margin-left: 5px;">
            @if (menuPadre.SubMenus.Count > 0)
            {
                //Menu padre con hijos
                    <a href="javascript:;" class="new_menu_a" target="@menuPadre.PageTarget" role="menu" region="Principal" parent="@menuPadre.Descripcion" title="@menuPadre.Descripcion" id="lnk-pri-@menuPadre.DescripcionFormateada">
                        @menuPadre.Descripcion
                        <div class="flecha_menu"></div>
                        <div class="pestana_esika"></div>
                    </a>
                    
                    <ul class="@(menuPadre.ClaseSubMenu)">
                        <li>
                            <div class="linea_menu"> </div>
                            @{
                                var margin = "";
                                var contador = 0;
                                var contadorRe = 0;
                                var addIngPedido = false;
                                var divHtmlF = "";
                                var addImgen = false;
                                var final = false;
                                foreach (var menuHijo in menuPadre.SubMenus)
                                {                                    
                                    //SI TIENE NIETOS
                                    if (menuHijo.SubMenus.Count > 0)
                                    {
                                        margin = contador > 5 ? "no_margin_right" : "";
                                        <div class="content_left_menu @(margin)">
                                            @if (!string.IsNullOrEmpty(menuHijo.Descripcion))
                                            {
                                                <p class="menu_enlace">
                                                    <b>@menuHijo.Descripcion</b>
                                                </p>

                                                foreach (var menuNieto in menuHijo.SubMenus)
                                                {
                                                    if (menuNieto.UrlItem == "")
                                                    {
                                                        <a href="javascript:;" class="menu_enlace">
                                                            @menuNieto.Descripcion
                                                        </a>
                                                    }
                                                    else if (menuNieto.EsDireccionExterior)
                                                    {
                                                        <a href="javascript:;" class="menu_enlace" 
                                                           onclick="RedirectMenu('@menuNieto.UrlItem', '', @Convert.ToInt32(menuNieto.PaginaNueva), '@menuNieto.Descripcion') " 
                                                           target="@menuNieto.PageTarget" role="menu" region="Principal" parent="@menuHijo.Descripcion" title="@menuNieto.Descripcion" id="lnk-pri-@menuNieto.DescripcionFormateada">
                                                            @menuNieto.Descripcion
                                                        </a>
                                                    }
                                                    else
                                                    {
                                                        <a href="javascript:;" class="menu_enlace" 
                                                           onclick="RedirectMenu('@menuNieto.UrlItem.Split('/')[1]', '@menuNieto.UrlItem.Split('/')[0]', @Convert.ToInt32(menuNieto.PaginaNueva), '@menuNieto.Descripcion')"
                                                           target="@menuNieto.PageTarget" role="menu" region="Principal" parent="@menuHijo.Descripcion" title="@menuNieto.Descripcion" id="lnk-pri-@menuNieto.DescripcionFormateada">
                                                            @menuNieto.Descripcion
                                                        </a>
                                                    }
                                                    contador++;
                                                }
                                            }
                                        </div>
                                    }
                                    else
                                    {
                                        addImgen = true;
                                        var divHtml = "";
                                        if (contadorRe%5 == 0)
                                        {
                                            divHtml = "<div class='content_left_menu'>";
                                            divHtmlF = "</div>";
                                        }

                                        if (divHtml != "")
                                        {
                                            @Html.Raw(divHtml)
                                        }
                                        if (contadorRe == 0 && !addIngPedido)
                                        {
                                            contadorRe++;
                                            <a href="javascript:;" class="menu_titulo" onclick="RedirectMenu('Index', 'Pedido', 0, 'Pedido')" target="_self" role="menu" region="Principal" parent="MI NEGOCIO" title="Ingreso Pedido" id="lnk-pri-ingreso-pedidos">
                                                INGRESA TU PEDIDO
                                            </a>
                                            addIngPedido = true;
                                        }
                                        if (menuHijo.UrlItem == "")
                                        {
                                            <a href="javascript:;" class="menu_enlace">
                                                @menuHijo.Descripcion
                                            </a>
                                        }
                                        else if (menuHijo.EsDireccionExterior)
                                        {
                                            <a href="javascript:;" class="menu_enlace" onclick="RedirectMenu('@menuHijo.UrlItem', '', @Convert.ToInt32(menuHijo.PaginaNueva), '@menuHijo.Descripcion') " target="@menuHijo.PageTarget" role="menu" region="Principal" parent="@menuPadre.Descripcion" title="@menuHijo.Descripcion" id="lnk-pri-@menuHijo.DescripcionFormateada">
                                                @menuHijo.Descripcion
                                            </a>
                                        }
                                        else
                                        {
                                            <a href="javascript:;" class="menu_enlace" onclick="RedirectMenu('@menuHijo.UrlItem.Split('/')[1]', '@menuHijo.UrlItem.Split('/')[0]', @Convert.ToInt32(menuHijo.PaginaNueva), '@menuHijo.Descripcion') " target="@menuHijo.PageTarget" role="menu" region="Principal" parent="@menuPadre.Descripcion" title="@menuHijo.Descripcion" id="lnk-pri-@menuHijo.DescripcionFormateada">
                                                @menuHijo.Descripcion
                                            </a>
                                        }

                                        contadorRe++;
                                        if (contadorRe == 5 || (final && contadorRe == menuPadre.SubMenus.Count()-4))
                                        {
                                            @Html.Raw(divHtmlF)
                                            divHtmlF = "";
                                            contadorRe = 0;
                                            final = true;
                                        }
                                    }
                                }

                                if (addImgen)
                                {
                                    <a href="javascript:;" class="menu_imagen" onclick="RedirectMenu('Index', 'MisCatalogosRevistas', 0, 'MisCatalogosRevistas')" target="_self" role="menu" region="Principal" parent="MI NEGOCIO" title="Mis Catalogos y Revistas" id="lnk-pri-miscatalogosrevistas">
                                        <img role="menu" region="Principal" parent="MI NEGOCIO" title="Mis Catalogos y Revistas" src="@(ViewBag.UrlRaizS3)Menu/MiNegocio/@(ViewBag.codigoISOMenu)/imagen_01.png" />
                                        <div role="menu" region="Principal" parent="MI NEGOCIO" title="Mis Catalogos y Revistas" class="titulo_imagen">CATÁLOGOS Y REVISTAS</div>
                                    </a>
                                    if (ViewBag.SegmentoConsultoraMenu == 1)
                                    {
                                        <a href="@urlProgramaNuevas" role="menu" region="Principal" parent="MI NEGOCIO" title="Programa Nuevas" class="menu_imagen no_margin_right" target="_blank">
                                            <img role="menu" region="Principal" parent="MI NEGOCIO" title="Programa Nuevas" src="@(ViewBag.UrlRaizS3)Menu/MiNegocio/@(ViewBag.codigoISOMenu)/imagen_02.png" />
                                            <div role="menu" region="Principal" parent="MI NEGOCIO" title="Programa Nuevas" class="titulo_imagen">PROGRAMA NUEVAS</div>
                                        </a>                                   
                                    }
                                    else
                                    {
                                        <a href="javascript:;" class="menu_imagen no_margin_right" onclick="RedirectMenu('Index', 'Incentivos', 0, 'Incentivos')" target="_self" role="menu" region="Principal" parent="MI NEGOCIO" title="Incentivos" id="lnk-pri-Incentivos">
                                            <img role="menu" region="Principal" parent="MI NEGOCIO" title="Incentivos" src="@(ViewBag.UrlRaizS3)Menu/MiNegocio/@(ViewBag.codigoISOMenu)/imagen_03.png" />
                                            <div role="menu" region="Principal" parent="MI NEGOCIO" title="Incentivos" class="titulo_imagen">INCENTIVOS</div>
                                        </a>
                                    }
                                }

                            }
                         </li>
                    </ul>
            }
            else
            {
                //Menu padre sin hijos
                    if (menuPadre.UrlItem == "")
                    {
                        <a href="javascript:;" class="new_menu_a @menuPadre.ClaseMenu">
                            @menuPadre.Descripcion
                        </a>
                    }
                    else
                    {
                        <a href="javascript:;" class="new_menu_a @menuPadre.ClaseMenu"
                           onclick="@menuPadre.OnClickFunt"
                           target="@menuPadre.PageTarget" role="menu" region="Principal" parent="@menuPadre.Descripcion" title="@menuPadre.Descripcion" id="lnk-pri-@menuPadre.DescripcionFormateada">
                            @if (menuPadre.UrlImagen != "")
                            {
                                <img src="@menuPadre.UrlImagen" alt="@menuPadre.Descripcion" style="margin-top: -5px;" />
                            }
                            else
                            {
                                @menuPadre.Descripcion
                            }
                        </a>
                    }
            }
            </li>
        }
        <li class="clear"></li>
    </ul>
}