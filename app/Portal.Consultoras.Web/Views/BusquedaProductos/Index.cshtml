@model Portal.Consultoras.Web.Models.Buscador.BusquedaProductoOutModel

@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_MainLayoutResponsive.cshtml";
}

<link href="@Url.Content("~/Content/Css/Site/BusquedaProductos/busqueda-productos.css")" rel="stylesheet" />
<link href="@Url.Content("~/Content/Css/Site/BusquedaProductos/filtros-busqueda.css")" rel="stylesheet" />
<link href="@Url.Content("~/Content/Css/Site/FichaProductoResponsive/ficha-producto-responsive.css")" rel="stylesheet" />
<link href="@Url.Content("~/Content/Css/Site/Notificacion.css")" rel="stylesheet" />

<main class="row flex-row ml-0 mr-0 mx-auto layout__content layout__content--vistaResultadosBusqueda">
    @if (ViewBag.FlagFiltrosBuscador)
    {
        <!-- SECCIÓN FILTROS -->
        <div class="col-12 pl-0 pr-0 background__filtros__mobile"></div>
        <!-- ESTA SECCIÓN APARECE CADA VEZ QUE SE HAGA CLICK EN ALGÚN FILTRO Y SE ACTUALICE LA PÁGINA DE RESULTADOS SEGÚN LO SELECCIONADO -->
        <div class="col-12 pl-0 pr-0 layout__precarga layout__precarga--actualizacionFiltros">
            <div class="row flex-column justify-content-center align-items-center ml-0 mr-0 layout__precarga__componentes">
                <div class="d-block precarga__spinner__wrapper precarga__spinner__wrapper--actualizacionFiltros">
                    <svg viewBox="0 0 120 120" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" class="precarga__spinner">
                        <symbol id="s--circle">
                            <circle r="9" cx="15" cy="15"></circle>
                        </symbol>
                        <g class="spinner__circulos">
                            <g class="spinner__circulo">
                                <use xlink:href="#s--circle" class="u--circle" />
                            </g>
                            <g class="spinner__circulo">
                                <use xlink:href="#s--circle" class="u--circle" />
                            </g>
                            <g class="spinner__circulo">
                                <use xlink:href="#s--circle" class="u--circle" />
                            </g>
                            <g class="spinner__circulo">
                                <use xlink:href="#s--circle" class="u--circle" />
                            </g>
                            <g class="spinner__circulo">
                                <use xlink:href="#s--circle" class="u--circle" />
                            </g>
                            <g class="spinner__circulo">
                                <use xlink:href="#s--circle" class="u--circle" />
                            </g>
                            <g class="spinner__circulo">
                                <use xlink:href="#s--circle" class="u--circle" />
                            </g>
                            <g class="spinner__circulo">
                                <use xlink:href="#s--circle" class="u--circle" />
                            </g>
                            <g class="spinner__circulo">
                                <use xlink:href="#s--circle" class="u--circle" />
                            </g>
                            <g class="spinner__circulo">
                                <use xlink:href="#s--circle" class="u--circle" />
                            </g>
                            <g class="spinner__circulo">
                                <use xlink:href="#s--circle" class="u--circle" />
                            </g>
                            <g class="spinner__circulo">
                                <use xlink:href="#s--circle" class="u--circle" />
                            </g>
                        </g>
                    </svg>
                </div>
                <p class="d-block mx-auto text-center text-bold precarga__texto">
                    Estamos buscando<br />las mejores ofertas para ti 🙂
                </p>
            </div>
        </div>
        <!-- FIN - ESTE BLOQUE APARECE CADA VEZ QUE SE HAGA CLICK EN ALGÚN FILTRO Y SE ACTUALICE LA PÁGINA DE RESULTADOS SEGÚN LO SELECCIONADO -->
        <section class="row flex-row justify-content-center align-items-stretch ml-0 mr-0 layout__content__filtros">
            <div class="col-12 pl-0 pr-0 filtros__wrapper">
                <div class="row flex-row justify-content-between align-items-center ml-0 mr-0 filtros_subtitulo mostrarEnMobile">
                    <div class="col-9 col-lg-12 col-xl-12 pl-0 pr-0">
                        <h3 class="col-12 pl-0 pr-0 text-bold text-uppercase">Filtra tus ofertas</h3>
                        <div class="col-12 pl-0 pr-0 text-bold cantidadProductoMobile">14 resultados</div>
                    </div>
                    <a id="cerrarFiltros" class="d-inline-block filtros__enlace__cerrar">
                        <img src="@Url.Content("~/Content/Images/cerrar-filtros.svg")" alt="" />
                    </a>
                </div>
                <!-- SECCIÓN ETIQUETAS DE CRITERIOS ELEGIDOS EN LOS FILTROS (MOBILE) -->
                <div class="row flex-row align-items-baseline ml-0 mr-0 mostrarEnMobile layout__content__etiquetas__criteriosElegidos layout__content__etiquetas__criteriosElegidosMobile" style="display:none;">
                    <ul class="row flex-row ml-0 lista__etiquetas__criteriosElegidos criteriosBuscadorMobile"></ul>
                </div>
                <!-- FIN - SECCIÓN ETIQUETAS DE CRITERIOS ELEGIDOS EN LOS FILTROS (MOBILE) -->
                <div class="col-12 pl-0 pr-0 filtros__subtitulo mostrarEnDesktop">
                    Filtrar por:
                </div>
                <ul class="row flex-row ml-0 mr-0 filtros__lista filtros__lista-handleBar">
                    
                </ul>
                <div class="row flex-row justify-content-between align-items-center ml-0 mr-0 mostrarEnMobile filtro__btn__mobile__wrapper">
                    <div class="col-6 pl-0">
                        <button class="col-12 pl-0 pr-0 text-uppercase filtro__btn filtro__btn--limpiar">
                            Limpiar
                        </button>
                    </div>
                    <div class="col-6 pl-0 pr-0">
                        <button class="col-12 pl-0 pr-0 text-uppercase filtro__btn filtro__btn--aplicar">
                            Aplicar
                        </button>
                    </div>
                </div>
            </div>
        </section>
        <!-- FIN - SECCIÓN DE FILTROS -->
    }
    <!-- SECCIÓN FICHA DE PRODUCTOS -->
    <section class="row flex-row justify-content-lg-between justify-content-xl-between align-self-start ml-0 mr-0 mx-auto layout__content__fichaProductos">
        <section class="col-12 col-lg-6 col-xl-6 busqueda__productos__encontrados__wrapper pr-lg-0 pr-xl-0">
            <h1 class="col-12 pl-0 pr-0 busqueda__productos__titulo">
                Resultados de la búsqueda
            </h1>
            <p class="col-12 pl-0 pr-0 busqueda__productos__encontrados">
                <span id="TotalProductos" class="busqueda__num__productos__encontrados">0</span>  resultados para: <span id="TextoBusqueda" class="busqueda__nom__filtro text-bold">@Model.TextoBusqueda</span>
            </p>
        </section>
        @if (Model.MostrarOpcionesOrdenamiento || ViewBag.FlagFiltrosBuscador)
        {
            <section class="col-12 col-lg-6 col-xl-6 lista__opciones__ordenamiento__y__filtrar pl-lg-0 pl-xl-0">
                <div class="row flex-row justify-content-between justify-content-lg-end justify-content-xl-end ml-0 mr-0">
                    @if (ViewBag.FlagFiltrosBuscador)
                    {
                        <div class="row flex-row ml-0 mr-0 col-6 col-lg-11 col-xl-11 pl-0 pr-0 lista__opcion__wrapper lista__opcion__wrapper--filtrar mostrarEnMobile">
                            <div id="opcionFiltrar" class="col-12 pl-0 pr-0 opcion__filtrar">
                                <a class="col-12 col-lg-4 col-xl-4 pl-0 d-inline-block text-center opcion__filtrar__link" title="Filtrar">
                                    Filtrar
                                </a>
                            </div>
                        </div>
                    }
                    @if (Model.MostrarOpcionesOrdenamiento)
                    {
                        <div class="row flex-row ml-0 mr-0 col-12 col-lg-11 col-xl-11 pl-0 pr-0 lista__opcion__wrapper lista__opcion__wrapper--ordenar">
                            <div class="col-12 pl-0 pr-0 opcion__ordenamiento text-lg-right text-xl-right">
                                <label class="col-12 col-lg-4 col-xl-4 pl-0 d-inline-block text-center text-lg-right text-xl-right opcion__ordenamiento__label">
                                    Ordenar
                                </label>
                                <!-- AL AGREGAR EL EVENTO CLICK POR JS PARA MOSTRAR EL LISTADO DE OPCIONES AGREGAR ESTA CLASE opcion__ordenamiento__dropdown--desplegado -->
                                <div id="dpw-ordenar" class="col-12 col-lg-6 col-xl-6 pl-0 pr-0 d-inline-block opcion__ordenamiento__dropdown text-left">
                                    <span class="col-11 opcion__ordenamiento__dropdown__seleccionada mostrarEnDesktop ul-seleccionado">Recomendación</span>
                                    <span class="col pl-0 pr-0 opcion__ordenamiento__dropdown__icono mostrarEnDesktop">
                                        <img src="@Url.Content("~/Content/Images/ordenar-flecha-icono.svg")" alt="" />
                                    </span>
                                </div>
                                <!-- FIN - AL AGREGAR EL EVENTO CLICK POR JS PARA MOSTRAR EL LISTADO DE OPCIONES AGREGAR ESTA CLASE opcion__ordenamiento__dropdown--desplegado -->
                            </div>
                        </div>
                        <ul id="ul-ordenar" class="col-9 col-md-10 col-lg-6 col-xl-6 pl-0 pr-0 opcion__ordenamiento__dropdown__lista d-none">
                            @for (int i = 0; i < Model.ListaOrdenamiento.Count; i++)
                            {
                                if (i == 0)
                                {
                                    <li class="col-12 pl-0 pr-0 opcion__ordenamiento__dropdown__item d-block"
                                        data-value=" @Model.ListaOrdenamiento.ToList()[i].Value " title="@Model.ListaOrdenamiento.ToList()[i].Key">
                                        <a class="col-12 d-block opcion__ordenamiento__dropdown__link opcion__ordenamiento__dropdown__link--seleccionada"
                                           title="@Model.ListaOrdenamiento.ToList()[i].Key">
                                            @Model.ListaOrdenamiento.ToList()[i].Key
                                        </a>
                                    </li>
                                }
                                else
                                {
                                    <li class="col-12 pl-0 pr-0 opcion__ordenamiento__dropdown__item d-block"
                                        data-value=" @Model.ListaOrdenamiento.ToList()[i].Value " title="@Model.ListaOrdenamiento.ToList()[i].Key">
                                        <a class="col-12 d-block opcion__ordenamiento__dropdown__link"
                                           title="@Model.ListaOrdenamiento.ToList()[i].Key">
                                            @Model.ListaOrdenamiento.ToList()[i].Key
                                        </a>
                                    </li>
                                }
                            }
                        </ul>
                    }
                </div>
            </section>
        }
        <!-- SECCIÓN ETIQUETAS DE CRITERIOS ELEGIDOS EN LOS FILTROS (DESKTOP) -->
        <section class="row flex-row align-items-baseline ml-0 mr-0 mx-auto w-100 mostrarEnDesktop layout__content__etiquetas__criteriosElegidos layout__content__etiquetas__criteriosElegidosDesktop" style="display: none">
            <ul class="row flex-row ml-0 lista__etiquetas__criteriosElegidos criteriosBuscadorDesktop"></ul>
            <a title="Limpiar filtros" class="text-right enlace__limpiar__filtros">
                Limpiar filtros
            </a>
        </section>
        <!-- FIN - SECCIÓN ETIQUETAS DE CRITERIOS ELEGIDOS EN LOS FILTROS (DESKTOP) -->
        <section class="col-12 fichas__productos__wrapper text-center" id="FichasProductosBuscador"></section>
    </section>
    <!-- FIN - SECCIÓN FICHA DE PRODUCTOS -->
</main>
@section scripts{
    <script type="text/javascript">
        var textoBusqueda = '@Model.TextoBusqueda';
        var categoriaBusqueda = '@Model.CategoriaBusqueda';
        var totalProductosPagina = '@Model.TotalProductosPagina';
        var totalCaracteresDescripcion = '@Model.TotalCaracteresDescripcion';
    </script>
    <script src="@Url.Content("~/Scripts/PortalConsultoras/Buscador/BusquedaProductoModule.js")"></script>
}

<script id="js-fichaFiltros" type="text/x-handlebars-template">
    {{#each this as |item|}}
    <li class="col-12 pl-0 pr-0 filtro__tipo">
        <div class="row flex-row justify-content-between align-items-center ml-0 mr-0 filtro__tipo__titulo filtro__tipo__titulo--mostrarContenido">
            <div class="col-10 pl-0 pr-0">{{item.NombreGrupo}}</div>
            <div class="d-inline-block filtro__tipo__titulo__icono__despliegue"></div>
        </div>
        <ul class="row flex-row ml-0 mr-0 filtro__tipo__items">
            {{#each item.Opciones as |filtro|}}
                {{#iff filtro.cantidad '>' 0}}
                <li class="col-12 pl-0 pr-0 filtro__item" data-item="BuscadorFiltros">
                    <input type="hidden" class="BuscadorFiltroLabel" value="{{filtro.nombreFiltro}}" />
                    <input type="hidden" class="BuscadorFiltroID" value="{{filtro.idFiltro}}" />
                    <input type="hidden" class="BuscadorSeccionFiltro" value="{{item.NombreGrupo}}" />
                    <div class="row flex-row flex-nowrap align-items-center ml-0 mr-0 filtro__item__form_fields buscadorFiltrosSeleccionar">
                        <input id="{{filtro.idFiltro}}" type="checkbox" class="filtro__item__checkbox buscadorFiltrosChecked" {{#if filtro.marcado}} checked {{/if}} /> <!--checked-->
                        <label class="col-11 pl-0 mb-0 filtro__item__descrip" for="{{filtro.idFiltro}}">
                            <span class="d-inline-block filtro__item__checkbox"></span>
                            <span class="d-inline-block">{{filtro.nombreFiltro}}</span>
                        </label>
                    </div>
                </li>            
                {{/iff}}
            {{/each}}
        </ul>
    </li>
    {{/each}}


</script>

<script id="js-FichaProductoBuscador" type="text/x-handlebars-template">

    {{#each this as |item|}}
    <article class="ficha__producto {{#if Stock}} ficha__producto--agotado {{/if}}" data-item="BuscadorFichasProductos">
        <div style="display:none;">
            <input type="hidden" class="hdBuscadorJSON" value="{{JSON2string item}}" />
            <div data-imagen-producto="{{Imagen}}"></div>
        </div>

        <div class="row flex-row justify-content-center ml-0 mr-0">
            <figure class="col-12 pl-0 pr-0 row flex-row ml-0 mr-0 justify-content-center align-items-end ficha__producto__imagen text-center">
                <img data-src="{{Imagen}}" data-src-error="@Url.Content("~/Content/Images/oferta-sin-imagen.svg")" class="lazy redireccionarFicha" />
                <a title="Ver detalle" class="row flex-row ml-0 mr-0 justify-content-center align-items-center col pl-0 pr-0 text-bold text-uppercase mostrarEnDesktop redireccionarFicha btn__ver__detalle">
                    Ver detalle
                </a>
            </figure>
            <div class="col-12 pl-0 pr-0 ficha__producto__descrip d-block mx-auto text-left">
                <div class="col-12 pl-0 pr-0 ficha__producto__descrip__marca__pais text-uppercase">
                    {{DescripcionEstrategia}}
                </div>
                <div class="col-12 pl-0 pr-0 ficha__producto__descrip__nom text-bold redireccionarFicha">
                    {{Descripcion}}
                </div>
            </div>
            <div class="row flex-row align-items-end align-items-md-baseline ml-0 mr-0 col-12 pl-0 pr-0 ficha__producto__precio">
                {{#if_eq TipoPersonalizacion 'LIQ'}}
                <div class="ficha__producto__precio__oferta ficha__producto__precio__oferta--liquidacion text-bold text-left">{{PrecioString}}</div>
                {{else}}
                {{#iff Valorizado '>' 0}}
                <div class="ficha__producto__precio__normal text-left">{{ValorizadoString}}</div>
                {{/iff}}
                <div class="ficha__producto__precio__oferta text-bold text-left">{{PrecioString}}</div>
                {{/if_eq}}
            </div>
            <div class="row flex-row justify-content-between ml-0 mr-0 pl-0 pr-0 ficha__producto__agregar__producto">
                {{#if_eq CodigoEstrategia '2003'}}
                <div class="w-100" data-OrigenPedidoWeb="{{OrigenPedidoWeb}}">
                    <!-- BOTÓN ELIGE TU OPCIÓN -->
                    {{#if Stock}}
                    <a class="redireccionarFicha row flex-row justify-content-center align-items-center ml-0 mr-0 btn_elegir_opcion btn__elegir__opcion--fichaProducto btn_inactivo btn__inactivo--fichaProducto ml-0 mr-0 text-uppercase text-center" href="javascript:;">
                        Agotado
                    </a>
                    {{else}}
                    <a class="redireccionarFicha row flex-row justify-content-center align-items-center ml-0 mr-0 btn_elegir_opcion btn__elegir__opcion--fichaProducto ml-0 mr-0 text-uppercase text-center" href="javascript:;">
                        <span class="col-12 pl-0 pr-0 text-bold d-inline-block">
                        </span>
                    </a>
                    {{/if}}
                    <!-- FIN - BOTÓN ELIGE TU OPCIÓN -->
                </div>
                {{else}}
                {{#if Stock}}
                <div class="col pl-0 pr-0">
                    <a class="boton_Agregalo_home boton__agregalo--fichaProducto btn_inactivo btn__inactivo--fichaProducto text-center text-uppercase d-block">
                        Agotado
                    </a>
                </div>
                {{else}}
                <div class="col-12 col-md col-lg col-xl pl-0 pr-0">
                    <div class="row flex-row justify-content-between ml-0 mr-0 ficha__producto__rango__cantidad js-no-popup" data-cantidad-contenedor="">
                        <a class="col-4 col-md-4 col-lg-4 col-xl-4 pl-0 pr-0 menos d-block js-no-popup" onclick="javascript:EstrategiaAgregarModule.DisminuirCantidad(event)">
                            <img class="d-block js-no-popup" src="/Content/Images/menos.svg" alt="">
                        </a>
                        <input type="text" value="1" size="2" maxlength="2" id="txtCantidad" data-input="cantidad" class="col-4 col-md-8 col-lg-8 col-xl-8 pl-0 pr-0 d-block text-center text-bold ValidaNumeral ValidaPasteNumeral js-no-popup" {{#if Stock}} disabled {{/if}}>
                        <a class="col-4 col-md-4 col-lg-4 col-xl-4 pl-0 pr-0 mas d-block js-no-popup" onclick="javascript:EstrategiaAgregarModule.AdicionarCantidad(event)">
                            <img class="d-block js-no-popup" src="/Content/Images/mas.svg" alt="">
                        </a>
                    </div>
                </div>
                <div class="col-12 col-md-7 col-lg-7 col-xl-7 pl-0 pr-0 flex-grow-1">
                    <a class="boton_Agregalo_home boton__agregalo--fichaProducto text-center text-uppercase d-block FichaAgregarProductoBuscador">
                        Agrégalo
                    </a>
                </div>
                {{/if}}
                {{/if_eq}}
            </div>
            <div class="col-12 pl-0 pr-0 etiqueta_buscador_producto ficha__producto__etiqueta text-center">
                {{#if_eq Agregado 'Agregado'}}
                <span class="text-uppercase text-bold d-inline-block">{{Agregado}}</span>
                {{/if_eq}}
            </div>
        </div>
    </article>
    {{/each}}
</script>