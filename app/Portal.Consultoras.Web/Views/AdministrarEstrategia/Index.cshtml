@using Portal.Consultoras.Common

@model Portal.Consultoras.Web.Models.EstrategiaModel
@{
    ViewBag.Title = "Administración de Estrategias";
    var imagenVacia = "prod_grilla_vacio.png";
}

<script src="@Url.Content("~/Scripts/fileuploader.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery.form.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery.toast.min.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/handlebars.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery.paging.min.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/AdminContenido/ToastHelper.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/AdminContenido/Paginador.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/AdminContenido/Nemotecnico.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/AdminContenido/DescripcionComercial.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/AdminContenido/MatrizComercialFileUpload.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/AdminContenido/AdministrarEstrategia.js")" type="text/javascript"></script>

<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<link href="@Url.Content("~/Content/Css/Toast/jquery.toast.min.css")" rel="stylesheet" />

<input type="hidden" id="mensajeErrorCUV" />
<input type="hidden" id="mensajeErrorCUV2" />
<input type="hidden" id="hdEstrategiaIDConsulta" />
<input type="hidden" id="ImagenProducto" />
<input type="hidden" id="hdEstrategiaID" />
<input type="hidden" id="hdEstrategiaCodigo" />
<input type="hidden" id="hdTipoConsulta" value="0" />
<input type="hidden" id="hdZonas" value="" />
<input type="hidden" id="hdSimbolo" />
<input type="hidden" id="hdTallaColorID" />
<div class="wrap_cab">
    <div class="filtros2">
        <div class="elements">
            <div class="div-2">
                <h1><span>Zona de Estrategias @(Model.TipoVistaEstrategia == Constantes.TipoVistaEstrategia.ProgramaNuevas ? "- Programa de Nuevas" : string.Empty)</span></h1>
            </div>
            <div class="div-3">
                <div class="titG">País:</div>
                <div class="selectA borde_redondeado">
                    @Html.DropDownListFor(model => model.PaisID, new SelectList(Model.listaPaises, "PaisID", "Nombre"), "-- Seleccionar --", new { id = "ddlPais" })
                </div>
                <div class="titG">Campaña:</div>
                <div class="selectA borde_redondeado">
                    @Html.DropDownListFor(model => model.CampaniaID, new SelectList(Model.listaCampania, "CampaniaID", "NombreCorto"), "-- Seleccionar --", new { id = "ddlCampania" })
                </div>
            </div>
            <div class="div-3">
                <div class="titG">Tipo de Estrategia:</div>
                <div class="selectA borde_redondeado">
                    <select id="ddlTipoEstrategia" name="ddlTipoEstrategia">
                        @if (Model.ListaTipoEstrategia != null)
                        {
                            <option value="">-- Seleccionar --</option>
                            for (int i = 0; i < Model.ListaTipoEstrategia.Count(); i++)
                            {
                            <option flag-nueva="@Model.ListaTipoEstrategia.ToList()[i].FlagNueva"
                                    flag-recoproduct="@Model.ListaTipoEstrategia.ToList()[i].FlagRecoProduc"
                                    flag-recoperfil="@Model.ListaTipoEstrategia.ToList()[i].FlagRecoPerfil"
                                    codigo-programa="@Model.ListaTipoEstrategia.ToList()[i].CodigoPrograma"
                                    imagen-tipo="@Model.ListaTipoEstrategia.ToList()[i].Imagen"
                                    value="@Model.ListaTipoEstrategia.ToList()[i].TipoEstrategiaID"
                                    data-id="@Model.ListaTipoEstrategia.ToList()[i].CodigoGeneral"
                                    data-codigo="@Model.ListaTipoEstrategia.ToList()[i].Codigo"
									data-FValidarImagen = "@Model.ListaTipoEstrategia.ToList()[i].FlagValidarImagen"
									data-PesoMaximo = "@Model.ListaTipoEstrategia.ToList()[i].PesoMaximoImagen" >
                                @Model.ListaTipoEstrategia.ToList()[i].Descripcion
                            </option>
                            }
                        }
                    </select>
                </div>
                <div class="titG">CUV<sub>2</sub>:</div>
                <div class="selectA borde_redondeado">
                    <input type="text" id="CUV" name="CUV" />
                </div>
            </div>

            <div class="div-3">
                <div class="titG">Tiene imagen?:</div>
                <div class="selectA borde_redondeado">
                    <select id="ddlTieneImagen" name="ddlTieneImagen">
                        <option value="-1" selected>-- Seleccionar --</option>
                        <option value="1">Si</option>
                        <option value="0">No</option>
                    </select>
                </div>
                <div class="titG">Oferta Activa?:</div>
                <div class="selectA borde_redondeado">
                    <select id="ddlOfertaActiva" name="ddlOfertaActiva">
                        <option value="-1" selected>-- Seleccionar --</option>
                        <option value="1">Si</option>
                        <option value="0">No</option>
                    </select>
                </div>
            </div>

            <div class="div-3">
                <div class="titG">&nbsp;</div>
                <div class="input_horizontal">
                    <input type="button" name="btnBuscar" id="btnBuscar" value="Buscar" />
                    <input type="button" name="btnNuevo" id="btnNuevo" value="Nuevo" />
                    @if (Model.TipoVistaEstrategia == Constantes.TipoVistaEstrategia.Todos)
                    { 
                        <input type="button" name="btnNuevoMasivo" id="btnNuevoMasivo" value="Nuevo Masivo" />
                    }
                    <input type="button" name="btnDescripcionMasivo" id="btnDescripcionMasivo" value="Desc. Masivo" />
                    <input type="button" name="btnActualizarTonos" id="btnActualizarTonos" value="Actualizar Tonos" />
                </div>
                <div class="input_modifica_pedido">
                    <input type="button" name="btnActivarDesactivar" id="btnActivarDesactivar" value="Activar/Desactivar" style="display: none;" />
                    <input type="button" name="btnCargaMasivaImagenes" id="btnCargaMasivaImagenes" value="Cargar Imagenes" style="display: none;"/>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="wrap">
    <div class="container clearfix">
        <div class="border-wrapper">
            <table id="list"></table>
            <div id="pager"></div>
        </div>
    </div>
</div>

@Html.Partial("AdministrarEstrategiaDialog")

<div id="DialogZona" style="display: none;">
    <div class="Content_modal">
        <div class="div-3">
            <div class="treeview_est_content">
                <div id="arbolRegionZona" class="demo">
                </div>
            </div>
        </div>
        <div class="div-3">
            <div class="titF"></div>
            <div class="titF"></div>
            <div class="titH">
                <input type="checkbox" id="chkSeleccionar" />Seleccionar todo
            </div>
        </div>
    </div>
</div>
<div id="DialogEditarTallaColor" style="display: none;">
    <div class="Content_modal">
        <div class="div-3">
            <div class="titG">CUV:</div>
            <div class="selectP2 borde_redondeado">
                <input type="text" id="txtCUVTC" />
            </div>
        </div>
        <div class="div-3">
            <div class="titG">Descripción:</div>
            <div class="selectP2 borde_redondeado" style="width: 300px">
                <input type="text" id="txtDescripcionCUVTC" style="width: 290px" readonly="readonly" />
            </div>
        </div>
        <div class="div-3">
            <div class="titG">Precio:</div>
            <div class="selectP2 borde_redondeado">
                <input type="text" id="txtPrecioCUVTC" readonly="readonly" />
            </div>
        </div>
        <div class="div-3">
            <div class="titG">Tipo:</div>
            <div class="selectP2 borde_redondeado">
                <select id="ddlTallaColor">
                    <option value='0'>-- Seleccionar --</option>
                    <option value='C'>Color</option>
                    <option value='T'>Talla</option>
                </select>
            </div>
        </div>
        <div class="div-3">
            <div class="titG">Descripción (Talla/Color):</div>
            <div class="selectP2 borde_redondeado">
                <input type="text" id="txtDescripcionTC" />
            </div>
        </div>
    </div>
</div>
<div id="DialogTonoMarca" style="display: none;">
    <div class="Content_modal">
        <table id="listTC"></table>
        <div id="pagerTC"></div>
    </div>
</div>
<div id="DialogNuevoMasivo" style="display: none;">
    <div class="Content_modal">
        <div class="div-3" style="text-align: center;">
            <div class="boton_redondo_admcontenido_on" id="divPaso1">1</div>
            <div class="signo_admcontenido_estrategia">></div>
            <div class="boton_redondo_admcontenido_off" id="divPaso2">2</div>
            <div class="signo_admcontenido_estrategia">></div>
            <div class="boton_redondo_admcontenido_off" id="divPaso3">3</div>
        </div>
        <div id="divMasivoPaso1">
            <div class="div-3" style="text-align: center; color: #00A2E8;">
                Pre Carga de CUVS pendientes por configurar en Zona de Estrategias
            </div>
            <div class="container" style="width: auto;">
                <div class="border-wrapper">
                    <table id="listCargaMasiva1"></table>
                    <div id="pagerCargaMasiva1"></div>
                </div>
            </div>
            <div id="divMostrarPreCarga">
                <div class="div-3" style="text-align: center; color: #00A2E8; margin-top: 20px;">
                    ¿Deseas pre cargar la información de los CUVS pendientes por configurar? (<span id="spnCantidadConfigurar1">11</span>) CUVS
                </div>
                <div class="div-3">
                    <div class="input_horizontal" style="text-align: center;">
                        <input type="button" name="btnAceptarMasivo1" id="btnAceptarMasivo1" value="Aceptar" style="float: none;" />
                        <input type="button" name="btnCancelarMasivo1" id="btnCancelarMasivo1" value="Cancelar" style="float: none;" />
                    </div>
                </div>
            </div>
        </div>
        <div id="divMasivoPaso2" style="display: none;">
            <div class="div-3" style="text-align: center; color: #00A2E8;">
                Grabar información en Zona de Estrategias
            </div>
            <div class="container" style="width: auto;">
                <div class="border-wrapper">
                    <table id="listCargaMasiva2"></table>
                    <div id="pagerCargaMasiva2"></div>
                </div>
            </div>
            <div id="divMostrarPreCarga2">
                <div class="div-3" style="text-align: center; color: #00A2E8; margin-top: 20px;">
                    ¿Deseas grabar la información de los CUVS pre cargados correctamente en la Zona de Estrategias? (<span id="spnCantidadConfigurar2">11</span>) CUVS
                </div>
                <div class="div-3">
                    <div class="input_horizontal" style="text-align: center;">
                        <input type="button" name="btnAceptarMasivo2" id="btnAceptarMasivo2" value="Aceptar" style="float: none;" />
                        <input type="button" name="btnCancelarMasivo2" id="btnCancelarMasivo2" value="Cancelar" style="float: none;" />
                    </div>
                </div>
            </div>
        </div>
        <div id="divMasivoPaso3" style="display: none;">
            <div class="div-3" style="text-align: center; color: #00A2E8;">
                Confirmación de grabación en Zona de Estrategias
            </div>
            <div class="div-3" style="text-align: center; margin-top: 20px;">
                Se grabó la información de los <a onclick="adminEstrategiaModule.VerCuvsTipo2(1); "><span id="spnCantidadConfigurar3">11</span> CUVS</a>
            </div>
            <div id="divMostrarNoCargados" class="div-3" style="text-align: center; margin-top: 20px;">
                Quedan <a onclick="adminEstrategiaModule.VerCuvsTipo2(2); "><span id="spnCantidadNoConfigurar3">11</span> CUVS</a> pendientes para cargar.
            </div>
            <div class="div-3">
                <div class="input_horizontal" style="text-align: center;">
                    <input type="button" name="btnAceptarMasivo3" id="btnAceptarMasivo3" value="Aceptar" style="float: none;" />
                </div>
            </div>
        </div>
    </div>
</div>
<div id="DialogGrillaCuv1">
    <div class="Content_modal">
        <div class="container" style="width: auto;">
            <div class="border-wrapper">
                <table id="listGrillaCuv1"></table>
                <div id="pagerGrillaCuv1"></div>
            </div>
        </div>
    </div>
</div>
<div id="DialogGrillaCuv2">
    <div class="Content_modal">
        <div class="container" style="width: auto;">
            <div class="border-wrapper">
                <table id="listGrillaCuv2"></table>
                <div id="pagerGrillaCuv2"></div>
            </div>
        </div>
    </div>
</div>

<div id="DialogDescMasivo" style="display: none;">
    <div class="Content_modal">
        <div id="divDescMasivoPaso1">
            <div class="div-3" style="text-align: center;">
                Seleccione el archivo para la carga masiva de las descripciones:
            </div>
            <div class="container" style="width: 70%;">
                <div class="border-wrapper">
                    <input type="file" id="fileDescMasivo" name="fileDescMasivo"/>
                </div>
            </div>
            <div class="div-3" style="margin: 15px auto; width: 200px;">
                Formato de archivo (*.csv):<br/>
                - CUV<br />
                - Descripción<br />
            </div>
            <div class="div-3">
                <div class="input_horizontal" style="text-align: center;">
                    <input type="button" name="btnAceptarMasivo1" id="btnAceptarDescMasivo1" value="Continuar" style="float: none;" />
                    <input type="button" name="btnCancelarMasivo1" id="btnCancelarDescMasivo1" value="Cancelar" style="float: none;" />
                </div>
            </div>
        </div>
        <div id="divDescMasivoPaso2" style="display: none;">
            <div class="div-3" style="text-align: center;">
                Resultado de la actualización: 
            </div>
            <div class="container" style="margin: 15px auto; width: auto;">                
                <div class="border-wrapper">
                    <table id="listCargaDescMasiva"></table>
                    <div id="pagerCargaDescMasiva"></div>
                </div>
            </div>
            <div class="div-3">
                <div class="input_horizontal" style="text-align: center;">
                    <input type="button" name="btnCancelarMasivo2" onclick="HideDialog('DialogDescMasivo')" value="Cerrar" style="float: none;" />
                </div>
            </div>
        </div>
    </div>
</div>
<div id="DialogDescActualizada">
    <div class="Content_modal">
        <div class="container" style="margin: 15px auto; width: auto;">
            <div class="border-wrapper">
                <table id="listDescActualizada"></table>
                <div id="pagerDescActualizada"></div>
            </div>
        </div>
        <div class="div-3">
            <div class="input_horizontal" style="text-align: center;">
                <input type="button" name="btnCancelarMasivo2" onclick="HideDialog('DialogDescActualizada')" value="Volver" style="float: none;" />
            </div>
        </div>
    </div>
</div>
<div id="DialogDescNoActualizada">
    <div class="Content_modal">
        <div class="container" style="margin: 15px auto; width: auto;">
            <div class="border-wrapper">
                <table id="listDescNoActualizada"></table>
                <div id="pagerDescNoActualizada"></div>
            </div>
        </div>
        <div class="div-3">
            <div class="input_horizontal" style="text-align: center;">
                <input type="button" name="btnCancelarMasivo2" onclick="HideDialog('DialogDescNoActualizada')" value="Volver" style="float: none;" />
            </div>
        </div>
    </div>
</div>
<div id="loadingScreen"></div>

<div id="DialogActualizarTono">
    <div class="Content_modal" style="overflow: hidden;">
        <div id="divActualizarTono">
            <div class="div-3" style="text-align: center;">
                Resultado de la actualización:
            </div>
            <div class="container" style="margin: 15px auto; width: auto;">
                <div class="border-wrapper">
                    <table id="listActualizarTono"></table>
                    <div id="pagerActualizarTono"></div>
                </div>
            </div>
            <div class="div-3">
                <div class="input_horizontal" style="text-align: center;">
                    <input type="button" name="btnCancelarMasivo2" onclick="HideDialog('DialogActualizarTono')" value="Cerrar" style="float: none;" />
                </div>
            </div>
        </div>
    </div>
</div>

<div id="DialogTonoActualizada">
    <div class="Content_modal" style="overflow: hidden;">
        <div class="container" style="margin: 15px auto; width: auto;">
            <div class="border-wrapper">
                <table id="listTonoActualizada"></table>
                <div id="pagerTonoActualizada"></div>
            </div>
        </div>
        <div class="div-3">
            <div class="input_horizontal" style="text-align: center;">
                <input type="button" name="btnCancelarMasivo2" onclick="HideDialog('DialogTonoActualizada')" value="Volver" style="float: none;" />
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
    var adminEstrategiaModule;
    var _toastHelper = ToastHelper();
    jQuery(document).ready(function () {
        adminEstrategiaModule = AdministrarEstrategia({
            actualizarMatrizComercialAction: '@Url.Action("ActualizarMatrizComercial", "MatrizComercial")',
            getImagesBySapCodeAction: '@Url.Action("GetImagesBySapCode", "AdministrarEstrategia")',
            getFiltrarEstrategiaAction: '@Url.Action("FiltrarEstrategia", "AdministrarEstrategia")',
            uploadAction: '@Url.Action("ImageMatrizUpload", "FileUpload")',
            getImagesByCodigoSAPAction: '@Url.Action("GetImagesByCodigoSAP", "MatrizComercial")',
            getImagesByNemotecnico: '@Url.Action("GetImagesByNemotecnicoSAP", "MatrizComercial")',
            habilitarNemotecnico: @Json.Encode(Model.habilitarNemotecnico),
            expValidacionNemotecnico: @Html.Raw(Model.ExpValidacionNemotecnico),
            actualizarDescripcionComercialAction: '@Url.Action("ActualizarDescripcionComercial", "MatrizComercial")',
            tipoEstrategiaIncentivosProgramaNuevas: '@Constantes.TipoEstrategiaCodigo.IncentivosProgramaNuevas',
            rutaImagenVacia: '@Url.Content("~/Content/Images/" + imagenVacia)',
            urlActivarDesactivarEstrategias: baseUrl + 'AdministrarEstrategia/ActivarDesactivarEstrategias',
            rutaImagenEdit: '@Url.Content("~/Content/Images/Edit.png")',
            rutaImagenDelete: '@Url.Content("~/Content/Images/Delete.png")',
            urlGetOfertaByCUV: baseUrl + 'AdministrarEstrategia/GetOfertaByCUV',
            urlS3: "@Model.UrlS3",
            rutaTemporal: '@Url.Content("~/Content/Temporales/")',
            urlConsultarCuvTipoConfigurado: baseUrl + 'AdministrarEstrategia/ConsultarCuvTipoConfigurado',
            urlConsultarCuvTipoConfiguradoTemporal: baseUrl + 'AdministrarEstrategia/ConsultarCuvTipoConfiguradoTemporal',
            urlDeshabilitarEstrategia: baseUrl + 'AdministrarEstrategia/DeshabilitarEstrategia',
            urlImageLanzamientoUpload: '@Url.Action("ImageLanzamientoUpload", "FileUpload")',
            urlUploadCvs: '@Url.Action("UploadCvs", "AdministrarEstrategia")'
        });
        adminEstrategiaModule.Inicializar();

        $.jgrid.extend({
            Editar: adminEstrategiaModule.Editar,
            Eliminar: adminEstrategiaModule.Deshabilitar
        });
    });

    $(document).keydown(function (e) {
        if (e.keyCode == 8 && e.target.tagName != 'INPUT' && e.target.tagName != 'TEXTAREA') {
            e.preventDefault();
        }
    });
</script>
