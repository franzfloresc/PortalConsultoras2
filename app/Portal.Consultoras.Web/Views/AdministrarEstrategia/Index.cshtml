@using Portal.Consultoras.Common

@model Portal.Consultoras.Web.Models.EstrategiaModel
@{
    ViewBag.Title = "Administración de Estrategias";
    var imagenVacia = "prod_grilla_vacio.png";
}

<script src="@Url.Content("~/Scripts/fileuploader.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery.form.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery.toast.min.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/handlebars.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery.paging.min.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/AdminContenido/ToastHelper.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/AdminContenido/Paginador.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/AdminContenido/Nemotecnico.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/AdminContenido/DescripcionComercial.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/AdminContenido/MatrizComercialFileUpload.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/AdminContenido/AdministrarEstrategia.js")" type="text/javascript"></script>

<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<link href="@Url.Content("~/Content/Css/Toast/jquery.toast.min.css")" rel="stylesheet" />

<input type="hidden" id="mensajeErrorCUV" />
<input type="hidden" id="mensajeErrorCUV2" />
<input type="hidden" id="hdEstrategiaIDConsulta" />
<input type="hidden" id="ImagenProducto" />
<input type="hidden" id="hdEstrategiaID" />
<input type="hidden" id="hdEstrategiaCodigo" />
<input type="hidden" id="hdTipoConsulta" value="0" />
<input type="hidden" id="hdZonas" value="" />
<input type="hidden" id="hdSimbolo" />
<input type="hidden" id="hdTallaColorID" />
<div class="wrap_cab_plan50">
    <div class="filtros2_plan50">
        <div class="elements_plan50">
            <div class="div-2">
                <h1><span>Zona de Estrategias @(Model.TipoVistaEstrategia == Constantes.TipoVistaEstrategia.ProgramaNuevas ? "- Programa de Nuevas" : string.Empty)</span></h1>
            </div>
            <div class="div-3">
                <div class="titG">País:</div>
                <div class="selectA borde_redondeado">
                    @Html.DropDownListFor(model => model.PaisID, new SelectList(Model.listaPaises, "PaisID", "Nombre"), "-- Seleccionar --", new { id = "ddlPais" })
                </div>
                <div class="titG">Campaña:</div>
                <div class="selectA borde_redondeado">
                    @Html.DropDownListFor(model => model.CampaniaID, new SelectList(Model.listaCampania, "CampaniaID", "NombreCorto"), "-- Seleccionar --", new { id = "ddlCampania" })
                </div>
            </div>
            <div class="div-3">
                <div class="titG">Tipo de Estrategia:</div>
                <div class="selectA borde_redondeado">
                    <select id="ddlTipoEstrategia" name="ddlTipoEstrategia">
                        @if (Model.ListaTipoEstrategia != null)
                        {
                            <option value="">-- Seleccionar --</option>
                            for (int i = 0; i < Model.ListaTipoEstrategia.Count(); i++)
                            {
                            <option flag-nueva="@Model.ListaTipoEstrategia.ToList()[i].FlagNueva"
                                    flag-recoproduct="@Model.ListaTipoEstrategia.ToList()[i].FlagRecoProduc"
                                    flag-recoperfil="@Model.ListaTipoEstrategia.ToList()[i].FlagRecoPerfil"
                                    codigo-programa="@Model.ListaTipoEstrategia.ToList()[i].CodigoPrograma"
                                    imagen-tipo="@Model.ListaTipoEstrategia.ToList()[i].Imagen"
                                    value="@Model.ListaTipoEstrategia.ToList()[i].TipoEstrategiaID"
                                    data-id="@Model.ListaTipoEstrategia.ToList()[i].CodigoGeneral"
                                    data-codigo="@Model.ListaTipoEstrategia.ToList()[i].Codigo"
									data-FValidarImagen = "@Model.ListaTipoEstrategia.ToList()[i].FlagValidarImagen"
									data-PesoMaximo = "@Model.ListaTipoEstrategia.ToList()[i].PesoMaximoImagen" >
                                @Model.ListaTipoEstrategia.ToList()[i].Descripcion
                            </option>
                            }
                        }
                    </select>
                </div>
                <div class="titG">CUV<sub>2</sub>:</div>
                <div class="selectA borde_redondeado">
                    <input type="text" id="CUV" name="CUV" />
                </div>
            </div>

            <div class="div-3">
                <div class="titG">Tiene imagen?:</div>
                <div class="selectA borde_redondeado">
                    <select id="ddlTieneImagen" name="ddlTieneImagen">
                        <option value="-1" selected>-- Seleccionar --</option>
                        <option value="1">Si</option>
                        <option value="0">No</option>
                    </select>
                </div>
                <div class="titG">Oferta Activa?:</div>
                <div class="selectA borde_redondeado">
                    <select id="ddlOfertaActiva" name="ddlOfertaActiva">
                        <option value="-1" selected>-- Seleccionar --</option>
                        <option value="1">Si</option>
                        <option value="0">No</option>
                    </select>
                </div>
            </div>

            <div class="div-3">
                <div class="titG">&nbsp;</div>
                <div class="input_horizontal">
                    <input type="button" name="btnBuscar" id="btnBuscar" value="Buscar" />
                </div>
            </div>
        </div>
    </div>
</div>
<div>
    <!--SHOWROOM-INICIO-->
    <div class="wrap_plan50" id="divShowRoomEvento" style="display: none;">
        <div class="container_plan50 clearfix">
            <h3>Evento</h3>
            <div id="divShowRoomEventoNuevo" style="display: none;">
                <div class="div-3">
                    <div class="input_search">
                        <input type="button" value="Nuevo Evento" id="btnNuevoShowRoom" name="">
                    </div>
                </div>
            </div>
            <div class="border-wrapper">
                <table id="listEvento"></table>
                <div id="pagerEvento"></div>
            </div>
        </div>
    </div>

    <div class="wrap_plan50" id="divPersonalizacion" style="display: none;">
        <div class="container_plan50 clearfix">
            <h3>Personalización</h3>
            <div class="div-3">
                <div class="titC">Nivel:</div>
                <div class="selectA borde_redondeado">
                    <select id="cbNivelEvento"></select>
                </div>

                <div class="input_horizontal">
                    <input type="button" value="Buscar Personalización" id="btnBuscarPersonalizacionNivel" name="">
                           <!--style="border-radius: 10px; background: #00A2E8; color: white; -webkit-appearance: none; border: 0; height: 38px;"-->
                </div>
            </div>
        </div>
    </div>

    <!--SHOWROOM-FIN-->
    <div class="wrap_plan50" id="divSeccionProductos" style="">
        <div class="container_plan50 clearfix">
            <h3>Producto</h3>
            <div class="div-3">
                <div class="input_horizontal">
                    <input type="button" name="btnNuevo" id="btnNuevo" value="Nuevo" />
                    @if (Model.TipoVistaEstrategia == Constantes.TipoVistaEstrategia.Todos)
                    {
                        <input type="button" name="btnNuevoMasivo" id="btnNuevoMasivo" value="Nuevo Masivo" />
                    }
                    <input type="button" name="btnActualizarTonos" id="btnActualizarTonos" value="Actualizar Tonos" />
                </div>
                <div class="input_modifica_pedido">
                    <input type="button" name="btnDescripcionMasivo" id="btnDescripcionMasivo" value="Descrip. Masivo" />
                    <input type="button" name="btnDescripcionMasivoProd" id="btnDescripcionMasivoProd" value="Descrip. Masivo Producto" style="display: none;" />
                    <input type="button" name="btnActivarDesactivar" id="btnActivarDesactivar" value="Activar/Desactivar" style="display: none;" />
                    <input type="button" name="btnCargaMasivaImagenes" id="btnCargaMasivaImagenes" value="Cargar Imagenes" style="display: none;" />
                </div>
            </div>

            <div class="border-wrapper">
                <table id="list"></table>
                <div id="pager"></div>
            </div>
            <div id="mensajeActivarDesactivar" style="display: none;">(*) Las filas con el check seleccionado indican que la oferta está habilitada. Las filas con el check sin seleccionar indican que la oferta no está habilitada.</div>
        </div>
    </div>
</div>

@Html.Partial("AdministrarEstrategiaDialog")

<div id="DialogZona" style="display: none;">
    <div class="Content_modal">
        <div class="div-3">
            <div class="treeview_est_content">
                <div id="arbolRegionZona" class="demo">
                </div>
            </div>
        </div>
        <div class="div-3">
            <div class="titF"></div>
            <div class="titF"></div>
            <div class="titH">
                <input type="checkbox" id="chkSeleccionar" />Seleccionar todo
            </div>
        </div>
    </div>
</div>
<div id="DialogEditarTallaColor" style="display: none;">
    <div class="Content_modal">
        <div class="div-3">
            <div class="titG">CUV:</div>
            <div class="selectP2 borde_redondeado">
                <input type="text" id="txtCUVTC" />
            </div>
        </div>
        <div class="div-3">
            <div class="titG">Descripción:</div>
            <div class="selectP2 borde_redondeado" style="width: 300px">
                <input type="text" id="txtDescripcionCUVTC" style="width: 290px" readonly="readonly" />
            </div>
        </div>
        <div class="div-3">
            <div class="titG">Precio:</div>
            <div class="selectP2 borde_redondeado">
                <input type="text" id="txtPrecioCUVTC" readonly="readonly" />
            </div>
        </div>
        <div class="div-3">
            <div class="titG">Tipo:</div>
            <div class="selectP2 borde_redondeado">
                <select id="ddlTallaColor">
                    <option value='0'>-- Seleccionar --</option>
                    <option value='C'>Color</option>
                    <option value='T'>Talla</option>
                </select>
            </div>
        </div>
        <div class="div-3">
            <div class="titG">Descripción (Talla/Color):</div>
            <div class="selectP2 borde_redondeado">
                <input type="text" id="txtDescripcionTC" />
            </div>
        </div>
    </div>
</div>
<div id="DialogTonoMarca" style="display: none;">
    <div class="Content_modal">
        <table id="listTC"></table>
        <div id="pagerTC"></div>
    </div>
</div>
<div id="DialogNuevoMasivo" style="display: none;">
    <div class="Content_modal">
        <div class="div-3" style="text-align: center;">
            <div class="boton_redondo_admcontenido_on" id="divPaso1">1</div>
            <div class="signo_admcontenido_estrategia">></div>
            <div class="boton_redondo_admcontenido_off" id="divPaso2">2</div>
            <div class="signo_admcontenido_estrategia">></div>
            <div class="boton_redondo_admcontenido_off" id="divPaso3">3</div>
        </div>
        <div id="divMasivoPaso1">
            <div class="div-3" style="text-align: center; color: #00A2E8;">
                Pre Carga de CUVS pendientes por configurar en Zona de Estrategias
            </div>
            <div class="container" style="width: auto;">
                <div class="border-wrapper">
                    <table id="listCargaMasiva1"></table>
                    <div id="pagerCargaMasiva1"></div>
                </div>
            </div>
            <div id="divMostrarPreCarga">
                <div class="div-3" style="text-align: center; color: #00A2E8; margin-top: 20px;">
                    ¿Deseas pre cargar la información de los CUVS pendientes por configurar? (<span id="spnCantidadConfigurar1">11</span>) CUVS
                </div>
                <div class="div-3">
                    <div class="input_horizontal" style="text-align: center;">
                        <input type="button" name="btnAceptarMasivo1" id="btnAceptarMasivo1" value="Aceptar" style="float: none;" />
                        <input type="button" name="btnCancelarMasivo1" id="btnCancelarMasivo1" value="Cancelar" style="float: none;" />
                    </div>
                </div>
            </div>
        </div>
        <div id="divMasivoPaso2" style="display: none;">
            <div class="div-3" style="text-align: center; color: #00A2E8;">
                Grabar información en Zona de Estrategias
            </div>
            <div class="container" style="width: auto;">
                <div class="border-wrapper">
                    <table id="listCargaMasiva2"></table>
                    <div id="pagerCargaMasiva2"></div>
                </div>
            </div>
            <div id="divMostrarPreCarga2">
                <div class="div-3" style="text-align: center; color: #00A2E8; margin-top: 20px;">
                    ¿Deseas grabar la información de los CUVS pre cargados correctamente en la Zona de Estrategias? (<span id="spnCantidadConfigurar2">11</span>) CUVS
                </div>
                <div class="div-3">
                    <div class="input_horizontal" style="text-align: center;">
                        <input type="button" name="btnAceptarMasivo2" id="btnAceptarMasivo2" value="Aceptar" style="float: none;" />
                        <input type="button" name="btnCancelarMasivo2" id="btnCancelarMasivo2" value="Cancelar" style="float: none;" />
                    </div>
                </div>
            </div>
        </div>
        <div id="divMasivoPaso3" style="display: none;">
            <div class="div-3" style="text-align: center; color: #00A2E8;">
                Confirmación de grabación en Zona de Estrategias
            </div>
            <div class="div-3" style="text-align: center; margin-top: 20px;">
                Se grabó la información de los <a onclick="adminEstrategiaModule.VerCuvsTipo2(1); "><span id="spnCantidadConfigurar3">11</span> CUVS</a>
            </div>
            <div id="divMostrarNoCargados" class="div-3" style="text-align: center; margin-top: 20px;">
                Quedan <a onclick="adminEstrategiaModule.VerCuvsTipo2(2); "><span id="spnCantidadNoConfigurar3">11</span> CUVS</a> pendientes para cargar.
            </div>
            <div class="div-3">
                <div class="input_horizontal" style="text-align: center;">
                    <input type="button" name="btnAceptarMasivo3" id="btnAceptarMasivo3" value="Aceptar" style="float: none;" />
                </div>
            </div>
        </div>
    </div>
</div>
<div id="DialogGrillaCuv1">
    <div class="Content_modal">
        <div class="container" style="width: auto;">
            <div class="border-wrapper">
                <table id="listGrillaCuv1"></table>
                <div id="pagerGrillaCuv1"></div>
            </div>
        </div>
    </div>
</div>
<div id="DialogGrillaCuv2">
    <div class="Content_modal">
        <div class="container" style="width: auto;">
            <div class="border-wrapper">
                <table id="listGrillaCuv2"></table>
                <div id="pagerGrillaCuv2"></div>
            </div>
        </div>
    </div>
</div>

<div id="DialogDescMasivo" style="display: none;">
    <div class="Content_modal">
        <div id="divDescMasivoPaso1">
            <div class="div-3" style="text-align: center;">
                Seleccione el archivo para la carga masiva de las descripciones:
            </div>
            <div class="container" style="width: 70%;">
                <div class="border-wrapper">
                    <input type="file" id="fileDescMasivo" name="fileDescMasivo"/>
                </div>
            </div>
            <div class="div-3" style="margin: 15px auto; width: 200px;">
                Formato de archivo (*.csv):<br/>
                    - CUV<br />
                <span id="seccionFormatoArchivoGeneral">                    
                    - Descripción<br />
                </span>
                <span id="seccionFormatoArchivoShowroon">
                    - Precio Normal<br />
                    - Unidades Permitidas<br />
                    - Nombre de Set<br />
                    - Tip Negocio<br />
                    - Es Subcampaña<br />
                    <br><i>Separador de campos:</i> "|"
                </span>
            </div>
            <div class="div-3">
                <div class="input_horizontal" style="text-align: center;">
                    <input type="button" name="btnAceptarMasivo1" id="btnAceptarDescMasivo1" value="Continuar" style="float: none;" />
                    <input type="button" name="btnCancelarMasivo1" id="btnCancelarDescMasivo1" value="Cancelar" style="float: none;" />
                </div>
            </div>
        </div>
        <div id="divDescMasivoPaso2" style="display: none;">
            <div class="div-3" style="text-align: center;">
                Resultado de la actualización: 
            </div>
            <div class="container" style="margin: 15px auto; width: auto;">                
                <div class="border-wrapper">
                    <label id="estadoCargaMasiva"></label>
                    <table id="listCargaDescMasiva"></table>
                    <div id="pagerCargaDescMasiva"></div>
                </div>
            </div>
            <div class="div-3">
                <div class="input_horizontal" style="text-align: center;">
                    <input type="button" name="btnCancelarMasivo2" onclick="HideDialog('DialogDescMasivo')" value="Cerrar" style="float: none;" />
                </div>
            </div>
        </div>
    </div>
</div>
<div id="DialogDescActualizada">
    <div class="Content_modal">
        <div class="container" style="margin: 15px auto; width: auto;">
            <div class="border-wrapper">
                <table id="listDescActualizada"></table>
                <div id="pagerDescActualizada"></div>
            </div>
        </div>
        <div class="div-3">
            <div class="input_horizontal" style="text-align: center;">
                <input type="button" name="btnCancelarMasivo2" onclick="HideDialog('DialogDescActualizada')" value="Volver" style="float: none;" />
            </div>
        </div>
    </div>
</div>
<div id="DialogDescNoActualizada">
    <div class="Content_modal">
        <div class="container" style="margin: 15px auto; width: auto;">
            <div class="border-wrapper">
                <table id="listDescNoActualizada"></table>
                <div id="pagerDescNoActualizada"></div>
            </div>
        </div>
        <div class="div-3">
            <div class="input_horizontal" style="text-align: center;">
                <input type="button" name="btnCancelarMasivo2" onclick="HideDialog('DialogDescNoActualizada')" value="Volver" style="float: none;" />
            </div>
        </div>
    </div>
</div>

<!-- SHOWROOM-INICIO -->

<div id="DialogDatosShowRoom" style="display: none;">
    <div class="Content_modal">
        <input type="hidden" id="hdEventoID" />
        <input type="hidden" id="hdCampaniaMinimaPersonalizacion" />
        <div class="div-3">
            <div class="titG">País:</div>
            <div class="selectP2 borde_redondeado" style="background: #F9F9F0;">
                <input type="text" id="txtEventoPaisID" readonly="readonly" style="background: #F9F9F0;" />
            </div>
            <div class="titG">Campaña:</div>
            <div class="selectP2 borde_redondeado" style="background: #F9F9F0;">
                <input type="text" id="txtEventoCampaniaID" readonly="readonly" style="background: #F9F9F0;" />
            </div>
        </div>
        <div class="div-3">
            <div class="titG">Nombre:</div>
            <div class="selectP2 borde_redondeado">
                <input type="text" id="txtEventoNombre" />
            </div>
            <div class="titG">Tema:</div>
            <div class="selectP2 borde_redondeado">
                <input type="text" id="txtEventoTema" />
            </div>
        </div>
        <div class="div-3">
            <div class="titG">Dias Antes Fact.:</div>
            <div class="selectP2 borde_redondeado">
                <input type="text" id="txtEventoDiasAntes" onkeypress="return FuncionesGenerales.ValidarSoloNumeros(event);" />
            </div>
            <div class="titG">Dias Despues Fact.:</div>
            <div class="selectP2 borde_redondeado">
                <input type="text" id="txtEventoDiasDespues" onkeypress="return FuncionesGenerales.ValidarSoloNumeros(event);" />
            </div>
        </div>
        <div class="div-3">

            <div id="divEventoEstado">
                <div class="titG">Habilitar Evento</div>
                <div class="selectCheck borde_redondeado" style="float: left; width: 170px; margin-right: 30px;">
                    <input type="checkbox" class="check" id="chkEventoEstado" />
                </div>
            </div>
            <div>
                <div class="titG">Habilitar Compra por Compra</div>
                <div class="selectCheck borde_redondeado" style="float: left; width: 170px; margin-right: 30px; ">
                    <input type="checkbox" class="check" id="chkEventocompraXcompra" />
                </div>
            </div>
        </div>
        <div class="div-3">
            <div>
                <div class="titG">Habilitar SubCampañas</div>
                <div class="selectCheck borde_redondeado" style="float: left; width: 170px; margin-right: 30px; ">
                    <input type="checkbox" class="check" id="chkEventoTieneSubCampania" />
                </div>
            </div>
        </div>
        <div class="div-3">

        </div>
    </div>
</div>

<div id="DialogPersonalizacionDetalle">
    <div class="wrap">
        <fieldset style="border: 1px black; border-style: groove; margin-bottom: 20px;">
            <legend></legend>
            <div class="container clearfix" style="width: 750px;">
                <h3>Mobile</h3>
                <div id="divPersonalizacionDetalleMobile">
                </div>
            </div>
        </fieldset>
        <fieldset style="border: 1px black; border-style: groove;">
            <legend></legend>
            <div class="container clearfix" style="width: 750px;">
                <h3>Desktop</h3>
                <div id="divPersonalizacionDetalleDesktop">

                </div>
            </div>
        </fieldset>
    </div>
</div>

<div id="DialogRegistroOfertaShowRoomDetalle" style="display: none;">
    <div class="Content_modal" style="max-height: 450px;">
        <div class="div-3">
            <div class="titG">País:</div>
            <div class="selectP2 borde_redondeado" style="background: #F9F9F0;">
                <input type="text" id="txtPaisDetalle" readonly="readonly" style="background: #F9F9F0;" />
            </div>
            <div class="titG">Campaña:</div>
            <div class="selectP2 borde_redondeado" style="background: #F9F9F0;">
                <input type="text" id="txtCampaniaDetalle" readonly="readonly" style="background: #F9F9F0;" />
            </div>
        </div>
        <div class="div-3">
            <div class="titG">CUV:</div>
            <div class="selectP2 borde_redondeado" style="background: #F9F9F0;">
                <input type="text" id="txtCUVDetalle" readonly="readonly" style="background: #F9F9F0;" />
            </div>
            <div class="titG">Precio Normal:</div>
            <div class="selectP2 borde_redondeado" style="background: #F9F9F0;">
                <input type="text" id="txtPrecioValorizadoDetalle" readonly="readonly" style="background: #F9F9F0;" />
            </div>
        </div>
        <div class="div-3">
            <div class="titG">Descripción:</div>
            <div class="selectP2 borde_redondeado" style="background: #F9F9F0; width: 513px;">
                <input type="text" id="txtDescripcionDetalle" readonly="readonly" style="background: #F9F9F0; width: 513px;" />
            </div>
        </div>
        <div class="div-3">
            <div class="input_search" style="float: right; padding-right: 155px;">
                <input type="button" value="Nuevo" id="btnNuevoDetalle" name="">
            </div>
        </div>
        <div class="container" style="width: auto;">
            <div class="border-wrapper">
                <table id="listShowRoomDetalle"></table>
                <div id="pagerShowRoomDetalle"></div>
            </div>
        </div>
    </div>
</div>

<div id="DialogRegistroOfertaShowRoomDetalleEditar" style="display: none;">
    <div class="Content_modal">
        @*<input type="hidden" id="hdOfertaShowRoomDetalleID" />*@
        <input type="hidden" id="hdEstrategiaProductoID" />
        <input type="hidden" id="hdEstrategiaID" />
        <input type="hidden" id="hdImagenDetalle" />
        <input type="hidden" id="hdImagenDetalleAnterior" />

        <div class="div-3">
            <div class="titG">CUV:</div>
            <div class="selectP2 borde_redondeado">
                <input type="text" id="txtCUVProductoDetalle" />
            </div>
            <div class="titG">Marca Producto:</div>
            <div class="selectP2 borde_redondeado">
                <select id="ddlMarcaProductoDetalle">
                    <option value="0" selected>Seleccione</option>
                    <option value="1">Lbel</option>
                    <option value="2">Esika</option>
                    <option value="3">Cyzone</option>
                </select>
            </div>
        </div>

        <div class="div-3">
            <div class="titG">Nombre Producto:</div>
            <div class="selectP2 borde_redondeado">
                <input type="text" id="txtNombreProductoDetalle" />
            </div>
            <div class="titG">Descripcion 1:</div>
            <div class="selectP2 borde_redondeado">
                <input type="text" id="txtDescripcion1Detalle" />
            </div>
        </div>
        @*<div class="div-3">
            <div class="titG">Descripcion 2:</div>
            <div class="selectP2 borde_redondeado">
                <input type="text" id="txtDescripcion2Detalle" />
            </div>
            <div class="titG">Descripcion 3:</div>
            <div class="selectP2 borde_redondeado">
                <input type="text" id="txtDescripcion3Detalle" />
            </div>
        </div>*@
        <div class="div-3">
            <div class="titG">Precio Oferta:</div>
            <div class="selectP2 borde_redondeado">
                <input type="text" id="txtPrecioOfertaDetalle" />
            </div>
            <div class="titG">¿Activar Oferta?:</div>
            <div class="selectP2 borde_redondeado">
                <input type="checkbox" id="chkActivoOfertaDetalle" />
            </div>
        </div>
        @*<div class="div-3">
            <div class="titG">Marca Producto:</div>
            <div class="selectP2 borde_redondeado">
                <input type="text" id="txtMarcaProductoDetalle" />
            </div>
            
        </div>*@
        <div class="div-3">
            <div class="titG">Imagen:</div>
            <div class="pdr_modal borde_redondeado aligncenter" style="width: 168px; height: 200px;">
                <img src='@Url.Content("~/Content/Images/prod_grilla_vacio.png")' id="imgProductoDetalle" style="cursor: pointer; max-width: 100% !important;">
            </div>
        </div>
        <div class="div-3">
            <div class="titG"></div>
            <div class="titC" style="padding: 0; width: 180px; padding-right: 20px;">
                <div class="input_search">
                    <div id="fpPopupImagenProductoDetalle">
                        <script type="text/javascript">
                            $.ajaxSetup({ cache: false });
                            var uploader = new qq.FileUploader({
                                allowedExtensions: ['jpg', 'png', 'jpeg', 'gif'],
                                element: document.getElementById('fpPopupImagenProductoDetalle'),
                                action: '@Url.Action("ImageMatrizUpload", "FileUpload")',
                                onComplete: function(id, fileName, responseJSON) {
                                    if (checkTimeout(responseJSON)) {
                                        $(".qq-upload-list").css("display", "none");
                                        if (responseJSON.success) {
                                            var rutaImagen = '@Url.Content("~/Content/Temporales/")' + responseJSON.name;
                                            $("#imgProductoDetalle").attr('src', rutaImagen);
                                            $("#hdImagenDetalle").val(responseJSON.name);
                                        } else {
                                            alert(responseJSON.message);
                                        }
                                    }
                                },
                                onSubmit: function(id, fileName) { $(".qq-upload-list").css("display", "none"); },
                                onProgress: function(id, fileName, loaded, total) { $(".qq-upload-list").css("display", "none"); },
                                onCancel: function(id, fileName) { $(".qq-upload-list").css("display", "none"); }
                            });
                        </script>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- SHOWROOM-FIN -->

<div id="loadingScreen"></div>

<div id="DialogActualizarTono">
    <div class="Content_modal" style="overflow: hidden;">
        <div id="divActualizarTono">
            <div class="div-3" style="text-align: center;">
                Resultado de la actualización:
            </div>
            <div class="container" style="margin: 15px auto; width: auto;">
                <div class="border-wrapper">
                    <table id="listActualizarTono"></table>
                    <div id="pagerActualizarTono"></div>
                </div>
            </div>
            <div class="div-3">
                <div class="input_horizontal" style="text-align: center;">
                    <input type="button" name="btnCancelarMasivo2" onclick="HideDialog('DialogActualizarTono')" value="Cerrar" style="float: none;" />
                </div>
            </div>
        </div>
    </div>
</div>

<div id="DialogTonoActualizada">
    <div class="Content_modal" style="overflow: hidden;">
        <div class="container" style="margin: 15px auto; width: auto;">
            <div class="border-wrapper">
                <table id="listTonoActualizada"></table>
                <div id="pagerTonoActualizada"></div>
            </div>
        </div>
        <div class="div-3">
            <div class="input_horizontal" style="text-align: center;">
                <input type="button" name="btnCancelarMasivo2" onclick="HideDialog('DialogTonoActualizada')" value="Volver" style="float: none;" />
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
    var adminEstrategiaModule;
    var _toastHelper = ToastHelper();
    // SHOWROOM-INICIO
    var paisNombre = "";
    var urlConsultarShowRoom = baseUrl + 'ShowRoom/ConsultarShowRoom';
    var urlGetShowRoomNiveles = baseUrl + 'ShowRoom/GetShowRoomNiveles';
    var urlGetShowRoomPersonalizacionNivel = baseUrl + 'ShowRoom/GetShowRoomPersonalizacionNivel';
    var urlGuardarPersonalizacionNivelShowRoom = baseUrl + 'ShowRoom/GuardarPersonalizacionNivelShowRoom';
    var urlImageMatrizUpload = '@Url.Action("ImageMatrizUpload", "FileUpload")';
    var urlDeshabilitarShowRoomEvento = baseUrl + 'ShowRoom/DeshabilitarShowRoomEvento';
    var urlEliminarShowRoomEvento = baseUrl + 'ShowRoom/EliminarShowRoomEvento';
    var urlGuardarShowRoom = baseUrl + 'ShowRoom/GuardarShowRoom';
    var urlConsultarOfertaShowRoomDetalle = baseUrl + "ShowRoom/ConsultarOfertaShowRoomDetalle";
    var urlEliminarOfertaShowRoomDetalleAll = baseUrl + 'ShowRoom/EliminarOfertaShowRoomDetalleAll';
    var urlEliminarOfertaShowRoomDetalle = baseUrl + 'ShowRoom/EliminarOfertaShowRoomDetalle';
    var urlInsertOfertaShowRoomDetalle = baseUrl + 'ShowRoom/InsertOfertaShowRoomDetalle';
    var urlUpdateOfertaShowRoomDetalle = baseUrl + 'ShowRoom/UpdateOfertaShowRoomDetalle';
    var rutaImagenTemporal = '@Url.Content("~/Content/Temporales/")';
    var imagenEdit = '@Url.Content("~/Content/Images/Edit.png")';
    var imagenDeshabilitar = '@Url.Content("~/Content/Images/NotAllowed.png")';
    var imagenEliminar = '@Url.Content("~/Content/Images/delete.png")';
    var imagenProductoVacio = '@Url.Content("~/Content/Images/prod_grilla_vacio.png")';
    // SHOWROOM-FIN

    jQuery(document).ready(function () {
        adminEstrategiaModule = AdministrarEstrategia({
            actualizarMatrizComercialAction: '@Url.Action("ActualizarMatrizComercial", "MatrizComercial")',
            getImagesBySapCodeAction: '@Url.Action("GetImagesBySapCode", "AdministrarEstrategia")',
            getFiltrarEstrategiaAction: '@Url.Action("FiltrarEstrategia", "AdministrarEstrategia")',
            uploadAction: '@Url.Action("ImageMatrizUpload", "FileUpload")',
            getImagesByCodigoSAPAction: '@Url.Action("GetImagesByCodigoSAP", "MatrizComercial")',
            getImagesByNemotecnico: '@Url.Action("GetImagesByNemotecnicoSAP", "MatrizComercial")',
            habilitarNemotecnico: @Json.Encode(Model.habilitarNemotecnico),
            expValidacionNemotecnico: @Html.Raw(Model.ExpValidacionNemotecnico),
            actualizarDescripcionComercialAction: '@Url.Action("ActualizarDescripcionComercial", "MatrizComercial")',
            tipoEstrategiaIncentivosProgramaNuevas: '@Constantes.TipoEstrategiaCodigo.IncentivosProgramaNuevas',
            rutaImagenVacia: '@Url.Content("~/Content/Images/" + imagenVacia)',
            urlActivarDesactivarEstrategias: baseUrl + 'AdministrarEstrategia/ActivarDesactivarEstrategias',
            rutaImagenEdit: '@Url.Content("~/Content/Images/Edit.png")',
            rutaImagenDelete: '@Url.Content("~/Content/Images/Delete.png")',
            urlGetOfertaByCUV: baseUrl + 'AdministrarEstrategia/GetOfertaByCUV',
            urlS3: "@Model.UrlS3",
            rutaTemporal: '@Url.Content("~/Content/Temporales/")',
            urlConsultarCuvTipoConfigurado: baseUrl + 'AdministrarEstrategia/ConsultarCuvTipoConfigurado',
            urlConsultarCuvTipoConfiguradoTemporal: baseUrl + 'AdministrarEstrategia/ConsultarCuvTipoConfiguradoTemporal',
            urlDeshabilitarEstrategia: baseUrl + 'AdministrarEstrategia/DeshabilitarEstrategia',
            urlImageLanzamientoUpload: '@Url.Action("ImageLanzamientoUpload", "FileUpload")',
            urlUploadCvs: '@Url.Action("UploadCvs", "AdministrarEstrategia")',
            rutaImagenDisable: '@Url.Content("~/Content/Images/NotAllowed.png")',
            urlEliminarEstrategia: baseUrl + 'AdministrarEstrategia/EliminarEstrategia'
        });
        adminEstrategiaModule.Inicializar();

        $.jgrid.extend({
            Editar: adminEstrategiaModule.Editar,
            Eliminar: adminEstrategiaModule.Deshabilitar,
            Remover: adminEstrategiaModule.remover,
            EditarEvento: adminEstrategiaModule.EditarEvento,
            DeshabilitarEvento: adminEstrategiaModule.DeshabilitarEvento,
            EliminarEvento: adminEstrategiaModule.EliminarEvento,
            EditarProducto: adminEstrategiaModule.EditarProducto,
            EliminarProducto: adminEstrategiaModule.EliminarProducto,
            EditarProductoDetalle: adminEstrategiaModule.EditarProductoDetalle,
            EliminarProductoDetalle: adminEstrategiaModule.EliminarProductoDetalle
        });
            // SHOWROOM-FIN
            
            if (aux1 == "4" || aux2 == "005" || aux2 == "007" || aux2 == "008" || aux2 == Codigo.CodigoShowRoom) {
            else if (aux1 == "4" || aux1 == "5" || aux2 == "005" || aux2 == "007" || aux2 == "008" || aux2 == Codigo.CodigoShowRoom) {
            if (aux2 == Codigo.CodigoShowRoom) {
                VistaNuevoProductoShowroon();
            } else {
                VistaNuevoProductoGeneral();
            }




                        Codigo.OfertasParaMi, Codigo.PackAltoDesembolso, Codigo.GuiaDeNegocio, Codigo.CodigoShowRoom)) {
                if (aux2 == Codigo.CodigoShowRoom) {
                    $("#btnDescripcionMasivo").val("Descrip. Masivo Set");
                    //$("#btnDescripcionMasivoProd").show();
                }
                else {
                    $("#btnDescripcionMasivo").val("Descrip. Masivo");
                    //$("#btnDescripcionMasivoProd").hide();
                }


            //kaka
            $("#list").html("");
            $("#divShowRoomEvento").hide();
            $("#divShowRoomEventoNuevo").hide();
            $("#divPersonalizacion").hide();
            $('#divSeccionProductos').hide();

            paisNombre = $("#ddlPais option:selected").text();
            var codigo = $('#ddlTipoEstrategia').find(':selected').data('codigo');
            if (codigo == Codigo.CodigoShowRoom) {
                cargarEventoShowRoom();
            }
            else {
                fnGrilla();
            }

            if (codigo == Codigo.OfertaParaTi ||
                codigo == Codigo.OfertaDelDia ||
                codigo == Codigo.Lanzamiento ||
                codigo == Codigo.OfertasParaMi ||
                codigo == Codigo.PackAltoDesembolso ||
                codigo == Codigo.GuiaDeNegocio ||
                codigo == Codigo.LosMasVendidos ||
                codigo == Codigo.CodigoShowRoom) {
                $("#mensajeActivarDesactivar").show();
            } else {
                $("#mensajeActivarDesactivar").hide();
            }




                if ($('#ddlTipoEstrategia').find(':selected').data('codigo') == Codigo.CodigoShowRoom) {
                    $("#ui-id-10").text('Carga masiva de Showroom');
                } else {
                    $("#ui-id-10").text('Carga masiva de descripciones de Estrategias');
                }
                if ($('#ddlTipoEstrategia').find(':selected').data('codigo') == Codigo.CodigoShowRoom) {
                    $("#seccionFormatoArchivoShowroon").show();
                    $("#seccionFormatoArchivoGeneral").hide();
                } else {
                    $("#seccionFormatoArchivoGeneral").show();
                    $("#seccionFormatoArchivoShowroon").hide();
                }


            $('#estadoCargaMasiva').text('');
            if ($('#ddlTipoEstrategia').find(':selected').data('codigo') == Codigo.CodigoShowRoom) {
                UploadFileStrategyShowroom();
            }else{
                UploadFileCvs();
            }



        //SHOWROOM-INICIO

        $("#btnBuscarPersonalizacionNivel").click(function() {
            var eventoId = $("#hdEventoID").val();
            var nivelId = $("#cbNivelEvento").val();

            if (eventoId == undefined || eventoId == 0) {
                //alert_msg("Evento no se puedo identificar");
                alert('Evento no se puedo identificar');
                return false;
            }

            if (nivelId == undefined || nivelId == 0) {
                //alert_msg("Debe seleccionar un Nivel");
                alert('Debe seleccionar un Nivel');
                return false;
            }

            var item = { eventoId: eventoId, nivelId: nivelId };

            waitingDialog({ title: "Procesando" });
            jQuery.ajax({
                type: 'POST',
                url: urlGetShowRoomPersonalizacionNivel,
                dataType: 'json',
                contentType: 'application/json; charset=utf-8',
                data: JSON.stringify(item),
                async: true,
                success: function (response) {
                    if (checkTimeout(response)) {
                        if (response.success) {
                            closeWaitingDialog();

                            $("#divPersonalizacionDetalleDesktop").html("");
                            $("#divPersonalizacionDetalleMobile").html("");
                            var listaPersonalizacion = response.listaPersonalizacion;

                            var listaPersonalizacionDesktop = listaPersonalizacion.Find("TipoAplicacion", "Desktop");
                            var listaPersonalizacionMobile = listaPersonalizacion.Find("TipoAplicacion", "Mobile");

                            $.each(listaPersonalizacionMobile, function (index, value) {
                                var htmlPersonalizacion = '';
                                htmlPersonalizacion += '<div class="div-3" data-idpersonalizacion="' + value.PersonalizacionId + '">';
                                htmlPersonalizacion += '<input type="hidden" class="hdPersonalizacionNivelId" value="' + value.PersonalizacionNivelId + '"/>';

                                var valor = value.TipoAtributo == 'IMAGEN' ? value.Valor.replace(/^.*[\\\/]/, '') : value.Valor;
                                htmlPersonalizacion += '<input type="hidden" class="hdValor" value="' + valor + '"/>';
                                htmlPersonalizacion += '<input type="hidden" class="hdValorAnterior" value="' + valor + '"/>';

                                htmlPersonalizacion += '<input type="hidden" class="hdAtributo" value="' + value.Atributo + '"/>';
                                htmlPersonalizacion += '<input type="hidden" class="hdTipoAtributo" value="' + value.TipoAtributo + '"/>';

                                if (value.TipoAtributo == 'IMAGEN') {

                                    htmlPersonalizacion += '<div class="titC" style="width: 250px; margin-top: 15px;">' + value.TextoAyuda + '</div>';
                                    htmlPersonalizacion += '<div class="titC" style="padding: 0; width: 230px;">';
                                    htmlPersonalizacion += '<div class="input_search">';
                                    htmlPersonalizacion += '<div class="fpPopupImagenPersonalizacion">';
                                    htmlPersonalizacion += '</div>';
                                    htmlPersonalizacion += '</div>';
                                    htmlPersonalizacion += '<div class="divPopupImagenPersonalizacion" style="width: 100px; height: 60px; float: right;">';

                                    if (value.PersonalizacionNivelId != 0 && value.Valor != "") {
                                        htmlPersonalizacion += '<img  alt="" src="' + value.Valor + '" style="width: auto; height: 60px; max-width: 300px !important;"/>';
                                    }

                                    htmlPersonalizacion += '</div>';
                                    htmlPersonalizacion += '</div>';
                                } else {

                                    htmlPersonalizacion += '<div class="titC" style="width: 250px;">' + value.TextoAyuda + '</div>';
                                    htmlPersonalizacion += '<div class="selectP2 borde_redondeado" style="width: 400px;">';
                                    htmlPersonalizacion += '<input type="text" class="txtAtributoPersonalizacion" value="' + value.Valor + '" style="width: 400px;"/>';
                                    htmlPersonalizacion += '</div>';
                                }

                                htmlPersonalizacion += '</div>';

                                $("#divPersonalizacionDetalleMobile").append(htmlPersonalizacion);

                                if (value.TipoAtributo == 'IMAGEN') {
                                    InsertarImagenPersonalizacion(value.PersonalizacionId);
                                }
                            });

                            $.each(listaPersonalizacionDesktop, function (index, value) {
                                var htmlPersonalizacion = '';
                                htmlPersonalizacion += '<div class="div-3" data-idpersonalizacion="' + value.PersonalizacionId + '">';
                                htmlPersonalizacion += '<input type="hidden" class="hdPersonalizacionNivelId" value="' + value.PersonalizacionNivelId + '"/>';

                                var valor = value.TipoAtributo == 'IMAGEN' ? value.Valor.replace(/^.*[\\\/]/, '') : value.Valor;
                                htmlPersonalizacion += '<input type="hidden" class="hdValor" value="' + valor + '"/>';
                                htmlPersonalizacion += '<input type="hidden" class="hdValorAnterior" value="' + valor + '"/>';

                                htmlPersonalizacion += '<input type="hidden" class="hdAtributo" value="' + value.Atributo + '"/>';
                                htmlPersonalizacion += '<input type="hidden" class="hdTipoAtributo" value="' + value.TipoAtributo + '"/>';

                                if (value.TipoAtributo == 'IMAGEN') {

                                    htmlPersonalizacion += '<div class="titC" style="width: 250px; margin-top: 15px;">' + value.TextoAyuda + '</div>';
                                    htmlPersonalizacion += '<div class="titC" style="padding: 0; width: 230px;">';
                                    htmlPersonalizacion += '<div class="input_search">';
                                    htmlPersonalizacion += '<div class="fpPopupImagenPersonalizacion">';
                                    htmlPersonalizacion += '</div>';
                                    htmlPersonalizacion += '</div>';
                                    htmlPersonalizacion += '<div class="divPopupImagenPersonalizacion" style="width: 100px; height: 60px; float: right;">';

                                    if (value.PersonalizacionNivelId != 0 && value.Valor != "") {
                                        htmlPersonalizacion += '<img  alt="" src="' + value.Valor + '" style="width: auto; height: 60px; max-width: 300px !important;"/>';
                                    }

                                    htmlPersonalizacion += '</div>';
                                    htmlPersonalizacion += '</div>';
                                } else {

                                    htmlPersonalizacion += '<div class="titC" style="width: 250px;">' + value.TextoAyuda + '</div>';
                                    htmlPersonalizacion += '<div class="selectP2 borde_redondeado" style="width: 400px;">';
                                    htmlPersonalizacion += '<input type="text" class="txtAtributoPersonalizacion" value="' + value.Valor + '" style="width: 400px;"/>';
                                    htmlPersonalizacion += '</div>';
                                }

                                htmlPersonalizacion += '</div>';

                                $("#divPersonalizacionDetalleDesktop").append(htmlPersonalizacion);

                                if (value.TipoAtributo == 'IMAGEN') {
                                    InsertarImagenPersonalizacion(value.PersonalizacionId);
                                }
                            });

                            showDialog("DialogPersonalizacionDetalle");
                        } else {
                            closeWaitingDialog();
                        }
                    }
                },
                error: function (response, error) {
                    if (checkTimeout(response)) {
                        //alert_msg(response.message);
                        alert(response.message);
                        closeWaitingDialog();
                    }
                }
            });

        });

        $("#btnNuevoShowRoom").click(function () {
            LimpiarDatosEventoShowRoom();
            $("#txtEventoPaisID").val(paisNombre);
            $("#txtEventoCampaniaID").val($("#ddlCampania").val());

            $("#divEventoEstado").css("display", "none");

            //$("#divShowRoomPerfil").css("display", "none");

            /*
            if ($("#hdCampaniaMinimaPersonalizacion").val()) {
                var campaniaMinimaPersonalizacion = parseInt($("#hdCampaniaMinimaPersonalizacion").val());
                if (parseInt($("#ddlCampania").val()) >= campaniaMinimaPersonalizacion) {
                    $("#chkEventoTienePersonalizacion").prop('checked', true);
                }
            }
            */

            showDialog("DialogDatosShowRoom");
        });

        $("#btnNuevoDetalle").click(function () {
            LimpiarDatosEventoShowRoomDetalle();

            $('#txtCUVProductoDetalle').attr('readonly', false);
            $('#txtPrecioOfertaDetalle').attr('readonly', false);

            showDialog("DialogRegistroOfertaShowRoomDetalleEditar");
        });

        //SHOWROOM-FIN

    });

    $(document).keydown(function (e) {
        if (e.keyCode == 8 && e.target.tagName != 'INPUT' && e.target.tagName != 'TEXTAREA') {
            e.preventDefault();
        }
    });
        $('#divSeccionProductos').show();
        var colNameActions = (codigo == Codigo.CodigoShowRoom) ? "Set" : ""
        var hideColProducts = (codigo == Codigo.CodigoShowRoom) ? false : true;

            multiselect: (tipo == '4' || tipo == '7' || tipo == '20' || codigo == "005" || codigo == "007" || codigo == "008" || codigo == "010" || codigo == Codigo.CodigoShowRoom),
            multiselectWidth: 35,
            colNames: ['EstrategiaID', 'Orden', '#', 'Pedido Asociado', 'Precio', 'CUV2', 'Descripción', 'Limite Venta', 'Código SAP', 'ImagenURL', 'Foto', colNameActions, 'Productos', 'EsOfertaIndependiente'],
                { name: 'Activo', index: 'Activo', width: 60, align: 'center', editable: true, resizable: false, sortable: false, formatter: ShowActions },
                { name: 'Activo', index: 'Activo', width: 60, align: 'center', editable: true, resizable: false, sortable: false, hidden: hideColProducts, formatter: ShowActionsProductos },
                { name: 'EsOfertaIndependiente', index: 'EsOfertaIndependiente', width: 0, editable: true, hidden: true }
        if (tipo == "4" || codigo == "005" || codigo == "007" ||
            codigo == "008" || codigo == "010" || codigo == Codigo.CodigoShowRoom) {
            $("#list").jqGrid('hideCol', ["Orden"]);
        }

        $("<span style=\"position: absolute;margin-top: 10px;\">(*)</span>").prependTo("#jqgh_list_cb");
    function ShowActions(cellvalue, options, rowObject) {
        var id = rowObject[0];
        var edit = "&nbsp;<a href='javascript:;' onclick=\"return jQuery('#list').Editar('" + id + "',event);\" >" + "<img src='" + rutaImagenEdit + "' alt='Editar Estrategia' title='Editar Estrategia' border='0' /></a>";
        var disable = "";
        if (rowObject[10] == "1") {
            disable += "&nbsp;&nbsp;<a href='javascript:;' onclick=\"return jQuery('#list').Eliminar('" + id + "',event);\" >" + "<img src='" + rutaImagenDisable + "' alt='Deshabilitar Estrategia' title='Deshabilitar Estrategia' border='0' /></a>";
        }
        var remove = "";
        if ($('#ddlTipoEstrategia').find(':selected').data('codigo') == Codigo.CodigoShowRoom) {
          remove += "&nbsp;&nbsp;<a href='javascript:;' onclick=\"return jQuery('#list').Remover('" + id + "',event);\" >" + "<img src='" + rutaImagenDelete + "' alt='Eliminar Estrategia' title='Eliminar Estrategia' border='0' /></a>";
        }

        return edit + disable + remove;
    }

    function ShowActionsProductos(cellvalue, options, rowObject) {
        if (rowObject[10] == "1")
        {
            var id = rowObject[0];
            var campaniaId = $("#ddlCampania").val();
            var cuv = rowObject[5];

            var edit = "&nbsp;<a href='javascript:;' onclick=\"return jQuery('#list').EditarProducto('" + id + "','" + campaniaId + "','" + cuv + "');\" >" + "<img src='" + rutaImagenEdit + "' alt='Editar Productos ShowRoom' title='Editar Productos ShowRoom' border='0' /></a>";
            //var remove = "&nbsp;<a href='javascript:;' onclick=\"return jQuery('#list').EliminarProducto('" + id + "','" + campaniaId + "','" + cuv + "');\" >" + "<img src='" + rutaImagenDelete + "' alt='Eliminar Productos Oferta Show Room' title='Eliminar Productos Oferta Show Room' border='0' /></a>";
            var remove = "&nbsp;<a href='javascript:;' onclick=\"return jQuery('#list').EliminarProducto('" + id + "');\" >" + "<img src='" + rutaImagenDisable + "' alt='Deshabilitar Productos ShowRoom' title='Deshabilitar Productos ShowRoom' border='0' /></a>";

            return edit + remove;
        }
        return "";
    }

                    if (aux2 !== 4 && aux2 !== 7 && aux2 !== 20 &&
                        aux2 !== 9 && aux2 !== 10 && aux2 !== 11 &&
                        aux2 !== 12 && aux2 !== 30) {
                    var ImagenMiniaturaURL = $("#imgMiniSeleccionada").attr("src").substr($("#imgMiniSeleccionada").attr("src").lastIndexOf("/") + 1);
                    var EsSubCampania = ($("#chkEsSubCampania").attr("checked")) ? true : false;
                        RutaImagenCompleta: imagenEstrategiaProducto,
                        ImagenMiniaturaURL: ImagenMiniaturaURL,
                        ImagenMiniaturaURLAnterior: $('#hdImagenMiniaturaURLAnterior').val(),
                        EsSubCampania: EsSubCampania

        // SHOWROOM-INICIO
        $('#DialogDatosShowRoom').dialog({
            autoOpen: false,
            resizable: false,
            modal: true,
            closeOnEscape: true,
            width: 800,
            draggable: true,
            title: "Carga de Evento ShowRoom",
            buttons:
            {
                "Guardar": function () {
                    var vMessage = "";
                    if (jQuery.trim($('#txtEventoNombre').val()) == "")
                        vMessage += "- Debe ingresar el Nombre del Evento.\n";
                    if (jQuery.trim($('#txtEventoTema').val()) == "")
                        vMessage += "- Debe ingresar el Tema del Evento.\n";
                    if (jQuery.trim($('#txtEventoDiasAntes').val()) == "")
                        vMessage += "- Debe ingresar la cantidad de dias antes de la Facturación.\n";
                    if (parseInt(jQuery.trim($('#txtEventoDiasAntes').val())) <= 0)
                        vMessage += "- La cantidad de dias antes de la Facturación debe ser mayor a cero.\n";
                    if (jQuery.trim($('#txtEventoDiasDespues').val()) == "")
                        vMessage += "- Debe ingresar la cantidad de dias después de la Facturación.\n";
                    if (parseInt(jQuery.trim($('#txtEventoDiasDespues').val())) <= 0)
                        vMessage += "- La cantidad de dias después de la Facturación debe ser mayor a cero.\n";
                    //if (jQuery.trim($('#txtEventoNumeroPerfiles').val()) == "")
                    //    vMessage += "- Debe ingresar la cantidad de perfiles.\n";
                    //if (parseInt(jQuery.trim($('#txtEventoNumeroPerfiles').val())) <= 0)
                    //    vMessage += "- La cantidad de perfiles debe ser mayor a cero.\n";
                    //if (jQuery.trim($('#txtEventoRutaShowRoomPopup').val()) == "")
                    //    vMessage += "- Debe ingresar la ruta del Popup del Evento ShowRoom.\n";
                    //if (jQuery.trim($('#txtEventoRutaShowRoomBannerLateral').val()) == "")
                    //    vMessage += "- Debe ingresar la ruta del del Banner Lateral del Evento ShowRoom.\n";

                    if (vMessage != "") {
                        alert(vMessage);
                        return false;
                    } else {
                        GuardarShowRoomEvento();
                    }
                },
                "Cancelar": function () {
                    $(this).dialog('close');
                }
            }
        });

         $('#DialogActualizarTono').dialog({



        $('#DialogPersonalizacionDetalle').dialog({
            autoOpen: false,
            resizable: false,
            modal: true,
            closeOnEscape: true,
            width: 800,
            draggable: true,
            title: "Detalle de Personalizacion por Nivel",
            buttons:
            {
                "Guardar": function () {
                    var vMessage = "";

                    var eventoId = $("#hdEventoID").val();
                    var nivelId = $("#cbNivelEvento").val();

                    if (eventoId == "")
                        vMessage += "- Debe seleccionar el evento.\n";

                    if (nivelId == "")
                        vMessage += "- Debe seleccionar el nivel de la personalización.\n";

                    if (vMessage != "") {
                        alert(vMessage);
                        return false;
                    }
                    else {
                        RegistrarShowRoomPersonalizacionNivel(eventoId, nivelId);
                    }
                    return false;
                },
                "Cancelar": function () {
                    $(this).dialog('close');
                }
            }
        });

        $('#DialogRegistroOfertaShowRoomDetalle').dialog({
            autoOpen: false,
            resizable: false,
            modal: true,
            closeOnEscape: true,
            width: 900,
            draggable: true,
            title: "Edición de Productos"
            //buttons:
            //{
            //    "Guardar": function () {
            //        alert("hola");
            //    },
            //    "Cancelar": function () {
            //        $(this).dialog('close');
            //    }
            //}
        });

        $('#DialogRegistroOfertaShowRoomDetalleEditar').dialog({
            autoOpen: false,
            resizable: false,
            modal: true,
            closeOnEscape: true,
            width: 800,
            draggable: true,
            title: "Registro / Edición de Productos",
            buttons:
            {
                "Guardar": function () {
                    var vMessage = "";
                    if (jQuery.trim($('#txtCUVProductoDetalle').val()) == "")
                        vMessage += "- Debe ingresar el CUV del Producto.\n";

                    if (jQuery.trim($('#ddlMarcaProductoDetalle').val()) == "0")
                        vMessage += "- Seleccione una marca del Producto.\n";

                    if (jQuery.trim($('#txtNombreProductoDetalle').val()) == "")
                        vMessage += "- Debe ingresar la el nombre del Producto.\n";

                    if (vMessage != "") {
                        alert(vMessage);
                        return false;
                    }
                    else {
                        RegistrarOfertaShowRoomDetalle();
                    }
                    return false;
                },
                "Cancelar": function () {
                    $(this).dialog('close');
                }
            }
        });
        // SHOWROOM-FIN

                   
            if (!estrategiaId.in(Id.OfertaParaTi, Id.GuiaDeNegocio, Id.LosMasVendidos, Id.Lanzamiento,
                Id.OfertasParaMi, Id.PackAltoDesembolso, Id.OfertaDelDia, Id.CodigoShowRoom)) {


                    caption: ""

            caption: "",

    // SHOWROOM-INICIO
    function cargarEventoShowRoom() {
        //$("#divCargaArchivos").css("display", "none");
        $("#divPersonalizacion").css("display", "none");
        //$("#divPersonalizacionCategoria").css("display", "none");
        //$("#divOfertasShowRoom").css("display", "none");
        //$("#divShowRoomPerfil").css("display", "none");

        //$("#divPerfilOfertaShowRoom").css("display", "none");

        LimpiarDatosEventoShowRoom();

        var msjex = "";
        if ($("#ddlPais").val() == "")
            msjex += " - Debe seleccionar un País .\n";
        if ($("#ddlCampania").val() == "")
            msjex += " - Debe seleccionar un Campania .\n";

        if (msjex == "") {
            //paisNombre = $("#ddlPais option:selected").text();
            paisID = $("#ddlPais").val();

            fnGrillaEvento();

            $("#divShowRoomEvento").css("display", "");
        }
        else {
            alert(msjex);
            return false;
        }
    };

    function LimpiarDatosEventoShowRoom() {
        $("#txtEventoNombre").val("");
        $("#txtEventoTema").val("");
        $("#txtEventoDiasAntes").val("");
        $("#txtEventoDiasDespues").val("");
        //$("#txtEventoNumeroPerfiles").val("");
        $("#txtEventoRutaShowRoomPopup").val("");
        $("#txtEventoRutaShowRoomBannerLateral").val("");

        $("#divPopupWebFondo").html("");
        $("#divPopupVentaImagenSet").html("");
        $("#divPopupWebImagenSet").html("");
        $("#divPopupTagLateralVentaImagenSet").html("");
        $("#divCabeceraPaginaProductos").html("");
        $("#divPestaniaNombreShowRoom").html("");
        $("#divPopupImagenPreventaDigital").html("");

        //$("#chkEventoTieneCategoria, #chkEventoTieneSubCampania, #chkEventocompraXcompra, #chkEventoTienePersonalizacion").attr('checked', false);
        $("#chkEventoTieneSubCampania, #chkEventocompraXcompra").attr('checked', false);
    }

    function LimpiarDatosShowRoomDetalle() {
        $("#txtPaisDetalle").val('');
        $("#txtCampaniaDetalle").val('');
        //$("#txtTipoOfertaDetalle").val('');
        $("#txtCUVDetalle").val('');
        $("#txtDescripcionDetalle").val('');
        $("#txtPrecioValorizadoDetalle").val('');
    }

    function LimpiarDatosEventoShowRoomDetalle() {
        //$("#hdOfertaShowRoomDetalleID").val("0");
        $("#hdEstrategiaProductoID").val("0");
        //$("#hdEstrategiaID").val("0");
        $("#txtCUVProductoDetalle").val("");
        $("#txtNombreProductoDetalle").val("");
        $("#txtDescripcion1Detalle").val("");
        //$("#txtDescripcion2Detalle").val("");
        //$("#txtDescripcion3Detalle").val("");
        //$("#txtMarcaProductoDetalle").val("");
        $("#txtPrecioOfertaDetalle").val("0");
        $("#chkActivoOfertaDetalle").attr("checked", false);

        $("#ddlMarcaProductoDetalle").val("0");
        $('#imgProductoDetalle').attr('src', imagenProductoVacio);
        $("#hdImagenDetalle").val("");
        $("#hdImagenDetalleAnterior").val("");
    }

    function fnGrillaEvento() {
        jQuery("#listEvento").jqGrid({
            url: urlConsultarShowRoom,
            hidegrid: false,
            datatype: 'json',
            postData: ({
                PaisID: function () { return $("#ddlPais").val(); },
                CampaniaID: function () { return ($("#ddlCampania").val() == "" ? "0" : $("#ddlCampania").val()); }
            }),
            mtype: 'GET',
            contentType: "application/json; charset=utf-8",
            colNames: ['EventoID', 'Nombre', 'Tema', 'Dias Antes Fact.', 'Dias Despues Fact.', 'Personalización', '# Perfiles', 'Imagen1', 'Imagen2', 'ImagenCabeceraProducto', 'ImagenVentaSetPopup', 'ImagenVentaTagLateral', 'ImagenPestaniaShowRoom', 'ImagenPreventaDigital', ''],
            colModel: [
                { name: 'id', width: 50, editable: true, resizable: false },
                { name: 'Nombre',  width: 80, editable: true, resizable: false },
                { name: 'Tema', width: 80, editable: true, resizable: false },
                { name: 'DiasAntes', width: 50, editable: true, resizable: false },
                { name: 'DiasDespues', width: 50, editable: true, resizable: false },
                { name: 'TienePersonalizacion', width: 50, editable: true, resizable: false, formatter: function (cellvalue) {
                    return cellvalue == true ? 'Activa' : 'Inactiva';
                }
                },
                { name: 'NumeroPerfiles', width: 50, editable: true, resizable: false, hidden: true },
                { name: 'Imagen1', width: 65, editable: true, resizable: false, hidden: true },
                { name: 'Imagen2', width: 65, editable: true, resizable: false, hidden: true },
                { name: 'ImagenCabeceraProducto', width: 65, editable: true, resizable: false, hidden: true },
                { name: 'ImagenVentaSetPopup', width: 65, editable: true, resizable: false, hidden: true },
                { name: 'ImagenVentaTagLateral', width: 65, editable: true, resizable: false, hidden: true },
                { name: 'ImagenPestaniaShowRoom', width: 65, editable: true, resizable: false, hidden: true },
                { name: 'ImagenPreventaDigital', width: 65, editable: true, resizable: false, hidden: true },
                { name: 'Options', width: 60, editable: true, sortable: false, align: 'center', resizable: false, formatter: ShowActionsEvento }
            ],
            jsonReader:
            {
                root: "rows",
                page: "page",
                total: "total",
                records: "records",
                repeatitems: false,
                cell:"",
                id: "id"
            },
            pager: jQuery('#pagerEvento'),
            loadtext: 'Cargando datos...',
            recordtext: "{0} - {1} de {2} Registros",
            emptyrecords: 'No hay resultados',
            rowNum: 10,
            scrollOffset: 0,
            rowList: [10, 20, 30, 40, 50],
            sortname: 'Nombre',
            sortorder: 'asc',
            viewrecords: true,
            multiselect: false,
            height: 'auto',
            width: 930,
            pgtext: 'Pág: {0} de {1}',
            altRows: true,
            altclass: 'jQGridAltRowClass',
            loadComplete: function () {
            },
            gridComplete: function () {
                var cantidadRegistros = jQuery('#listEvento').jqGrid('getGridParam', 'reccount');
                if (cantidadRegistros <= 0) {
                    $("#hdEventoID").val("0");
                    //Carga de Consultora
                    $("#hdCargaEventoID").val("0");
                    $("#hdCargaCampaniaID").val("");
                    //Carga de Stock
                    $("#hdCargaStockEventoID").val("0");
                    //Carga de Descripcion de Sets
                    $("#hdCargaDescripcionSetsEventoID").val("0");
                    $("#hdCargaDescripcionSetsCampaniaID").val("");
                    //Carga de Productos Compra por Compra
                    $("#hdCargarProductoCpcEventoID").val("0");
                    $("#hdCargarProductoCpcCampaniaID").val("");

                    $("#divShowRoomEventoNuevo").css("display", "");
                    //$("#divCargaArchivos").css("display", "none");
                    //$("#divOfertasShowRoom").css("display", "none");
                } else {
                    $("#divShowRoomEventoNuevo").css("display", "none");
                    //$("#divCargaArchivos").css("display", "");

                    // Listar Productos ShowRoom
                    fnGrilla();

                    var showroomEvento = jQuery('#listEvento').jqGrid('getRowData')[0];
                    CargarImagenes(showroomEvento);

                    CargarNiveles();
                    //CargarCategorias();

                    //fnGrilla();

                    //if (showroomEvento.TienePersonalizacion && showroomEvento.TienePersonalizacion == 'Activa') {
                        //$("#divPerfilOfertaShowRoom").hide();
                    //}

                    //$("#divOfertasShowRoom").css("display", "");
                }
            }
        });
        jQuery("#listEvento").jqGrid('navGrid', "#pager", { edit: false, add: false, refresh: false, del: false, search: false });
        jQuery("#listEvento").setGridParam({ datatype: 'json', page: 1 }).trigger('reloadGrid');
    }

    function CargarNiveles() {
        jQuery.ajax({
            type: 'POST',
            url: urlGetShowRoomNiveles,
            dataType: 'json',
            contentType: 'application/json; charset=utf-8',
            async: true,
            success: function (response) {
                if (checkTimeout(response)) {
                    if (response.success) {
                        $("#cbNivelEvento").empty();

                        if (response.data == "") {
                            $("#divPersonalizacion").css("display", "none");
                        } else {
                            var listaNiveles = response.data || new Array();

                            $("#cbNivelEvento").append('<option value="">-- Seleccionar --</option>');

                            $.each(listaNiveles, function (index, value) {
                                var html = '<option value="' + value.NivelId + '">' + value.Descripcion + '</option>';

                                $("#cbNivelEvento").append(html);
                            });

                            $("#divPersonalizacion").css("display", "");
                        }
                    } else {
                        $("#divPersonalizacion").css("display", "none");
                        //alert_msg(response.message);
                        alert(response.message);
                    }
                }
            },
            error: function (response, error) {
                if (checkTimeout(response)) {
                    //alert_msg(response.message);
                    alert(response.message);
                    closeWaitingDialog();
                }
            }
        });
    }

    function CargarImagenes(showroomEvento) {
        if (showroomEvento.Imagen1 != "") {
            $("#divPopupWebFondo").html("");
            var htmlImagen1 = '<img src="' + showroomEvento.Imagen1 + '" alt="PopupWebFondo" style="width: 75px; height: 50px;" />';
            $("#divPopupWebFondo").html(htmlImagen1);
        }
        $("#hdImagen1").val(showroomEvento.Imagen1.replace(/^.*[\\\/]/, ''));
        $("#hdImagen1Anterior").val(showroomEvento.Imagen1.replace(/^.*[\\\/]/, ''));

        if (showroomEvento.ImagenVentaSetPopup != "") {
            $("#divPopupVentaImagenSet").html("");
            var htmlImagen2 = '<img src="' + showroomEvento.ImagenVentaSetPopup + '" alt="PopupVentaImagenSet" style="width: 75px; height: 50px;" />';
            $("#divPopupVentaImagenSet").html(htmlImagen2);
        }
        $("#hdImagenVentaSetPopup").val(showroomEvento.ImagenVentaSetPopup.replace(/^.*[\\\/]/, ''));
        $("#hdImagenVentaSetPopupAnterior").val(showroomEvento.ImagenVentaSetPopup.replace(/^.*[\\\/]/, ''));

        if (showroomEvento.Imagen2 != "") {
            $("#divPopupWebImagenSet").html("");
            var htmlImagen3 = '<img src="' + showroomEvento.Imagen2 + '" alt="Imagen2" style="width: 75px; height: 50px;" />';
            $("#divPopupWebImagenSet").html(htmlImagen3);
        }
        $("#hdImagen2").val(showroomEvento.Imagen2.replace(/^.*[\\\/]/, ''));
        $("#hdImagen2Anterior").val(showroomEvento.Imagen2.replace(/^.*[\\\/]/, ''));

        if (showroomEvento.ImagenVentaTagLateral != "") {
            $("#divPopupTagLateralVentaImagenSet").html("");
            var htmlImagen4 = '<img src="' + showroomEvento.ImagenVentaTagLateral + '" alt="PopupTagLateralVentaImagenSet" style="width: 75px; height: 50px;" />';
            $("#divPopupTagLateralVentaImagenSet").html(htmlImagen4);
        }
        $("#hdImagenVentaTagLateral").val(showroomEvento.ImagenVentaTagLateral.replace(/^.*[\\\/]/, ''));
        $("#hdImagenVentaTagLateralAnterior").val(showroomEvento.ImagenVentaTagLateral.replace(/^.*[\\\/]/, ''));

        if (showroomEvento.ImagenCabeceraProducto != "") {
            $("#divCabeceraPaginaProductos").html("");
            var htmlImagen5 = '<img src="' + showroomEvento.ImagenCabeceraProducto + '" alt="CabeceraPaginaProductos" style="width: 75px; height: 50px;" />';
            $("#divCabeceraPaginaProductos").html(htmlImagen5);
        }
        $("#hdImagenCabeceraProducto").val(showroomEvento.ImagenCabeceraProducto.replace(/^.*[\\\/]/, ''));
        $("#hdImagenCabeceraProductoAnterior").val(showroomEvento.ImagenCabeceraProducto.replace(/^.*[\\\/]/, ''));

        if (showroomEvento.ImagenPestaniaShowRoom != "") {
            $("#divPestaniaNombreShowRoom").html("");
            var htmlImagen6 = '<img src="' + showroomEvento.ImagenPestaniaShowRoom + '" alt="PestaniaNombreShowRoom" style="width: 75px; height: 50px;" />';
            $("#divPestaniaNombreShowRoom").html(htmlImagen6);
        }
        $("#hdImagenPestaniaShowRoom").val(showroomEvento.ImagenPestaniaShowRoom.replace(/^.*[\\\/]/, ''));
        $("#hdImagenPestaniaShowRoomAnterior").val(showroomEvento.ImagenPestaniaShowRoom.replace(/^.*[\\\/]/, ''));

        if (showroomEvento.ImagenPreventaDigital != "") {
            $("#divPopupImagenPreventaDigital").html("");
            var htmlImagen7 = '<img src="' + showroomEvento.ImagenPreventaDigital + '" alt="PopupImagenPreventaDigital" style="width: 75px; height: 50px;" />';
            $("#divPopupImagenPreventaDigital").html(htmlImagen7);
        }
        $("#hdImagenPreventaDigital").val(showroomEvento.ImagenPreventaDigital.replace(/^.*[\\\/]/, ''));
        $("#hdImagenPreventaDigitalAnterior").val(showroomEvento.ImagenPreventaDigital.replace(/^.*[\\\/]/, ''));
    }

    function ShowActionsEvento(cellvalue, options, rowObject) {
        var edit = "&nbsp;<a href='javascript:;' onclick=\"return jQuery('#listEvento').EditarEvento('" + options.rowId + "','" + rowObject.CampaniaID + "','" + rowObject.Estado + "','" + rowObject.TieneCategoria + "','" + rowObject.TieneCompraXcompra + "','" + rowObject.TieneSubCampania + "', " + rowObject.TienePersonalizacion + ");\" >" + "<img src='" + imagenEdit + "' alt='Editar Evento ShowRoom' title='Editar Evento Show Room' border='0' /></a>";
        var del = "&nbsp;<a href='javascript:;' onclick=\"return jQuery('#listEvento').DeshabilitarEvento('" + options.rowId + "','" + rowObject.CampaniaID + "');\" >" + "<img src='" + imagenDeshabilitar + "' alt='Deshabilitar Evento ShowRoom' title='Deshabilitar Evento ShowRoom' border='0' /></a>";
        var remove = "&nbsp;<a href='javascript:;' onclick=\"return jQuery('#listEvento').EliminarEvento('" + options.rowId + "','" + rowObject.CampaniaID + "');\" >" + "<img src='" + imagenEliminar + "' alt='Eliminar Evento ShowRoom' title='Eliminar Evento ShowRoom' border='0' /></a>";

        var resultado = edit;

        if (rowObject.Estado == "1")
            resultado += del;

        if (rowObject.Estado == "1")
            resultado += remove;

        $("#hdEventoID").val(options.rowId);
        //Carga de Consultoras
        $("#hdCargaEventoID").val(options.rowId);
        $("#hdCargaCampaniaID").val(rowObject.CampaniaID);
        //Carga de Stock
        $("#hdCargaStockEventoID").val(options.rowId);
        //Carga de Descripcion de Sets
        $("#hdCargaDescripcionSetsEventoID").val(options.rowId);
        $("#hdCargaDescripcionSetsCampaniaID").val(rowObject.CampaniaID);
        //Carga de Productos Compra por Compra
        $("#hdCargarProductoCpcEventoID").val(options.rowId);
        $("#hdCargarProductoCpcCampaniaID").val(rowObject.CampaniaID);

        return resultado;
    }

    function GuardarShowRoomEvento() {
        var eventoID = $("#hdEventoID").val();
        var campaniaID = $("#txtEventoCampaniaID").val();
        var nombre = $("#txtEventoNombre").val();
        var tema = $("#txtEventoTema").val();
        var diasAntes = $("#txtEventoDiasAntes").val();
        var diasDespues = $("#txtEventoDiasDespues").val();
        //var numeroPerfiles = $("#txtEventoNumeroPerfiles").val();
        var numeroPerfiles = 0;
        var estado = $("#chkEventoEstado").is(":checked");
        //var tieneCategoria = $("#chkEventoTieneCategoria").is(":checked");
        var tieneCategoria = 0;
        var tieneCompraXcompra = $("#chkEventocompraXcompra").is(":checked");
        var tieneSubCampania = $("#chkEventoTieneSubCampania").is(":checked");
        //var tienePersonalizacion = $("#chkEventoTienePersonalizacion").is(":checked");
        var tienePersonalizacion = true;

        var showRoom = {
            EventoID: eventoID == "" || eventoID == undefined ? 0 : eventoID,
            CampaniaID: campaniaID,
            Nombre: nombre,
            Tema: tema,
            DiasAntes: parseInt(diasAntes),
            DiasDespues: parseInt(diasDespues),
            NumeroPerfiles: parseInt(numeroPerfiles),
            Estado: estado,
            TieneCategoria: tieneCategoria,
            TieneCompraXcompra: tieneCompraXcompra,
            TieneSubCampania: tieneSubCampania,
            TienePersonalizacion: tienePersonalizacion
        };

        waitingDialog({ title: "Procesando" });
        jQuery.ajax({
            type: 'POST',
            url: urlGuardarShowRoom,
            dataType: 'json',
            contentType: 'application/json; charset=utf-8',
            data: JSON.stringify(showRoom),
            async: true,
            success: function (response) {
                if (checkTimeout(response)) {
                    if (response.success) {
                        closeWaitingDialog();
                        var id = response.data;

                        if ($("#hdEventoID").val() == "0")
                            fnGrilla();

                        $("#hdEventoID").val(id);
                        //Cargar de Consultoras
                        $("#hdCargaEventoID").val(id);
                        $("#hdCargaCampaniaID").val(campaniaID);
                        //Carga de Stock
                        $("#hdCargaStockEventoID").val(id);
                        //Carga de Descripcion de Sets
                        $("#hdCargaDescripcionSetsEventoID").val(id);
                        $("#hdCargaDescripcionSetsCampaniaID").val(campaniaID);
                        //Carga de Productos Compra por Compra
                        $("#hdCargarProductoCpcEventoID").val(id);
                        $("#hdCargarProductoCpcCampaniaID").val(campaniaID);

                        HideDialog("DialogDatosShowRoom");
                        jQuery("#listEvento").setGridParam({ datatype: 'json', page: 1 }).trigger('reloadGrid');
                        //alert_msg(response.message);
                        alert(response.message);
                    } else {
                        //alert_msg(response.message);
                        alert(response.message);
                    }
                }
            },
            error: function (response, error) {
                if (checkTimeout(response)) {
                    //alert_msg(response.message);
                    alert(response.message);
                    closeWaitingDialog();
                }
            }
        });
    }

    function InsertarImagenPersonalizacion(personalizacionId) {
        var elementoPadre = $('.div-3[data-idpersonalizacion="' + personalizacionId + '"]');
        var elementoAgregarImagen = $(elementoPadre).find('.fpPopupImagenPersonalizacion')[0];
        var elementoDivVerImagen = $(elementoPadre).find('.divPopupImagenPersonalizacion')[0];
        var elementoHiddenValor = $(elementoPadre).find('.hdValor')[0];
        $.ajaxSetup({ cache: false });
        var uploader = new qq.FileUploader({
            allowedExtensions: ['jpg', 'png', 'jpeg', 'gif'],
            element: elementoAgregarImagen,
            action: urlImageMatrizUpload,
            onComplete: function (id, fileName, responseJSON) {
                if (checkTimeout(responseJSON)) {
                    $(".qq-upload-list").css("display", "none");
                    if (responseJSON.success) {
                        var rutaImagen = rutaImagenTemporal + responseJSON.name;

                        $(elementoHiddenValor).val(responseJSON.name);

                        var html = '<img  alt="" src="' + rutaImagen + '" style="width: auto; height: 60px; max-width: 300px !important;"/>';
                        $(elementoDivVerImagen).html(html);
                    } else {
                        alert(responseJSON.message);
                    }
                }
            },
            onSubmit: function (id, fileName) { $(".qq-upload-list").css("display", "none"); },
            onProgress: function (id, fileName, loaded, total) { $(".qq-upload-list").css("display", "none"); },
            onCancel: function (id, fileName) { $(".qq-upload-list").css("display", "none"); }
        });
    }

    function RegistrarShowRoomPersonalizacionNivel(eventoId, nivelId) {
        var lista = $("#DialogPersonalizacionDetalle .div-3[data-idpersonalizacion]");
        var array = new Array();

        $.each(lista, function (index, value) {
            var personalizacionNivelId = $(value).find(".hdPersonalizacionNivelId").val();
            var personalizacionId = $(value).attr("data-idpersonalizacion");
            var atributo = $(value).find(".hdAtributo").val();

            var valor = "";
            var esImagen = false;
            var tipoAtributo = $(value).find(".hdTipoAtributo").val();

            if (tipoAtributo == "IMAGEN") {
                valor = $(value).find(".hdValor").val();
                esImagen = true;
            } else {
                valor = $(value).find(".txtAtributoPersonalizacion").val();
            }

            var item = {
                PersonalizacionNivelId: personalizacionNivelId,
                PersonalizacionId: personalizacionId,
                EventoId: eventoId,
                NivelId: nivelId,
                CategoriaId: 0,
                Atributo: atributo,
                Valor: valor,
                ValorAnterior: $(value).find(".hdValorAnterior").val(),
                EsImagen: esImagen
            };

            array.push(item);
        });

        jQuery.ajax({
            type: 'POST',
            url: urlGuardarPersonalizacionNivelShowRoom,
            dataType: 'json',
            contentType: 'application/json; charset=utf-8',
            data: JSON.stringify(array),
            async: true,
            success: function (data) {
                if (checkTimeout(data)) {
                    closeWaitingDialog();
                    if (data.success == true) {
                        alert(data.message);

                        HideDialog("DialogPersonalizacionDetalle");
                    }
                    else {
                        alert(data.message);
                    }
                }
            },
            error: function (data, error) {
                if (checkTimeout(data)) {
                    closeWaitingDialog();
                    alert(data.message);
                }
            }
        });
    }

    function fnGrillaOfertaShowRoomDetalle(campaniaId, cuv, estrategiaId) {
        $("#listShowRoomDetalle").jqGrid("clearGridData");

        var parametros = {
            //campaniaId: campaniaId,
            //cuv: cuv,
            estrategiaId: estrategiaId
        };

        $('#listShowRoomDetalle').setGridParam({ postData: parametros });
        $('#hdEstrategiaID').val(estrategiaId);

        jQuery("#listShowRoomDetalle").jqGrid({
            url: urlConsultarOfertaShowRoomDetalle,
            hidegrid: false,
            datatype: 'json',
            postData: (parametros),
            mtype: 'GET',
            contentType: "application/json; charset=utf-8",
            //colNames: ['OfertaShowRoomDetalleID', 'CampaniaID', 'CUV', 'Nombre', 'Descripcion1', 'Descripcion2', 'Descripcion3', 'MarcaProducto', 'Foto', ''],
            colNames: ['EstrategiaProductoId', 'EstrategiaId', 'CampaniaID', 'CUV', 'Nombre', 'Descripcion1', 'Foto', 'Marca', '', '', '', ''],
            /*
            colModel: [
                { name: 'OfertaShowRoomDetalleID', index: 'OfertaShowRoomDetalleID', width: 50, editable: true, resizable: false, hidden: true },
                { name: 'CampaniaID', index: 'CampaniaID', width: 50, editable: true, resizable: false, hidden: true },
                { name: 'CUV', index: 'CUV', width: 50, editable: true, resizable: false, hidden: true },
                { name: 'NombreProducto', index: 'NombreProducto', width: 80, editable: true, resizable: false },
                { name: 'Descripcion1', index: 'Descripcion1', width: 80, editable: true, resizable: false },
                { name: 'Descripcion2', index: 'Descripcion2', width: 80, editable: true, resizable: false },
                { name: 'Descripcion3', index: 'Descripcion3', width: 80, editable: true, resizable: false },
                { name: 'Imagen', index: 'Imagen', width: 55, editable: true, resizable: false, sortable: false, align: 'center', formatter: ShowImageDetalle },
                { name: 'MarcaProducto', index: 'MarcaProducto', width: 80, editable: true, resizable: false, hidden: true },
                { name: 'Options', index: 'Options', width: 40, editable: true, sortable: false, align: 'center', resizable: false, formatter: ShowActionsDetalle }
            ],
            */
            colModel: [
                { name: 'EstrategiaProductoId', index: 'EstrategiaProductoId', width: 50, editable: true, resizable: false, hidden: true },
                { name: 'EstrategiaId', index: 'Estrategia', width: 50, editable: true, resizable: false, hidden: true },
                { name: 'Campania', index: 'Campania', width: 50, editable: true, resizable: false, hidden: true },
                { name: 'CUV', index: 'CUV', width: 50, editable: true, resizable: false, hidden: false },
                { name: 'NombreProducto', index: 'NombreProducto', width: 80, editable: true, resizable: false },
                { name: 'Descripcion1', index: 'Descripcion1', width: 80, editable: true, resizable: false },
                { name: 'ImagenProducto', index: 'ImagenProducto', width: 60, editable: true, resizable: false, sortable: false, align: 'center', formatter: ShowImageDetalle },
                { name: 'IdMarca', index: 'IdMarca', width: 50, editable: true, resizable: false, hidden: true },
                { name: 'Precio', index: 'Precio', width: 50, editable: true, resizable: false, hidden: true },
                { name: 'PrecioValorizado', index: 'PrecioValorizado', width: 50, editable: true, resizable: false, hidden: true },
                { name: 'Activo', index: 'Activo', width: 50, editable: true, resizable: false, hidden: true },
                { name: 'Options', index: 'Options', width: 40, editable: true, sortable: false, align: 'center', resizable: false, formatter: ShowActionsDetalle }
            ],
            jsonReader:
            {
                root: "rows",
                page: "page",
                total: "total",
                records: "records",
                repeatitems: true,
                cell: "cell",
                id: "id"
            },
            pager: jQuery('#pagerShowRoomDetalle'),
            loadtext: 'Cargando datos...',
            recordtext: "{0} - {1} de {2} Registros",
            emptyrecords: 'No hay resultados',
            rowNum: 10,
            scrollOffset: 0,
            rowList: [10, 20, 30, 40, 50],
            sortname: 'Nombre',
            sortorder: 'asc',
            viewrecords: true,
            multiselect: false,
            height: 'auto',
            width: 840,
            pgtext: 'Pág: {0} de {1}',
            altRows: true,
            altclass: 'jQGridAltRowClass',
            loadComplete: function () {
            },
            gridComplete: function () {
            }
        });
        jQuery("#listShowRoomDetalle").jqGrid('navGrid', "#pagerShowRoomDetalle", { edit: false, add: false, refresh: false, del: false, search: false });
        jQuery("#listShowRoomDetalle").setGridParam({ datatype: 'json', page: 1 }).trigger('reloadGrid');
    }

    function ShowImageDetalle(cellvalue, options, rowObject) {
        var image = "";
        if (rowObject[6] != "") {
            image = '<img src="' + rowObject[6] + '" alt="" width="70px" height="60px" title="" border="0" />'; // 1664
        } else {
            image = '<img src="' + imagenProductoVacio + '" alt="" width="60px" height="60px" title="" border="0" />';
        }
        return image;
    }

    function ShowActionsDetalle(cellvalue, options, rowObject) {
        var id = rowObject[0];
        var estrategiaId = rowObject[1];
        //var campaniaId = rowObject[2];
        var cuv = rowObject[3];
        var imagen = rowObject[6];

        //var edit = "&nbsp;<a href='javascript:;' onclick=\"return jQuery('#listShowRoomDetalle').EditarProductoDetalle('" + id + "','" + campaniaId + "','" + cuv + "','" + imagen + "');\" >" + "<img src='" + rutaImagenEdit + "' alt='Editar Productos Oferta Show Room Detalle' title='Editar Productos Oferta Show Room Detalle' border='0' /></a>";
        var edit = "&nbsp;<a href='javascript:;' onclick=\"return jQuery('#listShowRoomDetalle').EditarProductoDetalle('" + id  + "','" +  imagen + "');\" >" + "<img src='" + rutaImagenEdit + "' alt='Editar Producto' title='Editar Producto' border='0' /></a>";
        //var remove = "&nbsp;<a href='javascript:;' onclick=\"return jQuery('#listShowRoomDetalle').EliminarProductoDetalle('" + id + "','" + campaniaId + "','" + cuv + "');\" >" + "<img src='" + rutaImagenDelete + "' alt='Eliminar Productos Oferta Show Room Detalle' title='Eliminar Productos Oferta Show Room Detalle' border='0' /></a>";
        //var remove = "&nbsp;<a href='javascript:;' onclick=\"return jQuery('#listShowRoomDetalle').EliminarProductoDetalle('" + id + "','" + estrategiaId + "','" + cuv + "');\" >" + "<img src='" + rutaImagenDelete + "' alt='Eliminar Productos Oferta Show Room Detalle' title='Eliminar Productos Oferta Show Room Detalle' border='0' /></a>";
        var remove = "";

        if (rowObject[10] == "1") {
            var remove = "&nbsp;<a href='javascript:;' onclick=\"return jQuery('#listShowRoomDetalle').EliminarProductoDetalle('" + id + "','" + estrategiaId + "','" + cuv + "');\" >" + "<img src='" + rutaImagenDisable + "' alt='Deshabilitar Producto' title='Deshabilitar Producto' border='0' /></a>";
        }

        return edit + remove;
    }

    function RegistrarOfertaShowRoomDetalle() {
        var accion;

        //if ($("#hdOfertaShowRoomDetalleID").val() == "0")
        if ($("#hdEstrategiaProductoID").val() == "0")
            accion = urlInsertOfertaShowRoomDetalle;
        else
            accion = urlUpdateOfertaShowRoomDetalle;

        var isActive = ($('#chkActivoOfertaDetalle').val()) ? "1" : "0";

        var item = {
            //OfertaShowRoomDetalleID: $("#hdOfertaShowRoomDetalleID").val(),
            EstrategiaProductoID: $("#hdEstrategiaProductoID").val(),
            EstrategiaID: $("#hdEstrategiaID").val(),
            Campania: $("#txtCampaniaDetalle").val(),
            CUV2: $("#txtCUVDetalle").val(),
            CUV: $("#txtCUVProductoDetalle").val(),
            Precio: $("#txtPrecioOfertaDetalle").val(),
            NombreProducto: $("#txtNombreProductoDetalle").val(),
            Descripcion1: $("#txtDescripcion1Detalle").val(),
            //Descripcion2: $("#txtDescripcion2Detalle").val(),
            //Descripcion3: $("#txtDescripcion3Detalle").val(),
            IdMarca: $("#ddlMarcaProductoDetalle").val(),
            //Imagen: $("#hdImagenDetalle").val(),
            Activo: isActive,
            ImagenProducto: $("#hdImagenDetalle").val(),
            ImagenAnterior: $("#hdImagenDetalleAnterior").val()
        };

        console.log(item);

        waitingDialog({ title: "Procesando" });
        jQuery.ajax({
            type: 'POST',
            url: accion,
            dataType: 'json',
            contentType: 'application/json; charset=utf-8',
            data: JSON.stringify(item),
            async: true,
            success: function (data) {
                if (checkTimeout(data)) {
                    closeWaitingDialog();
                    if (data.success == true) {
                        alert(data.message);
                        HideDialog("DialogRegistroOfertaShowRoomDetalleEditar");
                        LimpiarDatos();
                        jQuery("#listShowRoomDetalle").setGridParam({ datatype: 'json', page: 1 }).trigger('reloadGrid');
                    }
                    else {
                        alert(data.message);
                    }
                }
            },
            error: function (data, error) {
                if (checkTimeout(data)) {
                    closeWaitingDialog();
                    alert(data.message);
                    HideDialog("DialogRegistroOfertaShowRoomDetalleEditar");
                }
            }
        });
    }

    function LimpiarDatos() {
        //$('#hdCampaniaID').val("");
        //$('#txtPaisModal').val("");
        //$('#txtCUVModal').val("");
        //$('#txtDescripcionModal').val("");
        //$('#txtPrecioValorizadoModal').val("");
        //$('#txtPrecioOfertaModal').val("");
        $('#chkHabilitarOferta').removeAttr('checked');
        //$("#FlagTransaccion").val("0");
        //$("#hdCodigoOferta").val("");
        //$("#hdStockProducto").val("0");
        //$('#txtUnidadesPermitidasModal').val("");
        $("#chkEsSubCampania").removeAttr('checked');
    }

    function VistaNuevoProductoShowroon() {
        $("#seccionTallaColor").hide();
        $("#seccionOfertaUltimoMinuto").hide();
        $("#seccionImagenMiniatura").show();
        $("#seccionEsSubCampania").show();
        $("#lblMensaje").text("Tip de Negocio:");
    }

    function VistaNuevoProductoGeneral() {
        $("#seccionEsSubCampania").hide();
        $("#seccionImagenMiniatura").hide();
        $("#seccionTallaColor").show();
        $("#seccionOfertaUltimoMinuto").show();
        $("#lblMensaje").text("Mensaje Adicional:");
    }

     function UploadFileStrategyShowroom() {
        waitingDialog({});
        var formData = new FormData();
        var totalFiles = document.getElementById("fileDescMasivo").files.length;
        if (totalFiles <= 0) {
            _toastHelper.error("Seleccione al menos un archivo.");
            closeWaitingDialog();
            return false;
        }

        formData.append("Documento", document.getElementById("fileDescMasivo").files[0]);
        formData.append("Pais", $('#ddlPais').val());
        formData.append("CampaniaId", $('#ddlCampania').val());
        formData.append("TipoEstrategia", $('#ddlTipoEstrategia').val());

        $.ajax({
            url: '@Url.Action("UploadFileStrategyShowroom", "AdministrarEstrategia")',
            type: "POST",
            dataType: "JSON",
            data: formData,
            contentType: false,
            processData: false,
            success: function (data) {
                $("#listCargaDescMasiva").jqGrid("GridUnload");
                var mensaje='';
                if (data.listActualizado == 0 && data.listInsertado ==0){
                    mensaje = 'No se realizó ninguna actualización ni inserción (Verificar que los CUVs existan en la tabla "ods.OfertasPersonalizadas").';
                }
                else{
                    mensaje = 'El procedimiento culmino con éxito, <br /> - Se actualizaron '+ data.listActualizado +' Set(s) <br /> - Se insertaron '+ data.listInsertado +' Set(s)';
                }
                closeWaitingDialog();
                $("#estadoCargaMasiva").css('color', 'black');
                $('#estadoCargaMasiva').html(mensaje);
                $("#divDescMasivoPaso1").fadeOut(function() {
                    $("#divDescMasivoPaso2").fadeIn();
                });

            },
            error: function(data){
                 $("#estadoCargaMasiva").css('color', 'red');
                 $('#estadoCargaMasiva').html(data.statusText);
                 $("#divDescMasivoPaso1").fadeOut(function() {
                        $("#divDescMasivoPaso2").fadeIn();
                  });
                closeWaitingDialog();
            }
        });
    }
    // SHOWROOM-FIN


</script>
