@using Portal.Consultoras.Common

@model Portal.Consultoras.Web.Models.EstrategiaModel
@{
    ViewBag.Title = "Administración de Estrategias";
    var imagenVacia = "prod_grilla_vacio.png";
}

<script src="@Url.Content("~/Scripts/fileuploader.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery.form.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery.toast.min.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/handlebars.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery.paging.min.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/AdminContenido/ToastHelper.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/AdminContenido/Paginador.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/AdminContenido/Nemotecnico.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/AdminContenido/DescripcionComercial.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/AdminContenido/MatrizComercialFileUpload.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/AdminContenido/Estrategia.js")" type="text/javascript"></script>

<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<link href="@Url.Content("~/Content/Css/Toast/jquery.toast.min.css")" rel="stylesheet" />

<input type="hidden" id="mensajeErrorCUV" />
<input type="hidden" id="mensajeErrorCUV2" />
<input type="hidden" id="hdEstrategiaIDConsulta" />
<input type="hidden" id="ImagenProducto" />
<input type="hidden" id="hdEstrategiaID" />
<input type="hidden" id="hdEstrategiaCodigo" />
<input type="hidden" id="hdTipoConsulta" value="0" />
<input type="hidden" id="hdZonas" value="" />
<input type="hidden" id="hdSimbolo" />
<input type="hidden" id="hdTallaColorID" />
<div class="wrap_cab">
    <div class="filtros2">
        <div class="elements">
            <div class="div-2">
                <h1><span>Zona de Estrategias @(Model.TipoVistaEstrategia == Constantes.TipoVistaEstrategia.ProgramaNuevas ? "- Programa de Nuevas" : string.Empty)</span></h1>
            </div>
            <div class="div-3">
                <div class="titG">País:</div>
                <div class="selectA borde_redondeado">
                    @Html.DropDownListFor(model => model.PaisID, new SelectList(Model.listaPaises, "PaisID", "Nombre"), "-- Seleccionar --", new { id = "ddlPais" })
                </div>
                <div class="titG">Campaña:</div>
                <div class="selectA borde_redondeado">
                    @Html.DropDownListFor(model => model.CampaniaID, new SelectList(Model.listaCampania, "CampaniaID", "NombreCorto"), "-- Seleccionar --", new { id = "ddlCampania" })
                </div>
            </div>
            <div class="div-3">
                <div class="titG">Tipo de Estrategia:</div>
                <div class="selectA borde_redondeado">
                    <select id="ddlTipoEstrategia" name="ddlTipoEstrategia">
                        @if (Model.ListaTipoEstrategia != null)
                        {
                            <option value="">-- Seleccionar --</option>
                            for (int i = 0; i < Model.ListaTipoEstrategia.Count(); i++)
                            {
                            <option flag-nueva="@Model.ListaTipoEstrategia.ToList()[i].FlagNueva"
                                    flag-recoproduct="@Model.ListaTipoEstrategia.ToList()[i].FlagRecoProduc"
                                    flag-recoperfil="@Model.ListaTipoEstrategia.ToList()[i].FlagRecoPerfil"
                                    codigo-programa="@Model.ListaTipoEstrategia.ToList()[i].CodigoPrograma"
                                    imagen-tipo="@Model.ListaTipoEstrategia.ToList()[i].Imagen"
                                    value="@Model.ListaTipoEstrategia.ToList()[i].TipoEstrategiaID"
                                    data-id="@Model.ListaTipoEstrategia.ToList()[i].CodigoGeneral"
                                    data-codigo="@Model.ListaTipoEstrategia.ToList()[i].Codigo"
									data-FValidarImagen = "@Model.ListaTipoEstrategia.ToList()[i].FlagValidarImagen"
									data-PesoMaximo = "@Model.ListaTipoEstrategia.ToList()[i].PesoMaximoImagen" >
                                @Model.ListaTipoEstrategia.ToList()[i].Descripcion
                            </option>
                            }
                        }
                    </select>
                </div>
                <div class="titG">CUV<sub>2</sub>:</div>
                <div class="selectA borde_redondeado">
                    <input type="text" id="CUV" name="CUV" />
                </div>
            </div>

            <div class="div-3">
                <div class="titG">Tiene imagen?:</div>
                <div class="selectA borde_redondeado">
                    <select id="ddlTieneImagen" name="ddlTieneImagen">
                        <option value="-1" selected>-- Seleccionar --</option>
                        <option value="1">Si</option>
                        <option value="0">No</option>
                    </select>
                </div>
                <div class="titG">Oferta Activa?:</div>
                <div class="selectA borde_redondeado">
                    <select id="ddlOfertaActiva" name="ddlOfertaActiva">
                        <option value="-1" selected>-- Seleccionar --</option>
                        <option value="1">Si</option>
                        <option value="0">No</option>
                    </select>
                </div>
            </div>

            <div class="div-3">
                <div class="titG">&nbsp;</div>
                <div class="input_horizontal">
                    <input type="button" name="btnBuscar" id="btnBuscar" value="Buscar" />
                    <input type="button" name="btnNuevo" id="btnNuevo" value="Nuevo" />
                    @if (Model.TipoVistaEstrategia == Constantes.TipoVistaEstrategia.Todos)
                    { 
                        <input type="button" name="btnNuevoMasivo" id="btnNuevoMasivo" value="Nuevo Masivo" />
                    }
                    <input type="button" name="btnDescripcionMasivo" id="btnDescripcionMasivo" value="Desc. Masivo" />
                </div>
                <div class="input_modifica_pedido">
                    <input type="button" name="btnActivarDesactivar" id="btnActivarDesactivar" value="Activar/Desactivar" style="display: none;" />
                </div>
            </div>
        </div>
    </div>
</div>
<div class="wrap">
    <div class="container clearfix">
        <div class="border-wrapper">
            <table id="list"></table>
            <div id="pager"></div>
        </div>
    </div>
</div>

@Html.Partial("AdministrarEstrategiaDialog")

<div id="DialogZona" style="display: none;">
    <div class="Content_modal">
        <div class="div-3">
            <div class="treeview_est_content">
                <div id="arbolRegionZona" class="demo">
                </div>
            </div>
        </div>
        <div class="div-3">
            <div class="titF"></div>
            <div class="titF"></div>
            <div class="titH">
                <input type="checkbox" id="chkSeleccionar" />Seleccionar todo
            </div>
        </div>
    </div>
</div>
<div id="DialogEditarTallaColor" style="display: none;">
    <div class="Content_modal">
        <div class="div-3">
            <div class="titG">CUV:</div>
            <div class="selectP2 borde_redondeado">
                <input type="text" id="txtCUVTC" />
            </div>
        </div>
        <div class="div-3">
            <div class="titG">Descripción:</div>
            <div class="selectP2 borde_redondeado" style="width: 300px">
                <input type="text" id="txtDescripcionCUVTC" style="width: 290px" readonly="readonly" />
            </div>
        </div>
        <div class="div-3">
            <div class="titG">Precio:</div>
            <div class="selectP2 borde_redondeado">
                <input type="text" id="txtPrecioCUVTC" readonly="readonly" />
            </div>
        </div>
        <div class="div-3">
            <div class="titG">Tipo:</div>
            <div class="selectP2 borde_redondeado">
                <select id="ddlTallaColor">
                    <option value='0'>-- Seleccionar --</option>
                    <option value='C'>Color</option>
                    <option value='T'>Talla</option>
                </select>
            </div>
        </div>
        <div class="div-3">
            <div class="titG">Descripción (Talla/Color):</div>
            <div class="selectP2 borde_redondeado">
                <input type="text" id="txtDescripcionTC" />
            </div>
        </div>
    </div>
</div>
<div id="DialogTonoMarca" style="display: none;">
    <div class="Content_modal">
        <table id="listTC"></table>
        <div id="pagerTC"></div>
    </div>
</div>
<div id="DialogNuevoMasivo" style="display: none;">
    <div class="Content_modal">
        <div class="div-3" style="text-align: center;">
            <div class="boton_redondo_admcontenido_on" id="divPaso1">1</div>
            <div class="signo_admcontenido_estrategia">></div>
            <div class="boton_redondo_admcontenido_off" id="divPaso2">2</div>
            <div class="signo_admcontenido_estrategia">></div>
            <div class="boton_redondo_admcontenido_off" id="divPaso3">3</div>
        </div>
        <div id="divMasivoPaso1">
            <div class="div-3" style="text-align: center; color: #00A2E8;">
                Pre Carga de CUVS pendientes por configurar en Zona de Estrategias
            </div>
            <div class="container" style="width: auto;">
                <div class="border-wrapper">
                    <table id="listCargaMasiva1"></table>
                    <div id="pagerCargaMasiva1"></div>
                </div>
            </div>
            <div id="divMostrarPreCarga">
                <div class="div-3" style="text-align: center; color: #00A2E8; margin-top: 20px;">
                    ¿Deseas pre cargar la información de los CUVS pendientes por configurar? (<span id="spnCantidadConfigurar1">11</span>) CUVS
                </div>
                <div class="div-3">
                    <div class="input_horizontal" style="text-align: center;">
                        <input type="button" name="btnAceptarMasivo1" id="btnAceptarMasivo1" value="Aceptar" style="float: none;" />
                        <input type="button" name="btnCancelarMasivo1" id="btnCancelarMasivo1" value="Cancelar" style="float: none;" />
                    </div>
                </div>
            </div>
        </div>
        <div id="divMasivoPaso2" style="display: none;">
            <div class="div-3" style="text-align: center; color: #00A2E8;">
                Grabar información en Zona de Estrategias
            </div>
            <div class="container" style="width: auto;">
                <div class="border-wrapper">
                    <table id="listCargaMasiva2"></table>
                    <div id="pagerCargaMasiva2"></div>
                </div>
            </div>
            <div id="divMostrarPreCarga2">
                <div class="div-3" style="text-align: center; color: #00A2E8; margin-top: 20px;">
                    ¿Deseas grabar la información de los CUVS pre cargados correctamente en la Zona de Estrategias? (<span id="spnCantidadConfigurar2">11</span>) CUVS
                </div>
                <div class="div-3">
                    <div class="input_horizontal" style="text-align: center;">
                        <input type="button" name="btnAceptarMasivo2" id="btnAceptarMasivo2" value="Aceptar" style="float: none;" />
                        <input type="button" name="btnCancelarMasivo2" id="btnCancelarMasivo2" value="Cancelar" style="float: none;" />
                    </div>
                </div>
            </div>
        </div>
        <div id="divMasivoPaso3" style="display: none;">
            <div class="div-3" style="text-align: center; color: #00A2E8;">
                Confirmación de grabación en Zona de Estrategias
            </div>
            <div class="div-3" style="text-align: center; margin-top: 20px;">
                Se grabó la información de los <a onclick=" VerCuvsTipo2(1); "><span id="spnCantidadConfigurar3">11</span> CUVS</a>
            </div>
            <div id="divMostrarNoCargados" class="div-3" style="text-align: center; margin-top: 20px;">
                Quedan <a onclick=" VerCuvsTipo2(2); "><span id="spnCantidadNoConfigurar3">11</span> CUVS</a> pendientes para cargar.
            </div>
            <div class="div-3">
                <div class="input_horizontal" style="text-align: center;">
                    <input type="button" name="btnAceptarMasivo3" id="btnAceptarMasivo3" value="Aceptar" style="float: none;" />
                </div>
            </div>
        </div>
    </div>
</div>
<div id="DialogGrillaCuv1">
    <div class="Content_modal">
        <div class="container" style="width: auto;">
            <div class="border-wrapper">
                <table id="listGrillaCuv1"></table>
                <div id="pagerGrillaCuv1"></div>
            </div>
        </div>
    </div>
</div>
<div id="DialogGrillaCuv2">
    <div class="Content_modal">
        <div class="container" style="width: auto;">
            <div class="border-wrapper">
                <table id="listGrillaCuv2"></table>
                <div id="pagerGrillaCuv2"></div>
            </div>
        </div>
    </div>
</div>

<div id="DialogDescMasivo" style="display: none;">
    <div class="Content_modal">
        <div id="divDescMasivoPaso1">
            <div class="div-3" style="text-align: center;">
                Seleccione el archivo para la carga masiva de las descripciones:
            </div>
            <div class="container" style="width: 70%;">
                <div class="border-wrapper">
                    <input type="file" id="fileDescMasivo" name="fileDescMasivo"/>
                </div>
            </div>
            <div class="div-3" style="margin: 15px auto; width: 200px;">
                Formato de archivo (*.csv):<br/>
                - CUV<br />
                - Descripción<br />
            </div>
            <div class="div-3">
                <div class="input_horizontal" style="text-align: center;">
                    <input type="button" name="btnAceptarMasivo1" id="btnAceptarDescMasivo1" value="Continuar" style="float: none;" />
                    <input type="button" name="btnCancelarMasivo1" id="btnCancelarDescMasivo1" value="Cancelar" style="float: none;" />
                </div>
            </div>
        </div>
        <div id="divDescMasivoPaso2" style="display: none;">
            <div class="div-3" style="text-align: center;">
                Resultado de la actualización: 
            </div>
            <div class="container" style="margin: 15px auto; width: auto;">                
                <div class="border-wrapper">
                    <table id="listCargaDescMasiva"></table>
                    <div id="pagerCargaDescMasiva"></div>
                </div>
            </div>
            <div class="div-3">
                <div class="input_horizontal" style="text-align: center;">
                    <input type="button" name="btnCancelarMasivo2" onclick="HideDialog('DialogDescMasivo')" value="Cerrar" style="float: none;" />
                </div>
            </div>
        </div>
    </div>
</div>
<div id="DialogDescActualizada">
    <div class="Content_modal">
        <div class="container" style="margin: 15px auto; width: auto;">
            <div class="border-wrapper">
                <table id="listDescActualizada"></table>
                <div id="pagerDescActualizada"></div>
            </div>
        </div>
        <div class="div-3">
            <div class="input_horizontal" style="text-align: center;">
                <input type="button" name="btnCancelarMasivo2" onclick="HideDialog('DialogDescActualizada')" value="Volver" style="float: none;" />
            </div>
        </div>
    </div>
</div>
<div id="DialogDescNoActualizada">
    <div class="Content_modal">
        <div class="container" style="margin: 15px auto; width: auto;">
            <div class="border-wrapper">
                <table id="listDescNoActualizada"></table>
                <div id="pagerDescNoActualizada"></div>
            </div>
        </div>
        <div class="div-3">
            <div class="input_horizontal" style="text-align: center;">
                <input type="button" name="btnCancelarMasivo2" onclick="HideDialog('DialogDescNoActualizada')" value="Volver" style="float: none;" />
            </div>
        </div>
    </div>
</div>
<div id="loadingScreen"></div>

<script type="text/javascript">
    var imagenVacia = '@imagenVacia';
    var rutaImagenVacia = '@Url.Content("~/Content/Images/" + imagenVacia)';
    var rutaTemporal = '@Url.Content("~/Content/Temporales/")';
    var urlGetOfertaByCUV = baseUrl + 'AdministrarEstrategia/GetOfertaByCUV';
    var urlCargarArbolRegionesZonas = baseUrl + "AdministrarEstrategia/CargarArbolRegionesZonas";
    var rutastylejstree = '@Url.Content("~/Content/Css/jstree/apple/stylejstree.css")';
    var rutaImagenEdit = '@Url.Content("~/Content/Images/Edit.png")';
    var rutaImagenDelete = '@Url.Content("~/Content/Images/Delete.png")';
    var urlFiltrarEstrategia = baseUrl + 'AdministrarEstrategia/FiltrarEstrategia';
    var urlDeshabilitarEstrategia = baseUrl + 'AdministrarEstrategia/DeshabilitarEstrategia';
    var urlActivarDesactivarEstrategias = baseUrl + 'AdministrarEstrategia/ActivarDesactivarEstrategias';
    var cantidadPrecargar = 0;
    var cantidadPrecargar2 = 0;
    var urlConsultarCuvTipoConfigurado = baseUrl + 'AdministrarEstrategia/ConsultarCuvTipoConfigurado';
    var urlConsultarCuvTipoConfiguradoTemporal = baseUrl + 'AdministrarEstrategia/ConsultarCuvTipoConfiguradoTemporal';
    var imagenesProductos = [];
    var originalContent;
    var imagen = "";
    var imagenPrevia = "";
    var isNuevo = false;
    var isVistaPreviaOpened = false;
    var urlS3 = "@Model.UrlS3";
    var estrategiaObj;
    var habilitarNemoTecnico = @Json.Encode(Model.habilitarNemotecnico);
    var TipoEstrategiaIncentivosProgramaNuevas = '@Constantes.TipoEstrategiaCodigo.IncentivosProgramaNuevas';
    var CodigoOfertaParaTi = "001";
    var CodigoPackNuevas = "002"; // Oferta Nueva Esika
    var CodigoOfertaWeb = "003";
    var CodigoLanzamiento = "005";
    var CodigoOfertasParaMi = "007";
    var CodigoPackAltoDesembolso = "008";
    var CodigoLosMasVendidos = "020";
    var CodigoOfertaDelDia = "009";
    var CodigoGuiaDeNegocio = "010";
    var _toastHelper = ToastHelper();

    jQuery(document).ready(function () {
        fnGrilla();
        IniDialog();

        estrategiaObj = Estrategia({
            actualizarMatrizComercialAction: '@Url.Action("ActualizarMatrizComercial", "MatrizComercial")',
            getImagesBySapCodeAction: '@Url.Action("GetImagesBySapCode", "AdministrarEstrategia")',
            getFiltrarEstrategiaAction: '@Url.Action("FiltrarEstrategia", "AdministrarEstrategia")',
            uploadAction: '@Url.Action("ImageMatrizUpload", "FileUpload")',
            getImagesByCodigoSAPAction: '@Url.Action("GetImagesByCodigoSAP", "MatrizComercial")',
            getImagesByNemotecnico: '@Url.Action("GetImagesByNemotecnicoSAP", "MatrizComercial")',
            habilitarNemotecnico: @Json.Encode(Model.habilitarNemotecnico),
            expValidacionNemotecnico: @Html.Raw(Model.ExpValidacionNemotecnico),
            actualizarDescripcionComercialAction: '@Url.Action("ActualizarDescripcionComercial", "MatrizComercial")'
        });

        if(habilitarNemoTecnico) {
            $("#matriz-busqueda-nemotecnico").show();
        } else{
            $("#matriz-busqueda-nemotecnico").hide();
        }

        $.jgrid.extend({
            Editar: estrategiaObj.editar,
            Eliminar: estrategiaObj.eliminar
        });

        $('#matriz-comercial-header').on('click', '#matriz-busqueda-nemotecnico #btnBuscarNemotecnico', estrategiaObj.buscarNemotecnico);
        $('#matriz-comercial-header').on('click', '#matriz-busqueda-nemotecnico #btnLimpiarBusquedaNemotecnico', estrategiaObj.limpiarBusquedaNemotecnico);

        $("#btnNuevo").click(function () {
            isNuevo = true;

            var tieneFlagNueva = $("#ddlTipoEstrategia option:selected").attr("flag-nueva");
            (tieneFlagNueva == "1") ? $(".chkEsOfertaIndependiente").show() : $(".chkEsOfertaIndependiente").hide();

            $.jstree._reference($("#arbolRegionZona")).check_all();

            if ($("#ddlPais").val() == "") {
                alert("Debe seleccionar el País, verifique.");
                return false;
            }
            if ($("#ddlCampania").val() == "") {
                alert("Debe seleccionar la Campaña, verifique.");
                return false;
            }
            if ($("#ddlTipoEstrategia").val() == "") {
                alert("Debe seleccionar un tipo de estrategia, verifique.");
                return false;
            }

            $("#hdTipoConsulta").val("1");
            $("#ddlCampaniaFin").val("");
            SeleccionarTipoOferta();
            PedidoAsociadoChecks();

            $("#hdEstrategiaIDConsulta").val($("#ddlTipoEstrategia").val());
            $("#hdEstrategiaID").val("0");
            $("#hdCampania").val($("#ddlCampania").val());
            $("#hdTipoEstrategiaID").val($("#ddlTipoEstrategia").val());
            $("#txtAlcance").val($("#ddlPais option:selected").html());
            $("#spanCampania").val($("#ddlCampania option:selected").html());
            $("#spanTipoEstrategia").val($("#ddlTipoEstrategia option:selected").html().trim());
            $('#chkHabilitarOferta').attr('checked', false);
            $('#chkEsOfertaIndependiente').attr('checked', false);
            $('#chkOfertaUltimoMinuto').attr('checked', false);
            $('#hdZonas').val('');

            $('#txtCUV2').val('');
            $('#txtPrecio2').val('');
            $('#txtCUV').val('');
            $('#txtPrecio').val('');
            $('#txtDescripcion').val('');
            $('#txtGanancia').val('');
            $('#matriz-imagenes-paginacion').empty();
            $('#matriz-comercial-images').empty();
            $('#file-upload').hide();

            $('#imgSeleccionada').attr("src", rutaImagenVacia);
            $('#imgZonaEstrategia').attr("src", rutaImagenVacia);

            $("#divImagenEstrategiaContenido").show();
            $("#divInformacionAdicionalEstrategiaContenido").hide();

            $("#divImagenEstrategia").css("color", "white");
            $("#divImagenEstrategia").css("background", "#00A2E8");
            $("#divInformacionAdicionalEstrategia").css("color", "#702789");
            $("#divInformacionAdicionalEstrategia").css("background", "#D0D0D0");
            $("#txtTextoLibre").val("");

            $('#hdColorFondo').val("#FFF");
            ActivarDesactivarChecks();
            $('#mensajeErrorCUV').val("");
            $('#mensajeErrorCUV2').val("");
            $("#linkAlcance").click();
            $(".checksPedidosAsociados").html('');

            var aux1 = $('#ddlTipoEstrategia').find(':selected').data('id');
            var aux2 = $('#ddlTipoEstrategia').find(':selected').data('codigo');
            //$("#btnActivarDesactivar").hide();

            if (aux1 == "4" || aux2 == "005" || aux2 == "007" || aux2 == "008") {
                $("#txtOrden").val("");
                $('#div-orden').hide();

                $('#txt1-estrella').html('Oferta de Último Minuto');
                $('#txt2-estrella').hide();
                // $("#btnActivarDesactivar").show();
            }
            else {
                $('#div-orden').show();

                $('#txt1-estrella').html('Mostrar estrella');
                $('#txt2-estrella').show();
            }

            $("#ddlEtiqueta1").children('option').show();
            $("#ddlEtiqueta2").children('option').show();

            if (aux1 == "2") {
                $("#ddlEtiqueta1").children('option').hide();
                $("#ddlEtiqueta1").children("option[data-id='4']").show();

                $("#hdnEtiqueta1").val('4');
            }
            else if (aux1 == "4" || aux1 == "5" || aux2 == "005" || aux2 == "007" || aux2 == "008") {

                $("#hdnEtiqueta1").val('1');
                $("#hdnEtiqueta2").val('3');

            } else if (aux1 == "0" || aux1 == '6') {
                $("#ddlEtiqueta1").children("option[data-id='5']").hide();
                $("#ddlEtiqueta2").children("option[data-id='5']").hide();
                $("#hdnEtiqueta1").val('5');
                $("#hdnEtiqueta2").val('5');
            }

            if (aux1 == "6") {
                $('.OfertaUltimoMinuto').hide();
            } else { $('.OfertaUltimoMinuto').show(); }

            if (aux1 == "7") {
                $('.Recomendados').hide();

                $("#ddlEtiqueta1").children('option').hide();
                $("#ddlEtiqueta1").children("option[data-id='1']").show();

                $("#ddlEtiqueta2").children('option').hide();
                $("#ddlEtiqueta2").children("option[data-id='5']").show();

                $('#div-orden').hide();

                $("#hdnEtiqueta1").val('1');
                $("#hdnEtiqueta2").val('5');
            }

            if (aux2 == '005') $('#div-revista-digital').show();
            else $('#div-revista-digital').hide();

            LimpiarCamposLanzamiento('img-fondo-desktop');
            LimpiarCamposLanzamiento('img-prev-desktop');
            //LimpiarCamposLanzamiento('img-fondo-mobile');
            LimpiarCamposLanzamiento('img-ficha-desktop');
            LimpiarCamposLanzamiento('img-ficha-mobile');
            LimpiarCamposLanzamiento('img-ficha-fondo-desktop');
            LimpiarCamposLanzamiento('img-ficha-fondo-mobile');
            LimpiarCamposLanzamiento('img-home-desktop');
            LimpiarCamposLanzamiento('img-home-mobile');
            $("#url-video-desktop").val("");
            $("#url-video-mobile").val("");

            if(aux2 == TipoEstrategiaIncentivosProgramaNuevas)
                $("#divPrecioValorizado").html("Ganancia");
            else
                $("#divPrecioValorizado").html("Precio Valorizado");

            HideDialog("DialogZona");
            showDialog("DialogAdministracionEstrategia");
        });
        $("#btnActivarDesactivar").click(function () {

            var proceder = confirm('¿ Desea habilitar/deshabiltar las estrategias?');
            if (!proceder)
                return false;

            waitingDialog({});

            var estrategias = jQuery("#list").jqGrid('getDataIDs', 'EstrategiaID');
            var estrategiasSeleccionadas = jQuery("#list").jqGrid('getGridParam', 'selarrrow');
            var estrategiasNoSeleccionadas = estrategias.filter(function (obj) { return estrategiasSeleccionadas.indexOf(obj) == -1; });

            var params = {
                EstrategiasActivas: estrategiasSeleccionadas.join(','),
                EstrategiasDesactivas: estrategiasNoSeleccionadas.join(','),
                campaniaID: $("#ddlCampania").val(),
                tipoEstrategiaCod: $('#ddlTipoEstrategia :selected').data('codigo')
            };

            jQuery.ajax({
                type: 'POST',
                url: urlActivarDesactivarEstrategias,
                dataType: 'json',
                contentType: 'application/json; charset=utf-8',
                data: JSON.stringify(params),
                async: true,
                success: function (data) {
                    alert(data.message);
                    fnGrilla();
                    closeWaitingDialog();
                },
                error: function (data, error) {
                    alert(data.message);
                    closeWaitingDialog();
                }
            });

        });
        $("#ddlTipoEstrategia").change(function () {
            //var aux1 = $('#ddlTipoEstrategia').find(':selected').data('id');
            var aux2 = $('#ddlTipoEstrategia').find(':selected').data('codigo');
            $("#btnActivarDesactivar").hide();
            $("#btnNuevoMasivo").hide();
            $("#btnDescripcionMasivo").hide();
            
            if (aux2.in(CodigoOfertaParaTi, CodigoOfertaDelDia, CodigoLosMasVendidos, CodigoLanzamiento,
                        CodigoOfertasParaMi, CodigoPackAltoDesembolso, CodigoGuiaDeNegocio)) {
                $("#btnActivarDesactivar").show();
                $("#btnNuevoMasivo").show();
            }

            SeleccionarTipoOferta();
            PedidoAsociadoChecks();
        });
        $("#btnBuscar").click(function () {
            if ($("#ddlPais").val() == "") {
                alert("Debe seleccionar el País, verifique.");
                return false;
            }
            if ($("#ddlCampania").val() == "") {
                alert("Debe seleccionar la Campaña, verifique.");
                return false;
            }
            if ($("#ddlTipoEstrategia").val() == "") {
                alert("Debe seleccionar el tipo de estrategia, verifique.");
                return false;
            }
            $("#hdEstrategiaIDConsulta").val($("#ddlTipoEstrategia").val());
            $("#hdTipoConsulta").val("1");
            $("#hdEstrategiaCodigo").val($('#ddlTipoEstrategia option:selected').data('codigo'));
            fnGrilla();
        });
        $('#ddlPais').change(function () {
            $("#hdTipoConsulta").attr("value", "0");
            $("#list").jqGrid("clearGridData", true).trigger("reloadGrid");
            var Id = $(this).val();
            waitingDialog({});
            $.ajaxSetup({ cache: false });
            $.ajax({
                type: 'GET',
                url: baseUrl + 'AdministrarEstrategia/ObtenterCampanias',
                data: "PaisID=" + (Id == "" ? 0 : Id),
                cache: false,
                dataType: 'Json',
                success: function (data) {
                    if (checkTimeout(data)) {
                        var ddlCampania = $('#ddlCampania');
                        var ddlCampaniaFin = $('#ddlCampaniaFin');
                        ddlCampania.empty();
                        ddlCampaniaFin.empty();
                        if (data.lista.length > 0) {
                            ddlCampania.append($('<option/>', {
                                value: "",
                                text: "-- Seleccionar --"
                            }));
                            ddlCampaniaFin.append($('<option/>', {
                                value: "",
                                text: "-- Seleccionar --"
                            }));
                            if (Id != "") {
                                for (var item in data.lista) {
                                    ddlCampania.append($('<option/>', {
                                        value: data.lista[item].CampaniaID,
                                        text: data.lista[item].Codigo
                                    }));
                                    ddlCampaniaFin.append($('<option/>', {
                                        value: data.lista[item].CampaniaID,
                                        text: data.lista[item].Codigo
                                    }));
                                }
                            }
                        }
                        cargarArbol();
                        closeWaitingDialog();
                    }
                },
                error: function (x, xh, xhr) {
                    if (checkTimeout(x)) {
                        closeWaitingDialog();
                    }
                }
            });

            $.getJSON(baseUrl + 'MatrizComercial/ObtenerISOPais', { paisID: Id }, function (data) {
                closeWaitingDialog();
            });

        });


        $("#linkAlcance").click(function () {
            var strZonas = $("#hdZonas").val();
            if (strZonas != "") {
                $.jstree._reference($("#arbolRegionZona")).uncheck_all();
                var strZonasArreglo = strZonas.split(",");
                for (i = 0; i < strZonasArreglo.length; i++) {
                    $("#arbolRegionZona").jstree("check_node", "#" + strZonasArreglo[i], true);
                }
                $("#chkSeleccionar").attr("checked", true);
                $.jstree._reference($("#arbolRegionZona")).get_unchecked(null, true).each(function () {
                    if (this.className.toLowerCase().indexOf("jstree-leaf") == -1) {
                        return true;
                    }
                    $("#chkSeleccionar").attr("checked", false);
                });
            } else {
                $.jstree._reference($("#arbolRegionZona")).check_all();
                var zonas = "";
                $.jstree._reference($("#arbolRegionZona")).get_checked(null, true).each(function () {
                    if (this.className.toLowerCase().indexOf("jstree-leaf") == -1) {
                        return true;
                    }
                    zonas += this.id + ",";
                });
                if (zonas != "") {
                    zonas = zonas.substring(0, zonas.length - 1);
                }
                $("#hdZonas").val(zonas);
                $("#chkSeleccionar").attr("checked", true);
            }
            $('#arbolRegionZona').jstree('close_all');
            showDialog("DialogZona");
            return false;
        });

        $("#chkSeleccionar").click(function () {
            if (this.checked)
                $.jstree._reference($("#arbolRegionZona")).check_all();
            else
                $.jstree._reference($("#arbolRegionZona")).uncheck_all();
        });
        $("#txtCUV").keyup(function () {
            if ($(this).val().length == 5) {

                if ($("#txtCUV2").val() == "") {
                    alert("Debe ingresar un valor para el CUV2");
                    return false;
                }

                waitingDialog({});
                $.ajaxSetup({ cache: false });

                var flagNueva = $("#ddlTipoEstrategia option:selected").attr("flag-nueva");
                var flagRecoProduc = $("#ddlTipoEstrategia option:selected").attr("flag-recoproduct");
                var flagRecoPerfil = $("#ddlTipoEstrategia option:selected").attr("flag-recoperfil");
                var auxOD = $('#ddlTipoEstrategia').find(':selected').data('id');

                var flagOD = "";
                if (auxOD == '7' || auxOD == '4') {
                    flagOD = '1';
                }
                else if (auxOD == '9' || auxOD == '10' || auxOD == '11') {
                    flagOD = auxOD;
                } else {
                    flagOD = '0';
                }

                var params = {
                    CampaniaID: $("#ddlCampania").val(),
                    CUV2: $("#txtCUV2").val(),
                    TipoEstrategiaID: $("#ddlTipoEstrategia").val(),
                    CUV1: $("#txtCUV").val(),
                    flag: flagOD,
                    FlagNueva: flagNueva,
                    FlagRecoProduc: flagRecoProduc,
                    FlagRecoPerfil: flagRecoPerfil
                };

                jQuery.ajax({
                    type: 'POST',
                    url: baseUrl + 'AdministrarEstrategia/GetOfertaByCUV',
                    dataType: 'json',
                    contentType: 'application/json; charset=utf-8',
                    data: JSON.stringify(params),
                    async: true,
                    success: function (data) {
                        if (data.message == "OK") {
                            $("#txtPrecio").val(parseFloat(data.precio).toFixed(2));
                            $('#mensajeErrorCUV').val("");
                            closeWaitingDialog();
                        } else {
                            $('#mensajeErrorCUV').val(data.message);
                            alert($('#mensajeErrorCUV').val());
                            closeWaitingDialog();
                        }
                    },
                    error: function (data, error) {
                        $('#mensajeErrorCUV').val(data.message);
                        alert($('#mensajeErrorCUV').val());
                        closeWaitingDialog();
                    }
                });
            }
        });
        $("#txtCUVTC").keyup(function () {

            if ($(this).val().length == 5) {

                if ($("#txtCUV2").val() == "") {
                    alert("Debe ingresar un valor para el CUV2");
                    return false;
                }

                waitingDialog({});
                $.ajaxSetup({ cache: false });

                var flagNueva = $("#ddlTipoEstrategia option:selected").attr("flag-nueva");
                var flagRecoProduc = $("#ddlTipoEstrategia option:selected").attr("flag-recoproduct");
                var flagRecoPerfil = $("#ddlTipoEstrategia option:selected").attr("flag-recoperfil");

                var params = {
                    CampaniaID: $("#ddlCampania").val(),
                    CUV2: $("#txtCUVTC").val(),
                    TipoEstrategiaID: $("#ddlTipoEstrategia").val(),
                    CUV1: "0",
                    flag: "2",
                    FlagNueva: flagNueva,
                    FlagRecoProduc: flagRecoProduc,
                    FlagRecoPerfil: flagRecoPerfil

                };

                jQuery.ajax({
                    type: 'POST',
                    url: baseUrl + 'AdministrarEstrategia/GetOfertaByCUV',
                    dataType: 'json',
                    contentType: 'application/json; charset=utf-8',
                    data: JSON.stringify(params),
                    async: true,
                    success: function (data) {
                        if (data.message == "OK") {
                            $("#txtDescripcionCUVTC").val(data.descripcion);
                            $("#txtPrecioCUVTC").val(parseFloat(data.precio).toFixed(2));
                            closeWaitingDialog();
                        } else {
                            alert(data.message);
                            closeWaitingDialog();
                        }
                    },
                    error: function (data, error) {
                        $('#mensajeErrorCUV').val(data.message);
                        alert($('#mensajeErrorCUV').val());
                        closeWaitingDialog();
                    }
                });
            }

        });
        $("#txtCUV2").keyup(function () {
            var cuvIngresado = $(this).val();
            $("#imgSeleccionada").attr("src", rutaImagenVacia);
            $("#imgSeleccionada").attr("data-id", "0");

            estrategiaObj.mostrarInformacionCUV(cuvIngresado, isNuevo);
        });

        $(".chk-estrategia-imagen").click(function () {
            var id = $(this).attr('data-id');
            if ($(this).attr('checked')) {
                $("#ImagenProducto").val($(this).val());
                $('.chk-estrategia-imagen[data-id!="' + id + '"]').removeAttr('checked');
            }
        });

        ActivarDesactivarChecks();
        PaletaColores();
        $(".activar-desactivar").click(function () {
            if (!$(this).attr("checked")) {
                $(this).parent().parent().find("input").each(function () {
                    $(this).val('');
                    $("#chkEstrella").attr('checked', false);
                    $(this).attr('disabled', true);
                });
                $(this).parent().parent().find("select").each(function () {
                    $(this).val('');
                    $(this).attr('disabled', true);
                });
                $(this).attr('disabled', false);
                PaletaColores();
            } else {
                $(this).parent().parent().find("input").each(function () {
                    $(this).val('');
                    $("#chkEstrella").attr('checked', false);
                    $(this).attr('disabled', false);
                });
                $(this).parent().parent().find("select").each(function () {
                    $(this).val('');
                    $(this).attr('disabled', false);
                });
                $(this).attr('disabled', false);
                PaletaColores();
            }
        });

        $("#btnNuevoMasivo").click(function () {
            if ($("#ddlPais").val() == "") {
                alert("Debe seleccionar el País, verifique.");
                return false;
            }
            if ($("#ddlCampania").val() == "") {
                alert("Debe seleccionar la Campaña, verifique.");
                return false;
            }
            if ($("#ddlTipoEstrategia").val() == "") {
                alert("Debe seleccionar un tipo de estrategia, verifique.");
                return false;
            } else {
                var estrategiaId = $("#ddlTipoEstrategia option:selected").data("id");
                if (estrategiaId !== 4 && estrategiaId !== 20 && estrategiaId !== 9 && estrategiaId !== 10 && estrategiaId !== 11 && estrategiaId !== 7 && estrategiaId !== 12) {
                    alert("Debe seleccionar el tipo de Estrategia que permita esta funcionalidad.");
                    return false;
                }
            }

            $("#divMasivoPaso1").show();
            $("#divMasivoPaso2").hide();
            $("#divMasivoPaso3").hide();

            $("#divPaso1").removeClass("boton_redondo_admcontenido_off");
            $("#divPaso1").addClass("boton_redondo_admcontenido_on");

            $("#divPaso2").removeClass("boton_redondo_admcontenido_on");
            $("#divPaso2").addClass("boton_redondo_admcontenido_off");

            $("#divPaso3").removeClass("boton_redondo_admcontenido_on");
            $("#divPaso3").addClass("boton_redondo_admcontenido_off");

            fnGrillaEstrategias1();
            showDialog("DialogNuevoMasivo");
        });

        $("#btnDescripcionMasivo").click(function () {
            if ($("#ddlPais").val() == "") {
                _toastHelper.error("Debe seleccionar el País, verifique.");
                return false;
            }
            if ($("#ddlCampania").val() == "") {
                _toastHelper.error("Debe seleccionar la Campaña, verifique.");
                return false;
            }
            if ($("#ddlTipoEstrategia").val() == "") {
                _toastHelper.error("Debe seleccionar un tipo de estrategia, verifique.");
                return false;
            } else {
                var estrategiaId = $("#ddlTipoEstrategia option:selected").data("id");
                if (estrategiaId !== 4 && estrategiaId !== 20 && estrategiaId !== 9 && estrategiaId !== 10 && estrategiaId !== 11 && estrategiaId !== 7 && estrategiaId !== 12) {
                    _toastHelper.error("Debe seleccionar el tipo de Estrategia que permita esta funcionalidad.");
                    return false;
                }
            }

            $("#divDescMasivoPaso1").show();
            $("#divDescMasivoPaso2").hide();

            showDialog("DialogDescMasivo");
        });
        
        $("#btnCancelarDescMasivo1").click(function () {
            HideDialog("DialogDescMasivo");
        });

        $("#btnAceptarDescMasivo1").click(function () {
            $("#divDescMasivoPaso1").show();
            $("#divDescMasivoPaso2").hide();
            UploadFileCvs();
        });
        
        $("#btnAceptarMasivo1").click(function () {
            var params = {
                campaniaId: parseInt($("#ddlCampania").val()),
                tipoConfigurado: 2,
                estrategiaCodigo: $('#ddlTipoEstrategia').find(':selected').data('codigo'),
                habilitarNemotecnico: estrategiaObj.habilitarNemotecnico
            };

            waitingDialog({});

            jQuery.ajax({
                type: 'POST',
                url: baseUrl + 'AdministrarEstrategia/InsertEstrategiaTemporal',
                dataType: 'json',
                contentType: 'application/json; charset=utf-8',
                data: JSON.stringify(params),
                async: true,
                success: function (data) {
                    if (data.success) {
                        closeWaitingDialog();
                        fnGrillaEstrategias2();
                    } else {
                        alert(data.message);
                    }
                },
                error: function (data, error) {
                    alert(data.message);
                }
            });
        });

        $("#btnCancelarMasivo1").click(function () {
            HideDialog("DialogNuevoMasivo");
        });

        $("#btnAceptarMasivo2").click(function () {
            var params = {
                campaniaId: parseInt($("#ddlCampania").val()),
                tipoConfigurado: 1,
                estrategiaId: $('#ddlTipoEstrategia').find(':selected').data('id')
            };

            waitingDialog({});

            jQuery.ajax({
                type: 'POST',
                url: baseUrl + 'AdministrarEstrategia/InsertEstrategiaOfertaParaTi',
                dataType: 'json',
                contentType: 'application/json; charset=utf-8',
                data: JSON.stringify(params),
                async: true,
                success: function (data) {
                    if (data.success) {
                        closeWaitingDialog();
                        $("#divMasivoPaso1").hide();
                        $("#divMasivoPaso2").hide();
                        $("#divMasivoPaso3").show();

                        $("#divPaso1").removeClass("boton_redondo_admcontenido_on");
                        $("#divPaso1").addClass("boton_redondo_admcontenido_off");

                        $("#divPaso2").removeClass("boton_redondo_admcontenido_on");
                        $("#divPaso2").addClass("boton_redondo_admcontenido_off");

                        $("#divPaso3").removeClass("boton_redondo_admcontenido_off");
                        $("#divPaso3").addClass("boton_redondo_admcontenido_on");
                    } else {
                        alert(data.message);
                    }
                },
                error: function (data, error) {
                    alert(data.message);
                }
            });
        });

        $("#btnCancelarMasivo2").click(function () {
            var params = {
                campaniaId: parseInt($("#ddlCampania").val())
            };

            jQuery.ajax({
                type: 'POST',
                url: baseUrl + 'AdministrarEstrategia/CancelarInsertEstrategiaTemporal',
                dataType: 'json',
                contentType: 'application/json; charset=utf-8',
                data: JSON.stringify(params),
                async: true,
                success: function (data) {
                    if (data.success) {
                        HideDialog("DialogNuevoMasivo");
                    }
                    alert(data.message);
                },
                error: function (data, error) {
                    alert(data.message);
                }
            });
        });

        $("#btnAceptarMasivo3").click(function () {
            HideDialog("DialogNuevoMasivo");
        });

        UploadFileLanzamineto('img-fondo-desktop');
        UploadFileLanzamineto('img-prev-desktop');
        //UploadFileLanzamineto('img-fondo-mobile');
        UploadFileLanzamineto('img-ficha-desktop');
        UploadFileLanzamineto('img-ficha-fondo-desktop');
        UploadFileLanzamineto('img-ficha-mobile');
        UploadFileLanzamineto('img-ficha-fondo-mobile');
        UploadFileLanzamineto('img-home-desktop');
        UploadFileLanzamineto('img-home-mobile');
        });

    $("#divImagenEstrategia").click(function () {
        $(this).css("color", "white");
        $(this).css("background", "#00A2E8");

        $("#divInformacionAdicionalEstrategia").css("color", "#702789");
        $("#divInformacionAdicionalEstrategia").css("background", "#D0D0D0");

        $("#divImagenEstrategiaContenido").show();
        $("#divInformacionAdicionalEstrategiaContenido").hide();
    });

    $("#divInformacionAdicionalEstrategia").click(function () {
        $(this).css("color", "white");
        $(this).css("background", "#00A2E8");

        $("#divImagenEstrategia").css("color", "#702789");
        $("#divImagenEstrategia").css("background", "#D0D0D0");

        $("#divInformacionAdicionalEstrategiaContenido").show();
        $("#divImagenEstrategiaContenido").hide();
    });

    $(document).keydown(function (e) {
        if (e.keyCode == 8 && e.target.tagName != 'INPUT' && e.target.tagName != 'TEXTAREA') {
            e.preventDefault();
        }
    });

    function fnGrillaEstrategias1() {
        $("#listCargaMasiva1").jqGrid("GridUnload");
        jQuery("#listCargaMasiva1").jqGrid({
            url: baseUrl + "AdministrarEstrategia/ConsultarOfertasParaTi",
            hidegrid: false,
            datatype: 'json',
            postData: ({
                CampaniaID: $("#ddlCampania").val(),
                EstrategiaID: $('#ddlTipoEstrategia').find(':selected').data('id')
            }),
            mtype: 'GET',
            contentType: "application/json; charset=utf-8",
            colNames: ['Id', 'Descripción', 'Cantidad'],
            colModel: [
                { name: 'Id', index: 'Id', width: 100, editable: true, resizable: false, hidden: true },
                { name: 'Descripcion', index: 'Descripcion', width: 100, editable: true, resizable: false },
                { name: 'Activo', index: 'Activo', width: 30, align: 'center', editable: true, resizable: false, formatter: ShowActionsVer1 }
            ],
            jsonReader:
            {
                root: "rows",
                page: "page",
                total: "total",
                records: "records",
                repeatitems: true,
                cell: "cell",
                id: "id"
            },
            pager: jQuery('#pagerCargaMasiva1'),
            loadtext: 'Cargando datos...',
            recordtext: "{0} - {1} de {2} Registros",
            emptyrecords: 'No hay resultados',
            rowNum: 10,
            scrollOffset: 0,
            rowList: [10, 20, 30, 40, 50],
            sortname: 'Orden',
            sortorder: 'asc',
            viewrecords: true,
            multiselect: false,
            height: 'auto',
            width: 540,
            pgtext: 'Pág: {0} de {1}',
            altRows: true,
            altclass: 'jQGridAltRowClass',
            loadComplete: function () { },
            gridComplete: function () {
                if (cantidadPrecargar == 0) {
                    $("#divMostrarPreCarga").css("display", "none");
                } else {
                    $("#divMostrarPreCarga").css("display", "");
                    $("#spnCantidadConfigurar1").html(cantidadPrecargar);
                }
            }
        });
        jQuery("#listCargaMasiva1").jqGrid('navGrid', "#pagerCargaMasiva1", { edit: false, add: false, refresh: false, del: false, search: false });
        jQuery("#listCargaMasiva1").setGridParam({ datatype: 'json', page: 1 }).trigger('reloadGrid');
    }

    function fnGrillaEstrategias2() {
        $("#listCargaMasiva2").jqGrid("GridUnload");
        jQuery("#listCargaMasiva2").jqGrid({
            url: baseUrl + "AdministrarEstrategia/ConsultarOfertasParaTiTemporal",
            hidegrid: false,
            datatype: 'json',
            postData: ({
                CampaniaID: $("#ddlCampania").val()
            }),
            mtype: 'GET',
            contentType: "application/json; charset=utf-8",
            colNames: ['Id', 'Descripción', 'Cantidad'],
            colModel: [
                { name: 'Id', index: 'Id', width: 100, editable: true, resizable: false, hidden: true },
                { name: 'Descripcion', index: 'Descripcion', width: 100, editable: true, resizable: false },
                { name: 'Activo', index: 'Activo', width: 30, align: 'center', editable: true, resizable: false, formatter: ShowActionsVer2 }
            ],
            jsonReader:
            {
                root: "rows",
                page: "page",
                total: "total",
                records: "records",
                repeatitems: true,
                cell: "cell",
                id: "id"
            },
            pager: jQuery('#pagerCargaMasiva2'),
            loadtext: 'Cargando datos...',
            recordtext: "{0} - {1} de {2} Registros",
            emptyrecords: 'No hay resultados',
            rowNum: 10,
            scrollOffset: 0,
            rowList: [10, 20, 30, 40, 50],
            sortname: 'Orden',
            sortorder: 'asc',
            viewrecords: true,
            multiselect: false,
            height: 'auto',
            width: 540,
            pgtext: 'Pág: {0} de {1}',
            altRows: true,
            altclass: 'jQGridAltRowClass',
            loadComplete: function () { },
            gridComplete: function () {
                if (cantidadPrecargar2 == 0) {
                    $("#divMostrarPreCarga2").css("display", "none");
                } else {
                    $("#divMostrarPreCarga2").css("display", "");
                    $("#spnCantidadConfigurar2").html(cantidadPrecargar2);
                }

                $("#divMasivoPaso1").hide();
                $("#divMasivoPaso2").show();

                $("#divPaso1").removeClass("boton_redondo_admcontenido_on");
                $("#divPaso1").addClass("boton_redondo_admcontenido_off");

                $("#divPaso2").removeClass("boton_redondo_admcontenido_off");
                $("#divPaso2").addClass("boton_redondo_admcontenido_on");
            }
        });
        jQuery("#listCargaMasiva2").jqGrid('navGrid', "#pagerCargaMasiva2", { edit: false, add: false, refresh: false, del: false, search: false });
        jQuery("#listCargaMasiva2").setGridParam({ datatype: 'json', page: 1 }).trigger('reloadGrid');
    }

    function InitCap(str) {
        return str.replace(/([^\W_]+[^\s-]*) */g, function (txt) { return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase(); });
    }

    function PaletaColores() {
        $("#txtColorFondo").spectrum({
            color: $("#hdColorFondo").val(),
            showInput: true,
            className: "full-spectrum",
            showInitial: true,
            showPalette: true,
            showSelectionPalette: true,
            maxPaletteSize: 10,
            preferredFormat: "hex",
            localStorageKey: "spectrum.demo",
            move: function (color) {

            },
            show: function () {

            },
            beforeShow: function () {

            },
            hide: function () {

            },
            change: function () {
                $("#hdColorFondo").val($(this).val());
            },
            palette: [
                ["rgb(0, 0, 0)", "rgb(67, 67, 67)", "rgb(102, 102, 102)",
                "rgb(204, 204, 204)", "rgb(217, 217, 217)", "rgb(255, 255, 255)"],
                ["rgb(152, 0, 0)", "rgb(255, 0, 0)", "rgb(255, 153, 0)", "rgb(255, 255, 0)", "rgb(0, 255, 0)",
                "rgb(0, 255, 255)", "rgb(74, 134, 232)", "rgb(0, 0, 255)", "rgb(153, 0, 255)", "rgb(255, 0, 255)"],
                ["rgb(230, 184, 175)", "rgb(244, 204, 204)", "rgb(252, 229, 205)", "rgb(255, 242, 204)", "rgb(217, 234, 211)",
                "rgb(208, 224, 227)", "rgb(201, 218, 248)", "rgb(207, 226, 243)", "rgb(217, 210, 233)", "rgb(234, 209, 220)",
                "rgb(221, 126, 107)", "rgb(234, 153, 153)", "rgb(249, 203, 156)", "rgb(255, 229, 153)", "rgb(182, 215, 168)",
                "rgb(162, 196, 201)", "rgb(164, 194, 244)", "rgb(159, 197, 232)", "rgb(180, 167, 214)", "rgb(213, 166, 189)",
                "rgb(204, 65, 37)", "rgb(224, 102, 102)", "rgb(246, 178, 107)", "rgb(255, 217, 102)", "rgb(147, 196, 125)",
                "rgb(118, 165, 175)", "rgb(109, 158, 235)", "rgb(111, 168, 220)", "rgb(142, 124, 195)", "rgb(194, 123, 160)",
                "rgb(166, 28, 0)", "rgb(204, 0, 0)", "rgb(230, 145, 56)", "rgb(241, 194, 50)", "rgb(106, 168, 79)",
                "rgb(69, 129, 142)", "rgb(60, 120, 216)", "rgb(61, 133, 198)", "rgb(103, 78, 167)", "rgb(166, 77, 121)",
                "rgb(91, 15, 0)", "rgb(102, 0, 0)", "rgb(120, 63, 4)", "rgb(127, 96, 0)", "rgb(39, 78, 19)",
                "rgb(12, 52, 61)", "rgb(28, 69, 135)", "rgb(7, 55, 99)", "rgb(32, 18, 77)", "rgb(76, 17, 48)"]
            ]
        });
    }

    function SeleccionarTipoOferta() {
        var flagNueva = $("#ddlTipoEstrategia option:selected").attr("flag-nueva");
        var flagRecoProduc = $("#ddlTipoEstrategia option:selected").attr("flag-recoproduct");
        var flagRecoPerfil = $("#ddlTipoEstrategia option:selected").attr("flag-recoperfil");
        var codigo = $('#ddlTipoEstrategia').find(':selected').data('codigo');;

        (flagNueva == "1") ? $(".chkEsOfertaIndependiente").show() : $(".chkEsOfertaIndependiente").hide();

        $("#ddlCampaniaFin").val("");
        $("#list").jqGrid('hideCol', ["NumeroPedido"]);
        if (flagNueva == "1") {
            $(".DatosNuevas").show();
            $(".OcultarNuevas").css({ visibility: "hidden" });
            $("#txtLimite").val("1");
            $("#list").jqGrid('showCol', ["NumeroPedido"]);
            $(".DatosNuevas .checksPedidosAsociados").prev().css("display", "");
            $(".DatosNuevas .checksPedidosAsociados").css("display", "");
        } else {
            if(codigo == TipoEstrategiaIncentivosProgramaNuevas)
            {
                $(".DatosNuevas").show();
                $(".OcultarNuevas").css({ visibility: "hidden" });
                $(".DatosNuevas .checksPedidosAsociados").prev().css("display", "none");
                $(".DatosNuevas .checksPedidosAsociados").css("display", "none");
            }
            else
            {
                $(".DatosNuevas").hide();
                $(".OcultarNuevas").css({ visibility: "visible" });
                $(".DatosNuevas .checksPedidosAsociados").prev().css("display", "");
                $(".DatosNuevas .checksPedidosAsociados").css("display", "");
            }
            $("#txtLimite").val("99");
        }
        if (flagRecoProduc == "1" || flagRecoPerfil == "1") {
            $(".Recomendados").show();
            if (flagRecoProduc == "1") {
                $("#idEstrella").hide();
                $("#idColorFondo").show();
            }
            if (flagRecoPerfil == "1") {
                $("#idColorFondo").hide();
                $("#idEstrella").show();
                $("#idEstrella").attr("checked", false);
            }
        } else {
            $(".Recomendados").hide();
        }
    }

    function PedidoAsociadoChecks() {
        waitingDialog({});
        $.ajaxSetup({ cache: false });
        var codigoPrograma = $("#ddlTipoEstrategia option:selected").attr("Codigo-Programa");

        if (codigoPrograma == undefined) {
            codigoPrograma = '00';
        }
        $.ajax({
            type: 'GET',
            url: baseUrl + 'AdministrarEstrategia/ObtenerPedidoAsociado',
            data: "CodigoPrograma=" + codigoPrograma,
            async: true,
            dataType: 'Json',
            success: function (data) {
                if (data != null && data.pedidoAsociado.length > 0) {
                    var pedidoAsociados = data.pedidoAsociado[0].PedidoAsociado.split(',');
                    $.each(pedidoAsociados, function (x) {
                        var item = $(this)[0];
                        $(".checksPedidosAsociados")
                            .append('<div class="titB" style="width:9px;"><input type="checkbox" class="chkclass" id="PedidoAsociado_' + item + '" name="PedidoAsociado_' + item + '" value=' + item + ' >' + item + '</div>');
                    });
                }
                closeWaitingDialog();
            },
            error: function (x, xh, xhr) {
                if (checkTimeout(x)) {
                    closeWaitingDialog();
                }
            }
        });
    }

    function ActivarDesactivarChecks() {
        $(".activar-desactivar").each(function () {
            if (!$(this).attr("checked")) {
                $(this).parent().parent().find("input").each(function () {
                    $(this).val('');
                    $("#chkEstrella").attr('checked', false);
                    $(this).attr('disabled', true);
                });
                $(this).parent().parent().find("select").each(function () {
                    $(this).val('');
                    $(this).attr('disabled', true);
                });
                $(this).attr('disabled', false);
                PaletaColores();
            } else {
                $(this).parent().parent().find("input").each(function () {
                    $(this).val('');
                    $("#chkEstrella").attr('checked', false);
                    $(this).attr('disabled', false);
                });
                $(this).parent().parent().find("select").each(function () {
                    $(this).val('');
                    $(this).attr('disabled', false);
                });
                $(this).attr('disabled', false);
                PaletaColores();
            }
        });
    }

    function cargarArbol() {
        $("#arbolRegionZona").jstree({
            json_data: {
                ajax: {
                    url: urlCargarArbolRegionesZonas,
                    data: function (n) {
                        return { pais: $("#ddlPais").val(), region: 0, zona: 0 };
                    },
                    type: "GET",
                    error: function (XMLHttpRequest, textStatus, errorThrown) { },
                    success: function (data, textStatus, jqXHR) { },
                    complete: function () {
                        $("#arbolRegionZona").jstree("set_theme", "apple", rutastylejstree);
                        closeWaitingDialog();
                    }
                }
            },
            "themes": {
                "theme": "apple",
                "dots": true,
                "icons": false
            },
            plugins: ["themes", "json_data", "ui", "checkbox"]
        });
    }

    function fnGrilla() {
        $("#list").jqGrid("GridUnload");
        var tipo = $('#ddlTipoEstrategia').find(':selected').data('id');
        var codigo = $('#ddlTipoEstrategia').find(':selected').data('codigo');
        var allRowsInGrid = [];
        var flag = true;
        jQuery("#list").jqGrid({
            url: baseUrl + "AdministrarEstrategia/Consultar",
            hidegrid: false,
            datatype: 'json',
            postData: ({
                CampaniaID: $("#ddlCampania").val(),
                TipoEstrategiaID: $("#ddlTipoEstrategia").val(),
                CUV: $("#CUV").val(),
                Consulta: $("#hdTipoConsulta").val(),
                Imagen: $("#ddlTieneImagen").val(),
                Activo: $("#ddlOfertaActiva").val()
            }),
            mtype: 'GET',
            contentType: "application/json; charset=utf-8",
            multiselect: (tipo == '4' || tipo == '7' || tipo == '20' || codigo == "005" || codigo == "007" || codigo == "008" || codigo == "010"),
            colNames: ['EstrategiaID', 'Orden', '#', 'Pedido Asociado', 'Precio', 'CUV2', 'Descripción', 'Limite Venta', 'Código SAP', 'ImagenURL', 'Foto', '','EsOfertaIndependiente'],
            colModel: [
                { name: 'EstrategiaID', index: 'EstrategiaID', width: 20, editable: true, resizable: false, hidden: true },
                { name: 'Orden', index: 'Orden', width: 20, editable: true, resizable: false, hidden: false, sortable: false },
                { name: 'ID', index: 'ID', width: 20, editable: true, hidden: false, sortable: false },
                { name: 'NumeroPedido', index: 'NumeroPedido', width: 40, editable: true, hidden: false, sortable: false },
                { name: 'Precio2', index: 'Precio2', width: 70, editable: true, align: 'center', resizable: false, sortable: false },
                { name: 'CUV2', index: 'CUV2', width: 70, editable: true, resizable: false, sortable: true, align: 'center' },
                { name: 'DescripcionCUV2', index: 'DescripcionCUV2', width: 120, editable: true, resizable: false, hidden: false, sortable: false },
                { name: 'LimiteVenta', index: 'LimiteVenta', width: 40, align: 'center', editable: true, resizable: false, sortable: false },
                { name: 'CodigoProducto', index: 'CodigoProducto', width: 70, align: 'center', editable: true, resizable: false, sortable: true },
                { name: 'ImagenURL', index: 'ImagenURL', hidden: true },
                { name: 'ImagenProducto', index: 'ImagenProducto', width: 70, align: 'center', editable: true, resizable: false, sortable: false, formatter: ShowImage },
                { name: 'Activo', index: 'Activo', width: 30, align: 'center', editable: true, resizable: false, sortable: false, formatter: ShowActions },
                { name: 'EsOfertaIndependiente', index: 'EsOfertaIndependiente', width: 0, editable: true, hidden:true }
            ],
            jsonReader:
            {
                root: "rows",
                page: "page",
                total: "total",
                records: "records",
                repeatitems: true,
                cell: "cell",
                id: "id"
            },
            pager: jQuery('#pager'),
            loadtext: 'Cargando datos...',
            recordtext: "{0} - {1} de {2} Registros",
            emptyrecords: 'No hay resultados',
            rowNum: 10,
            scrollOffset: 0,
            rowList: [10, 20, 30, 40, 50],
            sortname: 'Orden',
            sortorder: 'asc',
            viewrecords: true,
            height: 'auto',
            width: 930,
            pgtext: 'Pág: {0} de {1}',
            altRows: true,
            altclass: 'jQGridAltRowClass',
            loadComplete: function (data) {

                if (data.rows.length > 0) {
                    for (var i = 0; i < data.rows.length; i++) {
                        if (data.rows[i].cell[10] == '1') {
                            $("#list").jqGrid('setSelection', data.rows[i].id, true);
                        }
                    }
                }
            }
        });
        jQuery("#list").jqGrid('navGrid', "#pager", { edit: false, add: false, refresh: false, del: false, search: false });
        if (tipo == '4' || codigo == "005" || codigo == "007" || codigo == "008" || codigo == "010") { $("#list").jqGrid('hideCol', ["Orden"]); }
    }

    function ShowInputTC(cellvalue, options, rowObject) {
        var Des = "";
        Des += "<input type='text' value='" + cellvalue + "' style='width:160px' />";
        return Des;
    }

    function ShowActionsTC(cellvalue, options, rowObject) {
        var cellValueInt = parseInt(rowObject[0]);
        var Des = "<a href='javascript:;' onclick=\"return EditarTalla('" + rowObject[0] + "');\" >" + "<img src='" + rutaImagenEdit + "' alt='Editar Talla/Color' title='Editar Talla/Color' border='0' /></a>";
        if ($.trim(rowObject[1]) != $.trim($("#txtCUV2").val())) {
            Des += "<a href='javascript:;' onclick=\"return Eliminar('" + rowObject[0] + "');\" >" + "<img src='" + rutaImagenDelete + "' alt='Quitar Talla/Color' title='Quitar Talla/Color' border='0' /></a>";
        }
        return Des;
    }

    function EditarTalla(id) {
        $("#hdTallaColorID").val(id);
        $('#txtCUVTC').val(jQuery("#listTC").jqGrid('getCell', id, 'CUV'));
        $('#txtDescripcionCUVTC').val(jQuery("#listTC").jqGrid('getCell', id, 'DescripcionCUV'));
        $('#txtPrecioCUVTC').val(jQuery("#listTC").jqGrid('getCell', id, 'PrecioUnitario'));
        $('#ddlTallaColor').val(jQuery("#listTC").jqGrid('getCell', id, 'Tipo'));
        $('#txtDescripcionTC').val(jQuery("#listTC").jqGrid('getCell', id, 'DescripcionTallaColor'));
        $('#txtCUVTC').attr("readonly", true);
        showDialog("DialogEditarTallaColor");
        return false;
    }

    function Eliminar(id) {
        var elimina = confirm('¿ Está seguro que desea eliminar el registro seleccionado?');
        if (!elimina)
            return false;

        var params = {
            Id: id
        };

        jQuery.ajax({
            type: 'POST',
            url: baseUrl + 'AdministrarEstrategia/EliminarTallaColor',
            dataType: 'json',
            contentType: 'application/json; charset=utf-8',
            data: JSON.stringify(params),
            async: true,
            success: function (data) {
                alert(data.message);
                fnGrillaTC();
            },
            error: function (data, error) {
                alert(data.message);
            }
        });
    }

    function ShowActions(cellvalue, options, rowObject) {

        var Des = "&nbsp;<a href='javascript:;' onclick=\"return jQuery('#list').Editar('" + rowObject[0] + "',event);\" >" + "<img src='" + rutaImagenEdit + "' alt='Editar Estrategia' title='Editar Estrategia' border='0' /></a>";
        if (rowObject[10] == "1") {
            Des += "&nbsp;&nbsp;<a href='javascript:;' onclick=\"return jQuery('#list').Eliminar('" + rowObject[0] + "',event);\" >" + "<img src='" + rutaImagenDelete + "' alt='Deshabilitar Estrategia' title='Deshabilitar Estrategia' border='0' /></a>";
        }
        return Des;
    }

    function ShowImage(cellvalue, options, rowObject) {
        var image = $.trim(rowObject[9]);
        var filename = image.replace(/^.*[\\\/]/, '');
        image = '<img src="' + (filename != "" ? image : rutaImagenVacia) + '" alt="" width="70px" height="60px" title="" border="0" />';
        return image;
    }

    function ShowActionsVer1(cellvalue, options, rowObject) {
        var text = "";

        var cantidad = rowObject[2];
        var tipo = rowObject[3];

        if (tipo == "2")
            cantidadPrecargar = parseInt(cantidad);

        if (cantidad != "0")
            text = rowObject[2] + " <a href='javascript:;' onclick=VerCuvsTipo('" + tipo + "')>ver</a>";
        else
            text = rowObject[2];

        return text;
    }

    function ShowActionsVer2(cellvalue, options, rowObject) {
        var text = "";

        var cantidad = rowObject[2];
        var tipo = rowObject[3];

        if (tipo == "1") {
            cantidadPrecargar2 = parseInt(cantidad);
            $("#spnCantidadConfigurar3").html(parseInt(cantidad));
        }
        if (tipo == '2')
            $("#spnCantidadNoConfigurar3").html(parseInt(cantidad));

        if (cantidad != "0")
            text = rowObject[2] + " <a href='javascript:;' onclick=VerCuvsTipo2('" + tipo + "')>ver</a>";
        else
            text = rowObject[2];

        return text;
    }

    function VerCuvsTipo(tipo) {
        fnGrillaCuv1(tipo);
    }

    function fnGrillaCuv1(tipo) {
        $("#listGrillaCuv1").jqGrid("clearGridData");

        var parametros = {
            campaniaId: parseInt($("#ddlCampania").val()),
            tipoConfigurado: parseInt(tipo),
            estrategiaCodigo: $('#ddlTipoEstrategia').find(':selected').data('codigo')
        };

        $('#listGrillaCuv1').setGridParam({ postData: parametros });

        jQuery("#listGrillaCuv1").jqGrid({
            url: urlConsultarCuvTipoConfigurado,
            hidegrid: false,
            datatype: 'json',
            postData: (parametros),
            mtype: 'GET',
            contentType: "application/json; charset=utf-8",
            colNames: ['CUV', 'Descripción'],
            colModel: [
                { name: 'CUV2', index: 'CUV', width: 10, editable: true, resizable: false },
                { name: 'DescripcionCUV2', index: 'DescripcionCUV2', width: 90, editable: true, resizable: false },
            ],
            jsonReader:
            {
                root: "rows",
                page: "page",
                total: "total",
                records: "records",
                repeatitems: true,
                cell: "cell",
                id: "id"
            },
            pager: jQuery('#pagerGrillaCuv1'),
            loadtext: 'Cargando datos...',
            recordtext: "{0} - {1} de {2} Registros",
            emptyrecords: 'No hay resultados',
            rowNum: 10,
            scrollOffset: 0,
            rowList: [10, 20, 30, 40, 50],
            sortname: 'Nombre',
            sortorder: 'asc',
            viewrecords: true,
            multiselect: false,
            height: 'auto',
            width: 540,
            pgtext: 'Pág: {0} de {1}',
            altRows: true,
            altclass: 'jQGridAltRowClass',
            loadComplete: function () {
            },
            gridComplete: function () {
                showDialog("DialogGrillaCuv1");
            }
        });
        jQuery("#listGrillaCuv1").jqGrid('navGrid', "#pagerGrillaCuv1", { edit: false, add: false, refresh: false, del: false, search: false });
        jQuery("#listGrillaCuv1").setGridParam({ datatype: 'json', page: 1 }).trigger('reloadGrid');
    }

    function VerCuvsTipo2(tipo) {
        fnGrillaCuv2(tipo);
    }

    function fnGrillaCuv2(tipo) {
        $("#listGrillaCuv2").jqGrid("clearGridData");

        var parametros = {
            campaniaId: parseInt($("#ddlCampania").val()),
            tipoConfigurado: parseInt(tipo)
        };

        $('#listGrillaCuv2').setGridParam({ postData: parametros });

        jQuery("#listGrillaCuv2").jqGrid({
            url: urlConsultarCuvTipoConfiguradoTemporal,
            hidegrid: false,
            datatype: 'json',
            postData: (parametros),
            mtype: 'GET',
            contentType: "application/json; charset=utf-8",
            colNames: ['CUV', 'Descripción'],
            colModel: [
                { name: 'CUV2', index: 'CUV', width: 10, editable: true, resizable: false },
                { name: 'DescripcionCUV2', index: 'DescripcionCUV2', width: 90, editable: true, resizable: false },
            ],
            jsonReader:
            {
                root: "rows",
                page: "page",
                total: "total",
                records: "records",
                repeatitems: true,
                cell: "cell",
                id: "id"
            },
            pager: jQuery('#pagerGrillaCuv2'),
            loadtext: 'Cargando datos...',
            recordtext: "{0} - {1} de {2} Registros",
            emptyrecords: 'No hay resultados',
            rowNum: 10,
            scrollOffset: 0,
            rowList: [10, 20, 30, 40, 50],
            sortname: 'Nombre',
            sortorder: 'asc',
            viewrecords: true,
            multiselect: false,
            height: 'auto',
            width: 540,
            pgtext: 'Pág: {0} de {1}',
            altRows: true,
            altclass: 'jQGridAltRowClass',
            loadComplete: function () {
            },
            gridComplete: function () {
                showDialog("DialogGrillaCuv2");
            }
        });
        jQuery("#listGrillaCuv2").jqGrid('navGrid', "#pagerGrillaCuv2", { edit: false, add: false, refresh: false, del: false, search: false });
        jQuery("#listGrillaCuv2").setGridParam({ datatype: 'json', page: 1 }).trigger('reloadGrid');
    }

    function IniDialog() {


        $('#DialogAdministracionEstrategia').dialog({
            autoOpen: false,
            resizable: false,
            modal: true,
            closeOnEscape: true,
            width: 830,
            close: function () {
            },
            draggable: false,
            title: "Registro de Estrategias",
            open: function(event, ui) { $(".ui-dialog-titlebar-close", ui.dialog).hide(); },
            buttons:
            {
                "Guardar": function () {

                    if ($('#mensajeErrorCUV').val() != "") {
                        alert($('#mensajeErrorCUV').val());
                        return false;
                    }
                    if ($('#mensajeErrorCUV2').val() != "") {
                        alert($('#mensajeErrorCUV2').val());
                        return false;
                    }
                    if ($(".DatosNuevas").css("display") == "block") {
                        if ($("#ddlCampaniaFin").val() == "") {
                            alert("Seleccione la campaña de vigencia hasta.");
                            return false;
                        }
                        var campaniaIni = $("#spanCampania").val();
                        var campaniaFin = $("#ddlCampaniaFin").val();
                        if (parseInt(campaniaFin) < parseInt(campaniaIni)) {
                            alert("La campaña de vigencia final  no puede ser menor a la campaña de inicio.");
                            return false;
                        }
                    }

                    var valor = $("#txtDescripcion").val();
                    if ($.trim(valor) == "") {
                        alert("Ingrese el valor del CUV2 para obtener la descripción o ingrese una.");
                        return false;
                    }
                    var m = "";

                    if (($.trim($("#txtCUV").val()) != "" && $.trim($("#txtPrecio").val()) == "") || ($.trim($("#txtCUV").val()) != "" && $.isNumeric($("#txtPrecio").val()) == false)) {
                        m += "- Digite un valor correspondiente para el precio." + "\n";
                    }
                    if ($.trim($("#txtCUV").val()) != "" && $("#txtPrecio").val() <= 0) {
                        m += "- Ingrese un valor para el precio mayor a cero." + "\n";
                    }

                    if ($.trim($("#txtCUV2").val()) == "") {
                        m += "- Ingrese un valor para el CUV2." + "\n";
                    }

                    if ($.trim($("#txtPrecio2").val()) == "" || $.isNumeric($("#txtPrecio2").val()) == false) {
                        m += "- Digite un valor correspondiente para el precio." + "\n";
                    }
                    if ($("#txtPrecio2").val() <= 0) {
                        m += "- Ingrese un valor para el precio mayor a cero." + "\n";
                    }
                    if (m != "") {
                        alert(m);
                        return false;
                    }

                    if ($("#idEstrella").css("display") == "block") {
                        if (!$("#chkEstrella").attr("checked")) {
                            alert("Debe activar el la opción para mostrar estrella en la zona de producto.  ");
                            return false;
                        }
                    }

                    if ($('.chkImagenProducto:checked').length == 0) {
                        alert("Seleccione una imagen a mostrar.");
                        return false;
                    }

                    if (imagen=="") {
                        alert("Seleccione una imagen a mostrar.");
                        return false;
                    }
                    var aux2 = $('#ddlTipoEstrategia').find(':selected').data('id');
                    var aux3 = $('#ddlTipoEstrategia').find(':selected').data('codigo');
                    if (aux2 !== 4 && aux2 !== 7 && aux2 !== 20 && aux2 !== 9 && aux2 !== 10 && aux2 !== 11 && aux2 !== 12) {
                        if ($.trim($("#txtOrden").val()) == "" || $.isNumeric($("#txtOrden").val()) == false) {
                            alert("Ingrese un orden para mostrar.");
                            return false;
                        }
                        if ($("#txtOrden").val() <= 0) {
                            alert("Ingrese un valor para el orden a mostrar mayor a cero.");
                            return false;
                        }
                    }

                    //if ($("#hdZonas").val() == "") {
                    //    alert("Debe seleccionar el alcance de la estrategia.");
                    //    return false;
                    //}
                    if ($.trim($("#txtLimite").val()) == "" || $.isNumeric($("#txtLimite").val()) == false) {
                        alert("Ingrese un valor para el limite de venta.");
                        return false;
                    }
                    if ($("#txtLimite").val() <= 0) {
                        alert("Ingrese un valor para el limite de venta mayor a cero.");
                        return false;
                    }
                    var imagenEstrategiaProducto = $("#imgSeleccionada").attr("src");

                    var EstrategiaID = 0;
                    if(!isNuevo)
                        EstrategiaID = $("#hdEstrategiaID").val();

                    var TipoEstrategiaID = $("#hdTipoEstrategiaID").val();
                    var CampaniaID = $("#hdCampania").val();
                    var CampaniaIDFin = $("#ddlCampaniaFin").val();
                    var Activo = ($("#chkHabilitarOferta").attr("checked")) ? "1" : "0";
                    var ImagenURL = imagenEstrategiaProducto.substr(imagenEstrategiaProducto.lastIndexOf("/") + 1);
                    var LimiteVenta = $("#txtLimite").val();
                    var DescripcionCUV2 = $("#txtDescripcion").val();
                    var FlagDescripcion = (DescripcionCUV2 != "") ? "1" : "0";
                    var CUV = $("#txtCUV").val();
                    var EtiquetaID = $("#hdnEtiqueta1").val();
                    var Precio = $("#txtPrecio").val();
                    var FlagCEP = (CUV != "") ? "1" : "0";
                    var CUV2 = $("#txtCUV2").val();
                    var EtiquetaID2 = $("#hdnEtiqueta2").val();
                    var Precio2 = $("#txtPrecio2").val();
                    var FlagCEP2 = (CUV2 != "") ? "1" : "0";
                    var TextoLibre = $("#txtTextoLibre").val();
                    var FlagTextoLibre = (TextoLibre != "") ? "1" : "0";
                    var Cantidad = "";
                    var FlagCantidad = "0";
                    var Zona = $("#hdZonas").val();
                    var Orden = $("#txtOrden").val();
                    var flagEstrella = ($("#chkOfertaUltimoMinuto").attr("checked")) ? "1" : "0";
                    var colorFondo = $("#hdColorFondo").val();

                    var NumeroPedidoAsociado = $(".checksPedidosAsociados input:checked").map(function () {
                        return $(this).val();
                    }).get().join(",");

                    if (NumeroPedidoAsociado == "" && $("#txtPedidoAsociado").length) {
                        NumeroPedidoAsociado = $("#txtPedidoAsociado").val();
                    }
                    //valores para el carrusel de la estrategia de lanzamiento
                    var imgFondoDesktop = $("#nombre-img-fondo-desktop").val();
                    var imgPrevDesktop = $("#nombre-img-prev-desktop").val();
                    var imgFichaDesktop = $("#nombre-img-ficha-desktop").val();
                    var urlVideoDesktop = $("#url-video-desktop").val();
                    var imgFondoMobile = $("#nombre-img-fondo-mobile").val();
                    var imgFichaMobile = $("#nombre-img-ficha-mobile").val();
                    var urlVideoMobile = $("#url-video-mobile").val();
                    var imgFichaFondoDesktop = $("#nombre-img-ficha-fondo-desktop").val();
                    var imgFichaFondoMobile = $("#nombre-img-ficha-fondo-mobile").val();
                    var imgHomeDesktop = $("#nombre-img-home-desktop").val();
                    var imgHomeMobile = $("#nombre-img-home-mobile").val();
                    var ganancia = $("#txtGanancia").val();
                    var esOfertaIndependiente = ($("#chkEsOfertaIndependiente").attr("checked")) ? true : false;

                    var params = {
                        EstrategiaID: EstrategiaID,
                        TipoEstrategiaID: TipoEstrategiaID,
                        CampaniaID: CampaniaID,
                        CampaniaIDFin: CampaniaIDFin,
                        NumeroPedido: NumeroPedidoAsociado,
                        Activo: Activo,
                        ImagenURL: ImagenURL,
                        LimiteVenta: LimiteVenta,
                        DescripcionCUV2: DescripcionCUV2,
                        FlagDescripcion: FlagDescripcion,
                        CUV: CUV,
                        EtiquetaID: EtiquetaID,
                        Precio: Precio,
                        FlagCEP: FlagCEP,
                        CUV2: CUV2,
                        EtiquetaID2: EtiquetaID2,
                        Precio2: Precio2,
                        FlagCEP2: FlagCEP2,
                        TextoLibre: TextoLibre,
                        FlagTextoLibre: FlagTextoLibre,
                        Cantidad: Cantidad,
                        FlagCantidad: FlagCantidad,
                        Zona: Zona,
                        Orden: Orden,
                        ColorFondo: colorFondo,
                        FlagEstrella: flagEstrella,
                        CodigoTipoEstrategia: aux3,
                        ImgFondoDesktop: imgFondoDesktop,
                        ImgPrevDesktop: imgPrevDesktop,
                        ImgFichaDesktop: imgFichaDesktop,
                        UrlVideoDesktop: urlVideoDesktop,
                        ImgFondoMobile: imgFondoMobile,
                        ImgFichaMobile: imgFichaMobile,
                        UrlVideoMobile: urlVideoMobile,
                        ImgFichaFondoDesktop: imgFichaFondoDesktop,
                        ImgFichaFondoMobile: imgFichaFondoMobile,
                        ImgHomeDesktop: imgHomeDesktop,
                        ImgHomeMobile: imgHomeMobile,
                        PrecioAnt: $('#hdEstrategiaPrecioAnt').val(),
                        EsOfertaIndependiente: esOfertaIndependiente,
                        Ganancia: ganancia
                    };
                    jQuery.ajax({
                        type: 'POST',
                        url: baseUrl + 'AdministrarEstrategia/RegistrarEstrategia',
                        dataType: 'json',
                        contentType: 'application/json; charset=utf-8',
                        data: JSON.stringify(params),
                        async: true,
                        success: function (data) {

                            if (data.success) {
                                alert(data.message);
                                $("#ddlTipoEstrategia").val($("#hdEstrategiaIDConsulta").val());
                                HideDialog("DialogAdministracionEstrategia");
                                $("#list").jqGrid("clearGridData", true).trigger("reloadGrid");
                            } else {
                                alert(data.message);
                            }
                        },
                        error: function (data, error) {
                            alert(data.message);
                        }
                    });

                },
                "Salir": function () {
                    $("#ddlTipoEstrategia").val($("#hdEstrategiaIDConsulta").val());
                    $(this).dialog('close');
                }
            }
        });

        $('#DialogZona').dialog({
            autoOpen: false,
            resizable: false,
            modal: true,
            closeOnEscape: true,
            width: 500,
            draggable: false,
            title: "Seleccione el alcance de la estrategia",
            open: function(event, ui) { $(".ui-dialog-titlebar-close", ui.dialog).hide(); },
            buttons:
            {
                "Guardar": function () {
                    var zonas = "";
                    $.jstree._reference($("#arbolRegionZona")).get_checked(null, true).each(function () {
                        if (this.className.toLowerCase().indexOf("jstree-leaf") == -1) {
                            return true;
                        }
                        zonas += this.id + ",";
                    });
                    if (zonas != "") {
                        zonas = zonas.substring(0, zonas.length - 1);
                    }
                    if (zonas == "") {
                        alert("No se ha marcado ninguna zona o región.");
                        return false;
                    }
                    $("#hdZonas").val(zonas);
                    alert("Se agregaron las zonas seleccionadas.");
                    $(this).dialog('close');
                },
                "Salir": function () {
                    $(this).dialog('close');
                }
            }
        });

        $('#divVistaPrevia').dialog({
            autoOpen: false,
            resizable: false,
            modal: true,
            closeOnEscape: true,
            width: 250,
            draggable: false,
            title: "Vista previa",
            buttons:
            {
                "Cerrar": function () {
                    if(isVistaPreviaOpened){
                        var params = { paisID: $("#ddlPais").val(), EstrategiaID: $("#hdEstrategiaID").val(), CampaniaID: $("#ddlCampania").val(), TipoEstrategiaID: $("#ddlTipoEstrategia").val(),
                            CUV2 : $("#txtCUV2").val()};
                        estrategiaObj.obtenerImagenes(params, 1, true).done(function () {
                            showDialog("matriz-comercial-dialog");
                            closeWaitingDialog();
                        });
                    }
                    isVistaPreviaOpened = false;
                    $(this).dialog('close');
                }
            }
        });

        $('#DialogTonoMarca').dialog({
            autoOpen: false,
            resizable: false,
            modal: true,
            closeOnEscape: false,
            width: 700,
            draggable: false,
            title: "Seleccionar Talla/Color",
            open: function (event, ui) { $(".ui-dialog-titlebar-close", ui.dialog).hide(); },
            buttons:
            {
                "Nueva Talla/Color": function () {
                    $("#hdTallaColorID").val("0");
                    $("#ddlTallaColor").val("0");
                    $("#txtDescripcionTC").val("");
                    $("#txtCUVTC").val("");
                    $("#txtDescripcionCUVTC").val("");
                    $("#txtPrecioCUVTC").val("");
                    $('#txtCUVTC').attr("readonly", false);
                    showDialog("DialogEditarTallaColor");
                },
                "Salir": CerrarTallaColor
            }
        });

        $('#DialogEditarTallaColor').dialog({
            autoOpen: false,
            resizable: false,
            modal: true,
            closeOnEscape: true,
            width: 550,
            draggable: false,
            title: "Registro Talla/Color",
            buttons:
            {
                "Guardar": function () {
                    var msj = "";

                    if ($("#txtCUVTC").val() == "") {
                        msj += "- Ingrese un CUV." + "\n";
                    }

                    if ($("#ddlTallaColor").val() == "0") {
                        msj += "- Seleccione el tipo (Talla/Color)." + "\n";
                    }

                    if ($("#txtDescripcionTC").val() == "") {
                        msj += "- Ingrese descripción (Talla/Color)." + "\n";
                    }

                    if (msj != "") {
                        alert(msj);
                        return false;
                    }

                    var id = $("#hdTallaColorID").val();
                    var cuv = $("#txtCUVTC").val();
                    var campaniaID = $("#ddlCampania").val();
                    var tipo = $("#ddlTallaColor").val();
                    var descripcion = $("#txtDescripcionTC").val();
                    var CUVPadre = $("#txtCUV2").val();
                    var xmlString = '<params>';

                    xmlString += '<param ';
                    xmlString += ' ID = "' + id + '"';
                    xmlString += ' CampaniaID = "' + campaniaID + '"';
                    xmlString += ' CUV = "' + cuv + '"';
                    xmlString += ' Tipo = "' + tipo + '"';
                    xmlString += ' Descripcion = "' + descripcion + '"';
                    xmlString += ' CUVPadre = "' + CUVPadre + '"';
                    xmlString += ' />';
                    xmlString += '</params>';

                    var params = {
                        xmlTallaColor: xmlString
                    };

                    jQuery.ajax({
                        type: 'POST',
                        url: baseUrl + 'AdministrarEstrategia/RegistrarTallaColor',
                        dataType: 'json',
                        contentType: 'application/json; charset=utf-8',
                        data: JSON.stringify(params),
                        async: true,
                        success: function (data) {
                            if (data.success) {
                                alert(data.message);
                                fnGrillaTC();
                                HideDialog("DialogEditarTallaColor");
                            } else {
                                alert(data.message);
                            }
                        },
                        error: function (data, error) {
                            alert(data.message);
                        }
                    });
                },
                "Salir": function () {
                    $(this).dialog('close');
                }
            }
        });

        $('#DialogNuevoMasivo').dialog({
            autoOpen: false,
            resizable: false,
            modal: true,
            closeOnEscape: true,
            width: 600,
            draggable: false,
            title: "Carga Masiva de Estrategias"
        });

        $('#DialogGrillaCuv1').dialog({
            autoOpen: false,
            resizable: false,
            modal: true,
            closeOnEscape: true,
            width: 600,
            draggable: false,
            title: "Carga Masiva de Estrategias",
            buttons:
            {
                "Salir": function () {
                    $(this).dialog('close');
                }
            }
        });

        $('#DialogGrillaCuv2').dialog({
            autoOpen: false,
            resizable: false,
            modal: true,
            closeOnEscape: true,
            width: 600,
            draggable: false,
            title: "Carga Masiva de Estrategias",
            buttons:
            {
                "Salir": function () {
                    $(this).dialog('close');
                }
            }
        });

        $('#DialogDescMasivo').dialog({
            autoOpen: false,
            resizable: false,
            modal: true,
            closeOnEscape: true,
            width: 600,
            draggable: false,
            title: "Carga Masiva de descripciones de Estrategias"
        });

        $('#DialogDescActualizada').dialog({
            autoOpen: false,
            resizable: false,
            modal: true,
            closeOnEscape: true,
            width: 600,
            draggable: false,
            title: "Resultado de estrategias actualizadas"
        });

        $('#DialogDescNoActualizada').dialog({
            autoOpen: false,
            resizable: false,
            modal: true,
            closeOnEscape: true,
            width: 600,
            draggable: false,
            title: "Resultado de estrategias no actualizadas"
        });
    }

    function UploadFileLanzamineto(divId) {

        var uploader = new qq.FileUploader({
            allowedExtensions: ['jpg', 'png', 'jpeg'],
            element: document.getElementById(divId),
            action: '@Url.Action("ImageLanzamientoUpload", "FileUpload")',
            onComplete: function (id, fileName, responseJSON) {
                if (checkTimeout(responseJSON)) {
                    if (responseJSON.success) {
                        $("#nombre-" + divId).val(responseJSON.name);
                        $("#src-" + divId).attr('src', rutaTemporal + responseJSON.name);
                    } else alert(responseJSON.message);
                }
                return false;
            },
            onSubmit: function (id, fileName) { $(".qq-upload-list").remove(); },
            onProgress: function (id, fileName, loaded, total) { $(".qq-upload-list").remove(); },
            onCancel: function (id, fileName) { $(".qq-upload-list").remove(); }
        });
        return false;
    }

    function UploadFileCvs() {
        var formData = new FormData();
        var totalFiles = document.getElementById("fileDescMasivo").files.length;
        if (totalFiles <= 0) {
            _toastHelper.error("Seleccione al menos un archivo.");
            return false;
        }

        formData.append("Documento", document.getElementById("fileDescMasivo").files[0]);
        formData.append("Pais", $('#ddlPais').val());
        formData.append("CampaniaId", $('#ddlCampania').val());
        formData.append("TipoEstrategia", $('#ddlTipoEstrategia').val());

        $.ajax({
            url: '@Url.Action("UploadCvs", "AdministrarEstrategia")',
            type: "POST",
            dataType: "JSON",
            data: formData,
            contentType: false,
            processData: false,
            success: function (data) {
                $("#listCargaDescMasiva").jqGrid("GridUnload");
                var gridJson = { page: 1, total: 2, records: 10, rows: [
                    { Descripcion: "CUVs Actualizados", Cantidad: data.listActualizado.length + " <a href='#' onclick=showDialog(\'DialogDescActualizada\')> Ver </a>"},
                    { Descripcion: "CUVs no Actualizados", Cantidad: data.listNoActualizado.length + " <a href='#' onclick=showDialog(\'DialogDescNoActualizada\')> Ver </a>"}]
                };
 
                $("#listCargaDescMasiva").empty().jqGrid({
                    datatype: 'jsonstring',
                    datastr: gridJson,
                    colNames: ['Descripcion', 'Cantidad'],
                    colModel: [{ name: 'Descripcion', index: 'Descripcion', sortable: false},
                        {
                            name: 'Cantidad', index: 'Cantidad', width: 30, sortable: false
                        }],
                    pager: false,
                    jsonReader: {
                        repeatitems: false
                    },
                    width: 540,
                    height: "auto",
                    scrollOffset: 20,
                    rowNum: 10,
                    rowList: [10, 15, 20, 25],
                    sortname: 'Label',
                    sortorder: "asc",
                    viewrecords: true,
                    hoverrows: false,
                    caption: "",    
                });
                createGridUpdated(data.listActualizado);
                createGridNotUpdated(data.listNoActualizado);
                $("#divDescMasivoPaso1").fadeOut(function() {
                    $("#divDescMasivoPaso2").fadeIn();
                });
            },
            error: function(data){
                _toastHelper.error(data.statusText);
            }
        });
    }

    function LimpiarCamposLanzamiento(nombreCampo) {
        $("#nombre-" + nombreCampo).val("");
        $("#src-" + nombreCampo).attr("src", rutaImagenVacia);
    }

    function editarDescripcionComercial(idImagen) {
        estrategiaObj.editarDescripcionComercial(idImagen);
    }

    function createGridUpdated(list) {
        var gridJson = { page: 1, total: 2, records: 10, rows: list };
        $("#listDescActualizada").jqGrid("GridUnload");
        $("#listDescActualizada").empty().jqGrid({
            datatype: 'jsonstring',
            datastr: gridJson,
            colNames: ['CUV', 'Descripcion'],
            colModel: [{ name: 'Cuv', index: 'Cuv', width: 30, sortable: false},
                { name: 'Descripcion', index: 'Descripcion', sortable: false }],
            pager: jQuery('#pagerDescActualizada'),
            jsonReader: {
                repeatitems: false
            },
            width: 540,
            height: "auto",
            scrollOffset: 20,
            rowNum: 10,
            rowList: [10, 15, 20, 25],
            sortname: 'Label',
            sortorder: "asc",
            viewrecords: true,
            hoverrows: false,
            caption: "",           
            beforeSelectRow: function (rowid, e) { return false; } //this disables row being highlighted when clicked
        });
    }
    function createGridNotUpdated(list) {
        var gridJson = { page: 1, total: 2, records: 10, rows: list };
        $("#listDescNoActualizada").jqGrid("GridUnload");
        $("#listDescNoActualizada").empty().jqGrid({
            datatype: 'jsonstring',
            datastr: gridJson,
            colNames: ['CUV', 'Descripcion'],
            colModel: [{ name: 'Cuv', index: 'Cuv', width: 30, sortable: false },
                { name: 'Descripcion', index: 'Descripcion', sortable: false }],
            pager: jQuery('#pagerDescNoActualizada'),
            jsonReader: {
                repeatitems: false
            },
            width: 540,
            height: "auto",
            scrollOffset: 20,
            rowNum: 10,
            rowList: [10, 15, 20, 25],
            sortname: 'Label',
            sortorder: "asc",
            viewrecords: true,
            hoverrows: false,
            caption: "",           
            beforeSelectRow: function (rowid, e) { return false; } //this disables row being highlighted when clicked
        });
    }
</script>
