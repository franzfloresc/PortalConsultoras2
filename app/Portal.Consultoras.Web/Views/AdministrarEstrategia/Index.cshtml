@model Portal.Consultoras.Web.Models.EstrategiaModel
@{
    ViewBag.Title = "Administración de Estrategias";
    string imagenVacia = "prod_grilla_vacio.png";
    int nroImagenes = 10;
}

<input type="hidden" id="mensajeErrorCUV" />
<input type="hidden" id="mensajeErrorCUV2" />
<input type="hidden" id="hdEstrategiaIDConsulta" />
<input type="hidden" id="ImagenProducto" />
<input type="hidden" id="hdEstrategiaID" />
<input type="hidden" id="hdTipoConsulta" value="0" />
<input type="hidden" id="hdZonas" value="" />
<input type="hidden" id="hdSimbolo" />
<input type="hidden" id="hdTallaColorID" />
<div class="wrap_cab">
    <div class="filtros2">
        <div class="elements">
            <div class="div-2">
                <h1><span>Zona de Estrategias</span></h1>
            </div>
            <div class="div-3">
                <div class="titG">País:</div>
                <div class="selectA borde_redondeado">
                    @Html.DropDownListFor(model => model.PaisID, new SelectList(Model.listaPaises, "PaisID", "Nombre"), "-- Seleccionar --", new { id = "ddlPais" })
                </div>
                <div class="titG">Campaña:</div>
                <div class="selectA borde_redondeado">
                    @Html.DropDownListFor(model => model.CampaniaID, new SelectList(Model.listaCampania, "CampaniaID", "NombreCorto"), "-- Seleccionar --", new { id = "ddlCampania" })
                </div>
            </div>
            <div class="div-3">
                <div class="titG">Tipo de Estrategia:</div>
                <div class="selectA borde_redondeado">
                    @*Html.DropDownListFor(model => model.TipoEstrategiaID, new SelectList(Model.ListaTipoEstrategia, "TipoEstrategiaID", "Descripcion"), new { id = "ddlTipoEstrategia" })*@
                    <select id="ddlTipoEstrategia" name="ddlTipoEstrategia">
                        @if (Model.ListaTipoEstrategia != null)
                        {
                            <option value="">-- Seleccionar --</option>
                            for (int i = 0; i < Model.ListaTipoEstrategia.Count(); i++)
                            {
                            <option flag-nueva="@Model.ListaTipoEstrategia.ToList()[i].FlagNueva"
                                        flag-recoproduct="@Model.ListaTipoEstrategia.ToList()[i].FlagRecoProduc"
                                        flag-recoperfil="@Model.ListaTipoEstrategia.ToList()[i].FlagRecoPerfil"
                                        codigo-programa="@Model.ListaTipoEstrategia.ToList()[i].CodigoPrograma"
                                        imagen-tipo="@Model.ListaTipoEstrategia.ToList()[i].Imagen"
                                        value="@Model.ListaTipoEstrategia.ToList()[i].TipoEstrategiaID"
                                        data-id="@Model.ListaTipoEstrategia.ToList()[i].CodigoGeneral"
                                        data-codigo="@Model.ListaTipoEstrategia.ToList()[i].Codigo">
                                @Model.ListaTipoEstrategia.ToList()[i].Descripcion
                            </option>
                            }
                        }
                    </select>
                </div>
                <div class="titG">CUV<sub>2</sub>:</div>
                <div class="selectA borde_redondeado">
                    <input type="text" id="CUV" name="CUV" />
                </div>
            </div>

            <div class="div-3">
                <div class="titG">Tiene imagen?:</div>
                 <div class="selectA borde_redondeado">
                    <select id="ddlTieneImagen" name="ddlTieneImagen">
                        <option value="-1" selected>-- Seleccionar --</option>
                        <option value="1">Si</option>
                        <option value="0">No</option>
                    </select>
                </div>   
                <div class="titG">Oferta Activa?:</div>
                <div class="selectA borde_redondeado">
                    <select id="ddlOfertaActiva" name="ddlOfertaActiva">
                        <option value="-1" selected>-- Seleccionar --</option>
                        <option value="1">Si</option>
                        <option value="0">No</option>
                    </select>
                </div>
            </div>

            <div class="div-3">
                <div class="titG">&nbsp;</div>
                <div class="input_horizontal">
                    <input type="button" name="btnBuscar" id="btnBuscar" value="Buscar" />
                    <input type="button" name="btnNuevo" id="btnNuevo" value="Nuevo" />
                    <input type="button" name="btnNuevoMasivo" id="btnNuevoMasivo" value="Nuevo Masivo" />
                    </div>
                <div class="input_modifica_pedido">                    
                    <input type="button" name="btnActivarDesactivar" id="btnActivarDesactivar" value="Activar/Desactivar" style="display: none;" />
                </div>
            </div>
        </div>
    </div>
</div>
<div class="wrap">
    <div class="container clearfix">
        <div class="border-wrapper">
            <table id="list"></table>
            <div id="pager"></div>
        </div>
    </div>
</div>

<div id="DialogAdministracionEstrategia" style="display: none;">
    <input type="hidden" id="hdPais" value="" />
    <input type="hidden" id="hdCampania" value="" />
    <input type="hidden" id="hdTipoEstrategiaID" value="" />
    <input type="hidden" id="hdColorFondo" value="#FFF" />
    <input type="hidden" id="hdCodigoPrograma" value="">
    <input type="hidden" id="hdNumeroPedido" value="">
    <div class="Content_modal">

        <div class="div-3">
            <div class="titG">Campaña:</div>
            <div class="selectP2 borde_redondeado">
                <input id="spanCampania" type="text" readonly="readonly" />
            </div>
            <div class="titG">Tipo de Estrategia:</div>
            <div class="selectP2 borde_redondeado">
                <input id="spanTipoEstrategia" type="text" readonly="readonly" />
            </div>
        </div>

        <div class="div-3 DatosNuevas" style="display: none">
            <div class="titG">Campaña fin:</div>
            <div class="selectP2 borde_redondeado">
                @Html.DropDownListFor(model => model.CampaniaID, new SelectList(Model.listaCampania, "CampaniaID", "NombreCorto"), "-- Seleccionar --", new { id = "ddlCampaniaFin" })
            </div>
            <div class="titG">Pedido Asociado:</div>
            <div class="checksPedidosAsociados">
            </div>
        </div>
        <div class="div-3 Content_modal" style="margin-left: 12px; width: 92%; padding-top: 10px; padding-bottom: 0;">
            <div style="color: white;">
                <div style="display: inline-block; width: 47%; text-align: center; padding: 8px; background: #00A2E8; border-top-left-radius: 10px;">
                    Información CUV Oferta
                </div>
                <div style="display: inline-block; width: 48%; text-align: center; padding: 8px; background: #00A2E8; margin-left: -3px; border-left: 1px #D0D0D0 solid; border-top-right-radius: 10px;">
                    Precio Valorizado
                </div>
            </div>
            <div>
                <div style="display: inline-block; width: 47%; text-align: center; padding: 8px; margin-right: -3px; border-right: 1px #D0D0D0 solid;">
                    <div style="display: inline-block;">CUV2:</div>
                    <div style="display: inline-block;">
                        <input type="text" id="txtCUV2" maxlength="5" class="ValidaNumeral" style="width: 60px;" />
                    </div>
                    <div style="display: inline-block; padding-left: 40px;">Precio para ti:</div>
                    <div style="display: inline-block;">
                        <input type="text" id="txtPrecio2" maxlength="10" class="ValidaNumeral" style="width: 60px;" />
                    </div>
                </div>
                <div style="display: inline-block; width: 48%; text-align: center; padding: 8px; margin-right: -3px;">
                    <div style="display: inline-block;">CUV:</div>
                    <div style="display: inline-block;">
                        <input type="text" id="txtCUV" maxlength="5" class="ValidaNumeral" style="width: 60px;" />
                    </div>
                    <div style="display: inline-block;">Precio:</div>
                    <div style="display: inline-block;">
                        <input type="text" id="txtPrecio" style="width: 60px;" />
                    </div>
                </div>
            </div>
        </div>
        <div class="div-3">
            <div class="titG">Descripción:</div>
            <div class="titG">
                <input type="text" id="txtDescripcion" style="width: 520px;" />
            </div>
        </div>
        <div class="div-3">
            <div class="titG">Talla/Color:</div>
            <div class="titG" style="width: auto;">
                <a href="#" style="margin-left: 5px" id="linkTallaColor">
                    <img src='@Url.Content("~/Content/Images/icons/small/list-icon2.png")' border="0" alt="Agregar Tonos/Tallas/Colores" title="Agregar Tonos/Tallas/Colores"/>
                </a>
            </div>
            <div class="titG">¿Activar Oferta?</div>
            <div class="selectCheck borde_redondeado">
                <input type="checkbox" class="check" id="chkHabilitarOferta" style="margin-top: 2px; margin-left: 15px;" />
            </div>
        </div>
        <div class="div-3">
            <div class="titG">
                <span>Imagen Seleccionada:</span>
            </div>
            <div class="titG">
                <div class="pdr_modal borde_redondeado alignrigth">
                    <img src='@Url.Content("~/Content/Images/" + imagenVacia)' id="imgSeleccionada" class="img-matriz-preview" data-id="">
                </div>
            </div>
        </div>
        <div style="display: inline-block; width: 39%;">
        </div>

        <div class="Content_modal" style="margin-left: 10px; width: 94%; padding-top: 10px; padding-bottom: 0;">
            <div class="div-3">
                <div style="color: white;">
                    <div id="divImagenEstrategia" style="display: inline-block; text-align: center; padding: 8px; background: #00A2E8; border-top-left-radius: 10px; border-top-right-radius: 10px; cursor: pointer;">
                        Imagen - Matriz Somos Belcorp
                    </div>
                    <div id="divInformacionAdicionalEstrategia" style="display: inline-block; text-align: center; padding: 8px; color: #702789; background: #D0D0D0; border-top-left-radius: 10px; border-top-right-radius: 10px; cursor: pointer;">
                        Información Adicional
                    </div>
                </div>
            </div>
            <div id="divImagenEstrategiaContenido" style="display: none;">
                <div class="div-3">
                    <div class="titG">                        
                        <div class="input_search">
                            @*<img src='@Url.Content("~/Content/Images/subirimagen.png")' id="imgBuscar" class="img-matriz-preview">*@
                            <input type="hidden" id="hdnCodigoSAP" class="input-imagen-producto" />
                           <input type="hidden" id="hdnimagenProducto" class="input-imagen-producto" />
                            <input type="hidden" id="hdnDescripcion" class="input-imagen-producto" />
                            <input type="hidden" id="fotoProducto_Id" class="input-imagen-producto" />
                            <input type="hidden" id="imagenProductoAnterior" class="input-imagen-producto-anterior" />
                            <input type="hidden" id="hdnEtiqueta1" class="input-imagen-producto" />
                            <input type="hidden" id="hdnEtiqueta2" class="input-imagen-producto" />     
                             <input type="hidden" id="hdnEnMatrizComercial" class="input-imagen-producto" />                        
                            <div id="fpUpload">                               
                            </div>
                             <script src="@Url.Content("~/Scripts/fileuploader.js")" type="text/javascript"></script>
                             <script type="text/javascript">
                                 var uploader = new qq.FileUploader({
                                     allowedExtensions: ['jpg', 'png', 'jpeg'],
                                     element: document.getElementById('fpUpload'),
                                     action: '@Url.Action("ImageMatrizUpload", "FileUpload")',
                                     onComplete: function (id, fileName, responseJSON) {
                                         if (checkTimeout(responseJSON)) {
                                             //$(".qq-upload-list").css("display", "none");
                                             if (responseJSON.success) {
                                                 $("#hdnimagenProducto").val(responseJSON.name);
                                                 $("#imagenProductoAnterior").val("");
                                                 $("#fotoProducto_Id").val(('0' + ($("#ContenidoImagenes .titG").length + 1)).substr(-2));
                                                 // req. 1664   

                                                 ActualizarImagenMatriz();
                                                 mostrarInformacionCUV($("#txtCUV2").val());
                                             }
                                             else alert(responseJSON.message);
                                         }
                                     },
                                     onSubmit: function (id, fileName) { $(".qq-upload-list").css("display", "none"); },
                                     onProgress: function (id, fileName, loaded, total) { $(".qq-upload-list").css("display", "none"); },
                                     onCancel: function (id, fileName) { $(".qq-upload-list").css("display", "none"); }
                                 });

                                 // $('.qq-upload-button').text("cargar imagen");
                                 function ActualizarImagenMatriz() {
                                     var fotosProductos = [];
                                     var imagenNueva = {
                                         "idImagen": $("#fotoProducto_Id").val(),
                                         "dataImagen": $("#hdnimagenProducto").val(),
                                         "fotoProducto": $("#hdnimagenProducto").val(),
                                         "fotoProductoAnterior": $("#imagenProductoAnterior").val(),
                                         "selected": false
                                     }

                                     var idImagen;
                                     var dataImagen;
                                     var item = {
                                         CodigoSAP: $.trim($('#hdnCodigoSAP').val()),
                                         DescripcionOriginal: $.trim($('#hdnDescripcion').val()),
                                         Descripcion: $.trim($("#hdnDescripcion").val()),
                                         PaisID: $('#ddlPais').val()
                                     };

                                     var prd = 0;
                                     $.each($("#ContenidoImagenes .titG"), function (j) {
                                         prd++;
                                         if (prd != 0) {
                                             idImagen = ('0' + prd).substr(-2);
                                             dataImagen = $('#preview' + idImagen).attr('src');

                                             var imagen = {
                                                 "idImagen": idImagen,
                                                 "dataImagen": dataImagen,
                                                 "fotoProducto": dataImagen.substr(dataImagen.lastIndexOf("/") + 1),
                                                 "fotoProductoAnterior": dataImagen.substr(dataImagen.lastIndexOf("/") + 1),
                                                 "selected": $('#chk-estrategia-imagen' + idImagen).is(":checked") ? true : false
                                             }
                                             fotosProductos.push(imagen);
                                         }
                                     });
                                     fotosProductos.push(imagenNueva);

                                     var i = 1;
                                     fotosProductos.forEach(function (imagen) {
                                         idImagen = ('0' + i).substr(-2);
                                         item['FotoProducto' + idImagen] = imagen.fotoProducto;
                                         item['FotoProductoAnterior' + idImagen] = imagen.fotoProductoAnterior;
                                         i++;
                                     });

                                     for (i = fotosProductos.length + 1; i <= nroImagenes; i++) {
                                         idImagen = ('0' + i).substr(-2);
                                         item['FotoProducto' + idImagen] = imagenVacia;
                                         item['FotoProductoAnterior' + idImagen] = imagenVacia;
                                     }

                                     var enMatriz = $.trim($('#hdnEnMatrizComercial').val());
                                     var accion = (enMatriz == "0" ? baseUrl + 'MatrizComercial/InsertMatrizComercial' : baseUrl + 'MatrizComercial/UpdateMatrizComercial');
                                     jQuery.ajax({
                                         type: 'POST',
                                         url: accion,
                                         dataType: 'json',
                                         contentType: 'application/json; charset=utf-8',
                                         data: JSON.stringify(item),
                                         async: true,
                                         success: function (data) {
                                             if (checkTimeout(data)) {
                                                 closeWaitingDialog();
                                                 if (data.success == true) {
                                                     alert(data.message);
                                                     //HideDialog("DialogMatrizComercial");
                                                     //LimpiarDatos();
                                                     //jQuery("#list").setGridParam({ datatype: 'json', page: 1 }).trigger('reloadGrid');

                                                 }
                                                 else {
                                                     alert(data.message);
                                                 }
                                             }
                                         },
                                         error: function (data, error) {
                                             if (checkTimeout(data)) {
                                                 closeWaitingDialog();
                                                 alert(data.message);
                                                 // HideDialog("DialogMatrizComercial");
                                             }
                                         }
                                     });
                                 }
                                </script>
                        </div>
                    </div>
                </div>
                <div class="div-3" id="ContenidoImagenes">

                </div>
            </div>
            <div id="divInformacionAdicionalEstrategiaContenido" style="display: none;">
                <div class="div-3">
                    <div class="titG">Mensaje Adicional:</div>
                    <div class="titE">
                        <input type="text" id="txtTextoLibre" maxlength="100" style="width: 360px;" />
                    </div>
                </div>
                <div class="div-3 OfertaUltimoMinuto">
                    <div class="titH">Oferta de Último Minuto</div>
                    <div class="selectCheck borde_redondeado">
                        <input type="checkbox" class="check" id="chkOfertaUltimoMinuto" style="margin-top: 2px; margin-left: 15px;" />
                    </div>
                </div>
                <div class="div-est-3 DatosNuevas" id="div-orden" style="display: none">
                    <!--SB20-312 -->
                    <div class="titB">&nbsp;</div>
                    <div class="titB">Orden:</div>
                    <div class="titB">
                        <input type="text" id="txtOrden" value="" maxlength="3" />
                    </div>
                </div>
                <div class="div-3">
                    <div class="titG">Limite de Venta:</div>
                    <div class="titAuto">
                        <input type="text" id="txtLimite" value="99" style="width: 26px;" />
                    </div>
                    <div class="titE">&nbsp;(Número de Unidades máximas por Consultora)</div>
                </div>
                <div class="div-est-3 DatosNuevas" style="display: none">
                    <div class="titB">&nbsp;</div>
                    <div class="titB">Alcance:</div>
                    <div class="titD">
                        <input type="text" id="txtAlcance" readonly="readonly" />
                    </div>
                    <div class="titA" style="width: 20px">
                        <a href="#" style="margin-left: 5px" id="linkAlcance">
                            <img src='@Url.Content("~/Content/Images/search.png")' border="0" alt="Seleccionar alcance" title="Seleccionar alcance" />
                        </a>
                    </div>
                    <div class="titG" style="width: 300px">&nbsp;(Seleccionar Pa&iacute;s, Regi&oacute;n o Zona)</div>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="DialogZona" style="display: none;">
    <div class="Content_modal">
        <div class="div-3">
            <div class="treeview_est_content">
                <div id="arbolRegionZona" class="demo">
                </div>
            </div>
        </div>
        <div class="div-3">
            <div class="titF"></div>
            <div class="titF"></div>
            <div class="titH">
                <input type="checkbox" id="chkSeleccionar" />Seleccionar todo
            </div>
            </div>
        </div>
    </div>
<div id="DialogEditarTallaColor" style="display: none;">
    <div class="Content_modal">
        <div class="div-3">
            <div class="titG">CUV:</div>
            <div class="selectP2 borde_redondeado">
                <input type="text" id="txtCUVTC" />
            </div>
        </div>
        <div class="div-3">
            <div class="titG">Descripción:</div>
            <div class="selectP2 borde_redondeado" style="width: 300px">
                <input type="text" id="txtDescripcionCUVTC" style="width: 290px" readonly="readonly" />
            </div>
        </div>
        <div class="div-3">
            <div class="titG">Precio:</div>
            <div class="selectP2 borde_redondeado">
                <input type="text" id="txtPrecioCUVTC" readonly="readonly" />
            </div>
        </div>
        <div class="div-3">
            <div class="titG">Tipo:</div>
            <div class="selectP2 borde_redondeado">
                <select id="ddlTallaColor">
                    <option value='0'>-- Seleccionar --</option>
                    <option value='C'>Color</option>
                    <option value='T'>Talla</option>
                </select>
            </div>
        </div>
        <div class="div-3">
            <div class="titG">Descripción (Talla/Color):</div>
            <div class="selectP2 borde_redondeado">
                <input type="text" id="txtDescripcionTC" />
            </div>
        </div>
    </div>
</div>
<div id="DialogTonoMarca" style="display: none;">
    <div class="Content_modal">
        <table id="listTC"></table>
        <div id="pagerTC"></div>
    </div>
</div>
<div id="divVistaPrevia" class="Content_modal_ZE" style="display: none; background-color: #fff; width: 200px; height: 330px; overflow: hidden; text-align: center">
    <div class="Content_modal_ZE" style="margin: 5px; overflow: hidden;">
        <div style="position: absolute; width: 100%;">
            <img id="imgTipoOferta" style="float: right; margin-top: 10px;" src="">
        </div>
        <div style="position: absolute; width: 100%;">
            <img id="imgEstrella" style="float: left; margin-top: 10px; width: 23px; height: 23px;" src="@Url.Content("~/Content/Images/star_reco.png")">
        </div>
        <img id="imgZonaEstrategia" style="width: 128px; height: 161px; margin: 5px;" src="" alt="Imagen Producto">
    </div>
    <div class="zona_estrategia_1"></div>
    <div>&nbsp;</div>
    <div class="zona_estrategia_2"></div>
    <div class="zona_estrategia_3"></div>
    <div class="zona_estrategia_4"></div>
</div>
<div id="DialogNuevoMasivo" style="display: none;">
    <div class="Content_modal">
        <div class="div-3" style="text-align: center;">
            <div class="boton_redondo_admcontenido_on" id="divPaso1">1</div>
            <div class="signo_admcontenido_estrategia">></div>
            <div class="boton_redondo_admcontenido_off" id="divPaso2">2</div>
            <div class="signo_admcontenido_estrategia">></div>
            <div class="boton_redondo_admcontenido_off" id="divPaso3">3</div>
        </div>
        <div id="divMasivoPaso1">
            <div class="div-3" style="text-align: center; color: #00A2E8;">
                Pre Carga de CUVS pendientes por configurar en Zona de Estrategias
            </div>
            <div class="container" style="width: auto;">
                <div class="border-wrapper">
                    <table id="listCargaMasiva1"></table>
                    <div id="pagerCargaMasiva1"></div>
                </div>
            </div>
            <div id="divMostrarPreCarga">
                <div class="div-3" style="text-align: center; color: #00A2E8; margin-top: 20px;">
                    ¿Deseas pre cargar la información de los CUVS pendientes por configurar? (<span id="spnCantidadConfigurar1">11</span>) CUVS
                </div>
                <div class="div-3">
                    <div class="input_horizontal" style="text-align: center;">
                        <input type="button" name="btnAceptarMasivo1" id="btnAceptarMasivo1" value="Aceptar" style="float: none;" />
                        <input type="button" name="btnCancelarMasivo1" id="btnCancelarMasivo1" value="Cancelar" style="float: none;" />
                    </div>
                </div>
            </div>
        </div>
        <div id="divMasivoPaso2" style="display: none;">
            <div class="div-3" style="text-align: center; color: #00A2E8;">
                Grabar información en Zona de Estrategias
            </div>
            <div class="container" style="width: auto;">
                <div class="border-wrapper">
                    <table id="listCargaMasiva2"></table>
                    <div id="pagerCargaMasiva2"></div>
                </div>
            </div>
            <div id="divMostrarPreCarga2">
                <div class="div-3" style="text-align: center; color: #00A2E8; margin-top: 20px;">
                    ¿Deseas grabar la información de los CUVS pre cargados correctamente en la Zona de Estrategias? (<span id="spnCantidadConfigurar2">11</span>) CUVS
                </div>
                <div class="div-3">
                    <div class="input_horizontal" style="text-align: center;">
                        <input type="button" name="btnAceptarMasivo2" id="btnAceptarMasivo2" value="Aceptar" style="float: none;" />
                        <input type="button" name="btnCancelarMasivo2" id="btnCancelarMasivo2" value="Cancelar" style="float: none;" />
                    </div>
                </div>
            </div>
        </div>
        <div id="divMasivoPaso3" style="display: none;">
            <div class="div-3" style="text-align: center; color: #00A2E8;">
                Confirmación de grabación en Zona de Estrategias
            </div>
            <div class="div-3" style="text-align: center; margin-top: 20px;">
                Se grabó la información de los <a onclick=" VerCuvsTipo2(1); "><span id="spnCantidadConfigurar3">11</span> CUVS</a>
            </div>
            <div id="divMostrarNoCargados" class="div-3" style="text-align: center; margin-top: 20px;">
                Quedan <a onclick=" VerCuvsTipo2(2); "><span id="spnCantidadNoConfigurar3">11</span> CUVS</a> pendientes para cargar.
            </div>
            <div class="div-3">
                <div class="input_horizontal" style="text-align: center;">
                    <input type="button" name="btnAceptarMasivo3" id="btnAceptarMasivo3" value="Aceptar" style="float: none;" />
                </div>
            </div>
        </div>
    </div>
</div>
<div id="DialogGrillaCuv1">
    <div class="Content_modal">
        <div class="container" style="width: auto;">
            <div class="border-wrapper">
                <table id="listGrillaCuv1"></table>
                <div id="pagerGrillaCuv1"></div>
            </div>
        </div>
    </div>
</div>
<div id="DialogGrillaCuv2">
    <div class="Content_modal">
        <div class="container" style="width: auto;">
            <div class="border-wrapper">
                <table id="listGrillaCuv2"></table>
                <div id="pagerGrillaCuv2"></div>
            </div>
        </div>
    </div>
</div>
<div id="loadingScreen"></div>

<script id="ImagenCUV-template" type="text/x-jquery-tmpl">
    <div class="titG">
        <div class="pdr_modal borde_redondeado aligncenter">
            <img src="${dataImagen}" id="preview${idImagen}" class="img-matriz-preview" data-id="${idImagen}">
        </div>
        <div class="pdr_modal_check aligncenter">
            <input type="checkbox" id="chk-estrategia-imagen${idImagen}" class="chk-estrategia-imagen" {{if selected}} checked{{/if}} data-id="${idImagen}">
        </div>
    </div>
</script>

<script type="text/javascript">
    var nroImagenes = '@nroImagenes';
    var imagenVacia = '@imagenVacia';
    var rutaImagenVacia = '@Url.Content("~/Content/Images/" + imagenVacia)';
    var urlGetOfertaByCUV = baseUrl + 'AdministrarEstrategia/GetOfertaByCUV';
    var urlCargarArbolRegionesZonas = baseUrl + "AdministrarEstrategia/CargarArbolRegionesZonas";
    var rutastylejstree = '@Url.Content("~/Content/Css/jstree/apple/stylejstree.css")';
    var rutaImagenEdit = '@Url.Content("~/Content/Images/Edit.png")';
    var rutaImagenDelete = '@Url.Content("~/Content/Images/Delete.png")';
    var urlFiltrarEstrategia = baseUrl + 'AdministrarEstrategia/FiltrarEstrategia';
    var urlDeshabilitarEstrategia = baseUrl + 'AdministrarEstrategia/DeshabilitarEstrategia';
    var urlActivarDesactivarEstrategias = baseUrl + 'AdministrarEstrategia/ActivarDesactivarEstrategias';
    var cantidadPrecargar = 0;
    var cantidadPrecargar2 = 0;
    var urlConsultarCuvTipoConfigurado = baseUrl + 'AdministrarEstrategia/ConsultarCuvTipoConfigurado';
    var urlConsultarCuvTipoConfiguradoTemporal = baseUrl + 'AdministrarEstrategia/ConsultarCuvTipoConfiguradoTemporal';
    var imagenesProductos = [];
    var originalContent;





    jQuery(document).ready(function () {
        fnGrilla();
        IniDialog();

        $("#btnNuevo").click(function () {
            $.jstree._reference($("#arbolRegionZona")).check_all();

            if ($("#ddlPais").val() == "") {
                alert("Debe seleccionar el País, verifique.");
                return false;
            }
            if ($("#ddlCampania").val() == "") {
                alert("Debe seleccionar la Campaña, verifique.");
                return false;
            }
            if ($("#ddlTipoEstrategia").val() == "") {
                alert("Debe seleccionar un tipo de estrategia, verifique.");
                return false;
            }

            $("#hdTipoConsulta").val("1");
            $("#ddlCampaniaFin").val("");
            SeleccionarTipoOferta();
            PedidoAsociadoChecks();

            $("#hdEstrategiaIDConsulta").val($("#ddlTipoEstrategia").val());
                $("#hdEstrategiaID").val("0");
                $("#hdCampania").val($("#ddlCampania").val());
                $("#hdTipoEstrategiaID").val($("#ddlTipoEstrategia").val());
                $("#txtAlcance").val($("#ddlPais option:selected").html());
                $("#spanCampania").val($("#ddlCampania option:selected").html());
                $("#spanTipoEstrategia").val($("#ddlTipoEstrategia option:selected").html().trim());
                $('#chkHabilitarOferta').attr('checked', false);
            $('#chkOfertaUltimoMinuto').attr('checked', false);
                $('#hdZonas').val('');

            /*Limpiar datos*/
            $('#txtCUV2').val('');
            $('#txtPrecio2').val('');
            $('#txtCUV').val('');
            $('#txtPrecio').val('');
            $('#txtDescripcion').val('');

            $('#ContenidoImagenes').empty();
            $('#imgSeleccionada').attr("src", rutaImagenVacia);
            $('#imgZonaEstrategia').attr("src", rutaImagenVacia);

            $("#divImagenEstrategiaContenido").show();
            $("#divInformacionAdicionalEstrategiaContenido").hide();

            $("#divImagenEstrategia").css("color", "white");
            $("#divImagenEstrategia").css("background", "#00A2E8");
            $("#divInformacionAdicionalEstrategia").css("color", "#702789");
            $("#divInformacionAdicionalEstrategia").css("background", "#D0D0D0");
            $("#txtTextoLibre").val("");

                $('#hdColorFondo').val("#FFF");
                ActivarDesactivarChecks();
                $('#mensajeErrorCUV').val("");
                $('#mensajeErrorCUV2').val("");
                $("#linkAlcance").click();
                $(".checksPedidosAsociados").html('');

                var aux1 = $('#ddlTipoEstrategia').find(':selected').data('id');
            $("#btnActivarDesactivar").hide();

                /* SB20-312 - INICIO */
                if (aux1 == "4") {
                    $("#txtOrden").val("");
                    $('#div-orden').hide();

                    $('#txt1-estrella').html('Oferta de Último Minuto');
                    $('#txt2-estrella').hide();
                $("#btnActivarDesactivar").show();
                }
                else {
                    //$("#txtOrden").val("");
                    $('#div-orden').show();

                    $('#txt1-estrella').html('Mostrar estrella');
                    $('#txt2-estrella').show();
                }

                $("#ddlEtiqueta1").children('option').show();
                $("#ddlEtiqueta2").children('option').show();

                if (aux1 == "2") {
                    $("#ddlEtiqueta1").children('option').hide();
                    $("#ddlEtiqueta1").children("option[data-id='4']").show();

                $("#hdnEtiqueta1").val('4');
                }
                else if (aux1 == "4" || aux1 == "5") {

                $("#hdnEtiqueta1").val('1');
                $("#hdnEtiqueta2").val('3');

                } else if (aux1 == "0" || aux1 == '6') {
                $("#ddlEtiqueta1").children("option[data-id='5']").hide();
                $("#ddlEtiqueta2").children("option[data-id='5']").hide();
                $("#hdnEtiqueta1").val('5');
                $("#hdnEtiqueta2").val('5');
            }

            if (aux1 == "6") {
                $('.OfertaUltimoMinuto').hide();
            } else { $('.OfertaUltimoMinuto').show(); }

            if (aux1 == "7") {
                $('.Recomendados').hide();

                $("#ddlEtiqueta1").children('option').hide();
                $("#ddlEtiqueta1").children("option[data-id='1']").show();

                $("#ddlEtiqueta2").children('option').hide();
                $("#ddlEtiqueta2").children("option[data-id='5']").show();

                $('#div-orden').hide(); //Ocultando Orden

                $("#hdnEtiqueta1").val('1');
                $("#hdnEtiqueta2").val('5');

                //$('#txtLimite').prop('readonly', true); //Modo lectura on
            }
            //else {
            //    $('#div-orden').show(); //Ocultando Orden
            //    //$('#txtLimite').prop('readonly', false); //Modo lectura off
            //}
            /*********************/
                /* SB20-312 - FIN */

                HideDialog("DialogZona");
                showDialog("DialogAdministracionEstrategia");
        });
        // Activar/Desactivar las estrategias de Ofertas de forma masiva
        $("#btnActivarDesactivar").click(function () {

            var proceder = confirm('¿ Desea habilitar/deshabiltar las estrategias?');
            if (!proceder)
                return false;

            waitingDialog({});

            var estrategias = jQuery("#list").jqGrid('getDataIDs', 'EstrategiaID');
            var estrategiasSeleccionadas = jQuery("#list").jqGrid('getGridParam', 'selarrrow');
            var estrategiasNoSeleccionadas = estrategias.filter(function (obj) { return estrategiasSeleccionadas.indexOf(obj) == -1; });

            var params = {
                EstrategiasActivas: estrategiasSeleccionadas.join(','),
                EstrategiasDesactivas: estrategiasNoSeleccionadas.join(',')
            };

            jQuery.ajax({
                type: 'POST',
                url: urlActivarDesactivarEstrategias,
                dataType: 'json',
                contentType: 'application/json; charset=utf-8',
                data: JSON.stringify(params),
                async: true,
                success: function (data) {                    
                    alert(data.message);
                    fnGrilla();
                    closeWaitingDialog();
                },
                error: function (data, error) {
                    alert(data.message);
                    closeWaitingDialog();
                }
            });

        });
        $("#ddlTipoEstrategia").change(function () {
            var aux1 = $('#ddlTipoEstrategia').find(':selected').data('id');
            $("#btnActivarDesactivar").hide();
            if (aux1 == "4")
                $("#btnActivarDesactivar").show();

            SeleccionarTipoOferta();
            PedidoAsociadoChecks();
        });
        $("#btnBuscar").click(function () {
            if ($("#ddlPais").val() == "") {
                alert("Debe seleccionar el País, verifique.");
                return false;
            }
            if ($("#ddlCampania").val() == "") {
                alert("Debe seleccionar la Campaña, verifique.");
                return false;
            }
            if ($("#ddlTipoEstrategia").val() == "") {
                alert("Debe seleccionar el tipo de estrategia, verifique.");
                return false;
            }
            $("#hdEstrategiaIDConsulta").val($("#ddlTipoEstrategia").val());
            $("#hdTipoConsulta").val("1");
            fnGrilla();
        });
        $('#ddlPais').change(function () {
            $("#hdTipoConsulta").attr("value", "0");
            $("#list").jqGrid("clearGridData", true).trigger("reloadGrid");
            var Id = $(this).val();
            //if (Id != "") {
            waitingDialog({});
            $.ajaxSetup({ cache: false });
            $.ajax({
                type: 'GET',
                url: baseUrl + 'AdministrarEstrategia/ObtenterCampanias',
                data: "PaisID=" + (Id == "" ? 0 : Id),
                cache: false,
                dataType: 'Json',
                success: function (data) {
                    if (checkTimeout(data)) {
                        var ddlCampania = $('#ddlCampania');
                        var ddlCampaniaFin = $('#ddlCampaniaFin');
                        ddlCampania.empty();
                        ddlCampaniaFin.empty();
                        if (data.lista.length > 0) {
                            ddlCampania.append($('<option/>', {
                                value: "",
                                text: "-- Seleccionar --"
                            }));
                            ddlCampaniaFin.append($('<option/>', {
                                value: "",
                                text: "-- Seleccionar --"
                            }));
                            if (Id != "") {
                                for (var item in data.lista) {
                                    ddlCampania.append($('<option/>', {
                                        value: data.lista[item].CampaniaID,
                                        text: data.lista[item].Codigo
                                    }));
                                    ddlCampaniaFin.append($('<option/>', {
                                        value: data.lista[item].CampaniaID,
                                        text: data.lista[item].Codigo
                                    }));
                                }
                            }
                        }
                        cargarArbol();
                        closeWaitingDialog();
                    }
                },
                error: function (x, xh, xhr) {
                    if (checkTimeout(x)) {
                        closeWaitingDialog();
                    }
                }
            });
        });
        $("#linkAlcance").click(function () {
            var strZonas = $("#hdZonas").val();
            if (strZonas != "") {
                $.jstree._reference($("#arbolRegionZona")).uncheck_all();
                var strZonasArreglo = strZonas.split(",");
                for (i = 0; i < strZonasArreglo.length; i++) {
                    $("#arbolRegionZona").jstree("check_node", "#" + strZonasArreglo[i], true);
                }
                $("#chkSeleccionar").attr("checked", true);
                $.jstree._reference($("#arbolRegionZona")).get_unchecked(null, true).each(function () {
                    if (this.className.toLowerCase().indexOf("jstree-leaf") == -1) {
                        return true;
                    }
                    $("#chkSeleccionar").attr("checked", false);
                });
            } else {
                $.jstree._reference($("#arbolRegionZona")).check_all();
                var zonas = "";
                $.jstree._reference($("#arbolRegionZona")).get_checked(null, true).each(function () {
                    if (this.className.toLowerCase().indexOf("jstree-leaf") == -1) {
                        return true;
                    }
                    zonas += this.id + ",";
                });
                if (zonas != "") {
                    zonas = zonas.substring(0, zonas.length - 1);
                }
                $("#hdZonas").val(zonas);
                $("#chkSeleccionar").attr("checked", true);
            }
            $('#arbolRegionZona').jstree('close_all');
            showDialog("DialogZona");
            return false;
        });
        $("#linkTallaColor").click(function () {
            if ($.trim($("#txtCUV2").val()) == "") {
                alert("Debe ingresar un valor para CUV2");
                return false;
            }
            fnGrillaTC();
            showDialog("DialogTonoMarca");
            return false;
        });
        $("#chkSeleccionar").click(function () {
            if (this.checked)
                $.jstree._reference($("#arbolRegionZona")).check_all();
            else
                $.jstree._reference($("#arbolRegionZona")).uncheck_all();
        });
        $("#txtCUV").keyup(function () {
            if ($(this).val().length == 5) {

                if ($("#txtCUV2").val() == "") {
                    alert("Debe ingresar un valor para el CUV2");
                    return false;
                }

                waitingDialog({});
                $.ajaxSetup({ cache: false });

                var flagNueva = $("#ddlTipoEstrategia option:selected").attr("flag-nueva");
                var flagRecoProduc = $("#ddlTipoEstrategia option:selected").attr("flag-recoproduct");
                var flagRecoPerfil = $("#ddlTipoEstrategia option:selected").attr("flag-recoperfil");
                var auxOD = $('#ddlTipoEstrategia').find(':selected').data('id'); // PL20-1225

                /**** PL20-1225 *****/
                var flagOD = "";
                if (auxOD == '7' || auxOD == '4') {
                    flagOD = '1';
                }
                else {
                    flagOD = '0';
                }
                /********/

                var params = {
                    CampaniaID: $("#ddlCampania").val(),
                    CUV2: $("#txtCUV2").val(),
                    TipoEstrategiaID: $("#ddlTipoEstrategia").val(),
                    CUV1: $("#txtCUV").val(),
                    flag: flagOD,//"1",
                    FlagNueva: flagNueva,
                    FlagRecoProduc: flagRecoProduc,
                    FlagRecoPerfil: flagRecoPerfil
                };

                jQuery.ajax({
                    type: 'POST',
                    url: baseUrl + 'AdministrarEstrategia/GetOfertaByCUV',
                    dataType: 'json',
                    contentType: 'application/json; charset=utf-8',
                    data: JSON.stringify(params),
                    async: true,
                    success: function (data) {
                        if (data.message == "OK") {
                            $("#txtPrecio").val(parseFloat(data.precio).toFixed(2));
                            $('#mensajeErrorCUV').val("");
                            closeWaitingDialog();
                        } else {
                            $('#mensajeErrorCUV').val(data.message);
                            alert($('#mensajeErrorCUV').val());
                            closeWaitingDialog();
                        }
                    },
                    error: function (data, error) {
                        $('#mensajeErrorCUV').val(data.message);
                        alert($('#mensajeErrorCUV').val());
                        closeWaitingDialog();
                    }
                });
            }
        });
        $("#txtCUVTC").keyup(function () {

            if ($(this).val().length == 5) {

                if ($("#txtCUV2").val() == "") {
                    alert("Debe ingresar un valor para el CUV2");
                    return false;
                }

                waitingDialog({});
                $.ajaxSetup({ cache: false });

                var flagNueva = $("#ddlTipoEstrategia option:selected").attr("flag-nueva");
                var flagRecoProduc = $("#ddlTipoEstrategia option:selected").attr("flag-recoproduct");
                var flagRecoPerfil = $("#ddlTipoEstrategia option:selected").attr("flag-recoperfil");

                var params = {
                    CampaniaID: $("#ddlCampania").val(),
                    CUV2: $("#txtCUVTC").val(),
                    TipoEstrategiaID: $("#ddlTipoEstrategia").val(),
                    CUV1: "0",
                    flag: "2",
                    FlagNueva: flagNueva,
                    FlagRecoProduc: flagRecoProduc,
                    FlagRecoPerfil: flagRecoPerfil
                };

                jQuery.ajax({
                    type: 'POST',
                    url: baseUrl + 'AdministrarEstrategia/GetOfertaByCUV',
                    dataType: 'json',
                    contentType: 'application/json; charset=utf-8',
                    data: JSON.stringify(params),
                    async: true,
                    success: function (data) {
                        if (data.message == "OK") {
                            $("#txtDescripcionCUVTC").val(data.descripcion);
                            $("#txtPrecioCUVTC").val(parseFloat(data.precio).toFixed(2));
                            closeWaitingDialog();
                        } else {
                            alert(data.message);
                            closeWaitingDialog();
                        }
                    },
                    error: function (data, error) {
                        $('#mensajeErrorCUV').val(data.message);
                        alert($('#mensajeErrorCUV').val());
                        closeWaitingDialog();
                    }
                });
            }

        });
        $("#txtCUV2").keyup(function () {
            var cuvIngresado = $(this).val();
            $("#imgSeleccionada").attr("src", rutaImagenVacia);
            $("#imgSeleccionada").attr("data-id", "0");
            mostrarInformacionCUV(cuvIngresado);
        });

        $(".chk-estrategia-imagen").click(function () {
            var id = $(this).attr('data-id');
            if ($(this).attr('checked')) {
                $("#ImagenProducto").val($(this).val());
                $('.chk-estrategia-imagen[data-id!="' + id + '"]').removeAttr('checked');
            }
        });

        ActivarDesactivarChecks();
        PaletaColores();
        $(".activar-desactivar").click(function () {
            if (!$(this).attr("checked")) {
                $(this).parent().parent().find("input").each(function () {
                    $(this).val('');
                    $("#chkEstrella").attr('checked', false);
                    $(this).attr('disabled', true);
                });
                $(this).parent().parent().find("select").each(function () {
                    $(this).val('');
                    $(this).attr('disabled', true);
                });
                $(this).attr('disabled', false);
                PaletaColores();
            } else {
                $(this).parent().parent().find("input").each(function () {
                    $(this).val('');
                    $("#chkEstrella").attr('checked', false);
                    $(this).attr('disabled', false);
                });
                $(this).parent().parent().find("select").each(function () {
                    $(this).val('');
                    $(this).attr('disabled', false);
                });
                $(this).attr('disabled', false);
                PaletaColores();
            }
        });


        $("#btnNuevoMasivo").click(function () {
            if ($("#ddlPais").val() == "") {
                alert("Debe seleccionar el País, verifique.");
                return false;
            }
            if ($("#ddlCampania").val() == "") {
                alert("Debe seleccionar la Campaña, verifique.");
                return false;
            }
            if ($("#ddlTipoEstrategia").val() == "") {
                alert("Debe seleccionar un tipo de estrategia, verifique.");
                return false;
            } else {
                var estrategiaId = $("#ddlTipoEstrategia option:selected").attr("data-id");
                if (estrategiaId != 4) {
                    alert("Debe seleccionar el tipo de Estrategia Oferta para Ti, verifique.");
                    return false;
                }
            }

            $("#divMasivoPaso1").show();
            $("#divMasivoPaso2").hide();
            $("#divMasivoPaso3").hide();

            $("#divPaso1").removeClass("boton_redondo_admcontenido_off");
            $("#divPaso1").addClass("boton_redondo_admcontenido_on");

            $("#divPaso2").removeClass("boton_redondo_admcontenido_on");
            $("#divPaso2").addClass("boton_redondo_admcontenido_off");

            $("#divPaso3").removeClass("boton_redondo_admcontenido_on");
            $("#divPaso3").addClass("boton_redondo_admcontenido_off");

            fnGrillaEstrategias1();

            //$(".ui-dialog .ui-dialog-buttonpane .ui-dialog-buttonset").css("float", "none");
            //$(".ui-dialog .ui-dialog-buttonpane").css("text-align", "center");
            showDialog("DialogNuevoMasivo");
        });

        $("#btnAceptarMasivo1").click(function () {
            var params = {
                campaniaId: parseInt($("#ddlCampania").val()),
                tipoConfigurado: 2
            };

            waitingDialog({});

            jQuery.ajax({
                type: 'POST',
                url: baseUrl + 'AdministrarEstrategia/InsertEstrategiaTemporal',
                dataType: 'json',
                contentType: 'application/json; charset=utf-8',
                data: JSON.stringify(params),
                async: true,
                success: function (data) {
                    if (data.success) {
                        closeWaitingDialog();
                        fnGrillaEstrategias2();
                    } else {
                        alert(data.message);
                    }
                },
                error: function (data, error) {
                    alert(data.message);
                }
            });
        });

        $("#btnCancelarMasivo1").click(function () {
            HideDialog("DialogNuevoMasivo");
        });

        $("#btnAceptarMasivo2").click(function () {
            var params = {
                campaniaId: parseInt($("#ddlCampania").val()),
                tipoConfigurado: 1
            };

            waitingDialog({});

            jQuery.ajax({
                type: 'POST',
                url: baseUrl + 'AdministrarEstrategia/InsertEstrategiaOfertaParaTi',
                dataType: 'json',
                contentType: 'application/json; charset=utf-8',
                data: JSON.stringify(params),
                async: true,
                success: function (data) {
                    if (data.success) {
                        closeWaitingDialog();
                        //fnGrillaEstrategias2();
                        $("#divMasivoPaso1").hide();
                        $("#divMasivoPaso2").hide();
                        $("#divMasivoPaso3").show();

                        $("#divPaso1").removeClass("boton_redondo_admcontenido_on");
                        $("#divPaso1").addClass("boton_redondo_admcontenido_off");

                        $("#divPaso2").removeClass("boton_redondo_admcontenido_on");
                        $("#divPaso2").addClass("boton_redondo_admcontenido_off");

                        $("#divPaso3").removeClass("boton_redondo_admcontenido_off");
                        $("#divPaso3").addClass("boton_redondo_admcontenido_on");
                    } else {
                        alert(data.message);
                    }
                },
                error: function (data, error) {
                    alert(data.message);
                }
            });
        });

        $("#btnCancelarMasivo2").click(function () {
            var params = {
                campaniaId: parseInt($("#ddlCampania").val())
            };

            jQuery.ajax({
                type: 'POST',
                url: baseUrl + 'AdministrarEstrategia/CancelarInsertEstrategiaTemporal',
                dataType: 'json',
                contentType: 'application/json; charset=utf-8',
                data: JSON.stringify(params),
                async: true,
                success: function (data) {
                    if (data.success) {
                        HideDialog("DialogNuevoMasivo");
                    }
                    alert(data.message);
                },
                error: function (data, error) {
                    alert(data.message);
                }
            });
        });

        $("#btnAceptarMasivo3").click(function () {
            HideDialog("DialogNuevoMasivo");
        });

        });

    $(".chk-estrategia-imagen").live("click", function () {
        var id = $(this).attr('data-id');
        var imagenURL = ""
        if ($(this).attr('checked')) {
            $("#imgSeleccionada").attr("src", $("#preview" + id).attr("src"));
            imagenURL = $("#imgSeleccionada").attr("src");
            $("#ImagenProducto").val(imagenURL.substr(imagenURL.lastIndexOf("/") + 1));
            $('.chk-estrategia-imagen[data-id!="' + id + '"]').removeAttr('checked');
            $("#imgSeleccionada").attr('data-id', id);
        }
    });

    $(".img-matriz-preview").live("click", function () {
        var id = $(this).attr('data-id');
        var idImagen = ('0' + id).substr(-2);
        var objChkImagen = $('#chkImagenProducto' + idImagen);
        if (objChkImagen.attr("disabled") != "disabled") MostrarVistaPrevia('preview' + id);
    });

    function mostrarInformacionCUV(cuvIngresado) {
        $("#hdnCodigoSAP").val("");
        $("#hdnEnMatrizComercial").val("");
        if (cuvIngresado.length == 5) {
            waitingDialog({});
            $.ajaxSetup({ cache: false });

            var flagNueva = $("#ddlTipoEstrategia option:selected").attr("flag-nueva");
            var flagRecoProduc = $("#ddlTipoEstrategia option:selected").attr("flag-recoproduct");
            var flagRecoPerfil = $("#ddlTipoEstrategia option:selected").attr("flag-recoperfil");
            var auxOD = $('#ddlTipoEstrategia').find(':selected').data('id'); // PL20-1225

            /**** PL20-1225 *****/
            var flagOD = "";
            if (auxOD == '7') {
                flagOD = '4';
            }
            else {
                flagOD = '0';
            }
            /********/

            var params = {
                CampaniaID: $("#ddlCampania").val(),
                CUV2: $("#txtCUV2").val(),
                TipoEstrategiaID: $("#ddlTipoEstrategia").val(),
                CUV1: "0",
                flag: flagOD,
                FlagNueva: flagNueva,
                FlagRecoProduc: flagRecoProduc,
                FlagRecoPerfil: flagRecoPerfil
            };

            jQuery.ajax({
                type: 'POST',
                url: urlGetOfertaByCUV,
                dataType: 'json',
                contentType: 'application/json; charset=utf-8',
                data: JSON.stringify(params),
                async: true,
                success: function (data) {
                    var objPreview, objChkImagen, idImagen, dataImagen, imgFormat;
                    $('#mensajeErrorCUV').val("");

                    if (data.message == "OK") {
                        $("#txtDescripcion").val(data.descripcion);

                        if (data.wsprecio > 0) {
                            $("#txtPrecio2").val(parseFloat(data.wsprecio).toFixed(2));
                            $("#txtPrecio2")[0].disabled = true;
                        }
                        else if (data.wsprecio == 0) {
                            if (data.precio == 0) {
                                $("#txtPrecio2").val(parseFloat(data.precio).toFixed(2));
                                $("#txtPrecio2")[0].disabled = true;
                            }
                            else {
                                $("#txtPrecio2").val(parseFloat(data.precio).toFixed(2));
                                $("#txtPrecio2")[0].disabled = true;
                            }
                        }
                        else if (data.wsprecio == -1) {
                            $("#txtPrecio2")[0].disabled = true;
                            alert("No se pudo  obtener el precio del producto. Por favor, comunicarse con Soporte Digital Consultoras");
                        }
                        else if (data.wsprecio == -2) {
                            $("#txtPrecio2")[0].disabled = false;
                            $("#txtPrecio2").val("");
                            $("#txtPrecio2").focus();
                        }

                        //$("#txtPrecio").val("");
                        //$("#txtCUV").val("");

                        $("#ContenidoImagenes").empty();
                        //$("#imgSeleccionada").attr("src", rutaImagenVacia);
                        $("#hdnCodigoSAP").val(data.codigoSAP);
                        $("#hdnEnMatrizComercial").val(data.enMatrizComercial);
                        imagenesProductos = [];
                        var imagenProductoSeleccionada = $("#imgSeleccionada").attr('src');
                        imagenProductoSeleccionada = imagenProductoSeleccionada.substr(imagenProductoSeleccionada.lastIndexOf("/") + 1);

                        for (var i = 1; i <= nroImagenes; i++) {
                            idImagen = ('0' + i).substr(-2);
                            dataImagen = data['imagen' + i];


                            if (dataImagen != '') {
                                var imagen = {
                                    "idImagen": idImagen,
                                    "dataImagen": dataImagen,
                                    "fotoProducto": dataImagen.substr(dataImagen.lastIndexOf("/") + 1),
                                    "fotoProductoAnterior": dataImagen.substr(dataImagen.lastIndexOf("/") + 1),
                                    "selected": dataImagen.substr(dataImagen.lastIndexOf("/") + 1) == imagenProductoSeleccionada ? true : false
                                }
                                imagenesProductos.push(imagen);
                            }
                        }

                        $('#ImagenCUV-template').tmpl(imagenesProductos).appendTo("#ContenidoImagenes");

                        $("#divImagenEstrategiaContenido").show();
                        $("#divInformacionAdicionalEstrategiaContenido").hide();

                        (imagenesProductos.length == 10) ? $("#fpUpload").hide() : $("#fpUpload").show();

                        $('#mensajeErrorCUV2').val("");
                        closeWaitingDialog();
                    } else {
                        $('#mensajeErrorCUV2').val(data.message);
                        alert($('#mensajeErrorCUV2').val());
                        $("#txtDescripcion").val("");
                        $("#txtPrecio2").val("");

                        $("#txtPrecio").val("");
                        $("#txtCUV").val("");

                        for (var i = 1; i <= nroImagenes; i++) {
                            idImagen = ('0' + i).substr(-2);
                            objPreview = $('#preview' + i);
                            objChkImagen = $('#chkImagenProducto' + idImagen);
                            dataImagen = data['imagen' + i];

                            if (dataImagen != '') {
                                objPreview.attr('src', data.imagen1);
                                objChkImagen.attr('disabled', false);
                            }
                            else {
                                objPreview.attr('src', rutaImagenVacia);
                                objChkImagen.attr('disabled', true);
                            }
                            objChkImagen.attr('checked', false);
                        }

                        closeWaitingDialog();
                    }
                },
                error: function (data, error) {
                    alert(data.message);
                    closeWaitingDialog();
                }
            });
        }
    }

    $("#divImagenEstrategia").click(function () {
        $(this).css("color", "white");
        $(this).css("background", "#00A2E8");

        $("#divInformacionAdicionalEstrategia").css("color", "#702789");
        $("#divInformacionAdicionalEstrategia").css("background", "#D0D0D0");

        $("#divImagenEstrategiaContenido").show();
        $("#divInformacionAdicionalEstrategiaContenido").hide();
    });

    $("#divInformacionAdicionalEstrategia").click(function () {
        $(this).css("color", "white");
        $(this).css("background", "#00A2E8");

        $("#divImagenEstrategia").css("color", "#702789");
        $("#divImagenEstrategia").css("background", "#D0D0D0");

        $("#divInformacionAdicionalEstrategiaContenido").show();
        $("#divImagenEstrategiaContenido").hide();
    });

    ///////////////
    $(document).keydown(function (e) {
        if (e.keyCode == 8 && e.target.tagName != 'INPUT' && e.target.tagName != 'TEXTAREA') {
            e.preventDefault();
        }
    });
    //////////////

    function fnGrillaEstrategias1() {
        $("#listCargaMasiva1").jqGrid("GridUnload");
        jQuery("#listCargaMasiva1").jqGrid({
            url: baseUrl + "AdministrarEstrategia/ConsultarOfertasParaTi",
            hidegrid: false,
            datatype: 'json',
            postData: ({
                CampaniaID: $("#ddlCampania").val()
            }),
            mtype: 'GET',
            contentType: "application/json; charset=utf-8",
            //colNames: ['Descripcion', 'Cantidad'],
            colNames: ['Id', 'Descripción', 'Cantidad'],
            colModel: [
                { name: 'Id', index: 'Id', width: 100, editable: true, resizable: false, hidden: true },
                { name: 'Descripcion', index: 'Descripcion', width: 100, editable: true, resizable: false },
                { name: 'Activo', index: 'Activo', width: 30, align: 'center', editable: true, resizable: false, formatter: ShowActionsVer1 }
            ],
            jsonReader:
            {
                root: "rows",
                page: "page",
                total: "total",
                records: "records",
                repeatitems: true,
                cell: "cell",
                id: "id"
            },
            pager: jQuery('#pagerCargaMasiva1'),
            loadtext: 'Cargando datos...',
            recordtext: "{0} - {1} de {2} Registros",
            emptyrecords: 'No hay resultados',
            rowNum: 10,
            scrollOffset: 0,
            rowList: [10, 20, 30, 40, 50],
            sortname: 'Orden',
            sortorder: 'asc',
            viewrecords: true,
            multiselect: false,
            height: 'auto',
            width: 540,
            pgtext: 'Pág: {0} de {1}',
            altRows: true,
            altclass: 'jQGridAltRowClass',
            loadComplete: function () { },
            gridComplete: function () {
                if (cantidadPrecargar == 0) {
                    $("#divMostrarPreCarga").css("display", "none");
                } else {
                    $("#divMostrarPreCarga").css("display", "");
                    $("#spnCantidadConfigurar1").html(cantidadPrecargar);
                }
            }
        });
        jQuery("#listCargaMasiva1").jqGrid('navGrid', "#pagerCargaMasiva1", { edit: false, add: false, refresh: false, del: false, search: false });
        jQuery("#listCargaMasiva1").setGridParam({ datatype: 'json', page: 1 }).trigger('reloadGrid');
    }

    function fnGrillaEstrategias2() {
        $("#listCargaMasiva2").jqGrid("GridUnload");
        jQuery("#listCargaMasiva2").jqGrid({
            url: baseUrl + "AdministrarEstrategia/ConsultarOfertasParaTiTemporal",
            hidegrid: false,
            datatype: 'json',
            postData: ({
                CampaniaID: $("#ddlCampania").val()
            }),
            mtype: 'GET',
            contentType: "application/json; charset=utf-8",
            //colNames: ['Descripcion', 'Cantidad'],
            colNames: ['Id', 'Descripción', 'Cantidad'],
            colModel: [
                { name: 'Id', index: 'Id', width: 100, editable: true, resizable: false, hidden: true },
                { name: 'Descripcion', index: 'Descripcion', width: 100, editable: true, resizable: false },
                { name: 'Activo', index: 'Activo', width: 30, align: 'center', editable: true, resizable: false, formatter: ShowActionsVer2 }
            ],
            jsonReader:
            {
                root: "rows",
                page: "page",
                total: "total",
                records: "records",
                repeatitems: true,
                cell: "cell",
                id: "id"
            },
            pager: jQuery('#pagerCargaMasiva2'),
            loadtext: 'Cargando datos...',
            recordtext: "{0} - {1} de {2} Registros",
            emptyrecords: 'No hay resultados',
            rowNum: 10,
            scrollOffset: 0,
            rowList: [10, 20, 30, 40, 50],
            sortname: 'Orden',
            sortorder: 'asc',
            viewrecords: true,
            multiselect: false,
            height: 'auto',
            width: 540,
            pgtext: 'Pág: {0} de {1}',
            altRows: true,
            altclass: 'jQGridAltRowClass',
            loadComplete: function () { },
            gridComplete: function () {
                if (cantidadPrecargar2 == 0) {
                    $("#divMostrarPreCarga2").css("display", "none");
                } else {
                    $("#divMostrarPreCarga2").css("display", "");
                    $("#spnCantidadConfigurar2").html(cantidadPrecargar2);
                }

                $("#divMasivoPaso1").hide();
                $("#divMasivoPaso2").show();

                $("#divPaso1").removeClass("boton_redondo_admcontenido_on");
                $("#divPaso1").addClass("boton_redondo_admcontenido_off");

                $("#divPaso2").removeClass("boton_redondo_admcontenido_off");
                $("#divPaso2").addClass("boton_redondo_admcontenido_on");
            }
        });
        jQuery("#listCargaMasiva2").jqGrid('navGrid', "#pagerCargaMasiva2", { edit: false, add: false, refresh: false, del: false, search: false });
        jQuery("#listCargaMasiva2").setGridParam({ datatype: 'json', page: 1 }).trigger('reloadGrid');
    }

    // 2209 - Inicio
    function CerrarTallaColor() {

        var params = {
            CampaniaID: $("#ddlCampania").val(),
            CUV2: $("#txtCUV2").val(),
            TipoEstrategiaID: $("#ddlTipoEstrategia").val(),
            CUV1: "",
            flag: "3",
            FlagNueva: "0",
            FlagRecoProduc: "0",
            FlagRecoPerfil: "0"
        };

        jQuery.ajax({
            type: 'POST',
            url: baseUrl + 'AdministrarEstrategia/GetOfertaByCUV',
            dataType: 'json',
            contentType: 'application/json; charset=utf-8',
            data: JSON.stringify(params),
            async: true,
            success: function (data) {
                if (data.message == "OK") {
                    var cantidad = parseInt(data.precio);
                    if (cantidad > 0) {
                        alert("Debe ingresar todas las descripciones a las tallas/colores.");
                        return false;
                    } else {
                        HideDialog("DialogTonoMarca");
                    }
                } else {
                    alert(data.message);
                }
            },
            error: function (data, error) {
                alert(data.message);
            }
        });
    }
    // 2209 - Fin
    function MostrarVistaPrevia(id) {
        $("#imgZonaEstrategia").attr("src", $("#" + id).attr("src"));
        if (id == "preview0") $("#imgZonaEstrategia").attr("src", rutaImagenVacia);

        $("#imgTipoOferta").attr("src", $("#ddlTipoEstrategia option:selected").attr('imagen-tipo'));
        $("#imgEstrella").hide();
        $(".zona_estrategia_1").html("");
        $(".zona_estrategia_2").html("");
        $(".zona_estrategia_3").html("");
        $(".zona_estrategia_4").html("");

        if ($("#chkVisible1").attr("checked")) { $(".zona_estrategia_1").html(InitCap($("#txtDescripcion").val())); }
        else { $(".zona_estrategia_1").html(""); }
        if ($("#chkVisible2").attr("checked")) {
            if ($("#ddlEtiqueta1 option:selected").html() != "-- Seleccionar --") {
                $(".zona_estrategia_2").html($("#ddlEtiqueta1 option:selected").html() + " " + $("#hdSimbolo").val() + " " + parseFloat($("#txtPrecio").val()).toFixed(2));
            }
        }
        else { $(".zona_estrategia_2").html(""); }
        if ($("#chkVisible3").attr("checked")) {
            if ($("#ddlEtiqueta2 option:selected").html() != "-- Seleccionar --") {
                $(".zona_estrategia_3").html($("#ddlEtiqueta2 option:selected").html() + " " + $("#hdSimbolo").val() + " " + parseFloat($("#txtPrecio2").val()).toFixed(2));
            }
        }
        else { $(".zona_estrategia_3").html(""); }
        if ($("#chkVisible4").attr("checked")) { $(".zona_estrategia_4").html($("#txtTextoLibre").val()); }
        else { $(".zona_estrategia_4").html(""); }

        if ($("#chkVisible5").attr("checked")) {
            $(".Content_modal_ZE").css("background-color", $("#hdColorFondo").val());
            if (!$("#chkEstrella").attr("disabled")) {
                if ($("#chkEstrella").attr("checked")) {
                    $("#imgEstrella").show();
                } else {
                    $("#imgEstrella").hide();
                }
            } else {
                $("#imgEstrella").hide();
            }
        }
        else { $(".Content_modal_ZE").css("background-color", "#FFF"); }
        $("#imgTipoOferta").hide();
        showDialog('divVistaPrevia');
        return false;
    }

    function InitCap(str) {
        return str.replace(/([^\W_]+[^\s-]*) */g, function (txt) { return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase(); });
    }

    function PaletaColores() {
        $("#txtColorFondo").spectrum({
            color: $("#hdColorFondo").val(),
            showInput: true,
            className: "full-spectrum",
            showInitial: true,
            showPalette: true,
            showSelectionPalette: true,
            maxPaletteSize: 10,
            preferredFormat: "hex",
            localStorageKey: "spectrum.demo",
            move: function (color) {

            },
            show: function () {

            },
            beforeShow: function () {

            },
            hide: function () {

            },
            change: function () {
                $("#hdColorFondo").val($(this).val());
            },
            palette: [
                ["rgb(0, 0, 0)", "rgb(67, 67, 67)", "rgb(102, 102, 102)",
                "rgb(204, 204, 204)", "rgb(217, 217, 217)", "rgb(255, 255, 255)"],
                ["rgb(152, 0, 0)", "rgb(255, 0, 0)", "rgb(255, 153, 0)", "rgb(255, 255, 0)", "rgb(0, 255, 0)",
                "rgb(0, 255, 255)", "rgb(74, 134, 232)", "rgb(0, 0, 255)", "rgb(153, 0, 255)", "rgb(255, 0, 255)"],
                ["rgb(230, 184, 175)", "rgb(244, 204, 204)", "rgb(252, 229, 205)", "rgb(255, 242, 204)", "rgb(217, 234, 211)",
                "rgb(208, 224, 227)", "rgb(201, 218, 248)", "rgb(207, 226, 243)", "rgb(217, 210, 233)", "rgb(234, 209, 220)",
                "rgb(221, 126, 107)", "rgb(234, 153, 153)", "rgb(249, 203, 156)", "rgb(255, 229, 153)", "rgb(182, 215, 168)",
                "rgb(162, 196, 201)", "rgb(164, 194, 244)", "rgb(159, 197, 232)", "rgb(180, 167, 214)", "rgb(213, 166, 189)",
                "rgb(204, 65, 37)", "rgb(224, 102, 102)", "rgb(246, 178, 107)", "rgb(255, 217, 102)", "rgb(147, 196, 125)",
                "rgb(118, 165, 175)", "rgb(109, 158, 235)", "rgb(111, 168, 220)", "rgb(142, 124, 195)", "rgb(194, 123, 160)",
                "rgb(166, 28, 0)", "rgb(204, 0, 0)", "rgb(230, 145, 56)", "rgb(241, 194, 50)", "rgb(106, 168, 79)",
                "rgb(69, 129, 142)", "rgb(60, 120, 216)", "rgb(61, 133, 198)", "rgb(103, 78, 167)", "rgb(166, 77, 121)",
                "rgb(91, 15, 0)", "rgb(102, 0, 0)", "rgb(120, 63, 4)", "rgb(127, 96, 0)", "rgb(39, 78, 19)",
                "rgb(12, 52, 61)", "rgb(28, 69, 135)", "rgb(7, 55, 99)", "rgb(32, 18, 77)", "rgb(76, 17, 48)"]
            ]
        });
    }

    function SeleccionarTipoOferta() {
        var flagNueva = $("#ddlTipoEstrategia option:selected").attr("flag-nueva");
        var flagRecoProduc = $("#ddlTipoEstrategia option:selected").attr("flag-recoproduct");
        var flagRecoPerfil = $("#ddlTipoEstrategia option:selected").attr("flag-recoperfil");

        $("#ddlCampaniaFin").val("");
        $("#list").jqGrid('hideCol', ["NumeroPedido"]);
        if (flagNueva == "1") {
            $(".DatosNuevas").show();
            $(".OcultarNuevas").css({ visibility: "hidden" });
            $("#txtLimite").val("1");
            $("#list").jqGrid('showCol', ["NumeroPedido"]);
        } else {
            $(".DatosNuevas").hide();
            $(".OcultarNuevas").css({ visibility: "visible" });
            $("#txtLimite").val("99");
        }
        if (flagRecoProduc == "1" || flagRecoPerfil == "1") {
            $(".Recomendados").show();
            if (flagRecoProduc == "1") {
                $("#idEstrella").hide();
                $("#idColorFondo").show();
            }
            if (flagRecoPerfil == "1") {
                $("#idColorFondo").hide();
                $("#idEstrella").show();
                $("#idEstrella").attr("checked", false);
            }
        } else {
            $(".Recomendados").hide();
        }
    }

    function PedidoAsociadoChecks() {
        // $(".checksPedidosAsociados").html('');
        waitingDialog({});
        $.ajaxSetup({ cache: false });
        var codigoPrograma = $("#ddlTipoEstrategia option:selected").attr("Codigo-Programa");

        if (codigoPrograma == undefined) {
            codigoPrograma = '00';
        }
        $.ajax({
            type: 'GET',
            url: baseUrl + 'AdministrarEstrategia/ObtenerPedidoAsociado',
            data: "CodigoPrograma=" + codigoPrograma,
            async: true,
            dataType: 'Json',
            success: function (data) {
                if (data != null && data.pedidoAsociado.length > 0) {
                    var pedidoAsociados = data.pedidoAsociado[0].PedidoAsociado.split(',');
                    $.each(pedidoAsociados, function (x) {
                        var item = $(this)[0];
                        $(".checksPedidosAsociados")
                            .append('<div class="titB" style="width:9px;"><input type="checkbox" class="chkclass" id="PedidoAsociado_' + item + '" name="PedidoAsociado_' + item + '" value=' + item + ' >' + item + '</div>');
                    });
                }
                closeWaitingDialog();
            },
            error: function (x, xh, xhr) {
                if (checkTimeout(x)) {
                    closeWaitingDialog();
                }
            }
        });
    }

    function ActivarDesactivarChecks() {
        $(".activar-desactivar").each(function () {
            if (!$(this).attr("checked")) {
                $(this).parent().parent().find("input").each(function () {
                    $(this).val('');
                    $("#chkEstrella").attr('checked', false);
                    $(this).attr('disabled', true);
                });
                $(this).parent().parent().find("select").each(function () {
                    $(this).val('');
                    $(this).attr('disabled', true);
                });
                $(this).attr('disabled', false);
                PaletaColores();
            } else {
                $(this).parent().parent().find("input").each(function () {
                    $(this).val('');
                    $("#chkEstrella").attr('checked', false);
                    $(this).attr('disabled', false);
                });
                $(this).parent().parent().find("select").each(function () {
                    $(this).val('');
                    $(this).attr('disabled', false);
                });
                $(this).attr('disabled', false);
                PaletaColores();
            }
        });
    }

    function cargarArbol() {
        $("#arbolRegionZona").jstree({
            json_data: {
                ajax: {
                    url: urlCargarArbolRegionesZonas,
                    data: function (n) {
                        return { pais: $("#ddlPais").val(), region: 0, zona: 0 };
                    },
                    type: "GET",
                    error: function (XMLHttpRequest, textStatus, errorThrown) { },
                    success: function (data, textStatus, jqXHR) { },
                    complete: function () {
                        // $.jstree._reference($("#arbolRegionZona")).check_all();
                        $("#arbolRegionZona").jstree("set_theme", "apple", rutastylejstree);
                        closeWaitingDialog();
                    }
                }
            },
            "themes": {
                "theme": "apple",
                "dots": true,
                "icons": false
            },
            plugins: ["themes", "json_data", "ui", "checkbox"]
        });
    }

    function fnGrilla() {
        $("#list").jqGrid("GridUnload");
        var tipo = $('#ddlTipoEstrategia').find(':selected').data('id');
        var allRowsInGrid = [];
        var flag = true;
        jQuery("#list").jqGrid({
            url: baseUrl + "AdministrarEstrategia/Consultar",
            hidegrid: false,
            datatype: 'json',
            postData: ({
                CampaniaID: $("#ddlCampania").val(),
                TipoEstrategiaID: $("#ddlTipoEstrategia").val(),
                CUV: $("#CUV").val(),
                Consulta: $("#hdTipoConsulta").val(),
                Imagen: $("#ddlTieneImagen").val(),
                Activo: $("#ddlOfertaActiva").val()
            }),
            mtype: 'GET',
            contentType: "application/json; charset=utf-8",
            multiselect: (tipo == '4') ? true : false,
            //multiPageSelection: (tipo == '4') ? true : false,
            colNames: ['EstrategiaID', 'Orden', '#', 'Pedido Asociado', 'Precio', 'CUV2', 'Descripción', 'Limite Venta', 'Código SAP', 'Foto', ''],
            colModel: [
                { name: 'EstrategiaID', index: 'EstrategiaID', width: 20, editable: true, resizable: false, hidden: true },
                { name: 'Orden', index: 'Orden', width: 20, editable: true, resizable: false, hidden: false },
                { name: 'ID', index: 'ID', width: 20, editable: true, hidden: false },
                { name: 'NumeroPedido', index: 'NumeroPedido', width: 40, editable: true, hidden: false },
                { name: 'Precio2', index: 'Precio2', width: 70, editable: true, align: 'center', resizable: false },
                { name: 'CUV2', index: 'CUV2', width: 70, editable: true, resizable: false, sortable: false, align: 'center' },
                { name: 'DescripcionCUV2', index: 'DescripcionCUV2', width: 120, editable: true, resizable: false, hidden: false },
                { name: 'LimiteVenta', index: 'LimiteVenta', width: 40, align: 'center', editable: true, resizable: false },
                { name: 'CodigoProducto', index: 'CodigoProducto', width: 70, align: 'center', editable: true, resizable: false },
                { name: 'ImagenURL', index: 'ImagenURL', width: 70, align: 'center', editable: true, resizable: false, formatter: ShowImage },
                { name: 'Activo', index: 'Activo', width: 30, align: 'center', editable: true, resizable: false, formatter: ShowActions }
            ],
            jsonReader:
            {
                root: "rows",
                page: "page",
                total: "total",
                records: "records",
                repeatitems: true,
                cell: "cell",
                id: "id"
            },
            pager: jQuery('#pager'),
            loadtext: 'Cargando datos...',
            recordtext: "{0} - {1} de {2} Registros",
            emptyrecords: 'No hay resultados',
            rowNum: 10,
            scrollOffset: 0,
            rowList: [10, 20, 30, 40, 50],
            sortname: 'Orden',
            sortorder: 'asc',
            viewrecords: true,
            height: 'auto',
            width: 930,
            pgtext: 'Pág: {0} de {1}',
            altRows: true,
            altclass: 'jQGridAltRowClass',
            loadComplete: function (data) {
                if (data.rows.length > 0) {
                    for (var i = 0; i < data.rows.length; i++) {
                        if (data.rows[i].cell[10] == '1') {
                            $("#list").jqGrid('setSelection', data.rows[i].id, true);
                        }
                    }
                }
            }
            //gridComplete: function () { }
        });
        jQuery("#list").jqGrid('navGrid', "#pager", { edit: false, add: false, refresh: false, del: false, search: false });

        //jQuery("#list").setGridParam({ datatype: 'json', page: 1 }).trigger('reloadGrid');
        // allRowsInGrid = $('#list').getGridParam('data');
        if (tipo == '4') { $("#list").jqGrid('hideCol', ["Orden"]); }
    }

    function fnGrillaTC() {
        $("#listTC").jqGrid("GridUnload");
        jQuery("#listTC").jqGrid({
            url: baseUrl + "AdministrarEstrategia/ConsultarTallaColor",
            hidegrid: false,
            datatype: 'json',
            postData: ({
                CampaniaID: $("#ddlCampania").val(),
                CUV: $("#txtCUV2").val()
            }),
            mtype: 'GET',
            contentType: "application/json; charset=utf-8",
            colNames: ['ID', 'CUV', 'Descripción', 'Precio', 'Tipo', 'Talla/Color', 'Desc T/C', '', ''],
            colModel: [
                { name: 'ID', index: 'ID', width: 0, editable: true, resizable: false, hidden: true },
                { name: 'CUV', index: 'CUV', width: 20, editable: true, resizable: false, hidden: false },
                { name: 'DescripcionCUV', index: 'DescripcionCUV', width: 110, editable: true, resizable: false, hidden: false },
                { name: 'PrecioUnitario', index: 'PrecioUnitario', width: 30, editable: true, resizable: false, hidden: false },
                { name: 'Tipo', index: 'Tipo', width: 0, editable: true, resizable: false, hidden: true },
                { name: 'DescripcionTipo', index: 'DescripcionTipo', width: 50, editable: true, resizable: false, hidden: false },
                { name: 'DescripcionTallaColor', index: 'DescripcionTallaColor', width: 90, editable: true, resizable: false, hidden: false },
                { name: 'Accion', index: 'Accion', width: 30, editable: true, resizable: false, hidden: false, align: "center", formatter: ShowActionsTC },
                { name: 'IDAux', index: 'IDAux', width: 0, editable: true, resizable: false, hidden: true }
            ],
            jsonReader:
            {
                root: "rows",
                page: "page",
                total: "total",
                records: "records",
                repeatitems: true,
                cell: "cell",
                id: "id"
            },
            pager: jQuery('#pagerTC'),
            loadtext: 'Cargando datos...',
            recordtext: "{0} - {1} de {2} Registros",
            emptyrecords: 'No hay resultados',
            rowNum: 10,
            scrollOffset: 0,
            rowList: [],
            sortname: 'ID',
            sortorder: 'asc',
            viewrecords: true,
            multiselect: false,
            height: 'auto',
            width: 650,
            pgtext: 'Pág: {0} de {1}',
            altRows: true,
            altclass: 'jQGridAltRowClass',
            loadComplete: function () { },
            gridComplete: function () {
                showDialog("DialogTonoMarca");
            }
        });
        jQuery("#listTC").jqGrid('navGrid', "#pagerTC", { edit: false, add: false, refresh: false, del: false, search: false });
        jQuery("#listTC").setGridParam({ datatype: 'json', page: 1 }).trigger('reloadGrid');
    }

    function ShowInputTC(cellvalue, options, rowObject) {
        var Des = "";
        Des += "<input type='text' value='" + cellvalue + "' style='width:160px' />";
        return Des;
    }

    function ShowActionsTC(cellvalue, options, rowObject) {
        var cellValueInt = parseInt(rowObject[0]);
        var Des = "<a href='javascript:;' onclick=\"return EditarTalla('" + rowObject[0] + "');\" >" + "<img src='" + rutaImagenEdit + "' alt='Editar Talla/Color' title='Editar Talla/Color' border='0' /></a>";
        if ($.trim(rowObject[1]) != $.trim($("#txtCUV2").val())) {
            Des += "<a href='javascript:;' onclick=\"return Eliminar('" + rowObject[0] + "');\" >" + "<img src='" + rutaImagenDelete + "' alt='Quitar Talla/Color' title='Quitar Talla/Color' border='0' /></a>";
        }
        return Des;
    }

    function EditarTalla(id) {
        $("#hdTallaColorID").val(id);
        $('#txtCUVTC').val(jQuery("#listTC").jqGrid('getCell', id, 'CUV'));
        $('#txtDescripcionCUVTC').val(jQuery("#listTC").jqGrid('getCell', id, 'DescripcionCUV'));
        $('#txtPrecioCUVTC').val(jQuery("#listTC").jqGrid('getCell', id, 'PrecioUnitario'));
        $('#ddlTallaColor').val(jQuery("#listTC").jqGrid('getCell', id, 'Tipo'));
        $('#txtDescripcionTC').val(jQuery("#listTC").jqGrid('getCell', id, 'DescripcionTallaColor'));
        $('#txtCUVTC').attr("readonly", true);
        showDialog("DialogEditarTallaColor");
        return false;
    }

    function Eliminar(id) {
        var elimina = confirm('¿ Está seguro que desea eliminar el registro seleccionado?');
        if (!elimina)
            return false;

        var params = {
            Id: id
        };

        jQuery.ajax({
            type: 'POST',
            url: baseUrl + 'AdministrarEstrategia/EliminarTallaColor',
            dataType: 'json',
            contentType: 'application/json; charset=utf-8',
            data: JSON.stringify(params),
            async: true,
            success: function (data) {
                alert(data.message);
                fnGrillaTC();
            },
            error: function (data, error) {
                alert(data.message);
            }
        });
    }

    function ShowActions(cellvalue, options, rowObject) {
        var cellValueInt = parseInt(cellvalue);
        var Des = "&nbsp;<a href='javascript:;' onclick=\"return jQuery('#list').Editar('" + rowObject[0] + "',event);\" >" + "<img src='" + rutaImagenEdit + "' alt='Editar Estrategia' title='Editar Estrategia' border='0' /></a>";
        if (cellValueInt == "1") {
            Des += "&nbsp;&nbsp;<a href='javascript:;' onclick=\"return jQuery('#list').Eliminar('" + rowObject[0] + "',event);\" >" + "<img src='" + rutaImagenDelete + "' alt='Deshabilitar Estrategia' title='Deshabilitar Estrategia' border='0' /></a>";
        }
        return Des;
    }

    function ShowImage(cellvalue, options, rowObject) {
        var image = "";
        if (cellvalue != "") image = '<img src="' + cellvalue + '" alt="" width="60px" height="60px" title="" border="0" />';
        else image = '<img src="' + rutaImagenVacia + '" alt="" width="60px" height="60px" title="" border="0" />';
        return image;
    }

    function ShowActionsVer1(cellvalue, options, rowObject) {
        var text = "";

        var cantidad = rowObject[2];
        var tipo = rowObject[3];

        if (tipo == "2")
            cantidadPrecargar = parseInt(cantidad);

        if (cantidad != "0")
            text = rowObject[2] + " <a href='javascript:;' onclick=VerCuvsTipo('" + tipo + "')>ver</a>";
        else
            text = rowObject[2];

        return text;
    }

    function ShowActionsVer2(cellvalue, options, rowObject) {
        var text = "";

        var cantidad = rowObject[2];
        var tipo = rowObject[3];

        if (tipo == "1") {
            cantidadPrecargar2 = parseInt(cantidad);
            $("#spnCantidadConfigurar3").html(parseInt(cantidad));
        }
        if (tipo == '2')
            $("#spnCantidadNoConfigurar3").html(parseInt(cantidad));

        if (cantidad != "0")
            text = rowObject[2] + " <a href='javascript:;' onclick=VerCuvsTipo2('" + tipo + "')>ver</a>";
        else
            text = rowObject[2];

        return text;
    }

    function VerCuvsTipo(tipo) {
        fnGrillaCuv1(tipo);
    }

    function fnGrillaCuv1(tipo) {
        $("#listGrillaCuv1").jqGrid("clearGridData");

        var parametros = {
            campaniaId: parseInt($("#ddlCampania").val()),
            tipoConfigurado: parseInt(tipo)
        };

        $('#listGrillaCuv1').setGridParam({ postData: parametros });

        jQuery("#listGrillaCuv1").jqGrid({
            url: urlConsultarCuvTipoConfigurado,
            hidegrid: false,
            datatype: 'json',
            postData: (parametros),
            mtype: 'GET',
            contentType: "application/json; charset=utf-8",
            colNames: ['CUV', 'Descripción'],
            colModel: [
                { name: 'CUV2', index: 'CUV', width: 10, editable: true, resizable: false },
                { name: 'DescripcionCUV2', index: 'DescripcionCUV2', width: 90, editable: true, resizable: false },
            ],
            jsonReader:
            {
                root: "rows",
                page: "page",
                total: "total",
                records: "records",
                repeatitems: true,
                cell: "cell",
                id: "id"
            },
            pager: jQuery('#pagerGrillaCuv1'),
            loadtext: 'Cargando datos...',
            recordtext: "{0} - {1} de {2} Registros",
            emptyrecords: 'No hay resultados',
            rowNum: 10,
            scrollOffset: 0,
            rowList: [10, 20, 30, 40, 50],
            sortname: 'Nombre',
            sortorder: 'asc',
            viewrecords: true,
            multiselect: false,
            height: 'auto',
            width: 540,
            pgtext: 'Pág: {0} de {1}',
            altRows: true,
            altclass: 'jQGridAltRowClass',
            loadComplete: function () {
            },
            gridComplete: function () {
                showDialog("DialogGrillaCuv1");
            }
        });
        jQuery("#listGrillaCuv1").jqGrid('navGrid', "#pagerGrillaCuv1", { edit: false, add: false, refresh: false, del: false, search: false });
        jQuery("#listGrillaCuv1").setGridParam({ datatype: 'json', page: 1 }).trigger('reloadGrid');
    }

    function VerCuvsTipo2(tipo) {
        fnGrillaCuv2(tipo);
    }

    function fnGrillaCuv2(tipo) {
        $("#listGrillaCuv2").jqGrid("clearGridData");

        var parametros = {
            campaniaId: parseInt($("#ddlCampania").val()),
            tipoConfigurado: parseInt(tipo)
        };

        $('#listGrillaCuv2').setGridParam({ postData: parametros });

        jQuery("#listGrillaCuv2").jqGrid({
            url: urlConsultarCuvTipoConfiguradoTemporal,
            hidegrid: false,
            datatype: 'json',
            postData: (parametros),
            mtype: 'GET',
            contentType: "application/json; charset=utf-8",
            colNames: ['CUV', 'Descripción'],
            colModel: [
                { name: 'CUV2', index: 'CUV', width: 10, editable: true, resizable: false },
                { name: 'DescripcionCUV2', index: 'DescripcionCUV2', width: 90, editable: true, resizable: false },
            ],
            jsonReader:
            {
                root: "rows",
                page: "page",
                total: "total",
                records: "records",
                repeatitems: true,
                cell: "cell",
                id: "id"
            },
            pager: jQuery('#pagerGrillaCuv2'),
            loadtext: 'Cargando datos...',
            recordtext: "{0} - {1} de {2} Registros",
            emptyrecords: 'No hay resultados',
            rowNum: 10,
            scrollOffset: 0,
            rowList: [10, 20, 30, 40, 50],
            sortname: 'Nombre',
            sortorder: 'asc',
            viewrecords: true,
            multiselect: false,
            height: 'auto',
            width: 540,
            pgtext: 'Pág: {0} de {1}',
            altRows: true,
            altclass: 'jQGridAltRowClass',
            loadComplete: function () {
            },
            gridComplete: function () {
                showDialog("DialogGrillaCuv2");
            }
        });
        jQuery("#listGrillaCuv2").jqGrid('navGrid', "#pagerGrillaCuv2", { edit: false, add: false, refresh: false, del: false, search: false });
        jQuery("#listGrillaCuv2").setGridParam({ datatype: 'json', page: 1 }).trigger('reloadGrid');
    }

    function IniDialog() {


        $('#DialogAdministracionEstrategia').dialog({
            autoOpen: false,
            resizable: false,
            modal: true,
            closeOnEscape: true,
            width: 830,
            close: function () {
                //$('input:checkbox').removeAttr('checked');               
                //$(this).dialog('destroy');
                //$("#list").jqGrid("clearGridData", true).trigger("reloadGrid");
            },
            //open: function (event, ui) {
            //    originalContent = $("#DialogAdministracionEstrategia").html();
            //},
            draggable: false,
            title: "Registro de Estrategias",
            buttons:
            {
                "Guardar": function () {
                    //if (!$("#chkVisible2").attr("checked")) {
                    //    $('#mensajeErrorCUV').val('');
                    //}

                    if ($('#mensajeErrorCUV').val() != "") {
                        alert($('#mensajeErrorCUV').val());
                        return false;
                    }
                    if ($('#mensajeErrorCUV2').val() != "") {
                        alert($('#mensajeErrorCUV2').val());
                        return false;
                    }

                    if ($(".DatosNuevas").css("display") == "block") {
                        if ($("#ddlCampaniaFin").val() == "") {
                            alert("Seleccione la campaña de vigencia hasta.");
                            return false;
                        }
                        var campaniaIni = $("#spanCampania").val();
                        var campaniaFin = $("#ddlCampaniaFin").val();
                        if (parseInt(campaniaFin) < parseInt(campaniaIni)) {
                            alert("La campaña de vigencia final  no puede ser menor a la campaña de inicio.");
                            return false;
                        }
                    }

                    /**** // PL20-1225 ****/
                    var auxOD = $('#ddlTipoEstrategia').find(':selected').data('id');
                    if (auxOD == "7") {
                        var desc1 = $("#txtDescripcion").val();
                        if ($.trim(desc1) == "") {
                            alert("Ingrese una descripción.");
                            return false;
                        }
                        else {
                            if (desc1.indexOf('|') < 0) {
                                alert("La descripcion debe contener dos pipes (|) como minimo.");
                                return false;
                            }
                            else {
                                var arr1 = desc1.split('|');
                                if (arr1.length <= 2) {
                                    alert("La descripcion debe contener dos pipes (|) como minimo.");
                                    return false;
                                }
                                for (var i = 0; i < arr1.length; i++) {
                                    if ($.trim(arr1[i]) == "") {
                                        alert("La descripcion despues de un pipe (|) no puede ser vacia.");
                                        return false;
                                    }
                                }
                            }
                        }
                    }
                    /****/


                    var valor = $("#txtDescripcion").val();
                    if ($.trim(valor) == "") {
                        alert("Ingrese el valor del CUV2 para obtener la descripción o ingrese una.");
                        return false;
                    }

                    //if ($("#chkVisible2").attr("checked")) {
                    var m = "";
                    //if ($.trim($("#txtCUV").val()) == "" && $("#txtCUV").css("visibility") == "visible") { NO ES OBLIGATORIO
                    //    m += "- Ingrese un valor para el CUV1." + "\n";
                    //}
                    //if ($.trim($("#ddlEtiqueta1 option:selected").html()) == "-- Seleccionar --") {
                    //    m += "- Seleccione la etiqueta correspondiente." + "\n";
                    //}
                    if (($.trim($("#txtCUV").val()) != "" && $.trim($("#txtPrecio").val()) == "") || ($.trim($("#txtCUV").val()) != "" && $.isNumeric($("#txtPrecio").val()) == false)) {
                        m += "- Digite un valor correspondiente para el precio." + "\n";
                    }
                    if ($.trim($("#txtCUV").val()) != "" && $("#txtPrecio").val() <= 0) {
                        m += "- Ingrese un valor para el precio mayor a cero." + "\n";
                    }
                    //if (m != "") {
                    //    alert(m);
                    //    return false;
                    //}
                    // }
                    //if ($("#chkVisible3").attr("checked")) {
                    //   var m = "";
                    if ($.trim($("#txtCUV2").val()) == "") {
                        m += "- Ingrese un valor para el CUV2." + "\n";
                    }
                    //if ($.trim($("#ddlEtiqueta2 option:selected").html()) == "-- Seleccionar --") {
                    //    m += "- Seleccione la etiqueta correspondiente." + "\n";
                    //}
                    if ($.trim($("#txtPrecio2").val()) == "" || $.isNumeric($("#txtPrecio2").val()) == false) {
                        m += "- Digite un valor correspondiente para el precio." + "\n";
                    }
                    if ($("#txtPrecio2").val() <= 0) {
                        m += "- Ingrese un valor para el precio mayor a cero." + "\n";
                    }
                    if (m != "") {
                        alert(m);
                        return false;
                    }

                    if ($("#idEstrella").css("display") == "block") {
                        if (!$("#chkEstrella").attr("checked")) {
                            alert("Debe activar el la opción para mostrar estrella en la zona de producto.  ");
                            return false;
                        }
                    }

                    if ($('.chk-estrategia-imagen:checked').length == 0) {
                        alert("Seleccione una imagen a mostrar.");
                        return false;
                    }

                    /* SB20-312 - INICIO */
                    var aux2 = $('#ddlTipoEstrategia').find(':selected').data('id');
                    if (aux2 != "4" && aux2 != '7') { /**** PL20-1225 *****/
                        if ($.trim($("#txtOrden").val()) == "" || $.isNumeric($("#txtOrden").val()) == false) {
                            alert("Ingrese un orden para mostrar.");
                            return false;
                        }
                        if ($("#txtOrden").val() <= 0) {
                            alert("Ingrese un valor para el orden a mostrar mayor a cero.");
                            return false;
                        }
                    }
                    /* SB20-312 - FIN */
                    if ($("#hdZonas").val() == "") {
                        alert("Debe seleccionar el alcance de la estrategia.");
                        return false;
                    }
                    if ($.trim($("#txtLimite").val()) == "" || $.isNumeric($("#txtLimite").val()) == false) {
                        alert("Ingrese un valor para el limite de venta.");
                        return false;
                    }
                    if ($("#txtLimite").val() <= 0) {
                        alert("Ingrese un valor para el limite de venta mayor a cero.");
                        return false;
                    }
                    var imagenEstrategiaProducto = $("#imgSeleccionada").attr("src");
                    var EstrategiaID = $("#hdEstrategiaID").val();
                    var TipoEstrategiaID = $("#hdTipoEstrategiaID").val();
                    var CampaniaID = $("#hdCampania").val();
                    var CampaniaIDFin = $("#ddlCampaniaFin").val();
                    var Activo = ($("#chkHabilitarOferta").attr("checked")) ? "1" : "0";
                    var ImagenURL = imagenEstrategiaProducto.substr(imagenEstrategiaProducto.lastIndexOf("/") + 1);
                    var LimiteVenta = $("#txtLimite").val();
                    var DescripcionCUV2 = $("#txtDescripcion").val();
                    var FlagDescripcion = (DescripcionCUV2 != "") ? "1" : "0"; //($("#chkVisible1").attr("checked")) ? "1" : "0";
                    var CUV = $("#txtCUV").val();
                    var EtiquetaID = $("#hdnEtiqueta1").val(); //$("#ddlEtiqueta1").val();
                    var Precio = $("#txtPrecio").val();
                    var FlagCEP = (CUV != "") ? "1" : "0"; //($("#chkVisible2").attr("checked")) ? "1" : "0";
                    var CUV2 = $("#txtCUV2").val();
                    var EtiquetaID2 = $("#hdnEtiqueta2").val();//$("#ddlEtiqueta2").val();
                    var Precio2 = $("#txtPrecio2").val();
                    var FlagCEP2 = (CUV2 != "") ? "1" : "0"; //($("#chkVisible3").attr("checked")) ? "1" : "0";
                    var TextoLibre = $("#txtTextoLibre").val();
                    var FlagTextoLibre = (TextoLibre != "") ? "1" : "0"; //($("#chkVisible4").attr("checked")) ? "1" : "0";
                    var Cantidad = "";//$("#txtCantidad").val();
                    var FlagCantidad = "0"; //($("#chkVisible5").attr("checked")) ? "1" : "0";
                    var Zona = $("#hdZonas").val();
                    var Orden = $("#txtOrden").val();
                    var flagEstrella = ($("#chkOfertaUltimoMinuto").attr("checked")) ? "1" : "0";
                    var colorFondo = $("#hdColorFondo").val();

                    var NumeroPedidoAsociado = $(".checksPedidosAsociados input:checked").map(function () {
                        return $(this).val();
                    }).get().join(",");

                    if (NumeroPedidoAsociado == "" && $("#txtPedidoAsociado").length) {
                        NumeroPedidoAsociado = $("#txtPedidoAsociado").val();
                    }
                    var params = {
                        EstrategiaID: EstrategiaID,
                        TipoEstrategiaID: TipoEstrategiaID,
                        CampaniaID: CampaniaID,
                        CampaniaIDFin: CampaniaIDFin,
                        NumeroPedido: NumeroPedidoAsociado,
                        Activo: Activo,
                        ImagenURL: ImagenURL,
                        LimiteVenta: LimiteVenta,
                        DescripcionCUV2: DescripcionCUV2,
                        FlagDescripcion: FlagDescripcion,
                        CUV: CUV,
                        EtiquetaID: EtiquetaID,
                        Precio: Precio,
                        FlagCEP: FlagCEP,
                        CUV2: CUV2,
                        EtiquetaID2: EtiquetaID2,
                        Precio2: Precio2,
                        FlagCEP2: FlagCEP2,
                        TextoLibre: TextoLibre,
                        FlagTextoLibre: FlagTextoLibre,
                        Cantidad: Cantidad,
                        FlagCantidad: FlagCantidad,
                        Zona: Zona,
                        Orden: Orden,
                        ColorFondo: colorFondo,
                        FlagEstrella: flagEstrella,
                        CodigoTipoEstrategia: $('#ddlTipoEstrategia option:selected').attr('data-codigo')
                    };
                    jQuery.ajax({
                        type: 'POST',
                        url: baseUrl + 'AdministrarEstrategia/RegistrarEstrategia',
                        dataType: 'json',
                        contentType: 'application/json; charset=utf-8',
                        data: JSON.stringify(params),
                        async: true,
                        success: function (data) {

                            if (data.success) {
                                alert(data.message);
                                $("#ddlTipoEstrategia").val($("#hdEstrategiaIDConsulta").val());
                                HideDialog("DialogAdministracionEstrategia");
                                //fnGrilla(); Observación.
                                $("#list").jqGrid("clearGridData", true).trigger("reloadGrid");
                            } else {
                                alert(data.message);
                            }
                        },
                        error: function (data, error) {
                            alert(data.message);
                        }
                    });

                },
                "Salir": function () {
                    $("#ddlTipoEstrategia").val($("#hdEstrategiaIDConsulta").val());
                    //$('input:checkbox').removeAttr('checked');
                    $(this).dialog('close');
                }
            }
        });

        $('#DialogZona').dialog({
            autoOpen: false,
            resizable: false,
            modal: true,
            closeOnEscape: true,
            width: 500,
            draggable: false,
            title: "Seleccione el alcance de la estrategia",
            buttons:
            {
                "Guardar": function () {
                    var zonas = "";
                    $.jstree._reference($("#arbolRegionZona")).get_checked(null, true).each(function () {
                        if (this.className.toLowerCase().indexOf("jstree-leaf") == -1) {
                            return true;
                        }
                        zonas += this.id + ",";
                    });
                    if (zonas != "") {
                        zonas = zonas.substring(0, zonas.length - 1);
                    }
                    if (zonas == "") {
                        alert("No se ha marcado ninguna zona o región.");
                        return false;
                    }
                    $("#hdZonas").val(zonas);
                    alert("Se agregaron las zonas seleccionadas.");
                    $(this).dialog('close');
                },
                "Salir": function () {
                    $(this).dialog('close');
                }
            }
        });


        $('#divVistaPrevia').dialog({
            autoOpen: false,
            resizable: false,
            modal: true,
            closeOnEscape: true,
            width: 250,
            draggable: false,
            title: "Vista previa",
            buttons:
            {
                "Cerrar": function () {
                    $(this).dialog('close');
                }
            }
        });

        $('#DialogTonoMarca').dialog({
            autoOpen: false,
            resizable: false,
            modal: true,
            closeOnEscape: false,
            width: 700,
            draggable: false,
            title: "Seleccionar Talla/Color",
            open: function (event, ui) { $(".ui-dialog-titlebar-close", ui.dialog).hide(); },
            buttons:
            {
                "Nueva Talla/Color": function () {
                    $("#hdTallaColorID").val("0");
                    $("#ddlTallaColor").val("0");
                    $("#txtDescripcionTC").val("");
                    $("#txtCUVTC").val("");
                    $("#txtDescripcionCUVTC").val("");
                    $("#txtPrecioCUVTC").val("");
                    $('#txtCUVTC').attr("readonly", false);
                    showDialog("DialogEditarTallaColor");
                },
                "Salir": CerrarTallaColor
            }
        });

        $('#DialogEditarTallaColor').dialog({
            autoOpen: false,
            resizable: false,
            modal: true,
            closeOnEscape: true,
            width: 550,
            draggable: false,
            title: "Registro Talla/Color",
            buttons:
            {
                "Guardar": function () {
                    var msj = "";

                    if ($("#txtCUVTC").val() == "") {
                        msj += "- Ingrese un CUV." + "\n";
                    }

                    if ($("#ddlTallaColor").val() == "0") {
                        msj += "- Seleccione el tipo (Talla/Color)." + "\n";
                    }

                    if ($("#txtDescripcionTC").val() == "") {
                        msj += "- Ingrese descripción (Talla/Color)." + "\n";
                    }

                    if (msj != "") {
                        alert(msj);
                        return false;
                    }

                    var id = $("#hdTallaColorID").val();
                    var cuv = $("#txtCUVTC").val();
                    var campaniaID = $("#ddlCampania").val();
                    var tipo = $("#ddlTallaColor").val();
                    var descripcion = $("#txtDescripcionTC").val();
                    var CUVPadre = $("#txtCUV2").val();
                    var xmlString = '<params>';

                    xmlString += '<param ';
                    xmlString += ' ID = "' + id + '"';
                    xmlString += ' CampaniaID = "' + campaniaID + '"';
                    xmlString += ' CUV = "' + cuv + '"';
                    xmlString += ' Tipo = "' + tipo + '"';
                    xmlString += ' Descripcion = "' + descripcion + '"';
                    xmlString += ' CUVPadre = "' + CUVPadre + '"';
                    xmlString += ' />';
                    xmlString += '</params>';

                    var params = {
                        xmlTallaColor: xmlString
                    };

                    jQuery.ajax({
                        type: 'POST',
                        url: baseUrl + 'AdministrarEstrategia/RegistrarTallaColor',
                        dataType: 'json',
                        contentType: 'application/json; charset=utf-8',
                        data: JSON.stringify(params),
                        async: true,
                        success: function (data) {
                            if (data.success) {
                                alert(data.message);
                                fnGrillaTC();
                                HideDialog("DialogEditarTallaColor");
                            } else {
                                alert(data.message);
                            }
                        },
                        error: function (data, error) {
                            alert(data.message);
                        }
                    });
                },
                "Salir": function () {
                    $(this).dialog('close');
                }
            }
        });

        $('#DialogNuevoMasivo').dialog({
            autoOpen: false,
            resizable: false,
            modal: true,
            closeOnEscape: true,
            width: 600,
            draggable: false,
            title: "Carga Masiva de Estrategias"
        });

        $('#DialogGrillaCuv1').dialog({
            autoOpen: false,
            resizable: false,
            modal: true,
            closeOnEscape: true,
            width: 600,
            draggable: false,
            title: "Carga Masiva de Estrategias",
            buttons:
            {
                "Salir": function () {
                    $(this).dialog('close');
                }
            }
        });

        $('#DialogGrillaCuv2').dialog({
            autoOpen: false,
            resizable: false,
            modal: true,
            closeOnEscape: true,
            width: 600,
            draggable: false,
            title: "Carga Masiva de Estrategias",
            buttons:
            {
                "Salir": function () {
                    $(this).dialog('close');
                }
            }
        });
    }

    $.jgrid.extend({
        Editar: function (id, event) {
            event.preventDefault();
            event.stopPropagation();
            if (id) {
                waitingDialog({});

                $("#hdEstrategiaID").val(id);
                $("#hdnCodigoSAP").val("")
                $('#mensajeErrorCUV').val("")
                $('#mensajeErrorCUV2').val("");
                $(".checksPedidosAsociados").html('');

                var params = {
                    EstrategiaID: $("#hdEstrategiaID").val()
                };
                $('#ContenidoImagenes').empty();
                jQuery.ajax({
                    type: 'POST',
                    url: urlFiltrarEstrategia,
                    dataType: 'json',
                    contentType: 'application/json; charset=utf-8',
                    data: JSON.stringify(params),
                    async: true,
                    success: function (data) {

                        if (data.success == false) {
                            alert(data.message);
                            closeWaitingDialog();
                            return false;
                        }

                        var dataImagen, imgFormat;
                        $("#hdSimbolo").val(data.Simbolo);

                        if (data.Activo == "1") $("#chkHabilitarOferta").attr("checked", true);
                        else $("#chkHabilitarOferta").attr("checked", false);

                        if (data.FlagDescripcion == "1") $("#chkVisible1").attr("checked", true);
                        else $("#chkVisible1").attr("checked", false);

                        if (data.FlagCEP == "1") $("#chkVisible2").attr("checked", true);
                        else $("#chkVisible2").attr("checked", false);

                        if (data.FlagCEP2 == "1") $("#chkVisible3").attr("checked", true);
                        else $("#chkVisible3").attr("checked", false);

                        if (data.FlagTextoLibre == "1") $("#chkVisible4").attr("checked", true);
                        else $("#chkVisible4").attr("checked", false);

                        if (data.FlagCantidad == "1") $("#chkVisible5").attr("checked", true);
                        else $("#chkVisible5").attr("checked", false);

                        if (data.ColorFondo != "") $("#hdColorFondo").val(data.ColorFondo);
                        else $("#hdColorFondo").val("#FFF");
                        ActivarDesactivarChecks();

                        $("#hdCampania").val($("#ddlCampania").val());
                        $("#hdTipoEstrategiaID").val(data.TipoEstrategiaID);
                        $("#ddlTipoEstrategia").val(data.TipoEstrategiaID);                       
                        $("#hdnCodigoSAP").val(data.CodigoSAP);
                        SeleccionarTipoOferta();

                        $("#txtAlcance").val($("#ddlPais option:selected").html());
                        $("#spanCampania").val($("#ddlCampania option:selected").html());
                        $("#spanTipoEstrategia").val($("#ddlTipoEstrategia option:selected").html().trim());
                        $("#hdEstrategiaID").val(data.EstrategiaID);
                        $("#hdTipoEstrategiaID").val(data.TipoEstrategiaID);
                        $("#hdCampania").val(data.CampaniaID);
                        $("#ddlCampaniaFin").val(data.CampaniaIDFin);
                        $("#hdNumeroPedido").val(data.NumeroPedido);
                        $("#imgSeleccionada").attr('src', rutaImagenVacia);

                        var objPreview, objChkImagen, idImagen, dataImagen, imgFormat;
                        var imagenesProductos = [];

                        var i = 1;

                        for (var i = 1; i <= nroImagenes; i++) {

                            idImagen = ('0' + i).substr(-2);
                            dataImagen = data['FotoProducto' + idImagen];

                            if (dataImagen != '') {

                                if (dataImagen.substr(dataImagen.lastIndexOf("/") + 1) == data['ImagenURL']) {
                                    $("#imgSeleccionada").attr('src', dataImagen);
                                    $("#imgSeleccionada").attr('data-id', idImagen);
                                }

                                var imagen = {
                                    "idImagen": idImagen,
                                    "dataImagen": dataImagen,
                                    "fotoProducto": dataImagen.substr(dataImagen.lastIndexOf("/") + 1),
                                    "fotoProductoAnterior": dataImagen.substr(dataImagen.lastIndexOf("/") + 1),
                                    "selected": dataImagen.substr(dataImagen.lastIndexOf("/") + 1) == data['ImagenURL'] ? true : false
                                }
                                imagenesProductos.push(imagen);
                            }
                        }
                        (imagenesProductos.length == 10) ? $("#fpUpload").hide() : $("#fpUpload").show();
                        $('#ImagenCUV-template').tmpl(imagenesProductos).appendTo("#ContenidoImagenes");

                        $("#divImagenEstrategiaContenido").show();
                        $("#divInformacionAdicionalEstrategiaContenido").hide();

                        $("#divImagenEstrategia").css("color", "white");
                        $("#divImagenEstrategia").css("background", "#00A2E8");
                        $("#divInformacionAdicionalEstrategia").css("color", "#702789");
                        $("#divInformacionAdicionalEstrategia").css("background", "#D0D0D0");

                        $("#txtLimite").val(data.LimiteVenta);
                        $("#txtDescripcion").val(data.DescripcionCUV2);
                        $("#txtCUV").val(data.CUV1);
                        $("#ddlEtiqueta1").val(data.EtiquetaID);
                        if (data.Precio != "0") {
                            $("#txtPrecio").val(parseFloat(data.Precio).toFixed(2));
                        } else {
                            $("#txtPrecio").val('');
                        }
                        $("#txtCUV2").val(data.CUV2);
                        $("#ddlEtiqueta2").val(data.EtiquetaID2);
                        if (data.Precio2 != "0") {
                            $("#txtPrecio2").val(parseFloat(data.Precio2).toFixed(2));
                        } else {
                            $("#txtPrecio2").val('');
                        }
                        $("#txtTextoLibre").val(data.TextoLibre);
                        $("#txtCantidad").val(data.Cantidad);
                        $("#hdZonas").val(data.Zona);

                        var strZonas = $("#hdZonas").val();
                        if (strZonas != "") {
                            $.jstree._reference($("#arbolRegionZona")).uncheck_all();
                            var strZonasArreglo = strZonas.split(",");
                            for (i = 0; i < strZonasArreglo.length; i++) {
                                $("#arbolRegionZona").jstree("check_node", "#" + strZonasArreglo[i], true);
                            }
                        } else {
                            $.jstree._reference($("#arbolRegionZona")).uncheck_all();
                            $("#chkSeleccionar").attr("checked", false);
                        }

                        var aux1 = $('#ddlTipoEstrategia').find(':selected').data('id');
                        /* SB20-312 - INICIO */
                        if (aux1 == "4") {
                            $("#txtOrden").val("");
                            $('#div-orden').hide();

                            $('#txt1-estrella').html('Oferta de Último Minuto');
                            $('#txt2-estrella').hide();
                        }
                        else {
                            $("#txtOrden").val(data.Orden);
                            $('#div-orden').show();

                            $('#txt1-estrella').html('Mostrar estrella');
                            $('#txt2-estrella').show();
                        }

                        if (aux1 == "4" || aux1 == "5") {
                            $("#ddlEtiqueta1").children('option').hide();
                            $("#ddlEtiqueta1").children("option[data-id='1']").show();

                            $("#ddlEtiqueta2").children('option').hide();
                            $("#ddlEtiqueta2").children("option[data-id='3']").show();
                        }
                        else {
                            $("#ddlEtiqueta1").children('option').show();
                            $("#ddlEtiqueta2").children('option').show();
                        }

                        if (aux1 == "6") {
                            $('.OfertaUltimoMinuto').hide();
                        } else { $('.OfertaUltimoMinuto').show(); }

                        if (aux1 == "7") {
                            $('.Recomendados').hide();

                            $("#ddlEtiqueta1").children('option').hide();
                            $("#ddlEtiqueta1").children("option[data-id='1']").show();

                            $("#ddlEtiqueta2").children('option').hide();
                            $("#ddlEtiqueta2").children("option[data-id='5']").show();

                            $('#div-orden').hide(); //Ocultando Orden

                            //$('#txtLimite').prop('readonly', true); //Modo lectura on
                        }

                        /* SB20-312 - FIN */
                        if (data.FlagEstrella == "1") $("#chkOfertaUltimoMinuto").attr("checked", true);
                        else $("#chkEstrella").attr("checked", false);
                        $(".checksPedidosAsociados").append('<div class="selectP2 borde_redondeado"><input type="text" id="txtPedidoAsociado" value="' + data.NumeroPedido + '" readonly /></div>');
                        closeWaitingDialog();
                        showDialog("DialogAdministracionEstrategia");
                    },
                    error: function (data, error) {
                        alert(data.message);
                        closeWaitingDialog();
                    }
                });
            }

            return false;
        },
        Eliminar: function (id, event) {
            event.preventDefault();
            event.stopPropagation();

            var elimina = confirm('¿ Está seguro que desea deshabiltar la estrategia seleccionada?');
            if (!elimina)
                return false;

            if (id) {
                waitingDialog({});

                $("#hdEstrategiaID").val(id);

                var params = {
                    EstrategiaID: $("#hdEstrategiaID").val()
                };

                jQuery.ajax({
                    type: 'POST',
                    url: urlDeshabilitarEstrategia,
                    dataType: 'json',
                    contentType: 'application/json; charset=utf-8',
                    data: JSON.stringify(params),
                    async: true,
                    success: function (data) {
                        alert(data.message);
                        fnGrilla();
                        closeWaitingDialog();
                    },
                    error: function (data, error) {
                        alert(data.message);
                        closeWaitingDialog();
                    }
                });
            }
            return false;
        }
    });

</script>