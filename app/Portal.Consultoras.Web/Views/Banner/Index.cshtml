@using Portal.Consultoras.Common
@model Portal.Consultoras.Web.Models.BannerModel
@{
    Layout = "~/Views/Shared/_SACLayout.cshtml";
    ViewBag.Title = "Gestión de Banners";
}
<script src="@Url.Content("~/Scripts/fileuploader.js")" type="text/javascript"></script>
<script type="text/javascript" src="~/Scripts/jquery.form.js"></script>
<script type="text/javascript">

    if (!Array.prototype.filter) {
        Array.prototype.filter = function (fun) {
            "use strict";

            //Probando Filter in IE8
            if (this == null)
                throw new TypeError();

            var t = Object(this);
            var len = t.length >>> 0;
            if (typeof fun != "function")
                throw new TypeError();

            var res = [];
            var thisp = arguments[1];
            for (var i = 0; i < len; i++) {
                if (i in t) {
                    var val = t[i]; // in case fun mutates this
                    if (fun.call(thisp, val, i, t))
                        res.push(val);
                }
            }
            return res;
        };
    }

    if (!Array.prototype.indexOf) {
        Array.prototype.indexOf = function (elt) {
            var len = this.length >>> 0;

            var from = Number(arguments[1]) || 0;
            from = (from < 0)
                 ? Math.ceil(from)
                 : Math.floor(from);
            if (from < 0)
                from += len;
            for (; from < len; from++) {
                if (from in this &&
                    this[from] === elt)
                    return from;
            }
            return -1;
        };
    }

    //Variables globales
    var subgridheaderColumn, subgridmodelColumn, subgridheaderColumn2, subgridmodelColumn2;
    var jdata = [];
    var DltBannerID, idSubGrid, flgBnOperacionAct, flgBnOperacion = { cargar: 1, editar: 2, eliminar: 3 };

    function LoadPreviewControls() {
        $.getJSON(baseUrl + 'Banner/ObtenerPaises', {}, function (data) {
            if (checkTimeout(data)) {
                var ddlPaisesBanPrinpl_SB2 = $('#ddlPaisesBanPrinpl_SB2');
                var ddlPaisesBanPrinpl = $('#ddlPaisesBanPrinpl');
                var ddlPaisesBanBaja = $('#ddlPaisesBanBaja');
                ddlPaisesBanPrinpl_SB2.empty();
                ddlPaisesBanPrinpl.empty();
                ddlPaisesBanBaja.empty();
                if (data.listapaises.length > 0) {
                    ddlPaisesBanPrinpl_SB2.append($('<option/>', {
                        value: "",
                        text: "-- Seleccionar --"
                    }));
                    ddlPaisesBanPrinpl.append($('<option/>', {
                        value: "",
                        text: "-- Seleccionar --"
                    }));
                    ddlPaisesBanBaja.append($('<option/>', {
                        value: "",
                        text: "-- Seleccionar --"
                    }));
                    for (var item in data.listapaises) {
                        if (data.listapaises.hasOwnProperty(+item)) {
                            ddlPaisesBanPrinpl_SB2.append($('<option/>', {
                                value: data.listapaises[item].PaisID,
                                text: data.listapaises[item].Nombre
                            }));
                            ddlPaisesBanPrinpl.append($('<option/>', {
                                value: data.listapaises[item].PaisID,
                                text: data.listapaises[item].Nombre
                            }));
                            ddlPaisesBanBaja.append($('<option/>', {
                                value: data.listapaises[item].PaisID,
                                text: data.listapaises[item].Nombre
                            }));
                        }
                    }
                }
            }
        });
        IniDialogPreview();

        $("#lnkAdmBanPrincipalSB2").click(function () {
            if ($("#ddlCampania").val() === "0") {
                alert('Debe seleccionar una Campaña');
                return false;
            }
            $("#hdTipoBanner").val("P_SB2");
            LimpiaPreviewBanner("P_SB2");
            showDialog("DialogPreviewBanPrincipalSB2");
            return false;
        });

        $("#lnkAdmBanPrincipal").click(function () {
            if ($("#ddlCampania").val() === "0") {
                alert('Debe seleccionar una Campaña');
                return false;
            }
            $("#hdTipoBanner").val("P");
            LimpiaPreviewBanner("P");
            showDialog("DialogPreviewBanPrincipal");
            return false;
        });
        $("#lnkAdmBanIntermedio").click(function () {
            if ($("#ddlCampania").val() === "0") {
                alert('Debe seleccionar una Campaña');
                return false;
            }
            $("#hdTipoBanner").val("I");
            LimpiaPreviewBanner("I");
            showDialog("DialogPreviewBanPrincipal");
            return false;
        });
        $("#lnkAdmBanBaja").click(function () {
            if ($("#ddlCampania").val() === "0") {
                alert('Debe seleccionar una Campaña');
                return false;
            }
            $("#hdTipoBanner").val("B");
            LimpiaPreviewBanner("B");
            showDialog("DialogPreviewBanBaja");
            return false;
        });
        $('txtTextoComentario').live('keyup change', function () {
            var str = $(this).val()
            var mx = parseInt($(this).attr('maxlength'))
            if (str.length > mx) {
                $(this).val(str.substr(0, mx))
                return false;
            }
        });
        $("#img01").click(function () {
            var src = $(this).attr('src');
            $("#imgModal").attr('src', src);
            showDialog('DialogImagenContainer');
        });

        $("#ddlPaisesBanPrinpl_SB2").change(function () {
            var value = this.value;
            if (value !== "") {
                waitingDialog({});
                $.ajaxSetup({ cache: false });
                var tipoBanner = $("#hdTipoBanner").val();
                var campaniaID = $("#ddlCampania").val();
                $.getJSON(baseUrl + 'Banner/ObtenerBannerPrevio', { vTipoBanner: tipoBanner, vPaisID: value, vCampaniaID: campaniaID }, function (data) {
                    if (checkTimeout(data)) {
                        var divBanPPreview = $('#divBanPPreviewSB2');
                        divBanPPreview.empty();
                        if (data.lstBannerInfo.length > 0) {
                            divBanPPreview = document.getElementById("divBanPPreviewSB2");
                            for (var item in data.lstBannerInfo) {
                                if (data.lstBannerInfo.hasOwnProperty(+item)) {
                                    var div1 = document.createElement("div");
                                    div1.setAttribute("class", "box_banner");

                                    var hidden2 = document.createElement("input");
                                    hidden2.setAttribute("type", "hidden");
                                    hidden2.setAttribute("value", data.lstBannerInfo[item].BannerID);
                                    hidden2.setAttribute("class", "clasehid");

                                    var div2 = document.createElement("div");
                                    div2.setAttribute("class", "banner_img");

                                    var img1 = document.createElement("img");
                                    img1.setAttribute("src", data.lstBannerInfo[item].Archivo);
                                    img1.setAttribute("alt", "Imagen Banner");
                                    img1.setAttribute("width", "290");
                                    img1.setAttribute("height", "120");
                                    div2.appendChild(img1);

                                    var div3 = document.createElement("div");
                                    div3.setAttribute("class", "div-3 orde_banner");

                                    var div4 = document.createElement("div");
                                    div4.setAttribute("class", "titAuto");
                                    div4.innerHTML = "Orden:";
                                    div3.appendChild(div4);

                                    var div5 = document.createElement("div");
                                    div5.setAttribute("class", "ndias borde_redondeado");

                                    var text1 = document.createElement("input");
                                    text1.setAttribute("type", "text");
                                    text1.setAttribute("maxlength", "2");
                                    (function (t) {
                                        if (t.addEventListener) {
                                            t.addEventListener("keypress", function () { validate(event) }, false);
                                            t.addEventListener("blur", function () { validateblur(t) }, false);
                                        }
                                        else {
                                            t.attachEvent("onkeypress", function () { validate(event) });
                                            t.attachEvent("onblur", function () { validateblur(t) });
                                        }
                                    })(text1);
                                    text1.setAttribute("value", data.lstBannerInfo[item].Orden);
                                    div5.appendChild(text1);
                                    div3.appendChild(div4);
                                    div3.appendChild(div5);

                                    div1.appendChild(hidden2);
                                    div1.appendChild(div2);
                                    div1.appendChild(div3);
                                    divBanPPreview.appendChild(div1);
                                }
                            }
                            $('#DialogPreviewBanPrincipal').dialog({
                                position: 'center'
                            });
                        }
                        closeWaitingDialog();
                    }
                })
                .error(function (jqXHR, textStatus, errorThrown) {
                    alert(jqXHR.responseText);
                });
            }
            else {
                $('#divBanPPreviewSB2').empty();
                $('#DialogPreviewBanPrincipalSB2').dialog({
                    position: 'center'
                });
            }
        });
        $("#ddlPaisesBanPrinpl").change(function () {
            var value = this.value;
            if (value !== "") {
                waitingDialog({});
                $.ajaxSetup({ cache: false });
                var tipoBanner = $("#hdTipoBanner").val();
                var campaniaID = $("#ddlCampania").val();
                $.getJSON(baseUrl + 'Banner/ObtenerBannerPrevio', { vTipoBanner: tipoBanner, vPaisID: value, vCampaniaID: campaniaID }, function (data) {
                    if (checkTimeout(data)) {
                        var divBanPPreview = $('#divBanPPreview');
                        divBanPPreview.empty();
                        if (data.lstBannerInfo.length > 0) {
                            divBanPPreview = document.getElementById("divBanPPreview");
                            for (var item in data.lstBannerInfo) {
                                if (data.lstBannerInfo.hasOwnProperty(+item)) {
                                    var div1 = document.createElement("div");
                                    div1.setAttribute("class", "box_banner");

                                    var hidden2 = document.createElement("input");
                                    hidden2.setAttribute("type", "hidden");
                                    hidden2.setAttribute("value", data.lstBannerInfo[item].BannerID);
                                    hidden2.setAttribute("class", "clasehid");

                                    var div2 = document.createElement("div");
                                    div2.setAttribute("class", "banner_img");

                                    var img1 = document.createElement("img");
                                    img1.setAttribute("src", data.lstBannerInfo[item].Archivo);
                                    img1.setAttribute("alt", "Imagen Banner");
                                    img1.setAttribute("width", "290");
                                    img1.setAttribute("height", "120");
                                    div2.appendChild(img1);

                                    var div3 = document.createElement("div");
                                    div3.setAttribute("class", "div-3 orde_banner");

                                    var div4 = document.createElement("div");
                                    div4.setAttribute("class", "titAuto");
                                    div4.innerHTML = "Orden:";
                                    div3.appendChild(div4);

                                    var div5 = document.createElement("div");
                                    div5.setAttribute("class", "ndias borde_redondeado");

                                    var text1 = document.createElement("input");
                                    text1.setAttribute("type", "text");
                                    text1.setAttribute("maxlength", "2");
                                    (function (t) {
                                        if (t.addEventListener) {
                                            t.addEventListener("keypress", function () { validate(event) }, false);
                                            t.addEventListener("blur", function () { validateblur(t) }, false);
                                        }
                                        else {
                                            t.attachEvent("onkeypress", function () { validate(event) });
                                            t.attachEvent("onblur", function () { validateblur(t) });
                                        }
                                    })(text1);
                                    text1.setAttribute("value", data.lstBannerInfo[item].Orden);
                                    div5.appendChild(text1);
                                    div3.appendChild(div4);
                                    div3.appendChild(div5);

                                    div1.appendChild(hidden2);
                                    div1.appendChild(div2);
                                    div1.appendChild(div3);
                                    divBanPPreview.appendChild(div1);
                                }
                            }
                            $('#DialogPreviewBanPrincipal').dialog({
                                position: 'center'
                            });
                        }
                        closeWaitingDialog();
                    }
                })
                .error(function (jqXHR, textStatus, errorThrown) {
                    alert(jqXHR.responseText);
                });
            }
            else {
                $('#divBanPPreview').empty();
                $('#DialogPreviewBanPrincipal').dialog({
                    position: 'center'
                });
            }
        });
        $("#ddlPaisesBanBaja").change(function () {
            var value = this.value;
            if (value !== "") {
                waitingDialog({});
                $.ajaxSetup({ cache: false });
                var tipoBanner = $("#hdTipoBanner").val();
                var campaniaID = $("#ddlCampania").val();
                $.getJSON(baseUrl + 'Banner/ObtenerBannerPrevio', { vTipoBanner: tipoBanner, vPaisID: value, vCampaniaID: campaniaID }, function (data) {
                    if (checkTimeout(data)) {
                        var divBanPPreview = $('#divBanBPreview');
                        divBanPPreview.empty();
                        if (data.lstBannerInfo.length > 0) {
                            divBanPPreview = document.getElementById("divBanBPreview");
                            for (var item in data.lstBannerInfo) {
                                if (data.lstBannerInfo.hasOwnProperty(+item)) {
                                    var div1 = document.createElement("div");
                                    div1.setAttribute("class", "box_banner2");

                                    var hidden1 = document.createElement("input");
                                    hidden1.setAttribute("type", "hidden");
                                    hidden1.setAttribute("value", data.lstBannerInfo[item].BannerID);
                                    hidden1.setAttribute("class", "clasehid");
                                    div1.appendChild(hidden1);

                                    var div2 = document.createElement("div");
                                    div2.setAttribute("class", "banner_date");

                                    var div3 = document.createElement("div");
                                    div3.setAttribute("class", "banner_img_art");

                                    var img1 = document.createElement("img");
                                    img1.setAttribute("src", data.lstBannerInfo[item].Archivo);
                                    img1.setAttribute("alt", "Imagen Banner");
                                    div3.appendChild(img1);

                                    var div4 = document.createElement("div");
                                    div4.setAttribute("class", "banner_txt");

                                    var span1 = document.createElement("span");
                                    span1.setAttribute("class", "titulo");
                                    span1.innerText = data.lstBannerInfo[item].TituloComentario;

                                    var span2 = document.createElement("span");
                                    span2.setAttribute("class", "banner_info");
                                    span2.innerText = data.lstBannerInfo[item].TextoComentario;
                                    div4.appendChild(span1);
                                    div4.appendChild(span2);
                                    div2.appendChild(div3);
                                    div2.appendChild(div4);

                                    var div5 = document.createElement("div");
                                    div5.setAttribute("class", "div-3 orde_banner");

                                    var div6 = document.createElement("div");
                                    div6.setAttribute("class", "titAuto");
                                    div6.innerHTML = "Orden:";

                                    var div7 = document.createElement("div");
                                    div7.setAttribute("class", "ndias borde_redondeado");

                                    var text1 = document.createElement("input");
                                    text1.setAttribute("type", "text");
                                    text1.setAttribute("maxlength", "2");
                                    (function (t) {
                                        if (t.addEventListener) {
                                            t.addEventListener("keypress", function () { validate(event) }, false);
                                            t.addEventListener("blur", function () { validateblur(t) }, false);
                                        }
                                        else {
                                            t.attachEvent("onkeypress", function () { validate(event) });
                                            t.attachEvent("onblur", function () { validateblur(t) });
                                        }
                                    })(text1);
                                    text1.setAttribute("value", data.lstBannerInfo[item].Orden);
                                    div7.appendChild(text1);

                                    div5.appendChild(div6);
                                    div5.appendChild(div7);

                                    div1.appendChild(div2);
                                    div1.appendChild(div5);
                                    divBanPPreview.appendChild(div1);
                                }
                            }
                            $('#DialogPreviewBanBaja').dialog({
                                position: 'center'
                            });
                        }
                        closeWaitingDialog();
                    }
                })
                .error(function (jqXHR, textStatus, errorThrown) {
                    alert(jqXHR.responseText);
                });
            }
            else {
                $('#divBanBPreview').empty();
                $('#DialogPreviewBanBaja').dialog({
                    position: 'center'
                });
            }
        });
    }

    function LimpiaPreviewBanner(tipo) {
        if (tipo === "P") {
            $('#ddlPaisesBanPrinpl')[0].selectedIndex = 0;
            $('#divBanPPreview').empty();
        }
        else if (tipo == "P_SB2") {
            $('#ddlPaisesBanPrinpl_SB2')[0].selectedIndex = 0;
            $('#divBanPPreviewSB2').empty();
        }
        else if (tipo === "B") {
            $('#ddlPaisesBanBaja')[0].selectedIndex = 0;
            $('#divBanBPreview').empty();
        }
    }

    function validateblur(elem) {
        var val = elem.value.replace(/[^1-9]/mg, "");
        return $(elem).val(val);
    }

    function ValidarCUVMarquesina() {
        if ($("#hdBannerId").val() == 0) {
            $('#txtCUV').val("");
            alert('Debe Asignar primero un pais');
        }
        else {
            if ($("#txtCUV").val().length == 5) {
                if (isNaN($("#txtCUV").val())) {
                    alert('CUV no valido');
                    $('#txtCUV').val("");
                }
                else {
                    fnValidarCuvMarquesina($("#txtCUV").val(), $("#hdBannerId").val());
                }
            }
            else {
                alert('CUV no valido');
                $('#txtCUV').val("");
            }
        }
    }


    function validate(evt) {
        var theEvent = evt || window.event;
        var key = theEvent.keyCode || theEvent.which;
        key = String.fromCharCode(key);
        var regex = /[1-9]|\./;
        if (!regex.test(key)) {
            theEvent.returnValue = false;
            if (theEvent.preventDefault) theEvent.preventDefault();
        }
    }

    function IniDialogPreview() {
        $('#DialogImagenContainer').dialog({
            autoOpen: false,
            resizable: false,
            modal: true,
            closeOnEscape: true,
            width: 260,
            height: 400,
            title: "Sección Intermedia",
            draggable: true
        });

        $('#DialogPreviewBanPrincipalSB2').dialog({
            autoOpen: false,
            resizable: false,
            modal: true,
            closeOnEscape: true,
            width: 720,
            draggable: true,
            title: "Grupo Banner Principal SB2.0: Orden de Presentación - Preview",
            buttons:
            {
                "Guardar": function () {
                    var divBanPPreview = $('#divBanPPreviewSB2');
                    textos = divBanPPreview.find('.box_banner').find('.ndias input[type=text]');
                    var rep = {}, index = 0;
                    campaniaID = $("#ddlCampania").val();
                    var params = {
                        banners: []
                    };
                    for (i = 0; i < textos.length; i++) {
                        texto = textos[i].value;
                        id = $(textos[i]).parent().parent().parent().find('.clasehid').val();

                        if (texto === "") {
                            alert("Debe ingresar un número en el campo Orden.");
                            return false;
                        }
                        if (texto === "0") {
                            alert("Debe ingresar un número mayor a cero en el campo Orden.");
                            return false;
                        }
                        params.banners.push({
                            BannerID: id,
                            CampaniaID: campaniaID,
                            Orden: texto
                        });

                        if (rep[texto]) {
                            break;
                        }
                        else {
                            rep[texto] = true;
                            index++;
                        }
                    }
                    if (index !== textos.length) {
                        alert('Debe ingresar un número de orden distinto para cada Banner.');
                        return false;
                    }
                    waitingDialog({});
                    $.ajax({
                        type: "POST",
                        url: baseUrl + "Banner/ActualizarNroOrdenBanner",
                        data: JSON.stringify(params),
                        contentType: 'application/json',
                        success: function (data) {
                            if (checkTimeout(data)) {
                                closeWaitingDialog();
                                if (data.success == true) {
                                    alert(data.message);
                                    HideDialog("DialogPreviewBanPrincipalSB2");
                                }
                            }
                        },
                        error: function (data, error) {
                            if (checkTimeout(data)) {
                                closeWaitingDialog();
                                alert("Ocurrió un error inesperado. Consulte con su administrador del sistema para obtener mayor información");
                            }
                        }
                    });
                },
                "Cancelar": function () {
                    $(this).dialog('close');
                }
            }
        });

        $('#DialogPreviewBanPrincipal').dialog({
            autoOpen: false,
            resizable: false,
            modal: true,
            closeOnEscape: true,
            width: 720,
            draggable: true,
            title: "Grupo Banner Principal: Orden de Presentación - Preview",
            buttons:
            {
                "Guardar": function () {
                    var divBanPPreview = $('#divBanPPreview');
                    textos = divBanPPreview.find('.box_banner').find('.ndias input[type=text]');
                    var rep = {}, index = 0;
                    campaniaID = $("#ddlCampania").val();
                    var params = {
                        banners: []
                    };
                    for (i = 0; i < textos.length; i++) {
                        texto = textos[i].value;
                        id = $(textos[i]).parent().parent().parent().find('.clasehid').val();

                        if (texto === "") {
                            alert("Debe ingresar un número en el campo Orden.");
                            return false;
                        }
                        if (texto === "0") {
                            alert("Debe ingresar un número mayor a cero en el campo Orden.");
                            return false;
                        }
                        params.banners.push({
                            BannerID: id,
                            CampaniaID: campaniaID,
                            Orden: texto
                        });

                        if (rep[texto]) {
                            break;
                        }
                        else {
                            rep[texto] = true;
                            index++;
                        }
                    }
                    if (index !== textos.length) {
                        alert('Debe ingresar un número de orden distinto para cada Banner.');
                        return false;
                    }
                    waitingDialog({});
                    $.ajax({
                        type: "POST",
                        url: baseUrl + "Banner/ActualizarNroOrdenBanner",
                        data: JSON.stringify(params),
                        contentType: 'application/json',
                        success: function (data) {
                            if (checkTimeout(data)) {
                                closeWaitingDialog();
                                if (data.success == true) {
                                    alert(data.message);
                                    HideDialog("DialogPreviewBanPrincipal");
                                }
                            }
                        },
                        error: function (data, error) {
                            if (checkTimeout(data)) {
                                closeWaitingDialog();
                                alert("Ocurrió un error inesperado. Consulte con su administrador del sistema para obtener mayor información");
                            }
                        }
                    });
                },
                "Cancelar": function () {
                    $(this).dialog('close');
                }
            }
        });
        $('#DialogPreviewBanBaja').dialog({
            autoOpen: false,
            resizable: false,
            modal: true,
            closeOnEscape: true,
            width: 780,
            draggable: true,
            title: "Grupo Banner Sección Baja: Orden de Presentación - Preview",
            buttons:
            {
                "Guardar": function () {
                    var divBanPPreview = $('#divBanBPreview');
                    textos = divBanPPreview.find('.box_banner2').find('.ndias input[type=text]');
                    var rep = {}, index = 0;
                    campaniaID = $("#ddlCampania").val();
                    var params = {
                        banners: []
                    };
                    for (i = 0; i < textos.length; i++) {
                        texto = textos[i].value;
                        id = $(textos[i]).parent().parent().parent().find('.clasehid').val();

                        if (texto === "") {
                            alert("Debe ingresar un número en el campo Orden.");
                            return false;
                        }
                        if (texto === "0") {
                            alert("Debe ingresar un número mayor a cero en el campo Orden.");
                            return false;
                        }
                        params.banners.push({
                            BannerID: id,
                            CampaniaID: campaniaID,
                            Orden: texto
                        });

                        if (rep[texto]) {
                            break;
                        }
                        else {
                            rep[texto] = true;
                            index++;
                        }
                    }
                    if (index !== textos.length) {
                        alert('Debe ingresar un número de orden distinto para cada Banner.');
                        return false;
                    }
                    waitingDialog({});
                    $.ajax({
                        type: "POST",
                        url: baseUrl + "Banner/ActualizarNroOrdenBanner",
                        data: JSON.stringify(params),
                        contentType: 'application/json',
                        success: function (data) {
                            if (checkTimeout(data)) {
                                closeWaitingDialog();
                                if (data.success == true) {
                                    alert(data.message);
                                    HideDialog("DialogPreviewBanBaja");
                                }
                            }
                        },
                        error: function (data, error) {
                            if (checkTimeout(data)) {
                                closeWaitingDialog();
                                alert("Ocurrió un error inesperado. Consulte con su administrador del sistema para obtener mayor información");
                            }
                        }
                    });
                },
                "Cancelar": function () {
                    $(this).dialog('close');
                }
            }
        });
    }

    $(document).ready(function () {
        LoadPreviewControls();
        $(".qq-upload-list")[0].style['display'] = "none";
        $(".qq-upload-list").css("display", "none");

        $("#ddlTipoContenido").change(function () {

            var boton = $("#DivbtnValidarUrl");
            var lblUrl = $("#lblUrl");
            var ddlTipoContenido = $("#ddlTipoContenido");
            var Id = $('#ddlTipoAccion').val();
            if ($("#ddlTipoContenido").val() == "0") {
                Id = "0";
                $('#ddlTipoAccion')[0].children[0].innerHTML;
                $('#ddlTipoAccion')[0].value = Id;
                $('#txtUrl').val("");
                boton[0].style['display'] = "block";
                lblUrl[0].innerHTML = "Url destino:";
            }
            else if ($("#ddlTipoContenido").val() == "1")
            {
                Id = "0";
                $('#ddlTipoAccion')[0].children[0].innerHTML;
                $('#ddlTipoAccion')[0].value = Id;
                $('#txtUrl').val("");
                boton[0].style['display'] = "none";
                lblUrl[0].innerHTML = "Mensaje:";
            }

        })
        //Obtener las Columnas y el Modelo de la SubGrilla desde el inicio
        $.ajaxSetup({ cache: false });
        $.ajax({
            type: 'POST',
            url: baseUrl + 'Banner/ObtenerCabeceraYFilaConfiguracionSubGrilla',
            data: '',
            dataType: 'Json',
            success: function (dataResult) {
                if (checkTimeout(dataResult)) {
                    subgridheaderColumn = dataResult._colNames;
                    subgridmodelColumn = dataResult._colModel;

                    //Modificar el campo formatter del array
                    $.each(subgridmodelColumn, function (key, value) {
                        if (value.formatter != null && value.formatter == 'CustomCheckBox')
                            value.formatter = CustomCheckBox;
                        else if (value.formatter == 'CustomCheckFlag') {
                            value.formatter = CustomCheckFlag;
                        }
                        else if (value.formatter == 'CustomCheckFlagNva') {
                            value.formatter = CustomCheckFlagNva;
                        }
                        else if (value.formatter == 'ShowBannerOptions') {
                            value.formatter = ShowBannerOptions;
                        } else if (value.formatter == 'formatearArchivo') {
                            value.formatter = formatearArchivo;
                        }
                    });

                    var datosss = subgridmodelColumn;
                }
            },
            error: function (x, e) {
                if (checkTimeout(x)) {
                    alert_msg(x.readyState + " " + x.status + " " + e.msg);
                }
            }
        });

        $.ajax({
            type: 'POST',
            url: baseUrl + 'Banner/ObtenerCabeceraYFilaConfiguracionSubGrilla',
            data: '',
            dataType: 'Json',
            success: function (dataResult) {
                if (checkTimeout(dataResult)) {
                    subgridheaderColumn2 = dataResult._colNames;
                    subgridmodelColumn2 = dataResult._colModel;

                    //Modificar el campo formatter del array
                    $.each(subgridmodelColumn2, function (key, value) {
                        if (value.formatter != null && value.formatter == 'CustomCheckBox')
                            value.formatter = CustomCheckBox;
                        else if (value.formatter == 'CustomCheckFlag') {
                            value.formatter = CustomCheckFlag;
                        }
                        else if (value.formatter == 'CustomCheckFlagNva') {
                            value.formatter = CustomCheckFlagNva;
                        }
                        else if (value.formatter == 'ShowBannerOptions') {
                            value.formatter = ShowBannerOptions;
                        } else if (value.formatter == 'formatearArchivo') {
                            value.formatter = formatearArchivo;
                        }
                    });
                    subgridheaderColumn2.splice(27, 3);
                    subgridmodelColumn2.splice(27, 3);
                }
            },
            error: function (x, e) {
                if (checkTimeout(x)) {
                    alert_msg(x.readyState + " " + x.status + " " + e.msg);
                }
            }
        });

        $('#ddlTipoAccion').change(function () {

            var Id = $(this).val();

            if (Id != "") {
                if (Id == 0) {
                    $('#div_cuv').hide();
                    $('#div_Url').show();
                    $('#DivbtnValidarUrl').show();
                    $('#div_Url').find('#lblUrl')[0].innerHTML = "Url destino:";
                }
                else {
                    if (Id == 1) {
                        $('#div_cuv').show();
                        $('#div_Url').hide();
                    }
                    else if (Id == 2) {
                        $('#div_cuv').hide();
                        $('#div_Url').show();
                        $('#DivbtnValidarUrl').hide();
                        $('#div_Url').find('#lblUrl')[0].innerHTML = "Id Curso:";

                        Id = "0";
                        $('#ddlTipoContenido')[0].children[0].innerHTML;
                        $('#ddlTipoContenido')[0].value = Id;



                    }

                }
                $('#txtCUV').val("");
                $('#txtUrl').val("");
                $('#txtCantidad').val("");
            }
            else {
                if (Id == "") {
                    $('#div_cuv').hide();
                    $('#div_Url').hide();
                }
            }
        });

        $('#ddlCampania').live('change', function () {
            if ($(this).val() == 0)
                $('#divContenedorGrid').html('<div class="grilla_banner"><table id="list"><div id="pager"></div></table></div>');
            else
                fnGrilla();
        });

        IniDialog();

        fnEventos();

        fnExtenderMetodosArray();

        $("#chkSeleccionar").click(function () {
            if (this.checked)
                $.jstree._reference($("#arbolRegionZona")).check_all();
            else
                $.jstree._reference($("#arbolRegionZona")).uncheck_all();
        });
        $("#ddlPaisesBanSegZona").change(function () {
            waitingDialog({});
            var value = this.value;
            if (value !== "") {
                CargarSegmentoPais();
                var strZonas = CargarSegmentoZonaConfigurada();
                ConfigurarArbol(strZonas);
            }
            else {
                $("#arbolRegionZona").html("");
                $('#ddlSegmentoBanner').empty();
            }
            closeWaitingDialog();
        });
    });

	function ConfigurarArbol(Zonas) {
        $.ajaxSetup({
            cache: false
        });
        $("#arbolRegionZona").jstree({
            json_data: {
                ajax: {
                    url: baseUrl + "Banner/CargarArbolRegionesZonas",
                    data: function (n) {
                        return { pais: $("#ddlPaisesBanSegZona").val() };
                    },
                    type: "GET",
                    error: function (XMLHttpRequest, textStatus, errorThrown) { },
                    success: function (data, textStatus, jqXHR) { },
                    complete: function () {
                        $("#arbolRegionZona").jstree("set_theme", "apple", "@Url.Content("~/Content/Css/jstree/apple/stylejstree.css")");

                        var strZonas = Zonas;
                        if (strZonas != "") {
                            $.jstree._reference($("#arbolRegionZona")).uncheck_all();
                            var strZonasArreglo = strZonas.split(",");
                            for (i = 0; i < strZonasArreglo.length; i++) {
                                $("#arbolRegionZona").jstree("check_node", "#" + strZonasArreglo[i], true);
                            }
                            $("#chkSeleccionar").attr("checked", true);
                            $.jstree._reference($("#arbolRegionZona")).get_unchecked(null, true).each(function () {
                                if (this.className.toLowerCase().indexOf("jstree-leaf") == -1) {
                                    return true;
                                }
                                $("#chkSeleccionar").attr("checked", false);
                            });
                        } else {
                            $.jstree._reference($("#arbolRegionZona")).check_all();
                            var zonas = "";
                            $.jstree._reference($("#arbolRegionZona")).get_checked(null, true).each(function () {
                                if (this.className.toLowerCase().indexOf("jstree-leaf") == -1) {
                                    return true;
                                }
                                zonas += this.id + ",";
                            });
                            if (zonas != "") {
                                zonas = zonas.substring(0, zonas.length - 1);
                            }
                            $("#chkSeleccionar").attr("checked", true);
                        }
                        $('#arbolRegionZona').jstree('close_all');
                    }
                }
            },
            "themes": {
                "theme": "apple",
                "dots": true,
                "icons": false
            },
            plugins: ["themes", "json_data", "ui", "checkbox"]
        });
        return false;
    }

    function CargarSegmentoPais()
    {
        var PaisId = $('#ddlPaisesBanSegZona').val();
        if (PaisId != -1) {
            $.ajaxSetup({
                cache: false,
                async: false
            });
            $.getJSON(baseUrl + 'Banner/ObtenerSegmentoBanner', { PaisId: PaisId }, function (data) {
                if (checkTimeout(data)) {
                    var ddlSegmentoBanner = $('#ddlSegmentoBanner');
                    ddlSegmentoBanner.empty();
                    if (data.listasegmento.length > 0) {
                        for (var item in data.listasegmento) {
                            if (data.listasegmento.hasOwnProperty(+item)) {
                                ddlSegmentoBanner.append('<div style="display:block"><div style="float:left"><input type="Checkbox" value="' + data.listasegmento[item].BannerSegmentoId + '" style="display:inline-block !important; height: 15px !important;" /></div><div style="float:left;">' + data.listasegmento[item].BannerSegmentoDes + '</div> <div style="clear: both"></div></div>');                                
                            }
                        }

                        var BannerId = $("#hdBannerIdSegZon").val();
                        var CampaniaId = $('#ddlCampania').val();

                        $.getJSON(baseUrl + 'Banner/ObtenerBannerSegmentoSeccion', { CampaniaId: CampaniaId, BannerId: BannerId, PaisId: PaisId },
                            function (data) {
                                if (checkTimeout(data)) {
                                    if (data && data.Banner && data.Banner.SegmentoInterno) {
                                        var segmentosInternos = data.Banner.SegmentoInterno.split(',');

                                        $("#ddlSegmentoBanner").find('input[type="checkbox"]').each(function () {

                                            var valor = $(this).attr('value');
                                            if ($.inArray(valor, segmentosInternos) > -1) {
                                                $(this).attr("checked", true);
                                            }
                                        });
                                    }
                                }
                            });
                    }
                }
            });
            $.ajaxSetup({
                async: true
            });
        }
        else {
            $('#ddlSegmentoBanner').empty();
        }
        return false;
    }

    function CargarSegmentoZonaConfigurada() {
        var BannerId = $("#hdBannerIdSegZon").val();
        var CampaniaId = $('#ddlCampania').val();
        var PaisId = $('#ddlPaisesBanSegZona').val();
        var Segmento = -1;
        var ConfiguracionZona = "";
        var tipoAcceso = '';
        $.ajaxSetup({
            cache: false,
            async: false
        });
        $.getJSON(baseUrl + 'Banner/ObtenerSegmentoZona', { BannerId: BannerId, CampaniaId: CampaniaId, PaisId: PaisId }, function (data) {
            if (checkTimeout(data)) {
                Segmento = data.Segmento;
                ConfiguracionZona = data.ConfiguracionZona;
                tipoAcceso = data.TipoAcceso > 0 ? data.TipoAcceso : '';
            }
        });
        $.ajaxSetup({
            async: true
        });

        $('#ddlSegmentoBanner').val(Segmento);
        $('#ddlTipoAcceso').val(tipoAcceso);
        return ConfiguracionZona;
    }

    function GuardarInformacionBannerSegmentoZona()
    {
        var PaisId = $('#ddlPaisesBanSegZona').val();
        if (PaisId == '')
        {
            alert('Debe seleccionar un país.');
            return false;
        }

        var BannerId = $("#hdBannerIdSegZon").val();
        var CampaniaId = $('#ddlCampania').val();
        var PaisId = $('#ddlPaisesBanSegZona').val();
        var Segmento = -100;
        var TipoAcceso = $('#ddlTipoAcceso').val();
        var flConsultorasSegmento = $('#flConsultorasSegmento')[0].files;

        var SegmentoInterno = "";

        $("#ddlSegmentoBanner").find('input[type="checkbox"]').each(function () {
            if ($(this).attr("checked")) {
                SegmentoInterno += $(this).val() + ",";
            }
        });

        if (SegmentoInterno == "") {
            alert("No se ha marcado ningún Segmento.");
            return false;
        }

        if (SegmentoInterno != "") {
            SegmentoInterno = SegmentoInterno.substring(0, SegmentoInterno.length - 1);
        }

        var zonas = "";
        $.jstree._reference($("#arbolRegionZona")).get_checked(null, true).each(function () {
            if (this.className.toLowerCase().indexOf("jstree-leaf") == -1) {
                return true;
            }
            zonas += this.id + ",";
        });
        if (zonas != "") {
            zonas = zonas.substring(0, zonas.length - 1);
        }

        if (zonas == "") {
            alert("No se ha marcado ninguna zona o región.");
            return false;
        }

        if (!TipoAcceso) {
            TipoAcceso = -1;
        }

        var formData = new FormData();
        formData.append("BannerId", BannerId);
        formData.append("CampaniaId", CampaniaId);
        formData.append("PaisId", PaisId);
        formData.append("Segmento", Segmento);
        formData.append("ConfiguracionZona", zonas);
        formData.append("SegmentoInterno", SegmentoInterno);
        formData.append("TipoAcceso", TipoAcceso);

        if (flConsultorasSegmento && flConsultorasSegmento.length > 0) {
            formData.append("csvConsultoras", flConsultorasSegmento[0]);
        }

        $.ajaxSetup({
            cache: false,
        });

        $.ajax({
            url: baseUrl + 'Banner/UpdBannerPaisSegmentoZona',
            data: formData,
            processData: false,
            contentType: false,
            type: 'POST',
            success: function (data) {
                if (checkTimeout(data)) {
                    alert(data.Mensaje);
                    $('#ddlPaisesBanSegZona').val('');
                    $('#ddlTipoAcceso').val('');
                    $('#flConsultorasSegmento').val('');
                    $("#arbolRegionZona").html("");
                    $('#ddlSegmentoBanner').empty();
                }
            }
        });

        return false;
    }

    function fnEventos() {
        $('#frmCargarGrupoBanner').ajaxForm({
            beforeSubmit: function () {
                var GrupoBannerId = $('#hdGrupoBannerIdArchivo').val();
                var fileValue = $('#flConsultoras').val();
                var extensiones = ['xlsx'];
                var get_ext;
                var message = '';

                if ($('#txtTiempoRotacion').val().length == 0 || $('#txtTiempoRotacion').val() == '0')
                    message = '- El Tiempo de Rotación debe ser mayor a Cero. </br>';

                //validar la extension del archivo
                get_ext = fileValue.split('.');
                get_ext = get_ext.reverse();

                if ($.inArray(get_ext[0].toLowerCase(), extensiones) == -1 && fileValue.length > 0)
                    message = message + '- El tipo de archivo es inválido, asegúrese de seleccionar un documento de Excel (xlsx).'

                if (message.length > 0) {
                    alert_msg(message);
                    return false;
                }
            },
            success: fnRespuestaCargaGrupoBanner
        });

        $('#frmCargarBanner').ajaxForm({
            beforeSubmit: function () {
                var GrupoBannerId = $('#hdGrupoBannerIdBanner').val();
                var TiempoRotacion = $("#list").jqGrid('getCell', GrupoBannerId, 'TiempoRotacion');
                var fileValue = $('#imagenProducto01').val();
                var extensiones = ['jpg', 'jpeg', 'png', 'gif'];
                var get_ext;
                var message = '';

                if (GrupoBannerId != "2" && GrupoBannerId != "3" && GrupoBannerId != "4" && GrupoBannerId != "5" && GrupoBannerId != "11" && GrupoBannerId != "12" && GrupoBannerId != "13" && GrupoBannerId != "14" && GrupoBannerId != "15" && GrupoBannerId != "16" && GrupoBannerId != "17" && GrupoBannerId != "18" && GrupoBannerId != "19" && GrupoBannerId != "20" && GrupoBannerId != "21" && GrupoBannerId != "22" && GrupoBannerId != 23 && GrupoBannerId != 26) {
                    if (TiempoRotacion == 0)
                        message = '- Primero debe ingresar el Tiempo de Rotación para el Grupo de Banner.</br>';
                }

                if ($('#txtTitulo').val().length == 0)
                    message = message + '- Debe ingresar el Título del Banner. </br>'

                if (flgBnOperacionAct == flgBnOperacion.cargar && fileValue.length == 0)
                    message = message + '- Debe seleccionar la imagen que se cargará. </br>'

                //validar la extension del archivo
                get_ext = fileValue.split('.');
                get_ext = get_ext.reverse();

                if ($.inArray(get_ext[0].toLowerCase(), extensiones) == -1 && fileValue.length > 0)
                    message = message + '- El tipo de archivo de imagen es inválido.'

                if (message.length > 0) {
                    alert_msg(message);
                    return false;
                }

            },
            success: fnRespuestaCargaBanner
        });

        $('#btnCancelarCargaBanner').live('click', function () {
            $('#DialogCargarBanner').dialog('close')
        });

        $('#btnGuardar').live('click', function () {
            // validar si seleccionó paises
            if (jdata.length == 0) {
                alert_msg('No se puede guardar ya que no realizó cambios sobre los Paises.');
            }
            else
                fnRegistrarPaisPorBanner();
        });

        $('#btnCancelar').live('click', function () {
            $("#list").setGridParam({ datatype: 'json', page: 1 }).trigger('reloadGrid');
        });

        $('#btnValidarUrl').live('click', function () {
            var url = $('#txtUrl').val();
            if (url.length > 0)
                window.open(url, 'mywindow', 'width=400,height=200,toolbar=yes,location=yes,directories=yes,status=yes,menubar=yes,scrollbars=yes,copyhistory=yes, resizable=yes');
        });
    }

    function fnRespuestaCargaGrupoBanner(responseText, statusText, xhr, $form) {
        if (checkTimeout(responseText)) {
            $("#list").setGridParam({ datatype: 'json', page: 1 }).trigger('reloadGrid');
            alert_msg(responseText);
            $('#DialogCargarArchivo').dialog('close');
        }
    }

    function fnRespuestaCargaBanner(responseText, statusText, xhr, $form) {
        if (checkTimeout(responseText)) {
            //Cargar grilla o subGrilla
            if (flgBnOperacionAct == flgBnOperacion.cargar)
                $("#list").setGridParam({ datatype: 'json', page: 1 }).trigger('reloadGrid');
            else // Para :flgBnOperacion.editar y flgBnOperacion.eliminar
                $("#" + idSubGrid).setGridParam({ datatype: 'json', page: 1 }).trigger('reloadGrid');

            alert_msg(responseText);
            $('#DialogCargarBanner').dialog('close');
        }
    }

    function fnGrilla() {
        jQuery("#list").jqGrid({
            url: baseUrl + "Banner/ConsultarGruposPorCampania",
            hidegrid: false,
            datatype: 'json',
            postData: ({
                CampaniaId: function () { return jQuery.trim($("#ddlCampania").val()); }
            }),
            mtype: 'GET',
            contentType: "application/json; charset=utf-8",
            colNames: ['GrupoBannerID', 'TiempoRotacion', 'Nombre', 'Grupo Banner', 'Dimensiones', 'Ancho', 'Alto'],
            colModel: [
                { name: 'GrupoBannerID', index: 'GrupoBannerID', width: 100, editable: true, resizable: false, hidden: true },
                { name: 'TiempoRotacion', index: 'TiempoRotacion', width: 100, editable: true, resizable: false, hidden: true },
                { name: 'Nombre', index: 'Nombre', width: 150, editable: true, resizable: false, hidden: true },
                { name: 'NombreConIco', index: 'NombreConIco', width: 150, editable: true, resizable: false, formatter: ShowActions },
                { name: 'Dimension', index: 'Dimension', width: 150, editable: true, resizable: false, align: 'right' },
                { name: 'Ancho', index: 'Ancho', width: 0, editable: false, resizable: false, align: 'center', hidden: true },
                { name: 'Alto', index: 'Alto', width: 0, editable: false, resizable: false, align: 'center', hidden: true },
            ],
            jsonReader:
                {
                    root: "rows",
                    page: "page",
                    total: "total",
                    records: "records",
                    repeatitems: true,
                    cell: "cell",
                    id: "id"
                },
            pager: jQuery('#pager'),
            loadtext: 'Cargando datos...',
            recordtext: "{0} - {1} de {2} Registros",
            emptyrecords: 'No hay resultados',
            rowNum: 30,
            scrollOffset: 0,
            rowList: [30, 40, 50],
            sortname: 'Nombre',
            sortorder: 'asc',
            viewrecords: true,
            multiselect: false,
            height: 'auto',
            display: 'block',
            width: '100%',
            pgtext: 'Pág: {0} de {1}',
            autowidth: true,
            altclass: 'jQGridAltRowClass',
            loadComplete: function (data) {
                $("#list").parent().parent().parent().find('.ui-jqgrid-hdiv').hide();
                $('#btnGuardar').css('display', 'block');
                $('#btnCancelar').css('display', 'block');
            },
            gridComplete: function () { },
            subGrid: true,
            subGridRowExpanded: function (subgrid_id, row_id) {

                if (row_id == "2" || row_id == "3" || row_id == "4" || row_id == "5" || row_id == "11" || row_id == "12" || row_id == "13" || row_id == "14" || row_id == "15" || row_id == "16" || row_id == "17" || row_id == "18" || row_id == "19" || row_id == "20" || row_id == "21" || row_id == "22" || row_id == "23" || row_id == "26") {
                    //|| row_id == "151" || row_id == "152" || row_id == "153") {
                    var subgridheaderColumn3 = subgridheaderColumn2;
                    var subgridmodelColumn3 = subgridmodelColumn2;
                }
                else {
                    var subgridheaderColumn3 = subgridheaderColumn;
                    var subgridmodelColumn3 = subgridmodelColumn;
                }

                var subgrid_table_id;
                subgrid_table_id = subgrid_id + "_t";
                jQuery("#" + subgrid_id).html("<table id='" + subgrid_table_id + "' class='scroll' style='text-align:center;'></table>");
                jQuery("#" + subgrid_table_id).jqGrid({
                    url: baseUrl + "Banner/ConsultaBannerPorGrupoCampania",
                    datatype: "json",
                    postData: ({
                        CampaniaId: function () { return jQuery.trim($("#ddlCampania").val()); },
                        GrupoBannerId: function () { return row_id; }
                    }),
                    colNames: subgridheaderColumn3,
                    colModel: subgridmodelColumn3,
                    jsonReader:
                        {
                            cell: "cell",
                            id: "id"
                        },
                    height: '100%',
                    rowNum: 100,
                    width: 1100,
                    sortname: 'Nombre',
                    sortorder: "asc",
                    footerrow: false,
                    rownumbers: true,
                    autowidth: false,
                    loadComplete: function () {
                    }
                });
            }
        });
        jQuery("#list").jqGrid('navGrid', "#pager", { edit: false, add: false, refresh: false, del: false, search: false });
        jQuery("#list").setGridParam({ datatype: 'json', page: 1 }).trigger('reloadGrid');
    }

    function ShowActions(cellvalue, options, rowObject) {
        var cargaArchivo = cellvalue + "&nbsp;<a href='javascript:;' onclick=\"return jQuery('#list').CargaArchivo('" + rowObject[0] + "');\" >" + "<img src='@Url.Content("~/Content/Images/Edit.png")' alt='Configurar Grupo' title='Configurar Grupo' border='0' /></a>";
        var cargarBanner = "&nbsp;<a href='javascript:;' onclick=\"return jQuery('#list').CargaBanner('" + rowObject[0] + "');\" >" + "<img src='@Url.Content("~/Content/Images/add_banner.png")' alt='Agregar Banner' title='Agregar Banner' border='0' /></a>";
        if (rowObject[0] == "2" || rowObject[0] == "3" || rowObject[0] == "4" || rowObject[0] == "5" || rowObject[0] == "11" || rowObject[0] == "12" || rowObject[0] == "13" || rowObject[0] == "14" || rowObject[0] == "15" || rowObject[0] == "16" || rowObject[0] == "17" || rowObject[0] == "18" || rowObject[0] == "19" || rowObject[0] == "20" || rowObject[0] == "21" || rowObject[0] == "22" || rowObject[0] == "23" || rowObject[0] == "26")
            return cellvalue + cargarBanner;
        else
            return cargaArchivo + cargarBanner;
    };

    function CustomCheckBox(val, options, rowObject) {
        var nombrepais = options.colModel.name;
        var check = val.split('|')[0];
        var idpais = val.split('|')[1];
        var ischecked = check == 1 ? "checked='checked'" : "";
        var bannerId = rowObject[0];

        return "<input id='cboxPais_" + options.rowId + options.pos + "' value = '" + idpais + "' type='checkbox' " + ischecked + " onclick=\"ClickCboxPais(" + idpais + ", " + bannerId + ",this); \" />";
    }

    function CustomCheckFlag(val, options, rowObject) {
        var ischecked = val == 'true' ? "checked='checked'" : "";
        var bannerId = rowObject[0];
        return "<input id='cboxFlag_" + options.rowId + options.pos + "' value = 'flagConsultoraGrupo' type='checkbox' " + ischecked + "onclick='ClickCboxFlag(" + bannerId + ",this)' />";
    }

    function CustomCheckFlagNva(val, options, rowObject) {
        var ischecked = val == 'true' ? "checked='checked'" : "";
        var bannerId = rowObject[0];
        return "<input id='cboxFlagNva_" + options.rowId + options.pos + "' value = 'flagConsultora' type='checkbox' " + ischecked + "onclick='ClickCboxFlag(" + bannerId + ",this)' />";
    }

    function ShowBannerOptions(val, options, rowObject) {
        var BannerId = rowObject[0];

        var hasGroupNew = HasGroupOrNewConsultora(rowObject);

        var SeccionId = (Number)(rowObject[1]);
        $("#hdn_SeccionID").val(SeccionId);
        var editar = "&nbsp;<a href='#' onclick=\"return $('#list').EditBanner(" + BannerId + ", this);\" >" + "<img src='@Url.Content("~/Content/Images/Edit.png")' alt='Editar Banner' title='Editar Banner' border='0' /></a>";
        var eliminar = "&nbsp;<a href='#' onclick=\"return $('#list').DeleteBanner('" + BannerId + "', this);\" >" + "<img src='@Url.Content("~/Content/Images/Delete.png")' alt='Eliminar Banner' title='Eliminar Banner' border='0' /></a>";
        var segzona = "&nbsp;<a href='#' onclick=\"return $('#list').SegZonaBanner('" + BannerId + "', " + hasGroupNew + ", this);\" >" + "<img src='@Url.Content("~/Content/Images/configuracion.png")' alt='Configurar Segmento y Zona' title='Configurar Segmento y Zona' border='0' /></a>";
        if(SeccionId < 6 || SeccionId > 9)
            return editar + eliminar + segzona;
        else
            return editar + eliminar;
    }

    function HasGroupOrNewConsultora(cells) {
        if (!cells) {
            return false;
        }

        if (cells.length < 29) {
            return false;
        }

        return cells[27] === 'true' || cells[28] === 'true';
    }

    function formatearArchivo(val, options, rowObject) {
        var rutaLarga = rowObject[3];

        var img01 = rutaLarga.replace(/^.*[\\\/]/, '');
        if (img01.lastIndexOf("?") >= 0) {
            img01 = img01.substring(0, img01.lastIndexOf("?"));
        }
        rutaLarga = img01;

        return rutaLarga;
    }

    function ClickCboxPais(paisId, bannerId, obj) {
        var subgrid = $(obj).closest('table');
        var index = jdata.getIndexbyBannerId(bannerId);

        if ($(obj).is(':checked')) {
            if (index == -1) {// es nuevo
                fnAgregarNuevoObjBanner(subgrid, bannerId, paisId);
            }
            else {
                jdata.insertPais(bannerId, paisId);
            }
        }
        else {
            jdata.deletePais(bannerId, paisId);
        }

        //Verificar si existen paises seleccionados en la fila (para el Banner), en caso sea edicion
        var currentRow = $(obj).closest('tr');
        index = jdata.getIndexbyBannerId(bannerId);
        if (index == -1) {
            fnAgregarNuevoObjBanner(subgrid, bannerId, 0);
            index = jdata.getIndexbyBannerId(bannerId); //Obtener el nuevo indice
        }

        //Verificar si ya fue revisado todos los checkbox's para ese banner
        if (!jdata[index].EsRevisado) {
            $.each(currentRow.find('input:checkbox'), function (key, value) {
                var control = $(value);
                var controlIdPais = $(value).attr('value');

                if (control.is(':checked') && controlIdPais != 'flagConsultora' && paisId != controlIdPais) {
                    jdata.insertPais(bannerId, controlIdPais);
                }
            });
            jdata[index].EsRevisado = true;
        }
    }

    function ClickCboxFlag(bannerId, obj) {
        var subgrid = $(obj).closest('table');
        var index = jdata.getIndexbyBannerId(bannerId);
        if (index == -1) {// es nuevo
            fnAgregarNuevoObjBanner(subgrid, bannerId, 0);

            //Obtener la fila actual
            var currentRow = $(obj).closest('tr');
            index = jdata.getIndexbyBannerId(bannerId);

            //Verificar si ya fue revisado todos los checkbox's para ese banner
            if (!jdata[index].EsRevisado) {
                //Obtener los paises seleccionados de la fila
                $.each(currentRow.find('input:checkbox'), function (key, value) {
                    var control = $(value);
                    var controlIdPais = control.attr('value');

                    if (control.is(':checked') && controlIdPais != 'flagConsultora') {
                        jdata.insertPais(bannerId, controlIdPais);
                    }
                });
                jdata[index].EsRevisado = true;
            }
        }
        else {
            if ($(obj)[0].defaultValue == "flagConsultora")
                jdata[index].FlagConsultoraNueva = $(obj).is(':checked');

            else
                jdata[index].FlagGrupoConsultora = $(obj).is(':checked');
        }
    }

    function fnAgregarNuevoObjBanner(subgrid, BannerId, PaisId) {

        var img01 = subgrid.jqGrid('getCell', BannerId, 'ArchivoRutaCompleto').replace(/^.*[\\\/]/, '');
        if (img01.lastIndexOf("?") >= 0) {
            img01 = img01.substring(0, img01.lastIndexOf("?"));
        }

        jdata[jdata.length] = {
            BannerID: BannerId,
            CampaniaID: $('#ddlCampania').val(),
            GrupoBannerID: subgrid.jqGrid('getCell', BannerId, 'GrupoBannerID'),
            Titulo: subgrid.jqGrid('getCell', BannerId, 'Titulo'),
            Archivo: img01,
            URL: subgrid.jqGrid('getCell', BannerId, 'Url'),
            FlagGrupoConsultora: getControlCellValue(subgrid, subgrid.jqGrid('getCell', BannerId, 'FlagGrupoConsultora')),
            FlagConsultoraNueva: getControlCellValue(subgrid, subgrid.jqGrid('getCell', BannerId, 'FlagConsultoraNueva')),
            Paises: PaisId == 0 ? [] : [PaisId],
            EsRevisado: false,
            TipoContenido: subgrid.jqGrid('getCell', BannerId, 'TipoContenido'),
            PaginaNueva: subgrid.jqGrid('getCell', BannerId, 'PaginaNueva'),
            TipoAccion: subgrid.jqGrid('getCell', BannerId, 'TipoAccion'),
            CuvPedido: subgrid.jqGrid('getCell', BannerId, 'CuvPedido'),
            CantCuvPedido: subgrid.jqGrid('getCell', BannerId, 'CantCuvPedido')
        }
    }

    //Externer las funciones de la grilla
    $.jgrid.extend({
        CargaArchivo: function (id) {
            var nombreGrupo = $("#list").jqGrid('getCell', id, 'Nombre');
            var tiempoRotacion = $("#list").jqGrid('getCell', id, 'TiempoRotacion');
            var CampaniaId = $('#ddlCampania').val();

            //Limpiar control file
            var divcontainer = $('#flConsultoras').closest('div');
            divcontainer.html(divcontainer.html());
            $('#divMensaje li').remove(); //Limpiar mensajes de error

            //Setear valores
            $('#hdGrupoBannerIdArchivo').val(id);
            $('#hdCampaniaIdArchivo').val(CampaniaId);
            $('#txtTiempoRotacion').val(tiempoRotacion);
            $('#DialogCargarArchivo').dialog('option', 'title', nombreGrupo);
            $('#DialogCargarArchivo').dialog('open');
            return false;
        },

        CargaBanner: function (id) {
            var nombreGrupo = $("#list").jqGrid('getCell', id, 'Nombre');
            var BannerId = 0; //Ya que es nuevo
            var dimension = $("#list").jqGrid('getCell', id, 'Dimension');
            var CampaniaId = $('#ddlCampania').val();
            var Ancho = $("#list").jqGrid('getCell', id, 'Ancho');
            var Alto = $("#list").jqGrid('getCell', id, 'Alto');
            var ImagenMuestra = $("#ContenedorImagen");
            var DivlblArchivoCargado = $("#DivlblArchivoCargado");
            var contenedorArchivoCargado2 = $('#contenedorArchivoCargado2');

            //Variable global Operacion indica si actualiza grilla o subgrilla
            flgBnOperacionAct = flgBnOperacion.cargar;

            //Limpiar controles
            $('#txtTitulo').val('');
            $('#txtUrl').val('');
            $('#lblArchivoCargado').text('Ingresar Imagen');

            $('#img01').attr('src', '@Url.Content("~/Content/Images/prod_grilla_vacio.png")' + "");
            $('#imagenProducto01').val("");
            $('#hdnAccion').val("Insertar");
            $('#divMensaje li').remove(); //Limpiar mensajes de error
            $('#ddlTipoContenido').val("0");
            $('#ddlPaginaNueva').val("0");
            $('#txtTituloComentario').val("");
            $('#txtTextoComentario').val("");
            $('#ddlTipoAccion').val("0");
            $('#txtCUV').val("");
            $('#txtCantidad').val("");

            //Setear valores
            $('#hdCampaniaId').val(CampaniaId)
            $('#hdGrupoBannerIdBanner').val(id);
            $('#hdBannerId').val(BannerId);
            $('#hdFlagConsultora').val('false');
            $('#hdArchivoRutaCompleto').val('');
            $('#hdAncho').val(Ancho);
            $('#hdAlto').val(Alto);
            $('#lblArchivoCargado2').text('');

            if (id == 2 || id == 3 || id == 4 || id == 5 || id == 11 || id == 12 || id == 13 || id == 14 || id == 15 || id == 16 || id == 17 || id == 18 || id == 19 || id == 20 || id == 21 || id == 22 || id == 23 || id == 26) {
                $("#TipoContenido")[0].style['display'] = "block";
                DivlblArchivoCargado[0].style['display'] = 'none';
                ImagenMuestra[0].style['display'] = "block";
                contenedorArchivoCargado2[0].style['display'] = "none";
            }
            else {
                $("#TipoContenido")[0].style['display'] = "none";
                DivlblArchivoCargado[0].style['display'] = 'block';
                ImagenMuestra[0].style['display'] = "none";
                contenedorArchivoCargado2[0].style['display'] = "none";
            }

            if (id == 6 || id == 7 ||
                id == 8 || id == 9 ||
                id == 151 || id == 152 ||
                id == 153) {
                $("#TipoComentario")[0].style['display'] = "block";
            }
            else {
                $("#TipoComentario")[0].style['display'] = "none";
            }

            $("#div_cuv")[0].style['display'] = "none";
            $("#div_Url")[0].style['display'] = "block";
            $("#lblUrl")[0].innerHTML = "Url destino:";
            $("#DivbtnValidarUrl")[0].style['display'] = "block";
            $('#lblDimension').text(dimension);
            $('#DialogCargarBanner').dialog('option', 'title', nombreGrupo + ' - Nuevo Banner');
            $('#DialogCargarBanner').dialog('open');
            return false;
        },
        EditBanner: function (bannerId, obj) {

            var subgrid = $(obj).closest('table');
            var Titulo = subgrid.jqGrid('getCell', bannerId, 'Titulo');
            var GrupoBannerId = subgrid.jqGrid('getCell', bannerId, 'GrupoBannerID');
            var Url = subgrid.jqGrid('getCell', bannerId, 'Url');
            var Archivo = subgrid.jqGrid('getCell', bannerId, 'Archivo');
            var ArchivoRutaCompleto = subgrid.jqGrid('getCell', bannerId, 'ArchivoRutaCompleto');
            var BannerId = bannerId;
            var CampaniaId = $('#ddlCampania').val();
            var FlagConsultora = getControlCellValue(subgrid, subgrid.jqGrid('getCell', bannerId, 'FlagGrupoConsultora'));
            var dimension = $("#list").jqGrid('getCell', GrupoBannerId, 'Dimension');
            var Ancho = $("#list").jqGrid('getCell', GrupoBannerId, 'Ancho');
            var Alto = $("#list").jqGrid('getCell', GrupoBannerId, 'Alto');
            var TipoContenido = subgrid.jqGrid('getCell', bannerId, 'TipoContenido');
            var PaginaNueva = subgrid.jqGrid('getCell', bannerId, 'PaginaNueva');
            var TituloComentario = subgrid.jqGrid('getCell', bannerId, 'TituloComentario');
            var TextoComentario = subgrid.jqGrid('getCell', bannerId, 'TextoComentario');

            var TipoAccion = subgrid.jqGrid('getCell', bannerId, 'TipoAccion');
            var TextoCUVpedido = subgrid.jqGrid('getCell', bannerId, 'CuvPedido');
            var CantCUVpedido = subgrid.jqGrid('getCell', bannerId, 'CantCuvPedido');
            //Variable global Operacion indica si actualiza grilla o subgrilla
            flgBnOperacionAct = flgBnOperacion.editar;

            //Setear variable global IdSubGrilla para actualizarla
            idSubGrid = subgrid.attr('id');

            $('#img01').attr('src', ArchivoRutaCompleto);
            $('#imagenProducto01').val("");
            $('#hdnAccion').val("Actualizar");

            var botonvalidar = $("#DivbtnValidarUrl");
            var ddlTipoContenido = $("#ddlTipoContenido");
            var ddlPaginaNueva = $("#ddlPaginaNueva");
            var contenedor = $("#TipoContenido");
            var ImagenMuestra = $("#ContenedorImagen");
            var DivlblArchivoCargado = $("#DivlblArchivoCargado");
            var contenedorArchivoCargado2 = $('#contenedorArchivoCargado2');

            var ddlTipoAccion = $("#ddlTipoAccion");
            ddlTipoContenido.val(TipoContenido);
            ddlPaginaNueva.val(PaginaNueva);

            ddlTipoAccion.val(TipoAccion);

            if (TipoAccion == 0) {
                $("#div_cuv")[0].style['display'] = "none";
                $("#div_Url")[0].style['display'] = "block";
                $('#DivbtnValidarUrl').show();
                $('#div_Url').find('#lblUrl')[0].innerHTML = "Url destino:";
            }
            else if(TipoAccion == 1) {
                $("#div_cuv")[0].style['display'] = "block";
                $("#div_Url")[0].style['display'] = "none";
            }

            else if(TipoAccion == 2)
            {
                $("#div_cuv")[0].style['display'] = "none";
                $("#div_Url")[0].style['display'] = "block";
                $('#DivbtnValidarUrl').hide();
                $('#div_Url').find('#lblUrl')[0].innerHTML = "Id Curso:";
            }

            if (Number(GrupoBannerId) == 2 || Number(GrupoBannerId) == 3 || Number(GrupoBannerId) == 4 || Number(GrupoBannerId) == 5 || Number(GrupoBannerId) == 11 || Number(GrupoBannerId) == 12 || Number(GrupoBannerId) == 13 || Number(GrupoBannerId) == 14 || Number(GrupoBannerId) == 15 || Number(GrupoBannerId) == 16 || Number(GrupoBannerId) == 17 || Number(GrupoBannerId) == 18 || Number(GrupoBannerId) == 19 || Number(GrupoBannerId) == 20 || Number(GrupoBannerId) == 21 || Number(GrupoBannerId) == 22 || Number(GrupoBannerId) == 23 || Number(GrupoBannerId) == 26) {
                contenedor[0].style['display'] = "block";
                DivlblArchivoCargado[0].style['display'] = 'none';
                ImagenMuestra[0].style['display'] = "block";
                contenedorArchivoCargado2[0].style['display'] = "block";
                if (Number(TipoContenido) == 1) {
                    botonvalidar[0].style['display'] = "none";
                }
                else {

                    if (TipoAccion == 2) {
                        botonvalidar[0].style['display'] = "none";
                    }
                    else {
                        botonvalidar[0].style['display'] = "block";
                    }
                }
                ddlTipoContenido.val(TipoContenido);
            }
            else {
                contenedor[0].style['display'] = "none";
                ImagenMuestra[0].style['display'] = "none";
                DivlblArchivoCargado[0].style['display'] = 'block';
                contenedorArchivoCargado2[0].style['display'] = "none";
            }

            if (Number(GrupoBannerId) == 6 || Number(GrupoBannerId) == 7 ||
                Number(GrupoBannerId) == 8 || Number(GrupoBannerId) == 9 ||
                Number(GrupoBannerId) == 24 || Number(GrupoBannerId) == 25 ||
                Number(GrupoBannerId) == 151 || Number(GrupoBannerId) == 152 ||
                Number(GrupoBannerId) == 153) {
                $("#TipoComentario")[0].style['display'] = "block";
            }
            else {
                $("#TipoComentario")[0].style['display'] = "none";
            }

            //Setear valores
            $('#hdAncho').val(Ancho);
            $('#hdAlto').val(Alto);
            $('#hdCampaniaId').val(CampaniaId)
            $('#hdGrupoBannerIdBanner').val(GrupoBannerId);
            $('#hdBannerId').val(BannerId);
            $('#txtTitulo').val(Titulo);
            $('#txtUrl').val(Url);
            $('#hdFlagConsultora').val(FlagConsultora);
            $('#lblDimension').text(dimension);
            $('#lblArchivoCargado').text(Archivo);
            $('#lblArchivoCargado2').text('Archivo Cargado:' + Archivo);
            $('#hdArchivoRutaCompleto').val(ArchivoRutaCompleto);
            FormatearImagenes('#lblArchivoCargado');
            FormatearImagenes('#lblArchivoCargado2');
            FormatearImagenes('#hdArchivoRutaCompleto');
            $('#txtTituloComentario').val(TituloComentario);
            $('#txtTextoComentario').val(TextoComentario);
            $('#divMensaje li').remove(); //Limpiar mensajes de error
            $('#txtCUV').val(TextoCUVpedido);
            $('#txtCantidad').val(CantCUVpedido);

            $('#DialogCargarBanner').dialog('option', 'title', 'Editar Banner: ' + Titulo);
            $('#DialogCargarBanner').dialog('open');
            return false;
        },
        DeleteBanner: function (id, obj) {
            var subgrid = $(obj).closest('table');
            var Titulo = subgrid.jqGrid('getCell', id, 'Titulo');

            flgBnOperacionAct = flgBnOperacion.eliminar;
            idSubGrid = subgrid.attr('id');
            DltBannerID = id;

            $('#DialogEliminarBanner').dialog('option', 'title', 'Eliminar Banner: ' + Titulo);
            $('#DialogEliminarBanner').dialog('open');
            return false;
        },

        SegZonaBanner: function (id, hasGroupOrNew, obj) {
            var subgrid = $(obj).closest('table');
            var Titulo = subgrid.jqGrid('getCell', id, 'Titulo');
            var CampaniaId = $('#ddlCampania').val();
            $('#hdBannerIdSegZon').val(id);
            $('#ddlSegmentoBanner').empty();
            $('#ddlTipoAcceso').val('');
            $('#flConsultorasSegmento').val('');

            $("#flConsultorasSegmento").prop('disabled', hasGroupOrNew);

            flgBnOperacionAct = flgBnOperacion.editar;

            idSubGrid = subgrid.attr('id');
            $("#arbolRegionZona").html("");
            $('#ddlSegmentoBanner').empty();
            $.ajaxSetup({ cache: false });
            $.getJSON(baseUrl + 'Banner/ObtenerPaisesBanSegZona', { BannerId: id, CampaniaId: CampaniaId }, function (data) {
                if (checkTimeout(data)) {
                    var ddlPaisesBanSegZona = $('#ddlPaisesBanSegZona');
                    ddlPaisesBanSegZona.empty();
                    if (data.listapaises.length > 0) {
                        ddlPaisesBanSegZona.append($('<option/>', {
                            value: "",
                            text: "-- Seleccionar --"
                        }));
                        for (var item in data.listapaises) {
                            if (data.listapaises.hasOwnProperty(+item)) {
                                ddlPaisesBanSegZona.append($('<option/>', {
                                    value: data.listapaises[item].PaisID,
                                    text: data.listapaises[item].Nombre
                                }));
                            }
                        }
                    }
                }
            });

            $('#DialogSegZonaBanner').dialog('option', 'title', 'Segmento y Zonas: ' + Titulo);
            $('#DialogSegZonaBanner').dialog('open');
            return false;
        }
    });

    function FormatearImagenes(id) {
        var img01 = $(id).val().replace(/^.*[\\\/]/, '');
        if (img01.lastIndexOf("?") >= 0) {
            img01 = img01.substring(0, img01.lastIndexOf("?"));
        }
        $(id).val(img01);
    }
    //Crear el popup
    function IniDialog() {
        //Dialogo Grupo Banner
        $('#DialogCargarArchivo').dialog({
            autoOpen: false,
            resizable: false,
            modal: true,
            closeOnEscape: true,
            width: 700,
            draggable: true,
            title: "Grupo Banner",
            buttons:
            {
                "Grabar": function () {
                    var vMessage = "";
                    $('#frmCargarGrupoBanner').submit();
                },
                "Cancelar": function () {
                    $(this).dialog('close');
                }
            }
        });

        //Dialogo Banner
        $('#DialogCargarBanner').dialog({
            autoOpen: false,
            resizable: false,
            modal: true,
            closeOnEscape: true,
            width: 650,
            draggable: true,
            title: "Nuevo Banner",
            buttons:
            {
                "Grabar": function () {
                    var vMessage = "";
                    $('#frmCargarBanner').submit();
                },
                "Cancelar": function () {
                    $(this).dialog('close');
                }
            }
        });

        $('#DialogEliminarBanner').dialog({
            autoOpen: false,
            resizable: false,
            modal: true,
            closeOnEscape: true,
            width: 400,
            draggable: true,
            title: "Eliminar Banner",
            buttons:
            {
                "Eliminar": function () {
                    fnEliminarBanner(DltBannerID);
                },
                "Cancelar": function () {
                    $(this).dialog('close');
                }
            }
        });

        $('#DialogSegZonaBanner').dialog({
            autoOpen: false,
            resizable: false,
            modal: true,
            closeOnEscape: true,
            width: 810,
            draggable: true,
            title: "Segmento y Zona",
            buttons:
            {
                "Grabar": function () {
                    GuardarInformacionBannerSegmentoZona();
                },
                "Cancelar": function () {
                    $(this).dialog('close');
                }
            }
        });

        $('#DialogMensajesBanner').dialog({
            autoOpen: false,
            resizable: false,
            modal: true,
            closeOnEscape: true,
            width: 400,
            draggable: true,
            title: ":: Mensaje ::",
            buttons:
            {
                "Aceptar": function () {
                    $(this).dialog('close');
                }
            }
        });
    }

    function fnExtenderMetodosArray() {
        Array.prototype.getIndexbyBannerId = function (BannerId) {
            for (var i = 0; i < this.length; i++) {
                if (this[i].BannerID == BannerId) {
                    return i;
                }
            }
            return -1;
        };

        Array.prototype.insertPais = function (BannerId, PaisId) {
            var index = this.getIndexbyBannerId(BannerId);
            this[index].Paises.push(PaisId);
        }

        Array.prototype.deletePais = function (BannerId, PaisId) {
            var index = this.getIndexbyBannerId(BannerId);
            if (index != -1) {
                for (var i = 0; i < this[index].Paises.length; i++) {
                    if (this[index].Paises[i] == PaisId) {
                        this[index].Paises.splice(i, 1);
                    }
                }
            }
        }

        Array.prototype.ExistsPais = function (BannerId, PaisId) {
            var index = this.getIndexbyBannerId(BannerId);
            if (index == -1) return false;
            for (var i = 0; i < this[index].Paises.length; i++) {
                if (this[index].Paises[i] == PaisId) {
                    return true;
                }
            }
            return false;
        }
    }

    function fnRegistrarPaisPorBanner() {
        jQuery.ajax({
            type: 'POST',
            url: baseUrl + 'Banner/InsertarPaisPorBanner',
            dataType: 'json',
            contentType: 'application/json; charset=utf-8',
            data: JSON.stringify(jdata),
            async: true,
            success: function (result) {
                if (checkTimeout(result)) {
                    if (result.success == true) {
                        alert_msg(result.message);
                        //limpiar array
                        jdata = [];
                        jQuery("#list").setGridParam({ datatype: 'json', page: 1 }).trigger('reloadGrid');
                    }
                    else {
                        alert_msg('Error al realizar proceso, intentelo mas tarde.');
                    }
                }
            }
        });

        return false;
    }

    function fnValidarCuvMarquesina(cuv, idBanner) {
        var resultado;
        var data = {
            CampaniaID: $('#ddlCampania').val(),
            Cuv: cuv,
            IdBanner: idBanner
        };
        jQuery.ajax({
            type: 'POST',
            url: baseUrl + 'Pedido/ValidarCuvMarquesina',
            dataType: 'json',
            contentType: 'application/json; charset=utf-8',
            data: JSON.stringify(data),
            async: true,
            success: function (result) {
                if (checkTimeout(result)) {
                    resultado = result._validado;
                    if (result._validado == '0') {
                        alert('Cuv no valido');
                        $('#txtCUV').val("");
                    }
                    if (result._validado == '-1') {
                        alert('Debe Asignar primero un país.');
                        $('#txtCUV').val("");
                    }
                }
            }
        });

        return resultado;
    }
    function fnEliminarBanner(BannerId) {
        var data = {
            CampaniaID: $('#ddlCampania').val(),
            BannerID: BannerId
        };
        jQuery.ajax({
            type: 'POST',
            url: baseUrl + 'Banner/EliminarBanner',
            dataType: 'json',
            contentType: 'application/json; charset=utf-8',
            data: JSON.stringify(data),
            async: true,
            success: function (result) {
                if (checkTimeout(result)) {
                    if (result.success == true) {
                        $("#" + idSubGrid).setGridParam({ datatype: 'json', page: 1 }).trigger('reloadGrid');
                        alert_msg(result.message);
                    }
                    else {
                        alert_msg('Error al realizar proceso, intentelo mas tarde.');
                    }

                    $('#DialogEliminarBanner').dialog('close');
                }
            }
        });

        return false;
    }

    function getControlCellValue(subgrid, controlHtml) {
        var id = $(controlHtml).attr('id');
        var cellvalue = subgrid.find('#' + id).is(':checked');
        return cellvalue;
    }

    function alert_msg(message) {
        $('#DialogMensajesBanner .message_text').html(message);
        $('#DialogMensajesBanner').dialog('open');
    }

    function htmlDecode(value) {
        if (value) {
            return $('<div />').html(value).text();
        } else {
            return '';
        }
    }

</script>

<div class="wrap_cab">

    <div class="filtros2">
        <div class="elements">
            <div class="div-2">
                <h1>Gestión<span> de Banners</span></h1>
            </div>
            <div class="div-3">
                <div class="titC">Campaña:</div>
                <div class="selectA borde_redondeado">
                    @Html.DropDownListFor(model => model.NombreCorto, new SelectList(Model.DropDownListCampania, "CampaniaID", "Codigo"), new { id = "ddlCampania" })
                </div>
                <div class="input_search">
                    <input type="hidden" id="hdTipoBanner" />
                    <a href="#" id="lnkAdmBanPrincipalSB2">
                        <img title="Preview y Orden de Banner Principal SB2" src='@Url.Content("~/Content/Images/preview_banner_prin.png")' alt="" />
                    </a>
                    <a href="#" id="lnkAdmBanPrincipal">
                        <img title="Preview y Orden de Banner Principal" src='@Url.Content("~/Content/Images/preview_banner_prin.png")' alt="" />
                    </a>
                    <a href="#" id="lnkAdmBanBaja">
                        <img title="Preview y Orden de Banner Comentario" src='@Url.Content("~/Content/Images/preview_banner_com.png")' alt="" />
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="wrap">
    <div class="container clearfix" style="width: 1135px;">
        <div id="divContenedorGrid" class="border-wrapper">
            <div class="grilla_banner">
                <table id="list"></table>
            </div>
        </div>
        <div class="sep"></div>
        <div class="div-3">
            <div class="input_validar">
                <input id="btnCancelar" type="button" value="Cancelar" title="Cancelar" style="display: none;" />
                <input id="btnGuardar" type="button" value="Grabar" title="Grabar" style="display: none;" />
            </div>
        </div>
    </div>
</div>


<div id="loadingScreen"></div>

<div id="DialogCargarArchivo">
    @using (Html.BeginForm("InsertarGrupoBanner", "Banner", FormMethod.Post, new { id = "frmCargarGrupoBanner", enctype = "multipart/form-data" }))
    {
        @Html.HiddenFor(model => model.CampaniaID, new { id = "hdCampaniaIdArchivo" })
        @Html.HiddenFor(model => model.GrupoBannerID, new { id = "hdGrupoBannerIdArchivo" })
        <div class="Content_modal">
            <div class="div-3">
                <div class="titE">Tiempo de rotación (en segs):</div>
                <div class="selectA borde_redondeado">
                    @Html.TextBoxFor(model => model.TiempoRotacion, new { @class = "input_search_form", maxlength = 5, id = "txtTiempoRotacion" })
                </div>
            </div>
            <div class="div-3">
                <div class="titE">Especificar un grupo de consultoras:</div>
                <div class="input_file">
                    <input type="file" name="flConsultoras" id="flConsultoras" />
                </div>
            </div>
        </div>
        @Html.ValidationSummary(null, new { @class = "validation-error-server", @id = "divMensaje" })
    }
</div>

<div id="DialogCargarBanner" style="display: none">
    @using (Html.BeginForm("InsertarActualizar", "Banner", FormMethod.Post, new { id = "frmCargarBanner" }))
    {

        @Html.HiddenFor(model => model.CampaniaID, new { id = "hdCampaniaId" })
        @Html.HiddenFor(model => model.GrupoBannerID, new { id = "hdGrupoBannerIdBanner" })
        @Html.HiddenFor(model => model.BannerID, new { id = "hdBannerId", value = "0" })
        @Html.HiddenFor(model => model.Orden, new { id = "hdOrden", value = "0" })
        @Html.HiddenFor(model => model.FlagGrupoConsultora, new { id = "hdFlagConsultora", value = "false" })
        @Html.HiddenFor(model => model.Archivo, new { id = "hdArchivoRutaCompleto" })
        @Html.HiddenFor(model => model.Ancho, new { id = "hdAncho" })
        @Html.HiddenFor(model => model.Alto, new { id = "hdAlto" })
        @Html.HiddenFor(model => model.ImagenActualizar, new { id = "imagenProducto01" })
        @Html.HiddenFor(model => model.Accion, new { id = "hdnAccion" })
        <div class="Content_modal">
            <div class="div-3">
                <div class="titG">Título de banner:</div>
                <div class="selectP borde_redondeado" style="width: 335px;">
                    @Html.TextBoxFor(model => model.Titulo, new { @class = "input_search_form", maxlength = 150, id = "txtTitulo" })
                </div>
            </div>
            <div class="div-3">
                <div class="titG">Nombre de archivo:</div>
                <div class="selectP borde_redondeado" align="center" style="height: 100px; width: 335px;" id="ContenedorImagen">
                    <img src='@Url.Content("~/Content/Images/prod_grilla_vacio.png")' id="img01" width="85" height="100">
                </div>
                <div class="selectA borde_redondeado" id="DivlblArchivoCargado" style="width: 335px;"><span id="lblArchivoCargado"></span></div>
            </div>
            <div class="div-3">
                <div class="titG"></div>
                <div class="input_search">
                    <div id="flUpload">
                        <script type="text/javascript">
                            $.ajaxSetup({ cache: false });
                            var uploader = new qq.FileUploader({
                                allowedExtensions: ['jpg', 'png', 'jpeg','gif'],
                                element: document.getElementById('flUpload'),
                                action: '@Url.Action("ImageMatrizUpload", "Banner")',
                                onComplete: function (id, fileName, responseJSON) {
                                    if (checkTimeout(responseJSON)) {
                                        $(".qq-upload-list")[0].style['display'] = "none";
                                        $(".qq-upload-list").css("display", "none");
                                        if (responseJSON.success) {
                                            $("#imagenProducto01").val(responseJSON.name);
                                            $("#lblArchivoCargado").text(responseJSON.name);
                                            $('#img01').attr('src', '@Url.Content("~/Content/Temporales/")' + responseJSON.name);
                                        }
                                        else {
                                            alert(responseJSON.message);
                                        }
                                    }
                                },
                                onSubmit: function (id, fileName) { $(".qq-upload-list").css("display", "none"); $(".qq-upload-list")[0].style['display'] = "none"; },
                                onProgress: function (id, fileName, loaded, total) { $(".qq-upload-list").css("display", "none"); $(".qq-upload-list")[0].style['display'] = "none"; },
                                onCancel: function (id, fileName) { $(".qq-upload-list").css("display", "none"); $(".qq-upload-list")[0].style['display'] = "none"; }
                            });
                        </script>
                    </div>
                </div>
            </div>
            <div class="div-3" id="contenedorArchivoCargado2" style="height: 25px; padding: 0px; margin: 0px;">
                <div class="titAuto" style="height: 22px; padding: 0px;"><span id="lblArchivoCargado2"></span></div>
            </div>
            <div class="div-3" id="TipoContenido" style="display: none;">
                <div class="titG">Pagina Nueva</div>
                <div class="selectH2 borde_redondeado">
                    @Html.DropDownListFor(model => model.PaginaNueva, new SelectList(Model.DropDownListPaginaNueva, "PaginaNueva", "PaginaNuevaNombre"), new { id = "ddlPaginaNueva" })
                </div>
                <div class="titG">Tipo de Contenido:</div>
                <div class="selectH borde_redondeado">
                    @Html.DropDownListFor(model => model.TipoContenido, new SelectList(Model.DropDownListTipoContenido, "TipoContenido", "TipoContenidoNombre"), new { id = "ddlTipoContenido" })
                </div>
            </div>
            <div id="TipoComentario" style="display: none;">
                <div class="div-3">
                    <div class="titG">Título:</div>
                    <div class="selectP borde_redondeado" style="width: 335px;">
                        @Html.TextBoxFor(model => model.TituloComentario, new { @class = "input_search_form", maxlength = 120, id = "txtTituloComentario", name = "TituloComentario" })
                    </div>
                </div>
                <div class="div-3">
                    <div class="titG">Texto:</div>
                    <div class="selectP borde_redondeado" style="width: 335px;">
                        @Html.TextAreaFor(model => model.TextoComentario, new { @class = "input_search_form", maxlength = 120, id = "txtTextoComentario", name = "TextoComentario" })
                    </div>
                </div>
            </div>
            <div class="div-3">
                <div class="titG">Acci&oacute;n:</div>
                <div class="selectH3 borde_redondeado">

                    @Html.DropDownListFor(model => model.TipoAccion, new SelectList(Model.DropDownListTipoAccion, "TipoAccion", "TipoAccionNombre"), new { id = "ddlTipoAccion" })
                </div>
            </div>

            <div id="div_Url">
                <div class="div-3">


                    <div class="titG" id="lblUrl">Url destino:</div>
                    <div class="selectP borde_redondeado" style="width: 335px;">
                        @Html.TextBoxFor(model => model.URL, new { @class = "input_search_form", maxlength = 300, id = "txtUrl" })
                    </div>
                </div>
                <div class="div-3" id="DivbtnValidarUrl">
                    <div class="titG"></div>
                    <div class="input_modifica">
                        <input type="button" id="btnValidarUrl" value="Validar Url Destino" />
                    </div>
                </div>
            </div>

            <div id="div_cuv" style="display: none;">
                <div class="div-3">
                    <div class="titG">CUV:</div>
                    <div class="selectP borde_redondeado" style="width: 100px;">
                        @Html.TextBoxFor(model => model.CUV, new { @class = "input_search_form2", maxlength = 5, id = "txtCUV", onblur = "ValidarCUVMarquesina()" })
                    </div>
                </div>
                <div class="div-3">
                    <div class="titG">Cantidad a añadir:</div>
                    <div class="selectP borde_redondeado" style="width: 100px;">
                        @Html.TextBoxFor(model => model.cantidadPedido, new { @class = "input_search_form2", maxlength = 2, id = "txtCantidad" })
                    </div>
                </div>
            </div>
            <div>NOTA: El archivo de imagen debe tener las siguientes <span id="lblDimension"></span></div>
        </div>
        @Html.ValidationSummary(null, new { @class = "validation-error-server", @id = "divMensaje" })
    }
</div>

<div id="DialogEliminarBanner">
    <div class="Content_modal">
        <div class="message">
            ¿Está seguro que desea eliminar el Banner seleccionado?
        </div>
    </div>
</div>

<div id="DialogSegZonaBanner" style="display: none">
    <div class="Content_modal">
        @Html.Hidden("hdBannerIdSegZon")
        <div class="div-3">
            <div class="titC">País:</div>
            <div class="selectA borde_redondeado">
                <select id="ddlPaisesBanSegZona"></select>
            </div>
        </div>
        <div>
            <div style="float:left">
                <div class="div-3">
                    <div class="titC">Segmento:</div>
                    <div class="selectA borde_redondeado">
                        <ul id="ddlSegmentoBanner"></ul>&nbsp;
                    </div>
                </div>
            </div>
            <div style="float:left">
                <div class="div-3">
                    <div class="titC">Jerarquía:</div>
                    <div class="treeview_content borde_redondeado">
                        <div id="arbolRegionZona" class="demo">
                        </div>
                    </div>
                </div>
                <div class="div-3">
                    <div class="titC"></div>
                    <div class="titH">
                        <div style="float:left">
                            <label id="lblSeleccionar">
                                <input type="checkbox" id="chkSeleccionar" />

                            </label>
                        </div>
                        <div style="float:left; margin-top:10px">
                            Seleccionar todo
                        </div>
                    </div>
                </div>
                <div style="clear: both"></div>
            </div>
            <div class="div-3">
                <div class="titC">Tipo de Acceso:</div>
                <div class="selectA borde_redondeado">
                    <select id="ddlTipoAcceso">
                        <option value="">-- Seleccionar --</option>
                        <option value="@Constantes.TipoAccesoSegmento.Inclusion">Inclusión</option>
                        <option value="@Constantes.TipoAccesoSegmento.Exclusion">Exclusión</option>
                    </select>
                </div>
            </div>
            <div class="div-3">
                <div class="titC">Adjuntar Consultoras:</div>
                <div class="input_file">
                    <input type="file" id="flConsultorasSegmento" value="" accept=".csv" />
                    <div style="margin-top:15px">Formato de Archivo (*.csv) <br> - Código Consultora</div>
                </div>
            </div>
        </div>
    </div>

    <div id="DialogMensajesBanner">
        <div class="Content_modal">
            <div class="message_text">
                Ocurrió un error en la comunicación o la sesión ha expirado. Por favor vuelva a autenticarse.
            </div>
        </div>
    </div>
    @Html.Hidden("hdn_SeccionID")
    <div id="DialogPreviewBanPrincipal" style="display: none">
        <div class="Content_modal">
            <div class="div-3">
                <div class="titC">País:</div>
                <div class="selectA borde_redondeado">
                    <select id="ddlPaisesBanPrinpl"></select>
                </div>
            </div>
            <div class="border_banner" id="divBanPPreview">
            </div>
        </div>
    </div>

    <div id="DialogPreviewBanPrincipalSB2" style="display: none">
        <div class="Content_modal">
            <div class="div-3">
                <div class="titC">País:</div>
                <div class="selectA borde_redondeado">
                    <select id="ddlPaisesBanPrinpl_SB2"></select>
                </div>
            </div>
            <div class="border_banner" id="divBanPPreviewSB2">
            </div>
        </div>
    </div>

    <div id="DialogPreviewBanBaja" style="display: none">
        <div class="Content_modal">
            <div class="div-3">
                <div class="titC">País:</div>
                <div class="selectA borde_redondeado">
                    <select id="ddlPaisesBanBaja"></select>
                </div>
            </div>
            <div class="border_banner" id="divBanBPreview">
            </div>
        </div>
    </div>
    <div id="DialogImagenContainer" style="display: none;">
        <div class="Content_modal">
            <img src='' id="imgModal" />
        </div>
    </div>
