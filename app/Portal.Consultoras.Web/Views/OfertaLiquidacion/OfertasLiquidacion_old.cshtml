@{
    Layout = "~/Views/Shared/_MainLayout.cshtml";
    ViewBag.Title = "OfertasLiquidacion";
}

<style>

    .message_text {
    background: #FFF;
    padding: 20px 10px 10px 10px;
    /*max-height: 350px;*/
    /* overflow: auto; */
    border: 1px solid #D0D0D0;
    -webkit-border-radius: 10px; /* Para Safari y Chrome */
    -moz-border-radius: 10px; /* Para Firefox */
    -khtml-border-radius: 10px; /* Navegadores de Linux */
    border-radius: 10px; /* CSS3 */
    behavior: url(../../../../Content/Css/Pie/PIE.htc); /* Para IE */
    position: relative;
}



</style>

<script type="text/javascript">
    $(function () {

        //R2469 - Cargando Marcador 
        @{List<object> arrayEstrategia = new List<object>();
          int posProducto = 0;
          string variantcad = "";
          string categoriacad = "";}
        @foreach (var item in ViewBag.ListaOfertasLiquidacion)
        {
            posProducto += 1;

            if (item.DescripcionEstrategia == null || item.DescripcionEstrategia == "")
            {
                variantcad = "Estándar";
            }
            else { variantcad = item.DescripcionEstrategia; }

            if (item.DescripcionCategoria == null || item.DescripcionCategoria == "")
            {
                categoriacad = "Sin Categoría";
            }
            else { categoriacad = item.DescripcionCategoria; }
            
            arrayEstrategia.Add(new
            {
                name = item.Descripcion,
                id = item.CUV,
                price = item.PrecioOferta.ToString(),
                brand = item.DescripcionMarca,
                category = categoriacad,
                variant = variantcad,
                 list = "Liquidación Web",
                position = posProducto
                
               
            });
        }
        var arrayJS = '@Html.Raw(Json.Encode(arrayEstrategia))';
         //R2469 - JICM - Control C.       
        if ($.parseJSON(arrayJS) != null) {

            if ($.parseJSON(arrayJS).length > 0) {

                dataLayer.push({

                    'event': 'productImpression',
                    'ecommerce': {
                        'impressions': $.parseJSON(arrayJS)//arrayJS

                    }
                });

            }

        }


        //FIN R2469

        $(window).scroll(function () {
            if ($(this).scrollTop() > 70) {
                $('.productos_fixed').addClass("fixed");
            } else {
                $('.productos_fixed').removeClass("fixed");
            }
        });

        $('.ValidaNumeralOferta').live('keyup', function (evt) {
            var theEvent = evt || window.event;
            var key = theEvent.keyCode || theEvent.which;
            key = String.fromCharCode(key);
            var regex = /[0-9]|\./;
            if (!regex.test(key)) {
                theEvent.returnValue = false;
                if (theEvent.preventDefault) theEvent.preventDefault();
            }
        });

        $('.ValidaNumeralOferta').live('keypress', function (e) {
            if (e.which != 8 && e.which != 0 && (e.which < 48 || e.which > 57)) {
                return false;
            }
        });
        IniDialog();
        $("#btnVerPedido").click(function () {
            _gaq.push(['_trackEvent', 'Liquidacion-Web', 'Ver-Pedido']);
            dataLayer.push({
                'event': 'pageview',
                'virtualUrl': '/Liquidacion-Web/Ver-Pedido'
            });
            location.href = '@Url.Action("Index", "Pedido")';
        });

        $('.ValidaNumeralOferta').keypress(function (e) {
            if (e.which == 13) {
                var object = $(this).parent().find(".btnAdd");
                var estado = $(this).parent().find(".btnAdd")[0].disabled;
                if (!estado)
                    AgregarOfertaProducto(object, 0);
            }
        })

        ReservadoOEnHorarioRestringido();
        
        //if (HorarioRestringido())
            //setTimeout(function () { location.href = '@Url.Action("Index", "Bienvenida")'; }, 2500);
    });

    function HorarioRestringido() {
        var horarioRestringido = false;
        jQuery.ajax({
            type: 'GET',
            url: baseUrl + 'Pedido/EnHorarioRestringido',
            dataType: 'json',
            contentType: 'application/json; charset=utf-8',
            async: false,
            success: function (data) {
                if (checkTimeout(data)) {
                    if (data.success == true) {
                        alert_msgHorario(data.message);
                        //$("#DialogMensajeHorario").siblings(".ui-dialog-titlebar").hide();
                        horarioRestringido = true;
                    }
                }
            },
            error: function (data, error) {
                if (checkTimeout(data)) {
                    alert(data.message);
                }
            }
        });
        return horarioRestringido;
    }

    function IniDialog() {
        $('#DialogMensajeProducto').dialog({
            autoOpen: false,
            resizable: false,
            modal: true,
            closeOnEscape: true,
            width: 500,
            draggable: true
        });

        $('#DialogMensajesBanner').dialog({
            autoOpen: false,
            resizable: false,
            modal: true,
            closeOnEscape: true,
            width: 400,
            draggable: true,
            title: ":: Mensaje ::",
            buttons:
            {
                "Aceptar": function () {
                    $(this).dialog('close');
                }
            }
        });

        $('#DialogMensajeHorario').dialog({
            autoOpen: false,
            resizable: false,
            modal: true,
            closeOnEscape: false,
            width: 400,
            draggable: true,
            title: ":: Mensaje ::",
            open: function (event, ui) { $(".ui-dialog-titlebar-close").hide(); },
            buttons:
            {
                "Aceptar": function () {
                    location.href = '@Url.Action("Index", "Bienvenida")';
                }
            }
        });
    }

    //function alert_msg(message) {
    //    $('#DialogMensajesBanner .message_text').html(message);
    //    $('#DialogMensajesBanner').dialog('open');
    //}
   
    function alert_msg(message, fnClose) {
        $('#DialogMensajesBanner .message_text').html(message);
        if ($.isFunction(fnClose)) $('#DialogMensajesBanner').dialog({ close: fnClose });
        else $('#DialogMensajesBanner').dialog({ close: null });

        $('#DialogMensajesBanner').dialog('open');
    }

    function alert_msgHorario(message) {
        $('#DialogMensajeHorario .message_text').html(message);
        $('#DialogMensajeHorario').dialog('open');
    }

</script>
<div class="wrap_cab">
    <div class="filtros">
        <div class="elements">
            <div class="productos_fixed">
                <div class="productos_fixed_main">
                    <div class="div-2">
                        <h1>Liquidación <span>Web</span></h1>
                        <div class="title">
                            <div>Estos productos solo pueden ser pedidos por web. Suman al monto mínimo del pedido. No suma la escala</div>
                            <div>de comisión, ni otorga puntaje, ni comisión.</div>
                            <div>No hay límite de unidades. Precio neto consultora. Los productos son vigentes durante la campaña @ViewBag.CampaniaID.</div>
                            <div style="color:red;">Se atenderá hasta agotar stock.</div>
                        </div>
                    </div>
                    <div class="carrito">
                        <div class="carrito_compras">
                            <div><span id="spCantidadItems">0</span> productos agregados</div>
                        </div>
                        <div class="input_ver_pedido">
                            <input type="button" id="btnVerPedido" value="Ver mi pedido" />
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="wrap">
    <div class="container clearfix">
        <div class="">
            @Html.Partial("_ListadoOfertas")
        </div>
    </div>
</div>
<div id="loadingScreen"></div>
<div id="DialogMensajeProducto" style="display: none;">
    <div>
        <div id="divReservaSatisfactoria" class="modal_1">
            <div class="modal_1_title color_title">Estimada Consultora, debe ir a la opción de Ver Mi Pedido para verificar las Ofertas de Liquidación agregadas.</div>
        </div>
        <div class="div-3">
            <div class="input_modal">
                <input type="button" value="Cerrar" onclick="$('#DialogMensajeProducto').dialog('close');" />
            </div>
        </div>
    </div>
</div>

<div id="DialogMensajesBanner" style="display: none;">
    <div class="message_text">
        Ocurrió un error en la comunicación o la sesión ha expirado. Por favor vuelva a autenticarse.        
    </div>
</div>
