@model Portal.Consultoras.Web.Models.TipoEstrategiaModel
@{
    ViewBag.Title = "Administrar Tipo de Estrategia";
}
<script src="@Url.Content("~/Scripts/fileuploader.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery.form.js")" type="text/javascript"></script>
<script type="text/javascript">
    jQuery(document).ready(function () {
        IniDialog();
        fnGrilla();

        $.ajaxSetup({ cache: false });

        $("#btnNuevo").click(function () {
            if ($("#ddlPais").val() == "") {
                alert("Debe seleccionar el País, verifique.");
                return false;
            }
            $.ajaxSetup({ cache: false });
            $("#chkNueva").attr("checked", false);
            $("#chkRecoProduc").attr("checked", false);
            $("#chkRecoPerfil").attr("checked", false);
            $("#txtPaisOferta").val($("#ddlPais option:selected").html());
            $("#txtPaisModal").val($("#ddlPais option:selected").html());
            $("#hdPais").val($("#ddlPais").val());
            $("#txtDescripcionOriginalModal").val("");
            $("#txtOrden").val("");
            $('#img01').attr('src', '@Url.Content("~/Content/Images/prod_grilla_vacio.png")');
            $('#imgOfertaIndependiente').attr('src', '@Url.Content("~/Content/Images/prod_grilla_vacio.png")');
            $("#hdofertas").val("");
            $("#chkActivo").attr("checked", true);
            $("#imagenProducto01").val("");
            $("#imagenProductoAnterior01").val("");
            $("#hdImagenOfertaIndependiente").val("");
            $("#hdImagenOfertaIndependienteAnterior").val("");


            $("#hdTipoEstrategiaID").val("0");
            $("#txtCodigoPrograma").prop('disabled', true).val("");

            $("#chkMostrarImg").attr("checked", false);
            $("#chkMostrarImgIndependiente").attr("checked", false);
            $(".divOfertaIndependiente").hide();

			$("#chkValImg").attr("checked", false);
			$("#txtPesoMaximoImagen").val("0");

            fnGrillaOfertas('0');
            showDialog("DialogAdministracionTipoEstrategia");
        });
        $("#btnNuevaOferta").click(function () {
            $("#txtCodigoOferta").val("");
            $("#txtDescripcionOferta").val("");
            $("#txtCodigoOferta").focus();

            showDialog("DialogAdministracionNuevaOferta");
        });
        $("#btnBuscar").click(function () {

            if ($("#ddlPais").val() == "") {
                alert("Debe seleccionar el País, verifique.");
                return false;
            }

            if ($("#ddlCampania").val() == "") {
                alert("Debe seleccionar la Campaña, verifique.");
                return false;
            }

            $("#hdTipoConsulta").val("1");

            fnGrilla();
        });
        $("#chkNueva").click(function () {
            $(".divOfertaIndependiente").toggle();
            if ($("#chkNueva").attr('checked')) {
                $("#chkRecoProduc").removeAttr('checked');
                $("#chkRecoPerfil").removeAttr('checked');
                $("#txtCodigoPrograma").prop('disabled', false);
            }
        });
        $("#chkRecoProduc").click(function () {
            $(".divOfertaIndependiente").hide();
            if ($("#chkRecoProduc").attr('checked')) {
                $("#chkNueva").removeAttr('checked');
                $("#chkRecoPerfil").removeAttr('checked');
                $("#txtCodigoPrograma").attr('disabled', true);
                $("#txtCodigoPrograma").val(null);
            }
        });
        $("#chkRecoPerfil").click(function () {
            $(".divOfertaIndependiente").hide();
            if ($("#chkRecoPerfil").attr('checked')) {
                $("#chkNueva").removeAttr('checked');
                $("#chkRecoProduc").removeAttr('checked');
                $("#txtCodigoPrograma").attr('disabled', true);
                $("#txtCodigoPrograma").val(null);
            }
        });

		$("#chkValImg").click(function () {
            if ($("#chkValImg").attr('checked')) {
                $("#txtPesoMaximoImagen").attr('disabled', false);
                $("#txtPesoMaximoImagen").val("0");
            }
			else
			{
				$("#txtPesoMaximoImagen").attr('disabled', true);
				$("#txtPesoMaximoImagen").val("0");
			}
        });

		$(document).ready(function() {
			$("#txtPesoMaximoImagen").keydown(function (e) {
				if ($.inArray(e.keyCode, [46, 8, 9, 27, 13, 110, 190]) !== -1 ||
					(e.keyCode == 65 && e.ctrlKey === true) || 
					(e.keyCode >= 35 && e.keyCode <= 39)) {
						 return;
				}
 
				if ((e.shiftKey || (e.keyCode < 48 || e.keyCode > 57)) && (e.keyCode < 96 || e.keyCode > 105)) {
					e.preventDefault();
				}
			});
		});

        $("#btnAgregarOferta").click(function () {

            var ofertaID = $("#hdofertaid").val();
            var paisID = $("#hdPais").val();
            var codigoOferta = $("#txtCodigoOferta").val();
            var descripcionOferta = $("#txtDescripcionOferta").val();
            var flagNueva = ($("#chkNueva").attr("checked")) ? true : false;
            var codigoPrograma = flagNueva ? $("#txtCodigoPrograma").val() : null;
            if (flagNueva && $("#txtCodigoPrograma").val() == "") {
                alert("No ingresó Codigo de Programa");
                return false;
            }

            if ($.trim(codigoOferta) == "") {
                alert("No ingresó el código de oferta.");
                return false;
            }

            if ($.trim(descripcionOferta) == "") {
                alert("No ingresó la descripción de oferta.");
                return false;
            }


            var params = {
                OfertaID: ofertaID,
                PaisID: paisID,
                CodigoOferta: codigoOferta,
                DescripcionOferta: descripcionOferta,
                CodigoPrograma: codigoPrograma
            };

            jQuery.ajax({
                type: 'POST',
                url: baseUrl + 'AdministrarTipoEstrategia/RegistrarOferta',
                dataType: 'json',
                contentType: 'application/json; charset=utf-8',
                data: JSON.stringify(params),
                async: true,
                success: function (data) {
                    if (checkTimeout(data)) {
                        if (data.success == true) {

                            var id = $("#hdTipoEstrategiaID").val()
                            var ofertas = $("#hdofertas").val() + codigoOferta + ',';
                            $("#hdofertas").val(ofertas);

                            $("#hdofertaid").val("0");
                            $("#txtCodigoOferta").val("");
                            $("#txtDescripcionOferta").val("");
                            $("#btnAgregarOferta").val("Agregar");
                            $("#txtCodigoOferta").focus();

                            fnGrillaOfertas(id);
                        }
                        else {
                            alert(data.message);
                        }
                    }
                },
                error: function (data, error) {
                    if (checkTimeout(data)) {
                        alert(data.message);
                        HideDialog("DialogAdministracionNuevaOferta");
                    }
                }
            });

        });
    });


    function fnGrilla() {

        jQuery("#list").jqGrid({
            url: baseUrl + "AdministrarTipoEstrategia/Consultar",
            hidegrid: false,
            datatype: 'json',
            postData: ({
                CampaniaID: function () { return jQuery.trim($("#ddlCampania").val()); },
                PaisID: function () { return jQuery.trim($("#ddlPais").val()); },
                Consulta: function () { return jQuery.trim($("#hdTipoConsulta").val()); }
            }),
            mtype: 'GET',
            contentType: "application/json; charset=utf-8",
            colNames: ['TipoEstrategiaID', 'Código de Estrategia', 'Tipo de Estrategia', 'Ofertas', 'Orden', 'Imagen', 'OfertaID', 'Acción', '', '', '', 'CodigoPrograma', 'FlagMostrarImg', 'MostrarImgOfertaIndependiente','ImagenOfertaIndependiente','FlagValidarImagen', 'PesoMaximoImagen'],
            colModel: [
                { name: 'TipoEstrategiaID', index: 'TipoEstrategiaID', width: 20, editable: true, resizable: false, hidden: true },
                { name: 'Codigo', index: 'Codigo', width: 100, editable: true, resizable: false, hidden: false },
                { name: 'DescripcionEstrategia', index: 'DescripcionEstrategia', width: 180, editable: true, resizable: false, hidden: false },
                { name: 'DescripcionOferta', index: 'DescripcionOferta', width: 180, editable: true, hidden: false, formatter: ShowOferta },
                { name: 'Orden', index: 'Orden', width: 40, editable: true, align: 'center', resizable: false },
                { name: 'ImagenEstrategia', index: 'ImagenEstrategia', width: 70, editable: true, resizable: false, sortable: false, align: 'center', formatter: ShowImage },
                { name: 'OfertaID', index: 'OfertaID', width: 0, editable: true, resizable: false, hidden: true },
                { name: 'FlagActivo', index: 'FlagActivo', width: 40, align: 'center', editable: true, resizable: false, formatter: ShowActions },
                { name: 'FlagNueva', index: 'FlagNueva', width: 0, editable: true, resizable: false, hidden: true },
                { name: 'FlagRecoProduc', index: 'FlagRecoProduc', width: 0, editable: true, resizable: false, hidden: true },
                { name: 'FlagRecoPerfil', index: 'FlagRecoPerfil', width: 0, editable: true, resizable: false, hidden: true },
                { name: 'CodigoPrograma', index: 'CodigoPrograma', width: 0, editable: true, resizable: false, hidden: true },
                { name: 'FlagMostrarImg', index: 'FlagMostrarImg', width: 0, editable: true, resizable: false, hidden: true },
                { name: 'MostrarImgOfertaIndependiente', index: 'MostrarImgOfertaIndependiente', width: 0, editable: false, resizable: false, hidden: true },
                { name: 'ImagenOfertaIndependiente', index: 'ImagenOfertaIndependiente', width: 0, editable: false, resizable: false, hidden: true, formatter: ShowImage  },
				{ name: 'FlagValidarImagen', index: 'FlagValidarImagen', width: 0, editable: true, resizable: false, hidden: true },
				{ name: 'PesoMaximoImagen', index: 'PesoMaximoImagen', width: 180, editable: true, resizable: false, hidden: true },
            ],
            jsonReader:
            {
                root: "rows",
                page: "page",
                total: "total",
                records: "records",
                repeatitems: true,
                cell: "cell",
                id: "id"
            },
            pager: jQuery('#pager'),
            loadtext: 'Cargando datos...',
            recordtext: "{0} - {1} de {2} Registros",
            emptyrecords: 'No hay resultados',
            rowNum: 10,
            scrollOffset: 0,
            rowList: [10, 20, 30, 40, 50],
            sortname: 'Mensaje',
            sortorder: 'asc',
            viewrecords: true,
            multiselect: false,
            height: 'auto',
            width: 930,
            pgtext: 'Pág: {0} de {1}',
            altRows: true,
            altclass: 'jQGridAltRowClass',
            loadComplete: function () { },
            gridComplete: function () { }
        });
        jQuery("#list").jqGrid('navGrid', "#pager", { edit: false, add: false, refresh: false, del: false, search: false });
        jQuery("#list").setGridParam({ datatype: 'json', page: 1 }).trigger('reloadGrid');
    }

    function fnGrillaOfertas(id) {
        $("#listaOfertas").jqGrid("GridUnload");
        var url = "AdministrarTipoEstrategia/ConsultarOfertas/" + id
        jQuery("#listaOfertas").jqGrid({
            url: baseUrl + url,
            hidegrid: false,
            datatype: 'json',
            mtype: 'GET',
            contentType: "application/json; charset=utf-8",
            colNames: ['', 'Codigo', 'Descripción', ''],
            colModel: [
                { name: 'OfertaID', index: 'OfertaID', width: 10, editable: true, resizable: false, hidden: false, formatter: ShowChecks },
                { name: 'CodigoOferta', index: 'CodigoOferta', width: 30, editable: true, resizable: false, hidden: false },
                { name: 'DescripcionOferta', index: 'DescripcionOferta', width: 200, editable: true, hidden: false },
                { name: 'AccionOferta', index: 'AccionOferta', width: 30, editable: true, hidden: false, formatter: ShowActionsOferta }
            ],
            jsonReader:
            {
                root: "rows",
                page: "page",
                total: "total",
                records: "records",
                repeatitems: true,
                cell: "cell",
                id: "id"
            },
            pager: jQuery('#pagerOferta'),
            loadtext: 'Cargando datos...',
            recordtext: "",
            emptyrecords: 'No hay resultados',
            rowNum: 10,
            scrollOffset: 0,
            rowList: [],
            sortname: 'Descripcion',
            sortorder: 'asc',
            viewrecords: true,
            multiselect: false,
            height: 'auto',
            width: 625,
            pgtext: '',
            altRows: true,
            altclass: 'jQGridAltRowClass',
            loadComplete: function () { },
            gridComplete: function () {
                $("#listaOfertas input[type='checkbox']").each(function () {
                    var valor = $(this).attr("value");
                    var contenedor = $("#hdofertas").val();
                    var n = contenedor.lastIndexOf(valor);
                    if (n > -1) {
                        $(this).attr("checked", true)
                    }
                });
            }
        });
        jQuery("#listaOfertas").jqGrid('navGrid', "#pagerOferta", { edit: false, add: false, refresh: false, del: false, search: false });
        jQuery("#listaOfertas").setGridParam({ datatype: 'json', page: 1 }).trigger('reloadGrid');
    }

    function ShowActions(cellvalue, options, rowObject) {
        var cellValueInt = parseInt(cellvalue);
        var Des = "&nbsp;<a href='javascript:;' onclick=\"return jQuery('#list').Editar('"
            + rowObject[0]
            + "','" + rowObject[1]
            + "','" + rowObject[2]
            + "','" + rowObject[4]
            + "','" + rowObject[5]
            + "','" + rowObject[6]
            + "','" + rowObject[7]
            + "','" + rowObject[11]
            + "','" + rowObject[12]
            + "','" + rowObject[13]
            + "','" + rowObject[14]
            + "','" + rowObject[15]
            + "','" + rowObject[16]
            + "');\" >"
            + "<img src='@Url.Content("~/Content/Images/Edit.png")' alt='Editar Mensaje' title='Editar Mensaje' border='0' /></a>";

        Des += "&nbsp;&nbsp;<a href='javascript:;' onclick=\"return jQuery('#list').Eliminar('" + rowObject[0] + "');\" >" + "<img src='@Url.Content("~/Content/Images/Delete.png")' alt='Eliminar Mensaje' title='Eliminar Mensaje' border='0' /></a>";
        return Des;
    }

    function EditarOferta(id) {
        var codigoOferta = jQuery("#listaOfertas").jqGrid('getCell', id, 'CodigoOferta');
        var descripcionOferta = jQuery("#listaOfertas").jqGrid('getCell', id, 'DescripcionOferta');
        $("#hdofertaid").val(id);
        $("#txtCodigoOferta").val(codigoOferta);
        $("#txtDescripcionOferta").val(descripcionOferta);
        $("#btnAgregarOferta").val("Modificar");
    }

    function EliminarOferta(id) {
        var elimina = confirm('¿ Está seguro que desea eliminar el registro seleccionado?');
        if (!elimina)
            return false;
        var codigoOferta = jQuery("#listaOfertas").jqGrid('getCell', id, 'CodigoOferta');
        var params = {
            OfertaID: id
        };

        jQuery.ajax({
            type: 'POST',
            url: baseUrl + 'AdministrarTipoEstrategia/EliminarOferta',
            dataType: 'json',
            contentType: 'application/json; charset=utf-8',
            data: JSON.stringify(params),
            async: true,
            success: function (data) {
                if (checkTimeout(data)) {
                    if (data.success == true) {
                        alert(data.message);
                        var id = $("#hdTipoEstrategiaID").val()
                        $("#hdofertaid").val("0");
                        var ofertas = $("#hdofertas").val();
                        ofertas = ofertas.replace(codigoOferta + ',', '');
                        $("#hdofertas").val(ofertas);
                        fnGrillaOfertas(id);
                        fnGrilla();
                    }
                    else {
                        alert(data.message);
                    }
                }
            },
            error: function (data, error) {
                if (checkTimeout(data)) {
                    alert(data.message);
                    HideDialog("DialogAdministracionNuevaOferta");
                }
            }
        });

    }

    function ShowActionsOferta(cellvalue, options, rowObject) {
        var cellValueInt = parseInt(cellvalue);
        var Des = "&nbsp;<a href='javascript:;' onclick=\"return EditarOferta('" + rowObject[0] + "');\" >" + "<img src='@Url.Content("~/Content/Images/Edit.png")' alt='Editar Oferta' title='Editar Oferta' border='0' /></a>";
        Des += "&nbsp;&nbsp;<a href='javascript:;' onclick=\"return EliminarOferta('" + rowObject[0] + "');\" >" + "<img src='@Url.Content("~/Content/Images/Delete.png")' alt='Eliminar Oferta' title='Eliminar Oferta' border='0' /></a>";
        return Des;
    }

    function ShowOferta(cellvalue, options, rowObject) {
        var cellValueInt = parseInt(cellvalue);
        var Des = rowObject[3].replace(/,/g, '<br />');
        return Des;
    }

    function ShowChecks(cellvalue, options, rowObject) {
        var cellValue = rowObject[1];
        var Des = '<input type="checkbox" onclick="agregarQuitarChecks(this.checked, this.value)" value="' + cellValue + '" />';
        return Des;
    }

    function agregarQuitarChecks(activo, codigoOferta) {
        var ofertasSeleccionadas = $("#hdofertas").val();
        if (activo) {
            ofertasSeleccionadas += codigoOferta + ',';
        } else {
            ofertasSeleccionadas = ofertasSeleccionadas.replace(codigoOferta + ',', '');
        }
        $("#hdofertas").val(ofertasSeleccionadas);
    }

    function ShowImage(cellvalue, options, rowObject) {
        var image = "";
        if (cellvalue != "") {
            image = '<img src="' + cellvalue + '" alt="" width="100px" height="25px" title="" border="0" />';
        } else {
            image = '<img src="@Url.Content("~/Content/Images/prod_grilla_vacio.png")" alt="" width="60px" height="60px" title="" border="0" />';
        }
        return image;
    }

    function IniDialog() {
        $('#DialogAdministracionTipoEstrategia').dialog({
            autoOpen: false,
            resizable: false,
            modal: true,
            closeOnEscape: true,
            width: 805,
            draggable: true,
            title: "Registro de Tipo de Estrategias",
            buttons:
            {
                "Guardar": function () {

                    var tipoEstrategiaID = $("#hdTipoEstrategiaID").val();
                    var descripcionEstrategia = $("#txtDescripcionOriginalModal").val();
                    var imagenEstrategia = $("#imagenProducto01").val();
                    var imagenAnterior = $("#imagenProductoAnterior01").val();
                    var orden = $("#txtOrden").val();
                    var flagActivo = "0";
                    var ofertaID = "";
                    var imagenOfertaIndependiente = $("#hdImagenOfertaIndependiente").val();
                    var imagenOfertaIndependienteAnterior = $("#hdImagenOfertaIndependienteAnterior").val();

                    if ($("#chkActivo").attr("checked")) {
                        flagActivo = "1";
                    }

                    if ($.trim(descripcionEstrategia) == "") {
                        alert("No ingresó la descripción.");
                        return false;
                    }

                    if (!$.isNumeric(orden)) {
                        alert("No ingresó un valor válido para el orden a mostrar.");
                        return false;
                    }

                    if ($.trim(orden) == "") {
                        alert("No ingresó el orden a mostrar.");
                        return false;
                    }

                    if (parseInt(orden) <= 0) {
                        alert("Ingrese un orden mayor a cero.");
                        return false;
                    }

                    ofertaID = $("#hdofertas").val();

                    if (ofertaID.length > 0) {
                        ofertaID = ofertaID.substring(0, ofertaID.length - 1);
                    }

                    if ($("#chkMostrarImg").attr("checked")) {
                        if ($("#img01").attr("src") == "" || ($("#img01").attr("src").indexOf('prod_grilla_vacio.png') >= 0)) {
                            alert("Se debe seleccionar una imagen.");
                            return false;
                        }
                    }

                    if ($("#chkMostrarImgIndependiente").attr("checked")) {
                        if ($("#imgOfertaIndependiente").attr("src") == "" || ($("#imgOfertaIndependiente").attr("src").indexOf('prod_grilla_vacio.png') >= 0)) {
                            alert("Debe seleccionar una imagen para oferta independiente.");
                            return false;
                        }
                    }

					if ($("#chkValImg").attr("checked")) {
                        if ($("#txtPesoMaximoImagen").val() == "" || $("#txtPesoMaximoImagen").val() == "0") {
                            alert("Debe Ingresar un tamaño en Kb mayor a 0 de la imagen a validar.");
                            return false;
                        }
                    }


                    var flagNueva = ($("#chkNueva").attr("checked")) ? "1" : "0";
                    var flagRecoPerfil = ($("#chkRecoPerfil").attr("checked")) ? "1" : "0";
                    var flagRecoProduc = ($("#chkRecoProduc").attr("checked")) ? "1" : "0";
                    var codigoPrograma = flagNueva ? $("#txtCodigoPrograma").val() : null;
                    var flagMostrarImg = ($("#chkMostrarImg").attr("checked")) ? "1" : "0";
                    var flagMostrarImgIndependiente = ($("#chkMostrarImgIndependiente").attr("checked")) ? true : false;
                    var codigo = $("#txCodigoOriginalModal").val();
					var flagValidarImagen = ($("#chkValImg").attr("checked")) ? "1" : "0";
					var pesoMaximoImagen = flagValidarImagen ? $("#txtPesoMaximoImagen").val() : "0";

                    var params = {
                        TipoEstrategiaID: tipoEstrategiaID,
                        DescripcionEstrategia: descripcionEstrategia,
                        ImagenEstrategia: imagenEstrategia,
                        Orden: orden,
                        FlagActivo: flagActivo,
                        OfertaID: ofertaID,
                        ImagenAnterior: imagenAnterior,
                        FlagNueva: flagNueva,
                        FlagRecoPerfil: flagRecoPerfil,
                        FlagRecoProduc: flagRecoProduc,
                        CodigoPrograma: codigoPrograma,
                        FlagMostrarImg: flagMostrarImg,
						FlagValidarImagen: flagValidarImagen,
						PesoMaximoImagen: pesoMaximoImagen,
                        MostrarImgOfertaIndependiente: flagMostrarImgIndependiente,
                        ImagenOfertaIndependiente: imagenOfertaIndependiente,
                        ImagenOfertaIndependienteAnterior: imagenOfertaIndependienteAnterior,
                        Codigo: codigo
                    };

                    jQuery.ajax({
                        type: 'POST',
                        url: baseUrl + 'AdministrarTipoEstrategia/Registrar',
                        dataType: 'json',
                        contentType: 'application/json; charset=utf-8',
                        data: JSON.stringify(params),
                        async: true,
                        success: function (data) {
                            if (checkTimeout(data)) {
                                if (data.success == true) {
                                    alert(data.message);
                                    HideDialog("DialogAdministracionTipoEstrategia");
                                    $("#hdTipoConsulta").val("1");
                                    jQuery("#list").setGridParam({ datatype: 'json', page: 1 }).trigger('reloadGrid');
                                }
                                else {
                                    alert(data.message);
                                }
                            }
                        },
                        error: function (data, error) {
                            if (checkTimeout(data)) {
                                alert(data.message);
                                HideDialog("DialogAdministracionTipoEstrategia");
                            }
                        }
                    });

                },
                "Cancelar": function () {
                    $(this).dialog('close');
                }
            }
        });


        $('#DialogAdministracionNuevaOferta').dialog({
            autoOpen: false,
            resizable: false,
            modal: true,
            closeOnEscape: true,
            width: 700,
            draggable: true,
            title: "Registro de Ofertas",
            buttons:
            {
                "Nueva Oferta": function () {
                    $("#hdofertaid").val("0");
                    $("#txtCodigoOferta").val("");
                    $("#txtDescripcionOferta").val("");
                    $("#btnAgregarOferta").val("Agregar");
                    $("#txtCodigoOferta").focus();
                },
                "Salir": function () {
                    $(this).dialog('close');
                }
            }
        });

    }

    $.jgrid.extend({
        Editar: function (id, codigo, descripcion, orden, imagen, ofertas, flagactivo, codigoPrograma, flagMostrarImg, MostrarImgOfertaIndependiente, ImagenOfertaIndependiente, flagValidarImagen, pesoMaximoImagen) {
            if (id) {
                $("#txtPaisModal").val($("#ddlPais option:selected").html());
                $("#hdPais").val($("#ddlPais").val());
                $("#txCodigoOriginalModal").val(codigo)
                $("#txtDescripcionOriginalModal").val(descripcion);
                $("#txtOrden").val(orden);
                $("#txtPaisOferta").val($("#ddlPais option:selected").html());
                var img = $($("#list").jqGrid('getCell', id, 'ImagenEstrategia')).attr('src');

                $('#img01').attr('src', img);
                img = img.replace(/^.*[\\\/]/, '');

                if (img.length > 0) {
                    $('#imagenProducto01').val(img);
                    $('#imagenProductoAnterior01').val(img);
                }

                var imgOfertaIndependiente = $($("#list").jqGrid('getCell', id, 'ImagenOfertaIndependiente')).attr('src');
                $('#imgOfertaIndependiente').attr('src', imgOfertaIndependiente);

                imgOfertaIndependiente = imgOfertaIndependiente.replace(/^.*[\\\/]/, '');



				var flagValidarImagen = jQuery("#list").jqGrid('getCell', id, 'FlagValidarImagen');
				$("#chkValImg").attr("checked", (flagValidarImagen == "1"));

				$("#txtPesoMaximoImagen").val(pesoMaximoImagen);

				

                if (imgOfertaIndependiente.length > 0) {
                    $('#hdImagenOfertaIndependiente').val(imgOfertaIndependiente);
                    $('#hdImagenOfertaIndependienteAnterior').val(imgOfertaIndependiente);
                }

                var flagNueva = jQuery("#list").jqGrid('getCell', id, 'FlagNueva');
                var flagRecoProduc = jQuery("#list").jqGrid('getCell', id, 'FlagRecoProduc');
                var flagRecoPerfil = jQuery("#list").jqGrid('getCell', id, 'FlagRecoPerfil');
                var flagImagenOfertaIndependiente = jQuery("#list").jqGrid('getCell', id, 'MostrarImgOfertaIndependiente');


                $('#chkNueva').attr("checked", (flagNueva == "1"));
                $('#chkRecoProduc').attr("checked", (flagRecoProduc == "1"));
                $('#chkRecoPerfil').attr("checked", (flagRecoPerfil == "1"));
                $('#chkMostrarImgIndependiente').attr("checked", (flagImagenOfertaIndependiente == "1"));

                $("#hdTipoEstrategiaID").val(id);
                $("#hdofertas").val(ofertas + ',');

                if (flagactivo == "1") {
                    $("#chkActivo").attr("checked", true);
                }
                $("#txtCodigoPrograma").prop('disabled', true);
                $("#txtCodigoPrograma").val(codigoPrograma);

                if (flagMostrarImg == "1") {
                    $("#chkMostrarImg").attr("checked", true);
                }
                else {
                    $("#chkMostrarImg").attr("checked", false);
                }
                if (flagNueva == "1") {
                    $(".divOfertaIndependiente").show();
                } else {
                    $(".divOfertaIndependiente").hide();
                }

				if (flagValidarImagen == "1") {
                   $("#txtPesoMaximoImagen").prop('disabled', false);
                } else {
                    $("#txtPesoMaximoImagen").prop('disabled', true);
                }

                fnGrillaOfertas(id);

                showDialog("DialogAdministracionTipoEstrategia");
            } else {
                alert("No selecciono el Cliente");
            }
            return false;
        },
        Eliminar: function (Id) {
            var paisID = $("#hdPais").val();

            var elimina = confirm('¿ Está seguro que desea eliminar el registro seleccionado?');
            if (!elimina)
                return false;

            waitingDialog({});

            jQuery.ajax({
                type: 'POST',
                url: baseUrl + 'AdministrarTipoEstrategia/Eliminar',
                dataType: 'json',
                contentType: 'application/json; charset=utf-8',
                data: JSON.stringify({ PaisID: paisID, TipoEstrategiaID: Id }),
                async: true,
                success: function (data) {
                    if (checkTimeout(data)) {
                        closeWaitingDialog();
                        if (data.success == true) {
                            alert(data.message);
                            jQuery("#list").setGridParam({ datatype: 'json', page: 1 }).trigger('reloadGrid');
                        }
                        else
                            alert(data.message);
                    }
                },
                error: function (data, error) {
                    if (checkTimeout(data)) {
                        closeWaitingDialog();
                    }
                }
            });

            return false;
        }
    });
</script>
<input type="hidden" id="hdTipoConsulta" value="0" />
<div class="wrap_cab">
    <div class="filtros2">
        <div class="elements">
            <div class="div-2">
                <h1><span>Administrar Tipo de Estrategia</span></h1>
            </div>
            <div class="div-3">
                <div class="titA">País:</div>
                <div class="selectA borde_redondeado">
                    @Html.DropDownListFor(model => model.PaisID, new SelectList(Model.listaPaises, "PaisID", "Nombre"), "-- Seleccionar --", new { id = "ddlPais" })
                </div>

                <div class="input_horizontal">
                    <input type="button" name="btnBuscar" id="btnBuscar" value="Buscar" />
                    <input type="button" name="btnNuevo" id="btnNuevo" value="Nuevo" />
                </div>
            </div>
        </div>
    </div>
</div>
<div class="wrap">
    <div class="container clearfix">
        <div class="border-wrapper">
            <table id="list"></table>
            <div id="pager"></div>
        </div>
    </div>
</div>
<div id="DialogAdministracionTipoEstrategia" style="display: none;">
    <input type="hidden" id="hdPais" value="" />
    <input type="hidden" id="hdofertas" value="" />
    <input type="hidden" id="hdofertaid" value="0" />
    <input type="hidden" id="hdTipoEstrategiaID" value="0" />
    <div class="Content_modal">
        <div class="div-3">
            <div class="titB">País:</div>
            <div class="selectP2 borde_redondeado">
                <input type="text" id="txtPaisModal" readonly="readonly" />
            </div>
            <div class="titB">Orden:</div>
            <div class="selectP2 borde_redondeado">
                <input type="text" id="txtOrden" />
            </div>
        </div>
        <div class="div-3">
            <div class="titB">Código:</div>
            <div class="selectP2 borde_redondeado">
                <input type="text" id="txCodigoOriginalModal" />
            </div>
            <div class="titB">Activo:</div>
            <div class="selectCheck borde_redondeado">
                <input type="checkbox" id="chkActivo" />
            </div>
        </div>
        <div class="div-3">
            <div class="titB">Descripción:</div>
            <div class="selectP2 borde_redondeado" style="width:535px">
                <input type="text" id="txtDescripcionOriginalModal" style="width:100%" />
            </div>
        </div>
        <div class="div-3">
            <div class="titB">Tipo:</div>
            <div class="selectE borde_redondeado">
                <div class="titB">Nueva:</div>
                <div class="selectCheck borde_redondeado">
                    <input type="checkbox" id="chkNueva" />
                </div>
                <div class="titF">Recomendación por CUV:</div>
                <div class="selectCheck borde_redondeado">
                    <input type="checkbox" id="chkRecoProduc" />
                </div>
                <div class="titF" style="width:180px">Recomendación por perfil:</div>
                <div class="selectCheck borde_redondeado">
                    <input type="checkbox" id="chkRecoPerfil" />
                </div>
            </div>
        </div>
        <div class="div-3 divCodigoPrograma">
            <div class="titB">Código Programa:</div>
            <div class="selectP2 borde_redondeado">
                <input type="text" id="txtCodigoPrograma" />
            </div>
        </div>

		<div class="div-3">
		    <div class="titB">Validar Tamaño :</div>
                <div class="selectCheck borde_redondeado">
                <input type="checkbox" id="chkValImg" />
            </div>
            <div class="titB">Tamaño (Kb):</div>
                <div class="selectP2 borde_redondeado">
                <input type="number" id="txtPesoMaximoImagen" />
            </div>

        </div>


        <div class="div-3">
            <div class="titA"></div>
            <div class="titG">
                <div class="input_search">
                    <input type="button" name="btnNuevaOferta" id="btnNuevaOferta" value="Ofertas" style="float:right;" />
                </div>
            </div>
        </div>
        <div>
            <div class="float-left">
                <div class="div-3">
                    <div class="titB">Mostrar imagen:</div>
                    <div class="selectCheck borde_redondeado">
                        <input type="checkbox" id="chkMostrarImg" />
                    </div>
                </div>
                <div class="div-3">
                    <div class="titB">Imagen:</div>
                    <div class="selectP2 borde_redondeado aligncenter" style="height: 162px;">
                        <img src='@Url.Content("~/Content/Images/prod_grilla_vacio.png")' id="img01">
                    </div>

                    <div class="titB" style="display: none;">Oferta:</div>
                    <div class="container clearfix" style="display: none;">
                        <div class="selectA borde_redondeado">
                        </div>
                    </div>
                </div>
                <div class="div-3">
                    <div class="titF">Tamaño de imagen: (Ancho: 62px - Alto: 62px)</div>
                    <div class="titG" style="width: 180px;">
                        <div class="input_search">
                            <input type="hidden" id="imagenProducto01" />
                            <input type="hidden" id="imagenProductoAnterior01" />
                            <div id="fpUpload01">
                                <script type="text/javascript">
                            $.ajaxSetup({ cache: false });
                            var uploader = new qq.FileUploader({
                                allowedExtensions: ['jpg', 'png', 'jpeg'],
                                element: document.getElementById('fpUpload01'),
                                action: '@Url.Action("ImageTipoOfertaUpload", "AdministrarTipoEstrategia")',
                                onComplete: function (id, fileName, responseJSON) {
                                    if (checkTimeout(responseJSON)) {
                                        $(".qq-upload-list").css("display", "none");
                                        if (responseJSON.success) {
                                            $("#imagenProducto01").val(responseJSON.name);
                                            $('#img01').attr('src', '@Url.Content("~/Content/Temporales/")' + responseJSON.name);
                                        }
                                        else {
                                            alert(responseJSON.message);
                                        }
                                    }
                                },
                                onSubmit: function (id, fileName) { $(".qq-upload-list").css("display", "none"); },
                                onProgress: function (id, fileName, loaded, total) { $(".qq-upload-list").css("display", "none"); },
                                onCancel: function (id, fileName) { $(".qq-upload-list").css("display", "none"); }
                            });
                                </script>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
            <div class="float-left">
                <div class="div-3 divOfertaIndependiente">
                    <div class="titB">Imagen Independiente:</div>
                    <div class="selectCheck borde_redondeado">
                        <input type="checkbox" id="chkMostrarImgIndependiente" />
                    </div>
                </div>
                <div class="div-3 divOfertaIndependiente" style="display:none;">
                    <div class="titB">Imagen indep.:</div>
                    <div class="selectP2 borde_redondeado aligncenter" style="height: 162px;">
                        <img src='@Url.Content("~/Content/Images/prod_grilla_vacio.png")' id="imgOfertaIndependiente">
                    </div>
                </div>
                <div class="div-3 divOfertaIndependiente" style="display:none;">
                    <div class="titF">Tamaño de imagen: (Ancho: 62px - Alto: 62px)</div>
                    <div class="titG" style="width: 180px;">
                        <div class="input_search">
                            <input type="hidden" id="hdImagenOfertaIndependiente" />
                            <input type="hidden" id="hdImagenOfertaIndependienteAnterior" />
                            <div id="fpUpload02">
                                <script type="text/javascript">
                            $.ajaxSetup({ cache: false });
                            var uploader = new qq.FileUploader({
                                allowedExtensions: ['jpg', 'png', 'jpeg'],
                                element: document.getElementById('fpUpload02'),
                                action: '@Url.Action("ImageTipoOfertaUpload", "AdministrarTipoEstrategia")',
                                onComplete: function (id, fileName, responseJSON) {
                                    if (checkTimeout(responseJSON)) {
                                        $(".qq-upload-list").css("display", "none");
                                        if (responseJSON.success) {
                                            $("#hdImagenOfertaIndependiente").val(responseJSON.name);
                                            $('#imgOfertaIndependiente').attr('src', '@Url.Content("~/Content/Temporales/")' + responseJSON.name);
                                        }
                                        else {
                                            alert(responseJSON.message);
                                        }
                                    }
                                },
                                onSubmit: function (id, fileName) { $(".qq-upload-list").css("display", "none"); },
                                onProgress: function (id, fileName, loaded, total) { $(".qq-upload-list").css("display", "none"); },
                                onCancel: function (id, fileName) { $(".qq-upload-list").css("display", "none"); }
                            });
                                </script>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="DialogAdministracionNuevaOferta" style="display: none;">
    <div class="Content_modal">
        <div class="div-3" style="display: none">
            <div class="titB">País:</div>
            <div class="selectP2 borde_redondeado">
                <input type="text" id="txtPaisOferta" readonly="readonly" />
            </div>
        </div>
        <div class="div-3">
            <div class="titB">Código:</div>
            <div class="selectP2 borde_redondeado" style="width:50px">
                <input type="text" id="txtCodigoOferta" style="width:50px" />
            </div>
            <div class="titB">Descripción:</div>
            <div class="selectP2 borde_redondeado" style="width:230px">
                <input type="text" id="txtDescripcionOferta" style="width:230px" />
            </div>
            <div class="input_search">
                <input type="button" name="btnAgregarOferta" id="btnAgregarOferta" value="Agregar" style="float:right" />
            </div>
        </div>
        <div class="div-3">
            <div class="container clearfix">
                <div class="selectA borde_redondeado" style="width:630px">
                    <table id="listaOfertas"></table>
                    <div id="pagerOferta"></div>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="loadingScreen"></div>
