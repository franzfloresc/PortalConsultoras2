@model Portal.Consultoras.Web.Models.DetalleSolicitudPostulanteModel

@{
    var Solicitud = Model.Solicitud;
    var estadosCiviles = ViewBag.EstadosCiviles as SelectList;
    var nivelesEducativos = ViewBag.NivelesEducativos as SelectList;
    var tiposNacionalidad = ViewBag.TiposNacionalidad as SelectList;
    var tiposContacto = ViewBag.TiposContacto as SelectList;
}

<style>
    .validation {
        float: left;
        width: 170px !important;
        padding: 0 9px !important;
        min-height: 1px !important;
        color: #702789;
    }

    .validation_clear {
        float: left;
        width: 140px !important;
        height: 1px !important;
        padding: 0 9px !important;
    }

    .border_modal {
        margin-bottom: 10px;
    }

    .modal_base h3, .modal_base h4 {
        color: lightgray;
        border-bottom: 1px solid lightgray;
        margin: 0 40px;
    }

    .div_3_fix {
        padding: 1px !important;
        margin: 0 !important;
    }

        .div_3_fix .titC {
            width: 150px !important;
        }

    #frmDetalleSolicitud * {
        text-transform: uppercase;
    }

    #frmDetalleSolicitud .field-validation-error, #frmDetalleSolicitud .field-validation-error span {
        text-transform: initial !important;
    }

    #frmDetalleSolicitud .titC, #frmDetalleSolicitud .selectP2 * {
        font-size: 12px !important;
    }
</style>

@using (Ajax.BeginForm("Detalle", "Unete", null, new AjaxOptions()
{
    HttpMethod = "POST",
    UpdateTargetId = "modal_content",
    InsertionMode = InsertionMode.Replace,
    OnSuccess = "OnSuccess",
    OnBegin = "waitingDialog({});",
    OnComplete = "closeWaitingDialog({});"
}, new
{
    @id = "frmDetalleSolicitud"
}))
{
    @Html.HiddenFor(m => Solicitud.EstadoPostulante)
    @Html.HiddenFor(m => Solicitud.CodigoConsultora)

    @Html.HiddenFor(m => Solicitud.SolicitudPostulanteID)
    @Html.HiddenFor(m => Solicitud.CodigoPais)
    @Html.HiddenFor(m => Model.ModoLectura)
    @Html.HiddenFor(m => Model.CodigoISO)

    <div class="wrap_cab">
        <div class="filtros2">
            <div class="div-2">
                <h2>
                    Solicitud de Postulante
                    <img id="imgCerrar" src="@Url.Content("~/Content/Images/btnCerrar_AD.png")" class="float_rigth" style="cursor: pointer;" />
                </h2>
            </div>
            <h4>Datos del Postulante</h4>
            <div class="elements border_modal" style="padding-top: 15px !important">
                <div class="div-3 div_3_fix">
                    <div class="titC">Primer nombre:</div>
                    <div class="selectP2 borde_redondeado">
                        @Html.TextBoxFor(m => Solicitud.PrimerNombre, new { @class = "texto rfcSearch" })
                    </div>
                    <div class="titC">Apellido Paterno:</div>
                    <div class="selectP2 borde_redondeado">
                        @Html.TextBoxFor(m => Solicitud.ApellidoPaterno, new { @class = "texto rfcSearch" })
                    </div>
                    <div class="titC">Sexo:</div>
                    <div class="selectP2 borde_redondeado" style="display: flex; align-items: center; font-size: 11px; ">
                        @Html.RadioButtonFor(m => Solicitud.Sexo, 'F', new { @style = "float:none;width:auto" }) &nbsp; Femenino&nbsp; <br />
                        @Html.RadioButtonFor(m => Solicitud.Sexo, 'M', new { @style = "float:none;width:auto" }) &nbsp; Masculino
                    </div>
                </div>
                <div class="div-3 div_3_fix">
                    <div class="validation_clear"></div>
                    <div class="validation">
                        @Html.ValidationMessageFor(m => Solicitud.PrimerNombre)
                    </div>
                    <div class="validation_clear"></div>
                    <div class="validation">
                        @Html.ValidationMessageFor(m => Solicitud.ApellidoPaterno)
                    </div>
                    <div class="validation_clear"></div>
                    <div class="validation">
                        @Html.ValidationMessageFor(m => Solicitud.Sexo)
                    </div>
                </div>
                <div class="div-3 div_3_fix">
                    <div class="titC">Segundo nombre:</div>
                    <div class="selectP2 borde_redondeado">
                        @Html.TextBoxFor(m => Solicitud.SegundoNombre, new { @class = "texto rfcSearch" })
                    </div>

                    <div class="titC">Apellido Materno:</div>
                    <div class="selectP2 borde_redondeado">
                        @Html.TextBoxFor(m => Solicitud.ApellidoMaterno, new { @class = "texto rfcSearch" })
                    </div>
                    <div class="titC">Fecha Nacimiento:</div>
                    <div class="selectP2 borde_redondeado calendar">
                        @Html.TextBoxFor(m => Solicitud.FechaNacimiento, new { @class = "texto rfcSearch" })
                    </div>
                </div>
                <div class="div-3 div_3_fix">
                    <div class="validation_clear"></div>
                    <div class="validation">
                        @Html.ValidationMessageFor(m => Solicitud.SegundoNombre)
                    </div>
                    <div class="validation_clear"></div>
                    <div class="validation">
                        @Html.ValidationMessageFor(m => Solicitud.ApellidoMaterno)
                    </div>
                    <div class="validation_clear"></div>
                    <div class="validation">
                        @Html.ValidationMessageFor(m => Solicitud.FechaNacimiento)
                    </div>
                </div>
                <div class="div-3 div_3_fix">
                    <div class="titC">Telf. Fijo:</div>
                    <div class="selectP2 borde_redondeado">
                        @Html.TextBoxFor(m => Solicitud.Telefono, new { @class = "numero" })
                    </div>

                    <div class="titC">Celular:</div>
                    <div class="selectP2 borde_redondeado">
                        @Html.TextBoxFor(m => Solicitud.Celular, new { @class = "numero" })
                    </div>
                    @if (Solicitud.CodigoPais != "MX")
                    {
                        <div class="titC">Numero Documento:</div>
                        <div class="selectP2 borde_redondeado">
                            @Html.TextBoxFor(m => Solicitud.NumeroDocumento, new { @readOnly = true })
                        </div>
                    }
                    else if (Solicitud.CodigoPais == "MX")
                    {
                        <div class="titC">Correo Electr&oacute;nico:</div>
                        <div class="selectP2 borde_redondeado">
                            @Html.TextBoxFor(m => Solicitud.CorreoElectronico)
                        </div>
                        <div class="validation_clear"></div>
                        <div class="validation">
                            @Html.ValidationMessageFor(m => Solicitud.CorreoElectronico)
                        </div>
                    }
                </div>
                <div class="div-3 div_3_fix">
                    <div class="validation_clear"></div>
                    <div class="validation">
                        @Html.ValidationMessageFor(m => Solicitud.Telefono)
                    </div>
                    <div class="validation_clear"></div>
                    <div class="validation">
                        @Html.ValidationMessageFor(m => Solicitud.Celular)
                    </div>
                    @if (Solicitud.CodigoPais != "MX")
                    {
                        <div class="validation_clear"></div>
                        <div class="validation">
                            @Html.ValidationMessageFor(m => Solicitud.NumeroDocumento)
                        </div>
                    }
                    @if (Solicitud.CodigoPais == "MX")
                    {
                        <div class="validation_clear"></div>
                        <div class="validation">
                            @Html.ValidationMessageFor(m => Solicitud.CorreoElectronico)
                        </div>
                    }
                </div>

                @if (Solicitud.CodigoPais != "MX")
                {
                    <div class="div-3 div_3_fix">
                        <div class="titC">Correo Electr&oacute;nico:</div>
                        <div class="selectP2 borde_redondeado">
                            @Html.TextBoxFor(m => Solicitud.CorreoElectronico)
                        </div>
                    </div>
                    <div class="div-3 div_3_fix">
                        <div class="validation_clear"></div>
                        <div class="validation">
                            @Html.ValidationMessageFor(m => Solicitud.CorreoElectronico)
                        </div>
                    </div>
                }
                else if (Solicitud.CodigoPais == "MX")
                {
                    <div class="div-3 div_3_fix">
                        <div class="titC">RFC:</div>
                        <div class="selectP2 borde_redondeado">
                            @Html.TextBoxFor(m => Solicitud.NumeroDocumento, new { @readOnly = true })
                        </div>
                        @*<div class="input_search">
                                <button type="button" id="btnGenerarRfc" style ="background-color:#702789;background-image: url(../../Content/Images/bg_input4.png) 0 0 n-repeat; color: #fff; font-size: 14px; border: 0; " data-url="@Url.Action("GenerarRfc", "Unete", new {area = ""})">Generar RFC</button>
                            </div>*@
                    </div>
                    <div class="div-3 div_3_fix">
                        <div class="validation_clear"></div>
                        <div class="validation">
                            @Html.ValidationMessageFor(m => Solicitud.NumeroDocumento)
                        </div>
                    </div>
                }

            </div>
            <h4>Informaci&oacute;n adicional del Postulante</h4>
            <div class="elements border_modal" style="padding-top: 15px !important">
                <div class="div-3 div_3_fix">
                    <div class="titC">Estado civil:</div>
                    <div class="selectP2 borde_redondeado">
                        @Html.DropDownListFor(m => Solicitud.EstadoCivil, estadosCiviles, "Seleccione")
                    </div>
                    <div class="titC">Nivel educativo:</div>
                    <div class="selectP2 borde_redondeado">
                        @Html.DropDownListFor(m => Solicitud.NivelEducativo, nivelesEducativos, "Seleccione")
                    </div>
                    @if (Model.Solicitud.CodigoPais != "MX")
                    {
                        <div class="titC">Nacionalidad:</div>
                        <div class="selectP2 borde_redondeado">
                            @Html.DropDownListFor(m => Solicitud.TipoNacionalidad, tiposNacionalidad, "Seleccione")
                        </div>
                    }
                    else
                    {
                        <div class="titC">Como llego a nosotros:</div>
                        <div class="selectP2 borde_redondeado">
                            @Html.DropDownListFor(m => Solicitud.TipoContacto, tiposContacto, "Seleccione")
                        </div>
                    }
                </div>
                <div class="div-3 div_3_fix">
                    <div class="validation_clear"></div>
                    <div class="validation">
                        @Html.ValidationMessageFor(m => Solicitud.EstadoCivil)
                    </div>
                    <div class="validation_clear"></div>
                    <div class="validation">
                        @Html.ValidationMessageFor(m => Solicitud.NivelEducativo)
                    </div>
                    <div class="validation_clear"></div>
                    <div class="validation">
                        @Html.ValidationMessageFor(m => Solicitud.TipoNacionalidad)
                    </div>
                </div>
                <div class="div-3 div_3_fix">
                    @if (Model.Solicitud.CodigoPais != "MX")
                    {
                        <div class="titC">Como llego a nosotros:</div>
                        <div class="selectP2 borde_redondeado">
                            @Html.DropDownListFor(m => Solicitud.TipoContacto, tiposContacto, "Seleccione")
                        </div>
                        <div class="titC">C&oacute;digo Consultora que recomienda:</div>
                        <div class="selectP2 borde_redondeado">
                            @Html.TextBoxFor(m => Solicitud.CodigoConsultoraRecomienda, new { @class = "numero" })
                        </div>
                    }
                    else
                    {
                        <div class="titC">C&oacute;digo Consultora que recomienda:</div>
                        <div class="selectP2 borde_redondeado">
                            @Html.TextBoxFor(m => Solicitud.CodigoConsultoraRecomienda, new { @class = "numero" })
                        </div>
                    }

                </div>
                <div class="div-3 div_3_fix">
                    <div class="validation_clear"></div>
                    <div class="validation">
                        @Html.ValidationMessageFor(m => Solicitud.TipoContacto)
                    </div>
                    <div class="validation_clear"></div>
                    <div class="validation">
                        @Html.ValidationMessageFor(m => Solicitud.CodigoConsultoraRecomienda)
                    </div>
                </div>
            </div>
            @if (!Model.ModoLectura)
            {
                <div class="elements" style="padding-top: 0 !important">
                    <div class="div-3">
                        <div class="input_search">
                            <input type="submit" style="float:right !important; margin-right: 50px;" id="btnGuardar" value="Guardar" />
                        </div>
                    </div>
                </div>
            }
        </div>
    </div>
}

<script src="@Url.Content("~/Scripts/jquery.validate.js")"></script>
<script src="@Url.Content("~/Scripts/jquery.validate.unobtrusive.js")"></script>
<script type="text/javascript" src="~/Scripts/jquery.maskedinput.min.js"></script>
<script src="~/Scripts/HojaInscripcion/utilsCommon.js"></script>
<script>
    $.validator.setDefaults({
        ignore: '.ignore'
    });

    $.validator.addMethod('LengthTelefonoFijo', function (value, element) {
        return value.length == parseInt('@Solicitud.LengthTelefonoFijo') || value.length == 0;
    }, 'Máximo ' + '@Solicitud.LengthTelefonoFijo' + ' carácteres');

    $.validator.addMethod('LengthTelefonoCelular', function (value, element) {
        return value.length == parseInt('@Solicitud.LengthTelefonoCelular') || value.length == 0;
    }, 'Máximo ' + '@Solicitud.LengthTelefonoCelular' + ' carácteres');

    $.validator.addMethod('DocumentoValido', function (value, element) {
        var regex = new RegExp('@Solicitud.NumeroDocumentoRegex');
        return regex.test(value);
    }, 'El texto ingresado no es un documento valido');

    $(document).ready(function () {
    });

    $(function () {
        $.validator.unobtrusive.parse('form');

        $('input[name="Solicitud.NumeroDocumento"]').rules('add', 'DocumentoValido');
        $('input[name="Solicitud.Celular"]').rules('add', 'LengthTelefonoCelular');
        $('input[name="Solicitud.Telefono"]').rules('add', 'LengthTelefonoFijo');

        $("#Solicitud_FechaNacimiento").datepicker({
            showOn: "button",
            buttonImage: '@Url.Content("~/Content/Images/calendar.png")',
            buttonImageOnly: true,
            dateFormat: 'dd/mm/yy'
        }).mask('99/99/9999');

        @if (Model.ModoLectura)
        {
            <text>
        var controles = $('#modal_general input, #modal_general select');
        controles.attr('disabled', true);
        controles.attr('readonly', true);
        </text>
        }

        $('#imgCerrar').click(function () {
            modal.dialog('close');
        });

        $('.numero').keydown(IntegerNumber);
        $('.texto').keydown(Text);

        if ($("#Solicitud_CodigoPais").val() == "CO")
            $("#Solicitud_Celular").mask("3-999-999-999");

        if ($("#Solicitud_CodigoPais").val() == "MX") {
            $("body").on("change", ".rfcSearch", function (evt) {

                var primerNombre = $("#Solicitud_PrimerNombre").val();
                var segundoNombre = $("#Solicitud_SegundoNombre").val();
                var apellidoPaterno = $("#Solicitud_ApellidoPaterno").val();
                var apellidoMaterno = $("#Solicitud_ApellidoMaterno").val();
                var diaNacimiento = $("#Solicitud_FechaNacimiento").val().substr(0, 2);
                var mesNacimiento = $("#Solicitud_FechaNacimiento").val().substr(3, 2);
                var anioNacimiento = $("#Solicitud_FechaNacimiento").val().substr(6, 4);

                if (primerNombre && apellidoPaterno && diaNacimiento && mesNacimiento && anioNacimiento) {
                    Utils.Ajax({
                        url: "@Url.Action("GenerarRfc", "Unete", new {area = ""})",
                        parametros: {
                            Nombres: primerNombre + ' ' + segundoNombre,
                            ApellidoPaterno: apellidoPaterno,
                            ApellidoMaterno: apellidoMaterno,
                            DiaNacimiento: diaNacimiento,
                            MesNacimiento: mesNacimiento,
                            AnioNacimiento: anioNacimiento
                        }
                    }, function (response) {
                        $("#Solicitud_NumeroDocumento").val(response.Rfc);
                    });
                }
            });
        }
    });

    function OnSuccess(data) {
        if (data.success) {
            modal.dialog('close');

            fnGrilla();
        }
    }

</script>