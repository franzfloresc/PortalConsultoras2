@using System.Configuration
@using Portal.Consultoras.Common

@{

    Layout = "~/Views/Shared/_SACLayout.cshtml";
}

<div class="redborder w100 lateralPadding20">


    <div id="Filters" class="redborder" style="">
        <div class="FilterContainers redborder">
            <div class="inputContainer redborder">
                <input type="text" id="CampIni" placeholder="Campaña Inicio" name="name" value="" />
            </div>
            <div class="inputContainer redborder">
                <input type="text" id="CampFin" placeholder="Campaña Fin" name="name" value="" />
            </div>
            <div class="buttonContainer redborder">
                   <input type="button" id="buttonFunnel" onclick="GetData()" value="Aceptar" />
            </div>
        </div>

    </div>
    <div  class="excelDiv  redborder" style="height:30px;">

        <a href="javascript:void(0);" style="margin-left:40px; margin-top:-5px; float:right; " onclick="ExportExcel();" class="acciones_pagos redborder"><img src="@Url.Content("~/Content/Images/Esika/excel.png")" /></a>

    </div>
 
    <div id="ContainerGrid" class="redborder" style="height:auto">
       
        <div id="gridFunnel">
        </div>
    </div>

</div>
<script>
    @*var dataGrid = @Html.Raw(Json.Encode(ViewBag.Result));*@
    var dataGrid = null;
    var urlLoad = '@Url.Content("~/Content/Images/Loading.gif")';

     $(document).ready(function () { 
       
         setGridHeaders();
     });

     function setGridHeaders()
     {
         $('#gridFunnel').append('<div class="headers" >'+
                '<div class="headFunnel   cellFunnel"></div>'+
                '<div class="headFunnel   cellFunnel">Registros Completos</div>'+
                '<div class="headFunnel   cellFunnel"></div>'+
                '<div class="headFunnel   cellFunnel">Registros Validados</div>'+
                '<div class="headFunnel   cellFunnel"></div>'+
                '<div class="headFunnel   cellFunnel">Codigos Creados</div>'+
                '<div class="headFunnel   cellFunnel"></div>'+
                '<div class="headFunnel   cellFunnel">Ingresos Totales</div>'+
                   '<div class="headFunnel borderLeft    cellFunnel">Ingresos</BR>X</div>'+
                '<div class="headFunnel borderLeft  cellFunnel">Ingresos</BR>X+1</div>'+
                '<div class="headFunnel borderLeft  cellFunnel">TC </BR> (Ingresos/ </BR> RV)</div>'+
                '<div class="headFunnel borderLeft  cellFunnel">TC </BR> (IngresosX/ </BR> RV)</div>'+
                '<div class="headFunnel borderLeft  cellFunnel">TC </BR> (IngresosX+1/</BR> RV)</div>'+
                '<div class="headFunnel   cellFunnel">Dias de</BR> espera</div>'+

             '</div>');
     }
     function GetData()
     {
         if( $('#CampIni').val()=='' && $('#CampFin').val()=='')
         {
             alert('Por favor ingrese los filtros de Campaña Inicio y fin.');
             return false;
         }

         var obj ={CampaniaInicio: $('#CampIni').val() ,CampaniaFin: $('#CampFin').val() };

         $.ajax({
             type: 'POST',
             url: '@Url.Action("GetReporteFunnelSearch", "Unete")',
             dataType: 'json',
             contentType: 'application/json; charset=utf-8',
             data: JSON.stringify(obj),
             async: true,
             success: function (data) {
               
                 setDataToGrid(data);

             },
             error: function (error) {

             },
             beforeSend: function(){
                 LoadSpinner('gridFunnel'); 
                 
                 $('#buttonFunnel').attr('disabled', true);

             },
             complete: function(){
           
                 $('#buttonFunnel').removeAttr('disabled');
             }
             
         });

         return false;
     }

     function setDataToGrid(data)
     {
         ResetGrid();
         setGridHeaders();
         if(data)
         {
             $(data).each(function(a,b){
                 buildDataRow(b);
             });
         }



     }
     function ResetGrid()
     {
         $('.gridDataRow').remove();
         $('#spinner').remove();
     }

     function buildDataCell(colName, className, value)
     {
         var strClass = 'cellFunnel ';

         if(className)
         {
             strClass=strClass+className;

         }
         return '<div data-colname="'+ colName +'" class="'+ strClass+'">'+value+'</div>';

     }

     function buildDataRow(row)
     {
         var rowHtml ='<div class="gridDataRow" data-id="'+ row.Campania+'">';


         rowHtml = rowHtml + buildDataCell('Campania', 'Campania', row.Campania);

         rowHtml = rowHtml + buildDataCell('RegistroCompleto', 'RegistroCompleto purpleCell', row.RegistroCompleto);
         rowHtml = rowHtml + buildDataCell('RegistroCompletoPer', 'RegistroCompletoPer whiteCell', row.RegistroCompletoPer);
         rowHtml = rowHtml + buildDataCell('RegistroValidado', 'RegistroValidado purpleCell', row.RegistroValidado);
         rowHtml = rowHtml + buildDataCell('RegistroValidadoPer', 'RegistroValidadoPer whiteCell', row.RegistroValidadoPer);
         rowHtml = rowHtml + buildDataCell('CodigoCreado', 'CodigoCreado purpleCell', row.CodigoCreado);
         rowHtml = rowHtml + buildDataCell('CodigoCreadoPer', 'CodigoCreadoPer whiteCell', row.CodigoCreadoPer);
         rowHtml = rowHtml + buildDataCell('IngresoTotal', 'IngresoTotal purpleCell', row.IngresoTotal);
         rowHtml = rowHtml + buildDataCell('IngresoX', 'IngresoX ligthPurpleCell', row.IngresoX);
         rowHtml = rowHtml + buildDataCell('IngresoX1', 'IngresoX1 ligthPurpleCell', row.IngresoX1);
         rowHtml = rowHtml + buildDataCell('TCIngresoRV', 'TCIngresoRV ligthPinkCell', row.TCIngresoRV);
         rowHtml = rowHtml + buildDataCell('TCIngresoXRV', 'TCIngresoXRV ligthPinkCell', row.TCIngresoXRV);
         rowHtml = rowHtml + buildDataCell('TCIngresoX1RV', 'TCIngresoX1RV ligthPinkCell', row.TCIngresoX1RV);
         rowHtml = rowHtml + buildDataCell('DiasEnEspera', 'DiasEnEspera blueCell', row.DiasEnEspera);


         $('#gridFunnel').append(rowHtml +'</div>');


     }

     function LoadSpinner(elementId)
     {

         $('#'+elementId).html('<div id="spinner" style="text-align: center; color:white;">Cargando, por favor espere<br><img src="' + urlLoad + '" /></div>');
     }
   

     function ExportExcel() {
         var content = baseUrl +
             "Unete/ExportarExcelFunnel?" +
             "CampaniaInicio=" +
               $('#CampIni').val() +             
             "&CampaniaFin=" +
           $('#CampFin').val();

         var iframe_ = document.createElement("iframe");
         iframe_.style.display = "none";
         iframe_.setAttribute("src", content);

         if (navigator.userAgent.indexOf("MSIE") > -1 && !window.opera) { // Si es Internet Explorer
             iframe_.onreadystatechange = function () {
                 switch (this.readyState) {
                     case "loading":
                         waitingDialog({});
                         break;
                     case "complete":
                     case "interactive":
                     case "uninitialized":
                         closeWaitingDialog();
                         break;
                     default:
                         closeWaitingDialog();
                         break;
                 }
             };
         }
         else {
             // Si es Firefox o Chrome
             $(iframe_).ready(function () {
                
             });
         }
         document.body.appendChild(iframe_);
     }
</script>
<style>

 
    .redborder {
  
    }

    .greenBorder {
        border: solid green 1px;
    }

    .w100 {
        width: 95% !important;
    }

    .h100 {
        height: 100% !important;
    }

    .lateralPadding20 {
        padding-left: 50px;
        padding-right: 50px;
    }

    .cellFunnel {
        width: 6%;
        padding-top: 10px;
        padding-bottom: 10px;
        display: inline-block;
        overflow: hidden;
        /*border:solid 1px black;*/
    }

    .Campania {
        border-bottom: solid 2px #552080;
    }

    #gridFunnel {
        text-align: center;
    }

    .headFunnel {
        text-align: center;
    }

    .whiteCell {
        border-bottom: solid 1px #c144ab;
        text-align: center;
    }

    .purpleCell {
        color: white;
        background-color: #642f80;
    }

    .ligthPurpleCell {
        color: white;
        background-color: #bda2f1;
        border-left: 3px solid white;
    }

    .ligthPinkCell {
        color: white;
        background-color: #ffc4d4;
        border-left: 3px solid white;
    }

    .borderLeft {
     border-left: 3px solid white;
    }
    .blueCell {
        color: white;
        background-color: #2376b4;
        border-left: 3px solid white;
    }

    .FilterContainers {
        width: 60%;
        display: inline-block;
        margin-top: 50px;
    }

    #Filters {
        text-align: center;
        height: 150px;
        
    }

    .inputContainer {
        width: 40%;
        float: left;
    }

    .buttonContainer {
        width: 18%;
        float: left;
    }

    #CampIni, #CampFin {
        width: 100%;
        height: auto;
        padding: 9px;
        background: #fff;
        color: black;
        border: 1px solid #cfcfcf;
        position: relative;
        width: 75% !important;
        border-color: rgba(0, 0, 0, 0.66) !important;
        outline: 0;
        font-size: 100%;
    }

    #buttonFunnel {
        background: #642f80;
        color: #FFF;
        border: none;
        font-weight: normal !important;
        text-align: center;
        padding-top: 7px;
        padding-bottom: 8px;
        cursor: pointer;
        width: 70%;
        float: right;
    }

      

      #buttonFunnel:disabled  {
 
    background-color:#B75D9F !important;
    cursor:default;
    }

    .excelDiv{
        border-bottom: solid 2px black;
    }
</style>
