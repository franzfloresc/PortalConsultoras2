@{
    ViewBag.Title = "Pagos en Línea";
}
<script type="text/javascript">

    var selectedTodo = false;
    var montoTotal = $("#AMOUNT2").val();
    $(document).ready(function () {

        $('#AMOUNT2').keypress(function (e) {
            var character = String.fromCharCode(e.keyCode)
            var newValue = this.value + character;
            if (isNaN(newValue) || hasDecimalPlace(newValue, 3)) {
                e.preventDefault();
                return false;
            }
        });

        $.getJSON(baseUrl + 'Paypal/ObtenerAnios', { paisID: 0 }, function (data) {
            if (checkTimeout(data)) {
                var ddlAnio = $('#ddlAnho');
                ddlAnio.empty();
                if (data.lista.length > 0) {
                    for (var item in data.lista) {
                        ddlAnio.append($('<option/>', {
                            value: data.lista[item].substring(2, 4),
                            text: data.lista[item]
                        }));
                    }
                }
            }
        });

        $("#chkMontoPagar").click(function () {
            $("#AMOUNT2").val("");
            if (this.checked) {
                $("#AMOUNT2").val($("#divSaldo").text());
                $("#AMOUNT2").attr("readonly", "readonly");
            } else {
                $('#AMOUNT2').removeAttr("readonly");
            }
        });

        $('#btnPagar').click(function (event) {
            SetFechaVencimiento();
            var vMessage = "";
            var ekl = parseFloat(document.getElementById('AMOUNT2').value);
            var card = document.getElementById('CARDNUM2').value;
            if ($.trim($("#AMOUNT2").val()) == "")
                vMessage += "- Debe ingresar el monto a Abonar.\n";
            if (ekl == 0)
                vMessage += "- Debe ingresar un monto válido, ej. 2 o 2.00.\n";
            if (card == "")
                vMessage += "- Debe ingresar el número de tarjeta de crédito. \n";

            if (vMessage == "")
                RegristarDatosPago();
            else {
                alert(vMessage);
                return false;
            }
        });
    });

    function SetFechaVencimiento() {
        var mes = document.getElementById('ddlMes').value;
        var anho = document.getElementById('ddlAnho').value;
        var card = document.getElementById('CARDNUM2').value;
        var mont = document.getElementById('AMOUNT2').value;

        document.getElementById('EXPDATE').value = mes + anho;
        document.getElementById('CARDNUM').value = card;
        document.getElementById('AMOUNT').value = mont;
    }

    function RegristarDatosPago() {
        var resultado = false;
        var montoAbono = document.getElementById('AMOUNT2').value;
        var nroTarjeta = document.getElementById('CARDNUM2').value;
        var parametros = { accion: 'RegistrarPago', montoAbono: montoAbono, nroTarjeta: nroTarjeta };

        waitingDialog({});
        jQuery.ajax({
            type: 'POST',
            url: baseUrl + 'Paypal/InsertDatosPago',
            dataType: 'json',
            contentType: 'application/json; charset=utf-8',
            data: JSON.stringify({ NroTarjeta: nroTarjeta, Monto: montoAbono }),
            async: true,
            success: function (data) {
                if (checkTimeout(data)) {
                    closeWaitingDialog();
                    if (data.success == true) {
                        document.getElementById("frmPago").action = "https://payflowlink.paypal.com";
                        $('#frmPago').submit();
                    }
                    else {
                        alert("Ya existe una transaccción con esta información, espere su confirmación.");
                    }
                }
            },
            error: function (data, error) {
                if (checkTimeout(data)) {
                    closeWaitingDialog();
                    alert("ERROR");
                }
            }
        });
    }

    function hasDecimalPlace(value, x) {
        var pointIndex = value.indexOf('.');
        return pointIndex >= 0 && pointIndex < value.length - x;
    }
</script>
<div class="wrap_cab">
    <div class="filtros">
        <div class="elements">
            <div class="div-2">
                <h1>Pagos <span>en Línea</span></h1>
            </div>
            <div class="paypal">
                <div class="div-3">
                    <div class="titF">Código de Consultora:</div>
                    <div class="titAuto">@ViewBag.CodigoConsultora</div>
                </div>
                <div class="div-3">
                    <div class="titF">Código de Territorio:</div>
                    <div class="titAuto">@ViewBag.CodigoTerritorio</div>
                </div>
            </div>
        </div>
    </div>
</div>
<form id="frmPago" method="post">
    <input id="ORDERFORM" type="hidden" value="False" name="ORDERFORM">
    <input id="SHOWCONFIRM" type="hidden" value="False" name="SHOWCONFIRM">
    <input id="EMAILCUSTOMER" type="hidden" value="True" name="EMAILCUSTOMER">
    <input id="LOGIN" type="hidden" name="LOGIN" value="@ViewBag.LOGN">
    <input id="PARTNER" type="hidden" name="PARTNER" value="@ViewBag.PTNR">
    <input id="TYPE" type="hidden" name="TYPE" value="@ViewBag.TYPE">
    <input id="METHOD" type="hidden" name="METHOD" value="@ViewBag.METH">
    <input id="DESCRIPTION" type="hidden" value="Abono Cuenta - MyEbel" name="DESCRIPTION">
    <input id="EXPDATE" type="hidden" name="EXPDATE">
    <input id="NAME" type="hidden" name="NAME" value="@ViewBag.Nombre">
    <input id="ADDRESS" type="hidden" name="ADDRESS">
    <input id="CITY" type="hidden" name="CITY">
    <input id="COUNTRY" type="hidden" name="COUNTRY" value="PUERTORICO">
    <input id="ZIP" type="hidden" name="ZIP">
    <input id="EMAIL" type="hidden" name="EMAIL" value="@ViewBag.EMAIL">
    <input id="USER1" type="hidden" name="USER1" value="0282">
    <input id="USER2" type="hidden" name="USER2" value="@ViewBag.CodigoConsultora">
    <input id="USER3" type="hidden" name="USER3" value="@ViewBag.PaisID">
    <input id="CARDNUM" type="hidden" name="CARDNUM">
    <input id="AMOUNT" type="hidden" name="AMOUNT">
    <input id="RETURNURL" name="RETURNURL" type="hidden" value="@ViewBag.RURL">
    <input id="FAILEDURL" name="FAILEDURL" type="hidden">
    <input id="POSTURL" name="POSTURL" type="hidden" value="@ViewBag.PURL">
    <input id="COMMENT1" name="COMMENT1" type="hidden" value="@ViewBag.CodigoConsultora">

    <div class="wrap">
        <div class="container clearfix">
            <div class="border-wrapper_reg">
                <div class="div-3">
                    <div class="titAuto alignright">
                        <h4>1.- Ingresa el monto a cancelar o abonar (Dólares)</h4>
                    </div>
                </div>
                <div class="div-3">
                    <div class="titI">Total Deuda:</div>
                    <div id="divSaldo" class="titAuto alignleft">@ViewBag.SaldoActual</div>
                </div>
                <div class="div-3">
                    <div class="titI">Monto a Abonar:</div>
                    <div class="selectA borde_redondeado">
                        <input type="text" maxlength="9" id="AMOUNT2">
                    </div>
                    <div class="titAuto">
                        <input type="checkbox" id="chkMontoPagar" />
                        Todo
                    </div>
                </div>
                <div class="div-3">
                    <div class="titAuto alignright">
                        <h4>2.- Ingresa al número de Tarjeta de Crédito y la fecha de vencimiento la misma</h4>
                    </div>
                </div>
                <div class="div-3">
                    <div class="titI">Tarjeta de Crédito:</div>
                    <div class="selectA borde_redondeado">
                        <input id="CARDNUM2" type="text" maxlength="25" /><img alt="Buscar Cod. Venta" src="" style="display: none" />
                    </div>
                    <div class="titI">Fecha Vencimiento:</div>
                    <div class="selectP2 borde_redondeado">
                        <select data-val="true" id="ddlMes" name="ddlMes">
                            <option value="01">Enero</option>
                            <option value="02">Febrero</option>
                            <option value="03">Marzo</option>
                            <option value="04">Abril</option>
                            <option value="05">Mayo</option>
                            <option value="06">Junio</option>
                            <option value="07">Julio</option>
                            <option value="08">Agosto</option>
                            <option value="09">Septiembre</option>
                            <option value="10">Octubre</option>
                            <option value="11">Noviembre</option>
                            <option value="12">Diciembre</option>
                        </select>
                    </div>
                    <div class="selectH2 borde_redondeado">
                        <select data-val="true" id="ddlAnho" name="ddlAnho">
                            @*<option value="13">2013</option>
                            <option value="14">2014</option>
                            <option value="15">2015</option>
                            <option value="16">2016</option>
                            <option value="17">2017</option>
                            <option value="18">2018</option>
                            <option value="19">2019</option>
                            <option value="20">2020</option>*@
                        </select>
                    </div>
                </div>
                <div class="div-3">
                    <div class="titI"></div>
                    <div class="titAuto">
                        <img src="~/Content/Images/paypal_tarjetas.png" alt="" />
                    </div>
                </div>
                <div class="div-3">
                    <div class="titAuto alignright">
                        <h4>3.- Hacer clic en el botón "Pagar"</h4>
                    </div>
                </div>
                <div class="div-3">
                    <div class="titI"></div>
                    <div class="input_search">
                        <input id="btnPagar" type="button" value="Pagar" />
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="loadingScreen"></div>
</form>
