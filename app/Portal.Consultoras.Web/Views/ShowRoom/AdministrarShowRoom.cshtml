@model Portal.Consultoras.Web.Models.OfertaProductoModel
@{
    ViewBag.Title = "Administración de Ofertas Liquidación";
    Layout = "~/Views/Shared/_SACLayout.cshtml";
}

<link href="@Url.Content("~/Scripts/MultiSelect/css/ui.multiselect.css")" rel="stylesheet" />

<style>
    .multiselect {
        width: 560px;
        height: 250px;
    }

    .actions.ui-widget-header.ui-helper-clearfix {
        background: #00A2E8 !important;
        color: white;
    }

    .ui-multiselect div.selected {
        position: relative;
        padding: 0;
        margin: 0;
        border: 0;
        float: left;
        border-left: 1px solid;
    }

    .ui-multiselect div.available {
        position: relative;
        padding: 0;
        margin: 0;
        border: 0;
        float: left;
    }

    #switcher {
        margin-top: 20px;
    }
</style>

<script src="@Url.Content("~/Scripts/fileuploader.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery.form.js")" type="text/javascript"></script>

<script src="@Url.Content("~/Scripts/MultiSelect/js/plugins/localisation/jquery.localisation.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/MultiSelect/js/plugins/scrollTo/jquery.scrollTo.js")"></script>
<script src="@Url.Content("~/Scripts/MultiSelect/js/ui.multiselect.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/MultiSelect/js/locale/ui-multiselect-es.js")"></script>

<div class="wrap_cab">
    <div class="filtros">
        <div class="elements">
            <div class="div-2">
                <h1>Administrador Ofertas <span>ShowRoom</span></h1>
            </div>
            <div class="div-2">
                <h3>Datos del Evento</h3>
            </div>
            <div class="div-3">
                <div class="titC">País:</div>
                <div class="selectA borde_redondeado">
                    @Html.DropDownListFor(model => model.CampaniaID, new SelectList(Model.lstPais, "PaisID", "Nombre"), "-- Seleccionar --", new { id = "ddlPais" })
                </div>
                <div class="titB">Campaña:</div>
                <div class="selectA borde_redondeado">
                    @Html.DropDownListFor(model => model.CampaniaID, new SelectList(Model.lstCampania, "CampaniaID", "NombreCorto"), "-- Seleccionar --", new { id = "ddlCampania" })
                </div>
            </div>
            <div class="div-3">
                <div class="input_search">
                    <input type="button" value="Buscar" id="btnBuscar" name="">
                </div>
                <div class="input_search">
                    <input type="button" value="Tipos de Oferta" id="btnTiposOferta" name="">
                </div>
            </div>
        </div>
    </div>
</div>

<div class="wrap" id="divShowRoomEvento" style="display: none;">
    <div class="container clearfix">
        <div class="border-wrapper">
            <table id="listEvento"></table>
            <div id="pagerEvento"></div>
        </div>
    </div>
</div>

<div class="wrap" id="divShowRoomEventoNuevo" style="display: none;">
    <div class="filtros">
        <div class="elements" style="padding-top: 0">
            <div class="div-3">
                <div class="input_search">
                    <input type="button" value="Nuevo" id="btnNuevo" name="">
                </div>
            </div>
        </div>
    </div>
</div>

<div class="elements" id="divCargaArchivos" style="display: none;">
    <div class="div-2">
        <h3>Carga de Archivos</h3>
        <div class="div-3">
            <div class="titC" style="width: 160px; margin-top: 6px;">Carga de Consultoras</div>
            <div class="titC" style="padding: 0; margin-top: 15px; width: 50px;">
                <a href="#" id="lnkConsultoras">
                    <img title="Cargar Consultoras" src='@Url.Content("~/Content/Images/email_admin.png")' alt=""/>
                </a>
            </div>

            <div class="titC" style="width: 160px; margin-top: 6px; padding-left: 10px;">Carga de Sets</div>
            <div class="titC" style="padding: 0; margin-top: 15px; width: 50px;">
                <a href="#" id="lnkStock">
                    <img title="Cargar Stock" src='@Url.Content("~/Content/Images/stok.png")' alt=""/>
                </a>
            </div>

            <div class="titC" style="width: 160px; margin-top: 6px; padding-left: 10px;">Carga de Descripción de Sets/Productos</div>
            <div class="titC" style="padding: 0; margin-top: 15px; width: 50px;">
                <a href="#" id="lnkDescripcionSets">
                    <img title="Descripción Sets" src='@Url.Content("~/Content/Images/stok.png")' alt=""/>
                </a>
            </div>

            <div class="titC" style="width: 160px; margin-top: 6px; padding-left: 10px;">Carga de Productos Compra por Compra</div>
            <div class="titC" style="padding: 0; margin-top: 15px; width: 50px;">
                <a href="#" id="lnkProductoCpc">
                    <img title="Cargar Productos Compra por Compra" src='@Url.Content("~/Content/Images/stok.png")' alt="" />
                </a>
            </div>
        </div>
    </div>
</div>

<div class="elements" id="divPersonalizacion" style="display: none;">
    <div class="container clearfix">
        <h3>Personalización</h3>
        <div class="div-3">
            <div class="titC">Nivel:</div>
            <div class="selectA borde_redondeado">
                <select id="cbNivelEvento"></select>
            </div>

            <div class="input_horizontal">
                <input type="button" value="Buscar Personalización" id="btnBuscarPersonalizacionNivel" name="">
            </div>
        </div>
    </div>
</div>

<div class="elements" id="divPersonalizacionCategoria" style="display: none;">
    <div class="container clearfix">
        <h3>Personalización Categoria</h3>
        <div class="div-3">
            <div class="titC">Categoria:</div>
            <div class="selectA borde_redondeado">
                <select id="cbCategoriaEvento"></select>
            </div>

            <div class="input_horizontal">
                <input type="button" value="Buscar Personalización Categoría" id="btnBuscarPersonalizacionCategoria" name="">
            </div>
        </div>
    </div>
</div>

<div class="wrap" id="divOfertasShowRoom" style="display: none;">
    <div class="container clearfix">
        <h3>Ofertas ShowRoom</h3>
        <div class="border-wrapper">
            <table id="list"></table>
            <div id="pager"></div>
        </div>
    </div>
</div>

<div class="wrap" id="divShowRoomPerfil" style="display: none;">
    <fieldset style="border: 1px black; border-style: groove; margin-left: 200px; margin-right: 200px;">
        <legend></legend>
        <div class="container clearfix">
            <h3>Perfiles</h3>
            <div class="div-3">
                <div class="titC">Perfil:</div>
                <div class="selectA borde_redondeado">
                    <select id="cbPerfilesEvento"></select>
                </div>
            </div>
            <div class="div-3">
                <div class="titC" style="width: auto; margin-left: 45px; text-align: left;">
                    Selecciones los sets para el perfil 
                    <b>(El primer Set será el que aparecerá en el Landing Page de Intriga)</b>
                </div>
            </div>
            <div class="div-3" id="divPerfilOfertaShowRoom" style="display: none; padding-left: 52px;">
            </div>
            <div class="div-3" style="padding-left: 42px;">
                <div class="titAuto">
                    <div class="input_horizontal">
                        <input type="button" name="btnGuardarPerfilOfertaShowRoom" id="btnGuardarPerfilOfertaShowRoom" value="Guardar" />
                    </div>
                </div>
            </div>
        </div>
    </fieldset>

</div>

<div id="loadingScreen"></div>

<div id="DialogMensajes" style="display: none;">
    <div class="Content_modal">
        <div class="message_text">
            Ocurrió un error en la comunicación o la sesión ha expirado. Por favor vuelva a autenticarse.
        </div>
    </div>
</div>

<div id="DialogDatosShowRoom" style="display: none;">
    <div class="Content_modal">
        <input type="hidden" id="hdEventoID" />
        <input type="hidden" id="hdCampaniaMinimaPersonalizacion" />
        <div class="div-3">
            <div class="titG">País:</div>
            <div class="selectP2 borde_redondeado" style="background: #F9F9F0;">
                <input type="text" id="txtEventoPaisID" readonly="readonly" style="background: #F9F9F0;" />
            </div>
            <div class="titG">Campaña:</div>
            <div class="selectP2 borde_redondeado" style="background: #F9F9F0;">
                <input type="text" id="txtEventoCampaniaID" readonly="readonly" style="background: #F9F9F0;" />
            </div>
        </div>
        <div class="div-3">
            <div class="titG">Nombre:</div>
            <div class="selectP2 borde_redondeado">
                <input type="text" id="txtEventoNombre" />
            </div>
            <div class="titG">Tema:</div>
            <div class="selectP2 borde_redondeado">
                <input type="text" id="txtEventoTema" />
            </div>
        </div>
        <div class="div-3">
            <div class="titG">Dias Antes Fact.:</div>
            <div class="selectP2 borde_redondeado">
                <input type="text" id="txtEventoDiasAntes" onkeypress="return FuncionesGenerales.ValidarSoloNumeros(event);" />
            </div>
            <div class="titG">Dias Despues Fact.:</div>
            <div class="selectP2 borde_redondeado">
                <input type="text" id="txtEventoDiasDespues" onkeypress="return FuncionesGenerales.ValidarSoloNumeros(event);" />
            </div>
        </div>
        <div class="div-3">
            <div class="titG"># de Perfiles:</div>
            <div class="selectP2 borde_redondeado">
                <input type="text" id="txtEventoNumeroPerfiles" onkeypress=" return FuncionesGenerales.ValidarSoloNumeros(event); "/>
            </div>
            <div id="divEventoEstado">
                <div class="titG">Habilitar Evento</div>
                <div class="selectCheck borde_redondeado" style="float: left; width: 170px; margin-right: 30px;">
                    <input type="checkbox" class="check" id="chkEventoEstado"/>
                </div>
            </div>
        </div>
        <div class="div-3">
            <div>
                <div class="titG">Habilitar Categorías</div>
                <div class="selectCheck borde_redondeado" style="float: left; width: 170px; margin-right: 30px; ">
                    <input type="checkbox" class="check" id="chkEventoTieneCategoria" />
                </div>
            </div>
            <div>
                <div class="titG">Habilitar Compra por Compra</div>
                <div class="selectCheck borde_redondeado" style="float: left; width: 170px; margin-right: 30px; ">
                    <input type="checkbox" class="check" id="chkEventocompraXcompra" />
                </div>
            </div>
        </div>
        <div class="div-3">
            <div>
                <div class="titG">Habilitar SubCampañas</div>
                <div class="selectCheck borde_redondeado" style="float: left; width: 170px; margin-right: 30px; ">
                    <input type="checkbox" class="check" id="chkEventoTieneSubCampania" />
                </div>
            </div>
            <div>
                <div class="titG">Habilitar Personalización</div>
                <div class="selectCheck borde_redondeado" style="float: left; width: 170px; margin-right: 30px; ">
                    <input type="checkbox" class="check" id="chkEventoTienePersonalizacion" />
                </div>
            </div>
        </div>
    </div>
</div>

<div id="DialogCargarConsultoras" style="display: none;">
    @using (Html.BeginForm("CargarMasivaConsultora", "ShowRoom", FormMethod.Post, new { id = "frmCargarConsultoras", enctype = "multipart/form-data" }))
    {
        <input type="hidden" id="hdCargaCampaniaID" name="hdCargaCampaniaID" />
        <input type="hidden" id="hdCargaEventoID" name="hdCargaEventoID" />
        <div class="Content_modal">
            <div class="div-3">
                <div class="titC">
                    Archivo :
                </div>
                <div class="selectA borde_redondeado">
                    <input type="file" id="flCargarConsultoras" name="flCargarConsultoras" />
                </div>
            </div>
            <div class="div-3">
                <div class="titC">
                </div>
                <div class="titAuto" style="text-align:left;">
                    <div>Formato de archivo (*.csv):</div>
                    <div>- Código Consultora</div>
                    <div>- Nombre Perfil</div>
                </div>
            </div>
        </div>
    }
</div>

<div id="DialogCargarStock" style="display: none;">
    @using (Html.BeginForm("ActualizarStockMasivo", "ShowRoom", FormMethod.Post, new { id = "frmCargarStock", enctype = "multipart/form-data" }))
    {
        <input type="hidden" id="hdCargaStockEventoID" name="hdCargaStockEventoID" />
        <div class="Content_modal">
            <div class="div-3">
                <div class="titC">
                    Archivo :
                </div>
                <div class="selectA borde_redondeado">
                    <input type="file" id="flStock" name="flStock" />
                </div>
            </div>
            <div class="div-3">
                <div class="titC">
                </div>
                <div class="titAuto" style="text-align:left;">
                    <div>Formato de archivo (*.csv):</div>
                    <div>- Pais</div>
                    <div>- Campaña</div>
                    <div>- CUV</div>
                    <div>- Unidades</div>
                    <div>- PNormal</div>
                    <div>- Unidades Permitidas</div>
                    <div>- Nombre del Set</div>
                    <div>- Codigo de Categoria</div>
                    <div>- Tip de Negocio</div>
                    <div>- EsSubCampania</div>
                </div>
            </div>
        </div>
    }
</div>

<div id="DialogCargarDescripcionSets" style="display: none;">
    @using (Html.BeginForm("ActualizarDescripcionSetsMasivo", "ShowRoom", FormMethod.Post, new {id = "frmCargarDescripcionSets", enctype = "multipart/form-data"}))
    {
        <input type="hidden" id="hdCargaDescripcionSetsCampaniaID" name="hdCargaDescripcionSetsCampaniaID"/>
        <input type="hidden" id="hdCargaDescripcionSetsEventoID" name="hdCargaDescripcionSetsEventoID"/>
        <div class="Content_modal">
            <div class="div-3">
                <div class="titC">
                    Archivo :
                </div>
                <div class="selectA borde_redondeado">
                    <input type="file" id="flDescripcionSets" name="flDescripcionSets"/>
                </div>
            </div>
            <div class="div-3">
                <div class="titC">
                </div>
                <div class="titAuto" style="text-align: left;">
                    <div>Formato de archivo (*.csv):</div>
                    <div>- CUV</div>
                    <div>- Posición</div>
                    <div>- NombreProducto</div>
                    <div>- Descripcion1</div>
                    <div>- Descripcion2</div>
                    <div>- Descripcion3</div>
                    <div>- MarcaProducto</div>
                </div>
            </div>
        </div>
    }
</div>

<div id="DialogCargarProductoCpc" style="display: none;">
    @using (Html.BeginForm("CargarProductoCpc", "ShowRoom", FormMethod.Post, new { id = "frmCargarProductoCpc", enctype = "multipart/form-data" }))
    {
        <input type="hidden" id="hdCargarProductoCpcCampaniaID" name="hdCargarProductoCpcCampaniaID" />
        <input type="hidden" id="hdCargarProductoCpcEventoID" name="hdCargarProductoCpcEventoID" />
        <div class="Content_modal">
            <div class="div-3">
                <div class="titC">
                    Archivo :
                </div>
                <div class="selectA borde_redondeado">
                    <input type="file" id="flCargarProductoCpc" name="flCargarProductoCpc" />
                </div>
            </div>
            <div class="div-3">
                <div class="titC">
                </div>
                <div class="titAuto" style="text-align: left;">
                    <div>Formato de archivo (*.csv):</div>
                    <div>- CUV</div>
                    <div>- Codigo SAP</div>
                    <div>- Orden</div>
                    <div>- PrecioValorizado</div>
                </div>
            </div>
        </div>
    }
</div>

<div id="DialogRegistroOfertaShowRoom" style="display: none;">
    <input type="hidden" id="hdTallaColorID" value="0" />
    <input type="hidden" id="hdCampaniaID" />
    <input type="hidden" id="hdImagenProducto" />
    <input type="hidden" id="hdImagenProductoAnterior" />
    <input type="hidden" id="hdImagenMini" />
    <input type="hidden" id="hdImagenMiniAnterior" />
    <input type="hidden" id="FlagTransaccion" value="0" />
    <input type="hidden" id="hdCodigoOferta" value="" />
    <input type="hidden" id="hdCodigoCampania" value="" />
    <input type="hidden" id="hdOrdenAnterior" value="" />
    <input type="hidden" id="hdStockProducto" value="0" />
    <input type="hidden" id="hdConfiguracionOfertaID" value="0" />
    <div class="Content_modal">
        <div class="div-3">
            <div class="titG">País:</div>
            <div class="selectP2 borde_redondeado" style="background: #F9F9F0;">
                <input type="text" id="txtPaisModal" readonly="readonly" style="background: #F9F9F0;" />
            </div>
            <div class="titG">Campaña:</div>
            <div class="selectP2 borde_redondeado" style="background: #F9F9F0;">
                <input type="text" id="txtCampaniaModal" readonly="readonly" style="background: #F9F9F0;" />
            </div>
        </div>
        <div class="div-3">
            <div class="titG">CUV:</div>
            <div class="selectP2 borde_redondeado" style="background: #F9F9F0;">
                <input type="text" id="txtCUVModal" readonly="readonly" style="background: #F9F9F0;" />
            </div>
            <div class="titG">Precio Valorizado:</div>
            <div class="selectP2 borde_redondeado">
                <input type="text" id="txtPrecioValorizadoModal" />
            </div>
            
        </div>
        <div class="div-3">
            <div class="titG">Precio Oferta:</div>
            <div class="selectP2 borde_redondeado">
                <input type="text" id="txtPrecioOfertaModal" />
            </div>

            <div class="selectCheck borde_redondeado">
                <input style="text-align:left; position:absolute; right:222px; top:-4px;" type="checkbox" class="check" id="chkEsSubCampania" />
            </div>
            <div style="text-align:left; position:absolute; right:85px;" class="titG">¿Es SubCampaña?</div>
        </div>
        <div class="div-3">
            <div class="titG">Descripción:</div>
            <div class="selectP2 borde_redondeado" style="width: 513px;" >
                <input type="text" id="txtDescripcionModal" style="width: 513px;" />
            </div>            
        </div>
        <div class="div-3">
            <div class="titG">Unid. Permitidas:</div>
            <div class="selectP2 borde_redondeado">
                <input type="text" id="txtUnidadesPermitidasModal" maxlength="6">
            </div>
            
            <div  class="selectCheck borde_redondeado">
                <input style="text-align:left; position:absolute; right:222px; top:-4px;" type="checkbox" class="check" id="chkHabilitarOferta" />
            </div>
            <div style="text-align:left; position:absolute; right:85px;" class="titG">¿Habilitar Oferta?</div>
        </div>
        <div class="div-3">
            <div class="titG">Imagen:</div>
            <div class="pdr_modal borde_redondeado aligncenter" style="width: 168px; height: 200px;">
                <img src='@Url.Content("~/Content/Images/prod_grilla_vacio.png")' id="imgProducto" style="cursor: pointer; max-width: 100% !important;">
            </div>
            <div class="titG">Imagen Mini:</div>
            <div class="pdr_modal borde_redondeado aligncenter" style="width: 168px; height: 200px;">
                <img src='@Url.Content("~/Content/Images/prod_grilla_vacio.png")' id="imgMini" style="cursor: pointer; max-width: 100% !important;">
            </div>
        </div>
        <div class="div-3">
            <div class="titG"></div>
            <div class="titC" style="padding: 0; width: 180px; padding-right: 20px;">
                <div class="input_search">
                    <div id="fpPopupImagenProducto">
                        <script type="text/javascript">
                            $.ajaxSetup({ cache: false });
                            var uploader = new qq.FileUploader({
                                allowedExtensions: ['jpg', 'png', 'jpeg', 'gif'],
                                element: document.getElementById('fpPopupImagenProducto'),
                                action: '@Url.Action("ImageMatrizUpload", "FileUpload")',
                                onComplete: function (id, fileName, responseJSON) {
                                    if (checkTimeout(responseJSON)) {
                                        $(".qq-upload-list").css("display", "none");
                                        if (responseJSON.success) {
                                            var rutaImagen = '@Url.Content("~/Content/Temporales/")' + responseJSON.name;
                                            $("#imgProducto").attr('src', rutaImagen);
                                            $("#hdImagenProducto").val(responseJSON.name);
                                        }
                                        else {
                                            alert(responseJSON.message);
                                        }
                                    }
                                },
                                onSubmit: function (id, fileName) { $(".qq-upload-list").css("display", "none"); },
                                onProgress: function (id, fileName, loaded, total) { $(".qq-upload-list").css("display", "none"); },
                                onCancel: function (id, fileName) { $(".qq-upload-list").css("display", "none"); }
                            });
                        </script>
                    </div>
                </div>
            </div>

            <div class="titG"></div>
            <div class="titC" style="padding: 0; width: 180px; padding-right: 20px;">
                <div class="input_search">
                    <div id="fpPopupImagenMini">
                        <script type="text/javascript">
                            $.ajaxSetup({ cache: false });
                            var uploader = new qq.FileUploader({
                                allowedExtensions: ['jpg', 'png', 'jpeg', 'gif'],
                                element: document.getElementById('fpPopupImagenMini'),
                                action: '@Url.Action("ImageMatrizUpload", "FileUpload")',
                                onComplete: function (id, fileName, responseJSON) {
                                    if (checkTimeout(responseJSON)) {
                                        $(".qq-upload-list").css("display", "none");
                                        if (responseJSON.success) {
                                            var rutaImagen = '@Url.Content("~/Content/Temporales/")' + responseJSON.name;
                                            $("#imgMini").attr('src', rutaImagen);
                                            $("#hdImagenMini").val(responseJSON.name);
                                        }
                                        else {
                                            alert(responseJSON.message);
                                        }
                                    }
                                },
                                onSubmit: function (id, fileName) { $(".qq-upload-list").css("display", "none"); },
                                onProgress: function (id, fileName, loaded, total) { $(".qq-upload-list").css("display", "none"); },
                                onCancel: function (id, fileName) { $(".qq-upload-list").css("display", "none"); }
                            });
                        </script>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="DialogRegistroOfertaShowRoomDetalle" style="display: none;">
    <div class="Content_modal" style="max-height: 450px;">
        <div class="div-3">
            <div class="titG">País:</div>
            <div class="selectP2 borde_redondeado" style="background: #F9F9F0;">
                <input type="text" id="txtPaisDetalle" readonly="readonly" style="background: #F9F9F0;" />
            </div>
            <div class="titG">Campaña:</div>
            <div class="selectP2 borde_redondeado" style="background: #F9F9F0;">
                <input type="text" id="txtCampaniaDetalle" readonly="readonly" style="background: #F9F9F0;" />
            </div>
        </div>
        <div class="div-3">
            <div class="titG">CUV:</div>
            <div class="selectP2 borde_redondeado" style="background: #F9F9F0;">
                <input type="text" id="txtCUVDetalle" readonly="readonly" style="background: #F9F9F0;" />
            </div>
            <div class="titG">Precio Normal:</div>
            <div class="selectP2 borde_redondeado" style="background: #F9F9F0;">
                <input type="text" id="txtPrecioValorizadoDetalle" readonly="readonly" style="background: #F9F9F0;" />
            </div>
        </div>
        <div class="div-3">
            <div class="titG">Descripción:</div>
            <div class="selectP2 borde_redondeado" style="background: #F9F9F0; width: 513px;">
                <input type="text" id="txtDescripcionDetalle" readonly="readonly" style="background: #F9F9F0; width: 513px;" />
            </div>            
        </div>
        <div class="div-3">
            <div class="input_search" style="float: right; padding-right: 155px;">
                <input type="button" value="Nuevo" id="btnNuevoDetalle" name="">
            </div>
        </div>
        <div class="container" style="width: auto;">
            <div class="border-wrapper">
                <table id="listShowRoomDetalle"></table>
                <div id="pagerShowRoomDetalle"></div>
            </div>
        </div>
    </div>
</div>

<div id="DialogRegistroOfertaShowRoomDetalleEditar" style="display: none;">
    <div class="Content_modal">
        <input type="hidden" id="hdOfertaShowRoomDetalleID"/>
        <input type="hidden" id="hdImagenDetalle"/>
        <input type="hidden" id="hdImagenDetalleAnterior"/>
        <div class="div-3">
            <div class="titG">Nombre Producto:</div>
            <div class="selectP2 borde_redondeado">
                <input type="text" id="txtNombreProductoDetalle"/>
            </div>
            <div class="titG">Descripcion 1:</div>
            <div class="selectP2 borde_redondeado">
                <input type="text" id="txtDescripcion1Detalle"/>
            </div>
        </div>
        <div class="div-3">
            <div class="titG">Descripcion 2:</div>
            <div class="selectP2 borde_redondeado">
                <input type="text" id="txtDescripcion2Detalle"/>
            </div>
            <div class="titG">Descripcion 3:</div>
            <div class="selectP2 borde_redondeado">
                <input type="text" id="txtDescripcion3Detalle"/>
            </div>
        </div>
        <div class="div-3">
            <div class="titG">Marca Producto:</div>
            <div class="selectP2 borde_redondeado">
                <input type="text" id="txtMarcaProductoDetalle" />
            </div>
        </div>
        <div class="div-3">
            <div class="titG">Imagen:</div>
            <div class="pdr_modal borde_redondeado aligncenter" style="width: 168px; height: 200px;">
                <img src='@Url.Content("~/Content/Images/prod_grilla_vacio.png")' id="imgProductoDetalle" style="cursor: pointer; max-width: 100% !important;">
            </div>
        </div>
        <div class="div-3">
            <div class="titG"></div>
            <div class="titC" style="padding: 0; width: 180px; padding-right: 20px;">
                <div class="input_search">
                    <div id="fpPopupImagenProductoDetalle">
                        <script type="text/javascript">
                            $.ajaxSetup({ cache: false });
                            var uploader = new qq.FileUploader({
                                allowedExtensions: ['jpg', 'png', 'jpeg', 'gif'],
                                element: document.getElementById('fpPopupImagenProductoDetalle'),
                                action: '@Url.Action("ImageMatrizUpload", "FileUpload")',
                                onComplete: function(id, fileName, responseJSON) {
                                    if (checkTimeout(responseJSON)) {
                                        $(".qq-upload-list").css("display", "none");
                                        if (responseJSON.success) {
                                            var rutaImagen = '@Url.Content("~/Content/Temporales/")' + responseJSON.name;
                                            $("#imgProductoDetalle").attr('src', rutaImagen);
                                            $("#hdImagenDetalle").val(responseJSON.name);
                                        } else {
                                            alert(responseJSON.message);
                                        }
                                    }
                                },
                                onSubmit: function(id, fileName) { $(".qq-upload-list").css("display", "none"); },
                                onProgress: function(id, fileName, loaded, total) { $(".qq-upload-list").css("display", "none"); },
                                onCancel: function(id, fileName) { $(".qq-upload-list").css("display", "none"); }
                            });
                        </script>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="DialogPersonalizacionDetalle">
    <div class="wrap">
        <fieldset style="border: 1px black; border-style: groove; margin-bottom: 20px;">
            <legend></legend>
            <div class="container clearfix" style="width: 750px;">
                <h3>Mobile</h3>
                <div id="divPersonalizacionDetalleMobile">
                </div>
            </div>
        </fieldset>
        <fieldset style="border: 1px black; border-style: groove;">
            <legend></legend>
            <div class="container clearfix" style="width: 750px;">
                <h3>Desktop</h3>
                <div id="divPersonalizacionDetalleDesktop">

                </div>
            </div>
        </fieldset>
    </div>
</div>

<div id="DialogPersonalizacionCategoriaDetalle">
    <div class="wrap">
        <div class="div-3">
            <div class="titG" style="width: 150px;">Nombre Categoría:</div>
            <div class="selectP2 borde_redondeado" style="width: 400px;">
                <input type="text" id="txtDescripcionCategoria" style="width: 400px;"/>
            </div>
        </div>
        <fieldset style="border: 1px black; border-style: groove; margin-bottom: 20px;">
            <legend></legend>
            <div class="container clearfix" style="width: 750px;">
                <h3>Mobile</h3>
                <p><b>Para los textos en negrita colocar antes "[" y al final "]" .Ejemplo ( MAMÁ [MODERNA] )</b></p>
                <div id="divPersonalizacionCategoriaDetalleMobile">
                </div>
            </div>
        </fieldset>
        <fieldset style="border: 1px black; border-style: groove;">
            <legend></legend>
            <div class="container clearfix" style="width: 750px;">
                <h3>Desktop</h3>
                <p><b>Para los textos en negrita colocar antes "[" y al final "]" .Ejemplo ( MAMÁ [MODERNA] )</b></p>
                <div id="divPersonalizacionCategoriaDetalleDesktop">

                </div>
            </div>
        </fieldset>
    </div>
</div>

<div style="display: none;">
    <div id="divPersonalizacionPlantillaTexto" class="div-3">
        <div class="titC" style="width: 250px;">Perfil:</div>
        <div class="selectP2 borde_redondeado">
            <input type="text" id="txtPerfilTextoDemo"/>
        </div>
    </div>
</div>
<div style="display: none;">
    <div id="divPersonalizacionPlantillaImagen" class="div-3">
        <div class="titC" style="width: 250px; margin-top: 15px;">Popup / Imagen Texto</div>
        <div class="titC" style="padding: 0; width: 230px;">
            <div class="input_search">
                <input type="hidden" id="hdImagenPreventaDigital" />
                <input type="hidden" id="hdImagenPreventaDigitalAnterior" />
                <div id="fpPopupImagenDemo">
                </div>
            </div>
            <div id="divPopupImagenDemo" style="width: 100px; height: 60px; float: right;">
                <img src="http://S3.amazonaws.com/consultorasQAS/SomosBelcorp/Matriz/CO/CO_imagen_preventa_digital_2017232920_01_bddprudydm.png"
                     alt="PopupImagenDemo" style="height: 100%;">
            </div>
        </div>
    </div>
</div>

<div id="DialogTiposOferta" style="display: none;">
    <div class="Content_modal" style="max-height: 450px;">     
        <div class="div-3">
            <input type="hidden" id="hdIdTipoOferta"/>
            <div class="titB">Código:</div>
            <div class="selectP2 borde_redondeado" style="width:50px">
                <input type="text" id="txtCodigoTipoOferta" style="width:50px" />
            </div>
            <div class="titB">Descripción:</div>
            <div class="selectP2 borde_redondeado" style="width:230px">
                <input type="text" id="txtDescripcionTipoOferta" style="width:230px" />
            </div>
            <div class="input_search">
                <input type="button" name="btnAgregarTipoOferta" id="btnAgregarTipoOferta" value="Agregar" style="float:right" />
            </div>
        </div>
        <div class="container" style="width: auto;">
            <div class="border-wrapper">
                <table id="listShowRoomTipoOferta"></table>
                <div id="pagerShowRoomTipoOferta"></div>
            </div>
        </div>
    </div>
</div>


<script type="text/javascript">
    var paisNombre = "";
    var paisID = 11;
    var urlConsultarOfertaShowRoom = baseUrl + "ShowRoom/ConsultarOfertaShowRoom";
    var imagenEdit = '@Url.Content("~/Content/Images/Edit.png")';
    var imagenDeshabilitar = '@Url.Content("~/Content/Images/NotAllowed.png")';
    var imagenEliminar = '@Url.Content("~/Content/Images/delete.png")';
    var imagenProductoVacio = '@Url.Content("~/Content/Images/prod_grilla_vacio.png")';
    var urlConsultarShowRoom = baseUrl + 'ShowRoom/ConsultarShowRoom';
    var urlConsultarOfertaShowRoomDetalle = baseUrl + "ShowRoom/ConsultarOfertaShowRoomDetalle";
    var urlGuardarPerfilOfertaShowRoom = baseUrl + 'ShowRoom/GuardarPerfilOfertaShowRoom';
    var urlGetShowRoomPerfilOfertaCuvs = baseUrl + 'ShowRoom/GetShowRoomPerfilOfertaCuvs';
    var urlGetShowRoomPerfiles = baseUrl + 'ShowRoom/GetShowRoomPerfiles';
    var urlGuardarImagenShowRoom = baseUrl + 'ShowRoom/GuardarImagenShowRoom';
    var urlGuardarShowRoom = baseUrl + 'ShowRoom/GuardarShowRoom';
    var urlInsertOrUpdateOfertaShowRoom = baseUrl + 'ShowRoom/InsertOrUpdateOfertaShowRoom';
    var urlInsertOfertaShowRoomDetalle = baseUrl + 'ShowRoom/InsertOfertaShowRoomDetalle';
    var urlUpdateOfertaShowRoomDetalle = baseUrl + 'ShowRoom/UpdateOfertaShowRoomDetalle';
    var urlDeshabilitarOfertaShowRoom = baseUrl + 'ShowRoom/DeshabilitarOfertaShowRoom';
    var urlRemoverOfertaShowRoom = baseUrl + 'ShowRoom/RemoverOfertaShowRoom';
    var urlDeshabilitarShowRoomEvento = baseUrl + 'ShowRoom/DeshabilitarShowRoomEvento';
    var urlEliminarShowRoomEvento = baseUrl + 'ShowRoom/EliminarShowRoomEvento';
    var urlEliminarOfertaShowRoomDetalleAll = baseUrl + 'ShowRoom/EliminarOfertaShowRoomDetalleAll';
    var urlEliminarOfertaShowRoomDetalle = baseUrl + 'ShowRoom/EliminarOfertaShowRoomDetalle';
    var urlGetShowRoomNiveles = baseUrl + 'ShowRoom/GetShowRoomNiveles';
    var urlGetShowRoomPersonalizacionNivel = baseUrl + 'ShowRoom/GetShowRoomPersonalizacionNivel';
    var urlImageMatrizUpload = '@Url.Action("ImageMatrizUpload", "FileUpload")';
    var rutaImagenTemporal = '@Url.Content("~/Content/Temporales/")';
    var urlGuardarPersonalizacionNivelShowRoom = baseUrl + 'ShowRoom/GuardarPersonalizacionNivelShowRoom';
    var urlGetShowRoomCategorias = baseUrl + 'ShowRoom/GetShowRoomCategorias';
    var urlGetShowRoomPersonalizacionCategoria = baseUrl + 'ShowRoom/GetShowRoomPersonalizacionCategoria';
    var urlUpdateShowRoomDescripcionCategoria = baseUrl + 'ShowRoom/UpdateShowRoomDescripcionCategoria';
    var urlConsultarTiposOferta = baseUrl + 'ShowRoom/ConsultarTiposOferta';
    var urlExisteTipoOferta = baseUrl + 'ShowRoom/ExisteTipoOferta';
    var urlGuardarShowRoomTipoOferta = baseUrl + 'ShowRoom/GuardarShowRoomTipoOferta';
    var urlHabilitarShowRoomTipoOferta = baseUrl + 'ShowRoom/HabilitarShowRoomTipoOferta'
    var mensajePersonalizacion = 'El evento tiene habilitada la opción de personalización.';

    jQuery(document).ready(function() {
        CargarDialog();
        CargarAjaxForm();
        CargarEventos();
    });

    function CargarDialog() {
        $('#DialogMensajes').dialog({
            autoOpen: false,
            resizable: false,
            modal: true,
            closeOnEscape: true,
            width: 400,
            draggable: true,
            title: ":: Mensaje ::",
            buttons:
            {
                "Aceptar": function () {
                    $(this).dialog('close');
                }
            }
        });

        $('#DialogDatosShowRoom').dialog({
            autoOpen: false,
            resizable: false,
            modal: true,
            closeOnEscape: true,
            width: 800,
            draggable: true,
            title: "Carga de Evento ShowRoom",
            buttons:
            {
                "Guardar": function () {
                    var vMessage = "";
                    if (jQuery.trim($('#txtEventoNombre').val()) == "")
                        vMessage += "- Debe ingresar el Nombre del Evento.\n";
                    if (jQuery.trim($('#txtEventoTema').val()) == "")
                        vMessage += "- Debe ingresar el Tema del Evento.\n";
                    if (jQuery.trim($('#txtEventoDiasAntes').val()) == "")
                        vMessage += "- Debe ingresar la cantidad de dias antes de la Facturación.\n";
                    if (parseInt(jQuery.trim($('#txtEventoDiasAntes').val())) <= 0)
                        vMessage += "- La cantidad de dias antes de la Facturación debe ser mayor a cero.\n";
                    if (jQuery.trim($('#txtEventoDiasDespues').val()) == "")
                        vMessage += "- Debe ingresar la cantidad de dias después de la Facturación.\n";
                    if (parseInt(jQuery.trim($('#txtEventoDiasDespues').val())) <= 0)
                        vMessage += "- La cantidad de dias después de la Facturación debe ser mayor a cero.\n";
                    if (jQuery.trim($('#txtEventoNumeroPerfiles').val()) == "")
                        vMessage += "- Debe ingresar la cantidad de perfiles.\n";
                    if (parseInt(jQuery.trim($('#txtEventoNumeroPerfiles').val())) <= 0)
                        vMessage += "- La cantidad de perfiles debe ser mayor a cero.\n";

                    if (vMessage != "") {
                        alert(vMessage);
                        return false;
                    } else {
                        GuardarShowRoomEvento();
                    }
                },
                "Cancelar": function () {
                    $(this).dialog('close');
                }
            }
        });

        $('#DialogCargarConsultoras').dialog({
            autoOpen: false,
            resizable: false,
            modal: true,
            closeOnEscape: true,
            width: 480,
            draggable: true,
            title: "Carga de Consultoras",
            buttons:
            {
                "Cargar": function () {
                    $('#frmCargarConsultoras').submit();
                },
                "Cancelar": function () {
                    $(this).dialog('close');
                }
            }
        });

        $('#DialogCargarStock').dialog({
            autoOpen: false,
            resizable: false,
            modal: true,
            closeOnEscape: true,
            width: 480,
            draggable: true,
            title: "Carga de Pack de Productos",
            buttons:
            {
                "Cargar": function () {
                    $('#frmCargarStock').submit();
                },
                "Cancelar": function () {
                    $(this).dialog('close');
                }
            }
        });

        $('#DialogCargarDescripcionSets').dialog({
            autoOpen: false,
            resizable: false,
            modal: true,
            closeOnEscape: true,
            width: 480,
            draggable: true,
            title: "Carga de Descripcion de Sets/Productos",
            buttons:
            {
                "Cargar": function () {
                    $('#frmCargarDescripcionSets').submit();
                },
                "Cancelar": function () {
                    $(this).dialog('close');
                }
            }
        });

        $('#DialogCargarProductoCpc').dialog({
            autoOpen: false,
            resizable: false,
            modal: true,
            closeOnEscape: true,
            width: 480,
            draggable: true,
            title: "Carga de Descripcion de Sets/Productos",
            buttons:
            {
                "Cargar": function () {
                    $('#frmCargarProductoCpc').submit();
                },
                "Cancelar": function () {
                    $(this).dialog('close');
                }
            }
        });

        $('#DialogRegistroOfertaShowRoom').dialog({
            autoOpen: false,
            resizable: false,
            modal: true,
            closeOnEscape: true,
            width: 800,
            draggable: true,
            title: "Edición de Sets",
            buttons:
            {
                "Guardar": function () {
                    var vMessage = "";
                    if (jQuery.trim($('#txtDescripcionModal').val()) == "")
                        vMessage += "- Debe ingresar la Descripción del Producto.\n";

                    if (jQuery.trim($('#txtUnidadesPermitidasModal').val()) == "" || jQuery.trim($('#txtOrdenModal').val()) == "0")
                        vMessage += "- Debe ingresar las unidades permitidas válido.\n";

                    if (vMessage != "") {
                        alert(vMessage);
                        return false;
                    }
                    else {
                        RegistrarOfertaShowRoom();
                    }
                },
                "Cancelar": function () {
                    $(this).dialog('close');
                }
            }
        });

        $('#DialogRegistroOfertaShowRoomDetalle').dialog({
            autoOpen: false,
            resizable: false,
            modal: true,
            closeOnEscape: true,
            width: 900,
            draggable: true,
            title: "Edición de Productos"
        });

        $('#DialogRegistroOfertaShowRoomDetalleEditar').dialog({
            autoOpen: false,
            resizable: false,
            modal: true,
            closeOnEscape: true,
            width: 800,
            draggable: true,
            title: "Registro / Edición de Productos",
            buttons:
            {
                "Guardar": function () {
                    var vMessage = "";
                    if (jQuery.trim($('#txtNombreProductoDetalle').val()) == "")
                        vMessage += "- Debe ingresar la el nombre del Producto.\n";

                    if (jQuery.trim($('#txtDescripcion1Detalle').val()) == "")
                        vMessage += "- Debe ingresar la el nombre del Producto.\n";

                    if (vMessage != "") {
                        alert(vMessage);
                        return false;
                    }
                    else {
                        RegistrarOfertaShowRoomDetalle();
                    }
                    return false;
                },
                "Cancelar": function () {
                    $(this).dialog('close');
                }
            }
        });

        $('#DialogPersonalizacionDetalle').dialog({
            autoOpen: false,
            resizable: false,
            modal: true,
            closeOnEscape: true,
            width: 800,
            draggable: true,
            title: "Detalle de Personalizacion por Nivel",
            buttons:
            {
                "Guardar": function () {
                    var vMessage = "";

                    var eventoId = $("#hdEventoID").val();
                    var nivelId = $("#cbNivelEvento").val();

                    if (eventoId == "")
                        vMessage += "- Debe seleccionar el evento.\n";

                    if (nivelId == "")
                        vMessage += "- Debe seleccionar el nivel de la personalización.\n";                    

                    if (vMessage != "") {
                        alert(vMessage);
                        return false;
                    }
                    else {
                        RegistrarShowRoomPersonalizacionNivel(eventoId, nivelId);
                    }
                    return false;
                },
                "Cancelar": function () {
                    $(this).dialog('close');
                }
            }
        });

        $('#DialogPersonalizacionCategoriaDetalle').dialog({
            autoOpen: false,
            resizable: false,
            modal: true,
            closeOnEscape: true,
            width: 800,
            draggable: true,
            title: "Detalle de Personalizacion por Nivel",
            buttons:
            {
                "Guardar": function () {
                    var vMessage = "";

                    var eventoId = $("#hdEventoID").val();
                    var categoriaId = $("#cbCategoriaEvento").val();

                    if (eventoId == "")
                        vMessage += "- Debe seleccionar el evento.\n";

                    if (categoriaId == "")
                        vMessage += "- Debe seleccionar la categoría de la personalización.\n";

                    if (vMessage != "") {
                        alert(vMessage);
                        return false;
                    }
                    else {
                        UpdateDescripcionCategoria(categoriaId);
                        RegistrarShowRoomPersonalizacionCategoria(eventoId, categoriaId);
                    }
                    return false;
                },
                "Cancelar": function () {
                    $(this).dialog('close');
                }
            }
        });

        $('#DialogTiposOferta').dialog({
            autoOpen: false,
            resizable: false,
            modal: true,
            closeOnEscape: true,
            width: 700,
            draggable: true,
            title: "Registro de Tipos de Oferta",
            buttons:
            {
                "Nueva Oferta": function () {
                    $("#hdIdTipoOferta").val("");
                    $("#txtCodigoTipoOferta").val("");
                    $("#txtDescripcionTipoOferta").val("");

                    $("#btnAgregarTipoOferta").val("Agregar");

                    $("#txtCodigoTipoOferta").removeAttr("readonly");
                },
                "Salir": function () {
                    $(this).dialog('close');
                }
            }
        });        
    }

    function CargarAjaxForm() {
        $('#frmCargarConsultoras').ajaxForm({
            beforeSubmit: function () {
                waitingDialog({});
                var fileValue = $('#flCargarConsultoras').val();
                var extensiones = ['csv'];
                var get_ext;
                var message = '';
                //validar la extension del archivo
                get_ext = fileValue.split('.');
                get_ext = get_ext.reverse();

                if ($.inArray(get_ext[0].toLowerCase(), extensiones) == -1 && fileValue.length > 0)
                    message = message + '- El tipo de archivo es inválido, asegúrese de seleccionar con extensión (csv).';

                if (message.length > 0) {
                    closeWaitingDialog();
                    alert(message);
                    return false;
                }
            },
            success: function (response) {
                closeWaitingDialog();
                if (checkTimeout(response)) {
                    alert(response);
                    $('#DialogCargarConsultoras').dialog('close');
                }
            }
        });

        $('#frmCargarStock').ajaxForm({
            beforeSubmit: function () {
                waitingDialog({});
                var fileValue = $('#flStock').val();
                var extensiones = ['csv'];
                var get_ext;
                var message = '';

                //validar la extension del archivo
                get_ext = fileValue.split('.');
                get_ext = get_ext.reverse();

                if ($.inArray(get_ext[0].toLowerCase(), extensiones) == -1 && fileValue.length > 0)
                    message = message + '- El tipo de archivo es inválido, asegúrese de seleccionar con extensión (csv).';

                if (message.length > 0) {
                    closeWaitingDialog();
                    alert(message);
                    return false;
                }
            },
            success: function (response) {
                closeWaitingDialog();
                if (checkTimeout(response)) {
                    $("#list").setGridParam({ datatype: 'json', page: 1 }).trigger('reloadGrid');
                    CargarCategorias();
                    alert(response);
                    $('#DialogCargarStock').dialog('close');
                }
            }
        });

        $('#frmCargarDescripcionSets').ajaxForm({
            beforeSubmit: function () {
                waitingDialog({});
                var fileValue = $('#flDescripcionSets').val();
                var extensiones = ['csv'];
                var get_ext;
                var message = '';

                //validar la extension del archivo
                get_ext = fileValue.split('.');
                get_ext = get_ext.reverse();

                if ($.inArray(get_ext[0].toLowerCase(), extensiones) == -1 && fileValue.length > 0)
                    message = message + '- El tipo de archivo es inválido, asegúrese de seleccionar con extensión (csv).';

                if (message.length > 0) {
                    closeWaitingDialog();
                    alert(message);
                    return false;
                }
            },
            success: function (response) {
                closeWaitingDialog();
                if (checkTimeout(response)) {
                    $("#list").setGridParam({ datatype: 'json', page: 1 }).trigger('reloadGrid');
                    alert(response);
                    $('#DialogCargarDescripcionSets').dialog('close');
                }
            }
        });

        $('#frmCargarProductoCpc').ajaxForm({
            beforeSubmit: function () {
                waitingDialog({});
                var fileValue = $('#flCargarProductoCpc').val();
                var extensiones = ['csv'];
                var get_ext;
                var message = '';

                //validar la extension del archivo
                get_ext = fileValue.split('.');
                get_ext = get_ext.reverse();

                if ($.inArray(get_ext[0].toLowerCase(), extensiones) == -1 && fileValue.length > 0)
                    message = message + '- El tipo de archivo es inválido, asegúrese de seleccionar con extensión (csv).';

                if (message.length > 0) {
                    closeWaitingDialog();
                    alert(message);
                    return false;
                }
            },
            success: function (response) {
                closeWaitingDialog();
                if (checkTimeout(response)) {                    
                    alert(response);
                    $('#DialogCargarProductoCpc').dialog('close');
                }
            }
        });
    }

    var obtenerCampaniasPorPaisSuccess = function (id, response) {
        var jqXHR = response[2];
        var data = response[0];
        if (checkTimeout(jqXHR)) {
            LimpiarDependencias(id);

            var ddlCampania = $('#ddlCampania');

            ddlCampania.empty();
            if (data.lista.length > 0) {
                ddlCampania.append($('<option/>', {
                    value: "",
                    text: "-- Seleccionar --"
                }));
                if (id != "") {
                    for (var item in data.lista) {
                        ddlCampania.append($('<option/>', {
                            value: data.lista[item].CampaniaID,
                            text: data.lista[item].Codigo
                        }));
                    }
                }
            }

            closeWaitingDialog();
        }
    };

    var obtenerParametroPersonalizacionSuccess = function (response) {
        var data = response[0];
        $("#hdCampaniaMinimaPersonalizacion").val(data.campaniaMinimaPersonalizacion);
    };

    function CargarEventos() {
        $('#ddlPais').change(function () {
            var Id = $(this).val();
            if (Id != "") {
                waitingDialog({});
                var promiseObtenerCampanias = $.getJSON(baseUrl + 'ShowRoom/ObtenterCampaniasPorPais', { PaisID: Id == "" ? 0 : Id });
                var promiseObtenerParPersonalizacion = $.getJSON(baseUrl + 'ShowRoom/ObtenerParametroPersonalizacion', { PaisID: Id == "" ? 0 : Id });

                $.when(promiseObtenerCampanias, promiseObtenerParPersonalizacion).done(function (response1, response2) {
                    obtenerCampaniasPorPaisSuccess(Id, response1);
                    obtenerParametroPersonalizacionSuccess(response2);
                });
            } else LimpiarDependencias(Id);
        });

        $("#btnBuscar").click(function () {
            $("#divCargaArchivos").css("display", "none");
            $("#divPersonalizacion").css("display", "none");
            $("#divPersonalizacionCategoria").css("display", "none");
            $("#divOfertasShowRoom").css("display", "none");
            $("#divShowRoomPerfil").css("display", "none");

            $("#divPerfilOfertaShowRoom").css("display", "none");

            LimpiarDatosEventoShowRoom();

            var msjex = "";
            if ($("#ddlPais").val() == "")
                msjex += " - Debe seleccionar un País .\n";
            if ($("#ddlCampania").val() == "")
                msjex += " - Debe seleccionar un Campania .\n";

            if (msjex == "") {
                paisNombre = $("#ddlPais option:selected").text();
                paisID = $("#ddlPais").val();

                fnGrillaEvento();

                $("#divShowRoomEvento").css("display", "");
            }
            else {
                alert(msjex);
                return false;
            }
        });

        function personalizacionOfertasHabilitada() {
            return $('#listEvento').jqGrid('getRowData')[0].TienePersonalizacion == 'Activa';
        }

        $("#btnNuevo").click(function () {

            LimpiarDatosEventoShowRoom();
            $("#txtEventoPaisID").val(paisNombre);
            $("#txtEventoCampaniaID").val($("#ddlCampania").val());

            $("#divEventoEstado").css("display", "none");

            $("#divShowRoomPerfil").css("display", "none");

            if ($("#hdCampaniaMinimaPersonalizacion").val()) {
                var campaniaMinimaPersonalizacion = parseInt($("#hdCampaniaMinimaPersonalizacion").val());
                if (parseInt($("#ddlCampania").val()) >= campaniaMinimaPersonalizacion) {
                    $("#chkEventoTienePersonalizacion").prop('checked', true);
                }
            }

            showDialog("DialogDatosShowRoom");
        });

        $("#lnkConsultoras").click(function () {
            if (personalizacionOfertasHabilitada()) {
                alert(mensajePersonalizacion);
            } else {
                showDialog("DialogCargarConsultoras");
                LimpiarCargaConsultoras();
            }
            return false;
        });

        $("#lnkStock").click(function () {
            showDialog("DialogCargarStock");
            LimpiarCargaStock();
            return false;
        });

        $("#lnkDescripcionSets").click(function () {
            showDialog("DialogCargarDescripcionSets");
            LimpiarCargaDescripcionSets();
            return false;
        });

        $("#lnkProductoCpc").click(function () {
            showDialog("DialogCargarProductoCpc");
            LimpiarCargaProductoCpc();
            return false;
        });

        $("#btnNuevoDetalle").click(function () {
            LimpiarDatosEventoShowRoomDetalle();
            showDialog("DialogRegistroOfertaShowRoomDetalleEditar");
        });

        $("#cbPerfilesEvento").change(function (e) {

            if (personalizacionOfertasHabilitada()) {
                return false;
            }
            var perfilId = 0;

            var campaniaId = $("#ddlCampania").val() == "" ? "0" : $("#ddlCampania").val();
            var eventoId = $("#hdEventoID").val();

            if ($(this).val() != "") {
                perfilId = $(this).val();

                ObtenerShowRoomPerfilOfertaCuvs(campaniaId, eventoId, perfilId);
            } else {
                alert("Debe seleccionar un Perfil");
            }
        });

        $('#cbPerfilesEvento').on('mousedown', function (e) {
            if (personalizacionOfertasHabilitada()) {
                alert(mensajePersonalizacion);
                e.preventDefault();
            }
        });

        $("#btnGuardarPerfilOfertaShowRoom").click(function () {

            if (personalizacionOfertasHabilitada()) {
                alert(mensajePersonalizacion);
                return false;
            }

            var tagUlPerfil = $(".selected.connected-list.ui-sortable");
            var listaTagLiPerfil = $(tagUlPerfil).find("li.ui-state-default.ui-element");

            var cadenaCuv = "";

            if (listaTagLiPerfil.length > 0) {
                $.each(listaTagLiPerfil, function(index, value) {
                    var cuv = $(value).attr("data-selected-value");
                    cadenaCuv += cuv + ",";
                });

                var item = {
                    perfilId: $("#cbPerfilesEvento").val(),
                    eventoId: $("#hdEventoID").val(),
                    campaniaId: $("#ddlCampania").val(),
                    cadenaCuv: cadenaCuv
                };

                waitingDialog({ title: "Procesando" });
                jQuery.ajax({
                    type: 'POST',
                    url: urlGuardarPerfilOfertaShowRoom,
                    dataType: 'json',
                    contentType: 'application/json; charset=utf-8',
                    data: JSON.stringify(item),
                    async: true,
                    success: function (response) {
                        if (checkTimeout(response)) {
                            if (response.success) {
                                closeWaitingDialog();

                                alert_msg(response.message);
                            } else {
                                alert_msg(response.message);
                            }
                        }
                    },
                    error: function (response, error) {
                        if (checkTimeout(response)) {
                            alert_msg(response.message);
                            closeWaitingDialog();
                        }
                    }
                });
            } else {
                alert("Debe seleccionar al menos un cuv");
            }
        });

        /*
        $('#txtCantidad').keydown(function (event) {
            if (event.shiftKey) {
                event.preventDefault();
            }
            if (event.keyCode == 46 || event.keyCode == 8) {
            }
            else {
                if (event.keyCode < 95) {
                    if (event.keyCode < 48 || event.keyCode > 57) {
                        event.preventDefault();
                    }
                }
                else {
                    if (event.keyCode < 96 || event.keyCode > 105) {
                        event.preventDefault();
                    }
                }
            }
        });
        */

        $('#txtUnidadesPermitidasModal').keydown(function (event) {
            if (event.shiftKey) {
                event.preventDefault();
            }
            if (event.keyCode == 46 || event.keyCode == 8) {
            }
            else {
                if (event.keyCode < 95) {
                    if (event.keyCode < 48 || event.keyCode > 57) {
                        event.preventDefault();
                    }
                }
                else {
                    if (event.keyCode < 96 || event.keyCode > 105) {
                        event.preventDefault();
                    }
                }
            }
        });

        $('#chkAgotado').on('change', function () {
            if (this.checked) {
                $('#ddlIncrementar').attr('disabled', 'disabled');
                $('#txtCantidad').attr('disabled', 'disabled');
                $('#txtCantidad').css('background-color', '#F9F9F0');
                $('#ddlIncrementar').css('background-color', '#F9F9F0');
                $('#dvcantidad').attr('style', 'background-color : #F9F9F0');
                $('#dvincrementa').attr('style', 'background-color : #F9F9F0');
            } else {
                $('#ddlIncrementar').removeAttr('disabled');
                $('#txtCantidad').removeAttr('disabled');
                $('#txtCantidad').css('background-color', '');
                $('#ddlIncrementar').css('background-color', '');
                $('#dvcantidad').removeAttr('style');
                $('#dvincrementa').removeAttr('style');
            }
        });

        $("#btnBuscarPersonalizacionNivel").click(function() {
            var eventoId = $("#hdEventoID").val();
            var nivelId = $("#cbNivelEvento").val();

            if (eventoId == undefined || eventoId == 0) {
                alert_msg("Evento no se puedo identificar");
                return false;
            }

            if (nivelId == undefined || nivelId == 0) {
                alert_msg("Debe seleccionar un Nivel");
                return false;
            }

            var item = { eventoId: eventoId, nivelId: nivelId };

            waitingDialog({ title: "Procesando" });
            jQuery.ajax({
                type: 'POST',
                url: urlGetShowRoomPersonalizacionNivel,
                dataType: 'json',
                contentType: 'application/json; charset=utf-8',
                data: JSON.stringify(item),
                async: true,
                success: function (response) {
                    if (checkTimeout(response)) {
                        if (response.success) {
                            closeWaitingDialog();

                            $("#divPersonalizacionDetalleDesktop").html("");
                            $("#divPersonalizacionDetalleMobile").html("");
                            var listaPersonalizacion = response.listaPersonalizacion;

                            var listaPersonalizacionDesktop = listaPersonalizacion.Find("TipoAplicacion", "Desktop");
                            var listaPersonalizacionMobile = listaPersonalizacion.Find("TipoAplicacion", "Mobile");                            

                            $.each(listaPersonalizacionMobile, function (index, value) {
                                var htmlPersonalizacion = '';
                                htmlPersonalizacion += '<div class="div-3" data-idpersonalizacion="' + value.PersonalizacionId + '">';
                                htmlPersonalizacion += '<input type="hidden" class="hdPersonalizacionNivelId" value="' + value.PersonalizacionNivelId + '"/>';
                                
                                var valor = value.TipoAtributo == 'IMAGEN' ? value.Valor.replace(/^.*[\\\/]/, '') : value.Valor;
                                htmlPersonalizacion += '<input type="hidden" class="hdValor" value="' + valor + '"/>';
                                htmlPersonalizacion += '<input type="hidden" class="hdValorAnterior" value="' + valor + '"/>';

                                htmlPersonalizacion += '<input type="hidden" class="hdAtributo" value="' + value.Atributo + '"/>';
                                htmlPersonalizacion += '<input type="hidden" class="hdTipoAtributo" value="' + value.TipoAtributo + '"/>';

                                if (value.TipoAtributo == 'IMAGEN') {
                                    
                                    htmlPersonalizacion += '<div class="titC" style="width: 250px; margin-top: 15px;">' + value.TextoAyuda + '</div>';
                                    htmlPersonalizacion += '<div class="titC" style="padding: 0; width: 230px;">';
                                    htmlPersonalizacion += '<div class="input_search">';
                                    htmlPersonalizacion += '<div class="fpPopupImagenPersonalizacion">';
                                    htmlPersonalizacion += '</div>';
                                    htmlPersonalizacion += '</div>';
                                    htmlPersonalizacion += '<div class="divPopupImagenPersonalizacion" style="width: 100px; height: 60px; float: right;">';

                                    if (value.PersonalizacionNivelId != 0 && value.Valor != "") {
                                        htmlPersonalizacion += '<img  alt="" src="' + value.Valor + '" style="width: auto; height: 60px; max-width: 300px !important;"/>';
                                    }

                                    htmlPersonalizacion += '</div>';
                                    htmlPersonalizacion += '</div>';                                    
                                } else {
                                    
                                    htmlPersonalizacion += '<div class="titC" style="width: 250px;">' + value.TextoAyuda + '</div>';
                                    htmlPersonalizacion += '<div class="selectP2 borde_redondeado" style="width: 400px;">';
                                    htmlPersonalizacion += '<input type="text" class="txtAtributoPersonalizacion" value="' + value.Valor + '" style="width: 400px;"/>';
                                    htmlPersonalizacion += '</div>';
                                }

                                htmlPersonalizacion += '</div>';

                                $("#divPersonalizacionDetalleMobile").append(htmlPersonalizacion);

                                if (value.TipoAtributo == 'IMAGEN') {
                                    InsertarImagenPersonalizacion(value.PersonalizacionId);
                                }
                            });

                            $.each(listaPersonalizacionDesktop, function (index, value) {
                                var htmlPersonalizacion = '';
                                htmlPersonalizacion += '<div class="div-3" data-idpersonalizacion="' + value.PersonalizacionId + '">';
                                htmlPersonalizacion += '<input type="hidden" class="hdPersonalizacionNivelId" value="' + value.PersonalizacionNivelId + '"/>';

                                var valor = value.TipoAtributo == 'IMAGEN' ? value.Valor.replace(/^.*[\\\/]/, '') : value.Valor;
                                htmlPersonalizacion += '<input type="hidden" class="hdValor" value="' + valor + '"/>';
                                htmlPersonalizacion += '<input type="hidden" class="hdValorAnterior" value="' + valor + '"/>';

                                htmlPersonalizacion += '<input type="hidden" class="hdAtributo" value="' + value.Atributo + '"/>';
                                htmlPersonalizacion += '<input type="hidden" class="hdTipoAtributo" value="' + value.TipoAtributo + '"/>';

                                if (value.TipoAtributo == 'IMAGEN') {

                                    htmlPersonalizacion += '<div class="titC" style="width: 250px; margin-top: 15px;">' + value.TextoAyuda + '</div>';
                                    htmlPersonalizacion += '<div class="titC" style="padding: 0; width: 230px;">';
                                    htmlPersonalizacion += '<div class="input_search">';
                                    htmlPersonalizacion += '<div class="fpPopupImagenPersonalizacion">';
                                    htmlPersonalizacion += '</div>';
                                    htmlPersonalizacion += '</div>';
                                    htmlPersonalizacion += '<div class="divPopupImagenPersonalizacion" style="width: 100px; height: 60px; float: right;">';

                                    if (value.PersonalizacionNivelId != 0 && value.Valor != "") {
                                        htmlPersonalizacion += '<img  alt="" src="' + value.Valor + '" style="width: auto; height: 60px; max-width: 300px !important;"/>';
                                    }

                                    htmlPersonalizacion += '</div>';
                                    htmlPersonalizacion += '</div>';
                                } else {

                                    htmlPersonalizacion += '<div class="titC" style="width: 250px;">' + value.TextoAyuda + '</div>';
                                    htmlPersonalizacion += '<div class="selectP2 borde_redondeado" style="width: 400px;">';
                                    htmlPersonalizacion += '<input type="text" class="txtAtributoPersonalizacion" value="' + value.Valor + '" style="width: 400px;"/>';
                                    htmlPersonalizacion += '</div>';
                                }

                                htmlPersonalizacion += '</div>';

                                $("#divPersonalizacionDetalleDesktop").append(htmlPersonalizacion);

                                if (value.TipoAtributo == 'IMAGEN') {
                                    InsertarImagenPersonalizacion(value.PersonalizacionId);
                                }
                            });

                            showDialog("DialogPersonalizacionDetalle");
                        } else {
                            closeWaitingDialog();
                        }
                    }
                },
                error: function (response, error) {
                    if (checkTimeout(response)) {
                        alert_msg(response.message);
                        closeWaitingDialog();
                    }
                }
            });

        });

        $("#btnBuscarPersonalizacionCategoria").click(function() {
            var eventoId = $("#hdEventoID").val();
            var categoriaId = $("#cbCategoriaEvento").val();

            if (eventoId == undefined || eventoId == 0) {
                alert_msg("Evento no se puedo identificar");
                return false;
            }

            if (categoriaId == undefined || categoriaId == 0) {
                alert_msg("Debe seleccionar una Categoria");
                return false;
            }

            var item = { eventoId: eventoId, categoriaId: categoriaId };

            waitingDialog({ title: "Procesando" });
            jQuery.ajax({
                type: 'POST',
                url: urlGetShowRoomPersonalizacionCategoria,
                dataType: 'json',
                contentType: 'application/json; charset=utf-8',
                data: JSON.stringify(item),
                async: true,
                success: function (response) {
                    if (checkTimeout(response)) {
                        if (response.success) {
                            closeWaitingDialog();

                            var categoria = response.categoria;
                            $("#txtDescripcionCategoria").val(categoria.Descripcion);

                            $("#divPersonalizacionCategoriaDetalleDesktop").html("");
                            $("#divPersonalizacionCategoriaDetalleMobile").html("");
                            var listaPersonalizacion = response.listaPersonalizacion;

                            var listaPersonalizacionDesktop = listaPersonalizacion.Find("TipoAplicacion", "Desktop");
                            var listaPersonalizacionMobile = listaPersonalizacion.Find("TipoAplicacion", "Mobile");

                            $.each(listaPersonalizacionMobile, function (index, value) {
                                var htmlPersonalizacion = '';
                                htmlPersonalizacion += '<div class="div-3" data-idpersonalizacion="' + value.PersonalizacionId + '">';
                                htmlPersonalizacion += '<input type="hidden" class="hdPersonalizacionNivelId" value="' + value.PersonalizacionNivelId + '"/>';

                                var valor = value.TipoAtributo == 'IMAGEN' ? value.Valor.replace(/^.*[\\\/]/, '') : value.Valor;
                                htmlPersonalizacion += '<input type="hidden" class="hdValor" value="' + valor + '"/>';
                                htmlPersonalizacion += '<input type="hidden" class="hdValorAnterior" value="' + valor + '"/>';

                                htmlPersonalizacion += '<input type="hidden" class="hdAtributo" value="' + value.Atributo + '"/>';
                                htmlPersonalizacion += '<input type="hidden" class="hdTipoAtributo" value="' + value.TipoAtributo + '"/>';

                                if (value.TipoAtributo == 'IMAGEN') {

                                    htmlPersonalizacion += '<div class="titC" style="width: 250px; margin-top: 15px;">' + value.TextoAyuda + '</div>';
                                    htmlPersonalizacion += '<div class="titC" style="padding: 0; width: 230px;">';
                                    htmlPersonalizacion += '<div class="input_search">';
                                    htmlPersonalizacion += '<div class="fpPopupImagenPersonalizacion">';
                                    htmlPersonalizacion += '</div>';
                                    htmlPersonalizacion += '</div>';
                                    htmlPersonalizacion += '<div class="divPopupImagenPersonalizacion" style="width: 100px; height: 60px; float: right;">';

                                    if (value.PersonalizacionNivelId != 0 && value.Valor != "") {
                                        htmlPersonalizacion += '<img  alt="" src="' + value.Valor + '" style="width: auto; height: 60px; max-width: 300px !important;"/>';
                                    }

                                    htmlPersonalizacion += '</div>';
                                    htmlPersonalizacion += '</div>';
                                } else {

                                    htmlPersonalizacion += '<div class="titC" style="width: 250px;">' + value.TextoAyuda + '</div>';
                                    htmlPersonalizacion += '<div class="selectP2 borde_redondeado" style="width: 400px;">';
                                    htmlPersonalizacion += '<input type="text" class="txtAtributoPersonalizacion" value="' + value.Valor + '" style="width: 400px;" />';
                                    htmlPersonalizacion += '</div>';
                                }

                                htmlPersonalizacion += '</div>';

                                $("#divPersonalizacionCategoriaDetalleMobile").append(htmlPersonalizacion);

                                if (value.TipoAtributo == 'IMAGEN') {
                                    InsertarImagenPersonalizacion(value.PersonalizacionId);
                                }
                            });

                            $.each(listaPersonalizacionDesktop, function (index, value) {
                                var htmlPersonalizacion = '';
                                htmlPersonalizacion += '<div class="div-3" data-idpersonalizacion="' + value.PersonalizacionId + '">';
                                htmlPersonalizacion += '<input type="hidden" class="hdPersonalizacionNivelId" value="' + value.PersonalizacionNivelId + '"/>';

                                var valor = value.TipoAtributo == 'IMAGEN' ? value.Valor.replace(/^.*[\\\/]/, '') : value.Valor;
                                htmlPersonalizacion += '<input type="hidden" class="hdValor" value="' + valor + '"/>';
                                htmlPersonalizacion += '<input type="hidden" class="hdValorAnterior" value="' + valor + '"/>';

                                htmlPersonalizacion += '<input type="hidden" class="hdAtributo" value="' + value.Atributo + '"/>';
                                htmlPersonalizacion += '<input type="hidden" class="hdTipoAtributo" value="' + value.TipoAtributo + '"/>';

                                if (value.TipoAtributo == 'IMAGEN') {

                                    htmlPersonalizacion += '<div class="titC" style="width: 250px; margin-top: 15px;">' + value.TextoAyuda + '</div>';
                                    htmlPersonalizacion += '<div class="titC" style="padding: 0; width: 230px;">';
                                    htmlPersonalizacion += '<div class="input_search">';
                                    htmlPersonalizacion += '<div class="fpPopupImagenPersonalizacion">';
                                    htmlPersonalizacion += '</div>';
                                    htmlPersonalizacion += '</div>';
                                    htmlPersonalizacion += '<div class="divPopupImagenPersonalizacion" style="width: 100px; height: 60px; float: right;">';

                                    if (value.PersonalizacionNivelId != 0 && value.Valor != "") {
                                        htmlPersonalizacion += '<img  alt="" src="' + value.Valor + '" style="width: auto; height: 60px; max-width: 300px !important;"/>';
                                    }

                                    htmlPersonalizacion += '</div>';
                                    htmlPersonalizacion += '</div>';
                                } else {

                                    htmlPersonalizacion += '<div class="titC" style="width: 250px;">' + value.TextoAyuda + '</div>';
                                    htmlPersonalizacion += '<div class="selectP2 borde_redondeado" style="width: 400px;">';
                                    htmlPersonalizacion += '<input type="text" class="txtAtributoPersonalizacion" value="' + value.Valor + '" style="width: 400px;"/>';
                                    htmlPersonalizacion += '</div>';
                                }

                                htmlPersonalizacion += '</div>';

                                $("#divPersonalizacionCategoriaDetalleDesktop").append(htmlPersonalizacion);

                                if (value.TipoAtributo == 'IMAGEN') {
                                    InsertarImagenPersonalizacion(value.PersonalizacionId);
                                }
                            });

                            showDialog("DialogPersonalizacionCategoriaDetalle");
                        } else {
                            closeWaitingDialog();
                        }
                    }
                },
                error: function (response, error) {
                    if (checkTimeout(response)) {
                        alert_msg(response.message);
                        closeWaitingDialog();
                    }
                }
            });

        });

        $("#btnTiposOferta").click(function () {
            fnGrillaTiposOferta();

            showDialog("DialogTiposOferta");
        });

        $("#btnAgregarTipoOferta").click(function () {
            var tipoOfertaId = $("#hdIdTipoOferta").val() != "" ? $("#hdIdTipoOferta").val() : 0;
            var codigo = $.trim($("#txtCodigoTipoOferta").val());
            var descripcion =$.trim($("#txtDescripcionTipoOferta").val());

            if(codigo == ""){
                alert_msg("El código de Tipo de Oferta no puede ser vacío");
                return false;
            }

            if (descripcion == "") {
                alert_msg("La descripción del Tipo de Oferta no puede ser vacío");
                return false;
            }
           
            var existeTipoOferta = ExisteTipoOferta(tipoOfertaId, codigo, descripcion);
            if (existeTipoOferta != 0) {                
                return false;
            }

            var item = {
                TipoOfertaID: tipoOfertaId,
                Codigo: codigo,
                Descripcion: descripcion
            };

            GuardarTipoOferta(item);
        });
    }

    function ObtenerShowRoomPerfilOfertaCuvs(campaniaId, eventoId, perfilId) {
        var item = {
            campaniaId: campaniaId,
            eventoId: eventoId,
            perfilId: perfilId
        };

        waitingDialog({ title: "Procesando" });
        jQuery.ajax({
            type: 'POST',
            url: urlGetShowRoomPerfilOfertaCuvs,
            dataType: 'json',
            contentType: 'application/json; charset=utf-8',
            data: JSON.stringify(item),
            async: true,
            success: function (response) {
                if (checkTimeout(response)) {
                    if (response.success) {
                        closeWaitingDialog();

                        if (response.data == "") {
                            $("#divPerfilOfertaShowRoom").css("display", "none");
                        } else {
                            var listaPerfilCuv = response.data;

                            var html = '<select id="cbPerfilOfertaShowRoom" class="multiselect" multiple="multiple" name="cbPerfilOfertaShowRoom[]"></select>';
                            $("#divPerfilOfertaShowRoom").html(html);

                            $.each(listaPerfilCuv, function (index, value) {
                                var clase = '';

                                if (value.PerfilOfertaShowRoomID != 0) {
                                    clase = 'selected="selected"';
                                }

                                var cuvMostrar = value.EsSubCampania ? value.CUV + " (Sub Campaña)" : value.CUV;
                                var html = '<option value="' + value.CUV + '" ' + clase + '>' + cuvMostrar + '</option>';

                                $("#cbPerfilOfertaShowRoom").append(html);
                            });

                            $("#divPerfilOfertaShowRoom").css("display", "");

                            $("#cbPerfilOfertaShowRoom").multiselect();
                        }
                    } else {
                        $("#divPerfilOfertaShowRoom").css("display", "none");
                        alert_msg(response.message);
                    }
                }
            },
            error: function (response, error) {
                if (checkTimeout(response)) {
                    alert_msg(response.message);
                    closeWaitingDialog();
                }
            }
        });
    }

    function fnGrillaEvento() {
        jQuery("#listEvento").jqGrid({
            url: urlConsultarShowRoom,
            hidegrid: false,
            datatype: 'json',
            postData: ({
                PaisID: function () { return $("#ddlPais").val(); },
                CampaniaID: function () { return ($("#ddlCampania").val() == "" ? "0" : $("#ddlCampania").val()); }
            }),
            mtype: 'GET',
            contentType: "application/json; charset=utf-8",
            colNames: ['EventoID', 'Nombre', 'Tema', 'Dias Antes Fact.', 'Dias Despues Fact.', 'Personalización', '# Perfiles', 'Imagen1', 'Imagen2', 'ImagenCabeceraProducto', 'ImagenVentaSetPopup', 'ImagenVentaTagLateral', 'ImagenPestaniaShowRoom', 'ImagenPreventaDigital', ''],
            colModel: [
                { name: 'id', width: 50, editable: true, resizable: false },
                { name: 'Nombre',  width: 80, editable: true, resizable: false },
                { name: 'Tema', width: 80, editable: true, resizable: false },
                { name: 'DiasAntes', width: 50, editable: true, resizable: false },
                { name: 'DiasDespues', width: 50, editable: true, resizable: false },
                { name: 'TienePersonalizacion', width: 50, editable: true, resizable: false, formatter: function (cellvalue) {
                        return cellvalue == true ? 'Activa' : 'Inactiva';
                    }
                },
                { name: 'NumeroPerfiles', width: 50, editable: true, resizable: false, hidden: true },
                { name: 'Imagen1', width: 65, editable: true, resizable: false, hidden: true },
                { name: 'Imagen2', width: 65, editable: true, resizable: false, hidden: true },
                { name: 'ImagenCabeceraProducto', width: 65, editable: true, resizable: false, hidden: true },
                { name: 'ImagenVentaSetPopup', width: 65, editable: true, resizable: false, hidden: true },
                { name: 'ImagenVentaTagLateral', width: 65, editable: true, resizable: false, hidden: true },
                { name: 'ImagenPestaniaShowRoom', width: 65, editable: true, resizable: false, hidden: true },
                { name: 'ImagenPreventaDigital', width: 65, editable: true, resizable: false, hidden: true },
                { name: 'Options', width: 60, editable: true, sortable: false, align: 'center', resizable: false, formatter: ShowActionsEvento }
            ],
            jsonReader:
            {
                root: "rows",
                page: "page",
                total: "total",
                records: "records",
                repeatitems: false,
                cell:"",
                id: "id"
            },
            pager: jQuery('#pagerEvento'),
            loadtext: 'Cargando datos...',
            recordtext: "{0} - {1} de {2} Registros",
            emptyrecords: 'No hay resultados',
            rowNum: 10,
            scrollOffset: 0,
            rowList: [10, 20, 30, 40, 50],
            sortname: 'Nombre',
            sortorder: 'asc',
            viewrecords: true,
            multiselect: false,
            height: 'auto',
            width: 930,
            pgtext: 'Pág: {0} de {1}',
            altRows: true,
            altclass: 'jQGridAltRowClass',
            loadComplete: function () {
            },
            gridComplete: function () {
                var cantidadRegistros = jQuery('#listEvento').jqGrid('getGridParam', 'reccount');
                if (cantidadRegistros <= 0) {
                    $("#hdEventoID").val("0");
                    //Carga de Consultora
                    $("#hdCargaEventoID").val("0");
                    $("#hdCargaCampaniaID").val("");
                    //Carga de Stock
                    $("#hdCargaStockEventoID").val("0");
                    //Carga de Descripcion de Sets
                    $("#hdCargaDescripcionSetsEventoID").val("0");
                    $("#hdCargaDescripcionSetsCampaniaID").val("");
                    //Carga de Productos Compra por Compra
                    $("#hdCargarProductoCpcEventoID").val("0");
                    $("#hdCargarProductoCpcCampaniaID").val("");

                    $("#divShowRoomEventoNuevo").css("display", "");
                    $("#divCargaArchivos").css("display", "none");
                    $("#divOfertasShowRoom").css("display", "none");
                } else {
                    $("#divShowRoomEventoNuevo").css("display", "none");
                    $("#divCargaArchivos").css("display", "");

                    var showroomEvento = jQuery('#listEvento').jqGrid('getRowData')[0];
                    CargarImagenes(showroomEvento);

                    CargarNiveles();
                    CargarCategorias();

                    fnGrilla();

                    if (showroomEvento.TienePersonalizacion && showroomEvento.TienePersonalizacion == 'Activa') {
                        $("#divPerfilOfertaShowRoom").hide();
                    }

                    $("#divOfertasShowRoom").css("display", "");
                }
            }
        });
        jQuery("#listEvento").jqGrid('navGrid', "#pager", { edit: false, add: false, refresh: false, del: false, search: false });
        jQuery("#listEvento").setGridParam({ datatype: 'json', page: 1 }).trigger('reloadGrid');
    }

    function ObtenerShowRoomPerfiles() {
        var item = {
            paisId: $("#ddlPais").val(),
            eventoId: $("#hdEventoID").val()
        };

        jQuery.ajax({
            type: 'POST',
            url: urlGetShowRoomPerfiles,
            dataType: 'json',
            contentType: 'application/json; charset=utf-8',
            data: JSON.stringify(item),
            async: true,
            success: function (response) {
                if (checkTimeout(response)) {
                    if (response.success) {
                        $("#cbPerfilesEvento").empty();

                        if (response.data == "") {
                            $("#divShowRoomPerfil").css("display", "none");
                        } else {
                            var listaPerfiles = response.data || new Array();

                            $("#cbPerfilesEvento").append('<option value="">-- Seleccionar --</option>');

                            $.each(listaPerfiles, function (index, value) {
                                var html = '<option value="' + value.PerfilID + '">' + value.PerfilDescripcion + '</option>';

                                $("#cbPerfilesEvento").append(html);
                            });

                            $("#divShowRoomPerfil").css("display", "");
                        }
                    } else {
                        $("#divShowRoomPerfil").css("display", "none");
                        alert_msg(response.message);
                    }
                }
            },
            error: function (response, error) {
                if (checkTimeout(response)) {
                    alert_msg(response.message);
                    closeWaitingDialog();
                }
            }
        });
    }

    function CargarImagenes(showroomEvento) {
        if (showroomEvento.Imagen1 != "") {
            $("#divPopupWebFondo").html("");
            var htmlImagen1 = '<img src="' + showroomEvento.Imagen1 + '" alt="PopupWebFondo" style="width: 75px; height: 50px;" />';
            $("#divPopupWebFondo").html(htmlImagen1);
        }
        $("#hdImagen1").val(showroomEvento.Imagen1.replace(/^.*[\\\/]/, ''));
        $("#hdImagen1Anterior").val(showroomEvento.Imagen1.replace(/^.*[\\\/]/, ''));

        if (showroomEvento.ImagenVentaSetPopup != "") {
            $("#divPopupVentaImagenSet").html("");
            var htmlImagen2 = '<img src="' + showroomEvento.ImagenVentaSetPopup + '" alt="PopupVentaImagenSet" style="width: 75px; height: 50px;" />';
            $("#divPopupVentaImagenSet").html(htmlImagen2);
        }
        $("#hdImagenVentaSetPopup").val(showroomEvento.ImagenVentaSetPopup.replace(/^.*[\\\/]/, ''));
        $("#hdImagenVentaSetPopupAnterior").val(showroomEvento.ImagenVentaSetPopup.replace(/^.*[\\\/]/, ''));

        if (showroomEvento.Imagen2 != "") {
            $("#divPopupWebImagenSet").html("");
            var htmlImagen3 = '<img src="' + showroomEvento.Imagen2 + '" alt="Imagen2" style="width: 75px; height: 50px;" />';
            $("#divPopupWebImagenSet").html(htmlImagen3);
        }
        $("#hdImagen2").val(showroomEvento.Imagen2.replace(/^.*[\\\/]/, ''));
        $("#hdImagen2Anterior").val(showroomEvento.Imagen2.replace(/^.*[\\\/]/, ''));

        if (showroomEvento.ImagenVentaTagLateral != "") {
            $("#divPopupTagLateralVentaImagenSet").html("");
            var htmlImagen4 = '<img src="' + showroomEvento.ImagenVentaTagLateral + '" alt="PopupTagLateralVentaImagenSet" style="width: 75px; height: 50px;" />';
            $("#divPopupTagLateralVentaImagenSet").html(htmlImagen4);
        }
        $("#hdImagenVentaTagLateral").val(showroomEvento.ImagenVentaTagLateral.replace(/^.*[\\\/]/, ''));
        $("#hdImagenVentaTagLateralAnterior").val(showroomEvento.ImagenVentaTagLateral.replace(/^.*[\\\/]/, ''));

        if (showroomEvento.ImagenCabeceraProducto != "") {
            $("#divCabeceraPaginaProductos").html("");
            var htmlImagen5 = '<img src="' + showroomEvento.ImagenCabeceraProducto + '" alt="CabeceraPaginaProductos" style="width: 75px; height: 50px;" />';
            $("#divCabeceraPaginaProductos").html(htmlImagen5);
        }
        $("#hdImagenCabeceraProducto").val(showroomEvento.ImagenCabeceraProducto.replace(/^.*[\\\/]/, ''));
        $("#hdImagenCabeceraProductoAnterior").val(showroomEvento.ImagenCabeceraProducto.replace(/^.*[\\\/]/, ''));

        if (showroomEvento.ImagenPestaniaShowRoom != "") {
            $("#divPestaniaNombreShowRoom").html("");
            var htmlImagen6 = '<img src="' + showroomEvento.ImagenPestaniaShowRoom + '" alt="PestaniaNombreShowRoom" style="width: 75px; height: 50px;" />';
            $("#divPestaniaNombreShowRoom").html(htmlImagen6);
        }
        $("#hdImagenPestaniaShowRoom").val(showroomEvento.ImagenPestaniaShowRoom.replace(/^.*[\\\/]/, ''));
        $("#hdImagenPestaniaShowRoomAnterior").val(showroomEvento.ImagenPestaniaShowRoom.replace(/^.*[\\\/]/, ''));

        if (showroomEvento.ImagenPreventaDigital != "") {
            $("#divPopupImagenPreventaDigital").html("");
            var htmlImagen7 = '<img src="' + showroomEvento.ImagenPreventaDigital + '" alt="PopupImagenPreventaDigital" style="width: 75px; height: 50px;" />';
            $("#divPopupImagenPreventaDigital").html(htmlImagen7);
        }
        $("#hdImagenPreventaDigital").val(showroomEvento.ImagenPreventaDigital.replace(/^.*[\\\/]/, ''));
        $("#hdImagenPreventaDigitalAnterior").val(showroomEvento.ImagenPreventaDigital.replace(/^.*[\\\/]/, ''));
    }

    function GuardarImagenEventoShowRoom(rutaImagen, nombreImagen, nombreDiv, tipo) {
        var html = '<img  alt="" src="' + rutaImagen + '" style="max-width: 100% !important;"/>';
        $("#" + nombreDiv).html(html);

        waitingDialog({ title: "Procesando" });

        var imagenAnterior = "";
        switch (tipo) {
            case 1:
                imagenAnterior = $("#hdImagen1Anterior").val();
                break;
            case 2:
                imagenAnterior = $("#hdImagenVentaSetPopupAnterior").val();
                break;
            case 3:
                imagenAnterior = $("#hdImagen2Anterior").val();
                break;
            case 4:
                imagenAnterior = $("#hdImagenVentaTagLateralAnterior").val();
                break;
            case 5:
                imagenAnterior = $("#hdImagenCabeceraProductoAnterior").val();
                break;
            case 6:
                imagenAnterior = $("#hdImagenPestaniaShowRoomAnterior").val();
                break;
            case 7:
                imagenAnterior = $("#hdImagenPreventaDigitalAnterior").val();
                break;
            default:
                break;
        }

        var item = {
            eventoId: parseInt($("#hdEventoID").val()),
            nombreImagen: nombreImagen,
            nombreImagenAnterior: imagenAnterior,
            tipo: tipo
        };

        jQuery.ajax({
            type: 'POST',
            url: urlGuardarImagenShowRoom,
            dataType: 'json',
            contentType: 'application/json; charset=utf-8',
            data: JSON.stringify(item),
            async: true,
            success: function (data) {
                if (checkTimeout(data)) {
                    closeWaitingDialog();
                    if (data.success == true) {
                        alert(data.message);
                        //actualizar los inputs de la imagen respectiva
                        switch (tipo) {
                            case 1:
                                $("#hdImagen1").val(data.extra);
                                $("#hdImagen1Anterior").val(data.extra);
                                break;
                            case 2:
                                $("#hdImagenVentaSetPopup").val(data.extra);
                                $("#hdImagenVentaSetPopupAnterior").val(data.extra);
                                break;
                            case 3:
                                $("#hdImagen2").val(data.extra);
                                $("#hdImagen2Anterior").val(data.extra);
                                break;
                            case 4:
                                $("#hdImagenVentaTagLateral").val(data.extra);
                                $("#hdImagenVentaTagLateralAnterior").val(data.extra);
                                break;
                            case 5:
                                $("#hdImagenCabeceraProducto").val(data.extra);
                                $("#hdImagenCabeceraProductoAnterior").val(data.extra);
                                break;
                            case 6:
                                $("#hdImagenPestaniaShowRoom").val(data.extra);
                                $("#hdImagenPestaniaShowRoomAnterior").val(data.extra);
                                break;
                            case 7:
                                $("#hdImagenPreventaDigital").val(data.extra);
                                $("#hdImagenPreventaDigitalAnterior").val(data.extra);
                                break;
                            default:
                                break;
                        }
                    }
                    else {
                        alert(data.message);
                    }
                }
            },
            error: function (data, error) {
                if (checkTimeout(data)) {
                    closeWaitingDialog();
                    alert(data.message);
                }
            }
        });
    }

    function CargarNiveles() {
        jQuery.ajax({
            type: 'POST',
            url: urlGetShowRoomNiveles,
            dataType: 'json',
            contentType: 'application/json; charset=utf-8',
            async: true,
            success: function (response) {
                if (checkTimeout(response)) {
                    if (response.success) {
                        $("#cbNivelEvento").empty();

                        if (response.data == "") {
                            $("#divPersonalizacion").css("display", "none");
                        } else {
                            var listaNiveles = response.data || new Array();
                            
                            $("#cbNivelEvento").append('<option value="">-- Seleccionar --</option>');

                            $.each(listaNiveles, function (index, value) {
                                var html = '<option value="' + value.NivelId + '">' + value.Descripcion + '</option>';

                                $("#cbNivelEvento").append(html);
                            });

                            $("#divPersonalizacion").css("display", "");
                        }
                    } else {
                        $("#divPersonalizacion").css("display", "none");
                        alert_msg(response.message);
                    }
                }
            },
            error: function (response, error) {
                if (checkTimeout(response)) {
                    alert_msg(response.message);
                    closeWaitingDialog();
                }
            }
        });
    }

    function CargarCategorias() {
        var item = {
            eventoId: $("#hdEventoID").val()
        };

        jQuery.ajax({
            type: 'POST',
            url: urlGetShowRoomCategorias,
            dataType: 'json',
            contentType: 'application/json; charset=utf-8',
            async: true,
            data: JSON.stringify(item),
            success: function (response) {
                if (checkTimeout(response)) {
                    if (response.success) {
                        $("#cbCategoriaEvento").empty();

                        if (response.data == "") {
                            $("#divPersonalizacionCategoria").css("display", "none");
                        } else {
                            var listaNiveles = response.data || new Array();
                            $("#cbCategoriaEvento").append('<option value="">-- Seleccionar --</option>');

                            $.each(listaNiveles, function (index, value) {
                                var html = '<option value="' + value.CategoriaId + '">' + value.Codigo + '</option>';

                                $("#cbCategoriaEvento").append(html);
                            });

                            $("#divPersonalizacionCategoria").css("display", "");
                        }
                    } else {
                        $("#divPersonalizacionCategoria").css("display", "none");
                        alert_msg(response.message);
                    }
                }
            },
            error: function (response, error) {
                if (checkTimeout(response)) {
                    alert_msg(response.message);
                    closeWaitingDialog();
                }
            }
        });
    }

    function ShowActionsEvento(cellvalue, options, rowObject) {
        var edit = "&nbsp;<a href='javascript:;' onclick=\"return jQuery('#listEvento').EditarEvento('" + options.rowId + "','" + rowObject.CampaniaID + "','" + rowObject.Estado + "','" + rowObject.TieneCategoria + "','" + rowObject.TieneCompraXcompra + "','" + rowObject.TieneSubCampania + "', " + rowObject.TienePersonalizacion + ");\" >" + "<img src='" + imagenEdit + "' alt='Editar Evento ShowRoom' title='Editar Evento Show Room' border='0' /></a>";
        var del = "&nbsp;<a href='javascript:;' onclick=\"return jQuery('#listEvento').DeshabilitarEvento('" + options.rowId + "','" + rowObject.CampaniaID + "');\" >" + "<img src='" + imagenDeshabilitar + "' alt='Deshabilitar Evento ShowRoom' title='Deshabilitar Evento ShowRoom' border='0' /></a>";
        var remove = "&nbsp;<a href='javascript:;' onclick=\"return jQuery('#listEvento').EliminarEvento('" + options.rowId + "','" + rowObject.CampaniaID + "');\" >" + "<img src='" + imagenEliminar + "' alt='Eliminar Evento ShowRoom' title='Eliminar Evento ShowRoom' border='0' /></a>";

        var resultado = edit;

        if (rowObject.Estado == "1")
            resultado += del;

        if (rowObject.Estado == "1")
            resultado += remove;

        $("#hdEventoID").val(options.rowId);
        //Carga de Consultoras
        $("#hdCargaEventoID").val(options.rowId);
        $("#hdCargaCampaniaID").val(rowObject.CampaniaID);
        //Carga de Stock
        $("#hdCargaStockEventoID").val(options.rowId);
        //Carga de Descripcion de Sets
        $("#hdCargaDescripcionSetsEventoID").val(options.rowId);
        $("#hdCargaDescripcionSetsCampaniaID").val(rowObject.CampaniaID);
        //Carga de Productos Compra por Compra
        $("#hdCargarProductoCpcEventoID").val(options.rowId);
        $("#hdCargarProductoCpcCampaniaID").val(rowObject.CampaniaID);

        return resultado;
    }

    function GuardarShowRoomEvento() {
        var eventoID = $("#hdEventoID").val();
        var campaniaID = $("#txtEventoCampaniaID").val();
        var nombre = $("#txtEventoNombre").val();
        var tema = $("#txtEventoTema").val();
        var diasAntes = $("#txtEventoDiasAntes").val();
        var diasDespues = $("#txtEventoDiasDespues").val();
        var numeroPerfiles = $("#txtEventoNumeroPerfiles").val();
        var estado = $("#chkEventoEstado").is(":checked");
        var tieneCategoria = $("#chkEventoTieneCategoria").is(":checked");
        var tieneCompraXcompra = $("#chkEventocompraXcompra").is(":checked");
        var tieneSubCampania = $("#chkEventoTieneSubCampania").is(":checked");
        var tienePersonalizacion = $("#chkEventoTienePersonalizacion").is(":checked");
        
        var showRoom = {
            EventoID: eventoID == "" || eventoID == undefined ? 0 : eventoID,
            CampaniaID: campaniaID,
            Nombre: nombre,
            Tema: tema,
            DiasAntes: parseInt(diasAntes),
            DiasDespues: parseInt(diasDespues),
            NumeroPerfiles: parseInt(numeroPerfiles),
            Estado: estado,
            TieneCategoria: tieneCategoria,
            TieneCompraXcompra: tieneCompraXcompra,
            TieneSubCampania: tieneSubCampania,
            TienePersonalizacion: tienePersonalizacion
        };

        waitingDialog({ title: "Procesando" });
        jQuery.ajax({
            type: 'POST',
            url: urlGuardarShowRoom,
            dataType: 'json',
            contentType: 'application/json; charset=utf-8',
            data: JSON.stringify(showRoom),
            async: true,
            success: function (response) {
                if (checkTimeout(response)) {
                    if (response.success) {
                        closeWaitingDialog();
                        var id = response.data;

                        if ($("#hdEventoID").val() == "0")
                            fnGrilla();

                        $("#hdEventoID").val(id);
                        //Cargar de Consultoras
                        $("#hdCargaEventoID").val(id);
                        $("#hdCargaCampaniaID").val(campaniaID);
                        //Carga de Stock
                        $("#hdCargaStockEventoID").val(id);
                        //Carga de Descripcion de Sets
                        $("#hdCargaDescripcionSetsEventoID").val(id);
                        $("#hdCargaDescripcionSetsCampaniaID").val(campaniaID);
                        //Carga de Productos Compra por Compra
                        $("#hdCargarProductoCpcEventoID").val(id);
                        $("#hdCargarProductoCpcCampaniaID").val(campaniaID);

                        HideDialog("DialogDatosShowRoom");
                        jQuery("#listEvento").setGridParam({ datatype: 'json', page: 1 }).trigger('reloadGrid');
                        alert_msg(response.message);
                    } else {
                        alert_msg(response.message);
                    }
                }
            },
            error: function (response, error) {
                if (checkTimeout(response)) {
                    alert_msg(response.message);
                    closeWaitingDialog();
                }
            }
        });
    }

    function RegistrarOfertaShowRoom() {
        var Item = {
            CampaniaID: jQuery('#hdCampaniaID').val(),
            CUV: jQuery('#txtCUVModal').val(),
            Descripcion: $("#txtDescripcionModal").val(),
            PrecioValorizado: $("#txtPrecioValorizadoModal").val(),
            PrecioOferta: $("#txtPrecioOfertaModal").val(),
            ImagenProducto: $("#hdImagenProducto").val(),
            ImagenProductoAnterior: $('#hdImagenProductoAnterior').val(),
            ImagenMini: $("#hdImagenMini").val(),
            ImagenMiniAnterior: $("#hdImagenMiniAnterior").val(),
            UnidadesPermitidas: $("#txtUnidadesPermitidasModal").val(),
            CodigoCampania: $("#txtCampaniaModal").val(),
            FlagHabilitarProducto: $("#chkHabilitarOferta").attr('checked') ? 1 : 0,
            CodigoTipoOferta: $.trim($("#hdCodigoOferta").val()),
            PaisID: paisID,
            CantidadIncrementa: 0,
            Incrementa: 0,
            Agotado: 0,
            ConfiguracionOfertaID: $("#hdConfiguracionOfertaID").val(),
            EsSubCampania: $("#chkEsSubCampania").attr('checked') ? true : false
        };

        waitingDialog({ title: "Procesando" });
        jQuery.ajax({
            type: 'POST',
            url: urlInsertOrUpdateOfertaShowRoom,
            dataType: 'json',
            contentType: 'application/json; charset=utf-8',
            data: JSON.stringify(Item),
            async: true,
            success: function (data) {
                if (checkTimeout(data)) {
                    closeWaitingDialog();
                    if (data.success == true) {
                        alert(data.message);
                        HideDialog("DialogRegistroOfertaShowRoom");
                        LimpiarDatos();
                        jQuery("#list").setGridParam({ datatype: 'json', page: 1 }).trigger('reloadGrid');
                    }
                    else alert(data.message);
                }
            },
            error: function (data, error) {
                if (checkTimeout(data)) {
                    closeWaitingDialog();
                    alert(data.message);
                    HideDialog("DialogRegistroOfertaShowRoom");
                }
            }
        });
    }

    function fnGrilla() {
        jQuery("#list").jqGrid({
            url: urlConsultarOfertaShowRoom,
            hidegrid: false,
            datatype: 'json',
            postData: ({
                PaisID: function() { return $("#ddlPais").val() },                
                CampaniaID: function() { return ($("#ddlCampania").val() == "" ? "0" : $("#ddlCampania").val()); }
            }),
            mtype: 'GET',
            contentType: "application/json; charset=utf-8",
            colNames: ['Código TipoOferta', 'Código SAP', 'CUV', 'Descripción', 'Precio Valorizado', 'Precio Oferta', 'Orden', 'Stock',
                'Stock Inicial', 'Unid.Permitidas', 'CampaniaID', 'OfertaShowRoomID', 'FlagHabilitarProducto', 'ConfiguracionOfertaID',
                'EsSubCampania', 'CodigoCampania', 'Foto', 'Set', 'Productos'],
            colModel: [
                { name: 'CodigoTipoOferta', index: 'CodigoTipoOferta', width: 50, editable: true, resizable: false },
                { name: 'CodigoProducto', index: 'CodigoProducto', width: 60, editable: true, resizable: false },
                { name: 'CUV', index: 'CUV', width: 40, editable: true, resizable: false },
                { name: 'Descripcion', index: 'Descripcion', width: 135, editable: true, resizable: false },
                { name: 'PrecioValorizado', index: 'PrecioValorizado', width: 60, editable: true, resizable: false },
                { name: 'PrecioOferta', index: 'PrecioOferta', width: 60, editable: true, resizable: false },
                { name: 'Orden', index: 'Orden', width: 35, editable: true, resizable: false, hidden: true },
                { name: 'Stock', index: 'Stock', width: 35, editable: true, resizable: false, hidden: true },
                { name: 'StockInicial', index: 'StockInicial', width: 50, editable: true, resizable: false, hidden: true },
                { name: 'UnidadesPermitidas', index: 'UnidadesPermitidas', width: 65, editable: true, resizable: false },
                { name: 'CampaniaID', index: 'CampaniaID', width: 65, editable: true, resizable: false, hidden: true },
                { name: 'OfertaShowRoomID', index: 'OfertaShowRoomID', width: 65, editable: true, resizable: false, hidden: true },
                { name: 'FlagHabilitarProducto', index: 'FlagHabilitarProducto', width: 65, editable: true, resizable: false, hidden: true },
                { name: 'ConfiguracionOfertaID', index: 'ConfiguracionOfertaID', width: 65, editable: true, resizable: false, hidden: true },
                { name: 'EsSubCampania', index: 'EsSubCampania', width: 65, editable: true, resizable: false, hidden: true },
                { name: 'CodigoCampania', index: 'CodigoCampania', width: 65, editable: true, resizable: false, hidden: true },
                { name: 'Imagen', index: 'Imagen', width: 55, editable: true, resizable: false, sortable: false, align: 'center', formatter: ShowImage },
                { name: 'Options', index: 'Options', width: 60, editable: true, sortable: false, align: 'center', resizable: false, formatter: ShowActions },
                { name: 'Options', index: 'Options', width: 60, editable: true, sortable: false, align: 'center', resizable: false, formatter: ShowActionsProductos }
            ],
            jsonReader:
            {
                root: "rows",
                page: "page",
                total: "total",
                records: "records",
                repeatitems: true,
                cell: "cell",
                id: "id"
            },
            pager: jQuery('#pager'),
            loadtext: 'Cargando datos...',
            recordtext: "{0} - {1} de {2} Registros",
            emptyrecords: 'No hay resultados',
            rowNum: 10,
            scrollOffset: 0,
            rowList: [10, 20, 30, 40, 50],
            sortname: 'Nombre',
            sortorder: 'asc',
            viewrecords: true,
            multiselect: false,
            height: 'auto',
            width: 930,
            pgtext: 'Pág: {0} de {1}',
            altRows: true,
            altclass: 'jQGridAltRowClass',
            loadComplete: function() {
            },
            gridComplete: function () {
                ObtenerShowRoomPerfiles();
            }
        });
        jQuery("#list").jqGrid('navGrid', "#pager", { edit: false, add: false, refresh: false, del: false, search: false });
        jQuery("#list").setGridParam({ datatype: 'json', page: 1 }).trigger('reloadGrid');
    }

    function fnGrillaOfertaShowRoomDetalle(campaniaId, cuv) {
        $("#listShowRoomDetalle").jqGrid("clearGridData");

        var parametros = {
            campaniaId: campaniaId,
            cuv: cuv
        };

        $('#listShowRoomDetalle').setGridParam({ postData: parametros });

        jQuery("#listShowRoomDetalle").jqGrid({
            url: urlConsultarOfertaShowRoomDetalle,
            hidegrid: false,
            datatype: 'json',
            postData: (parametros),
            mtype: 'GET',
            contentType: "application/json; charset=utf-8",
            colNames: ['OfertaShowRoomDetalleID', 'CampaniaID', 'CUV', 'Nombre', 'Descripcion1', 'Descripcion2', 'Descripcion3', 'MarcaProducto', 'Foto', ''],
            colModel: [
                { name: 'OfertaShowRoomDetalleID', index: 'OfertaShowRoomDetalleID', width: 50, editable: true, resizable: false, hidden: true },
                { name: 'CampaniaID', index: 'CampaniaID', width: 50, editable: true, resizable: false, hidden: true },
                { name: 'CUV', index: 'CUV', width: 50, editable: true, resizable: false, hidden: true },
                { name: 'NombreProducto', index: 'NombreProducto', width: 80, editable: true, resizable: false },
                { name: 'Descripcion1', index: 'Descripcion1', width: 80, editable: true, resizable: false },
                { name: 'Descripcion2', index: 'Descripcion2', width: 80, editable: true, resizable: false },
                { name: 'Descripcion3', index: 'Descripcion3', width: 80, editable: true, resizable: false },                
                { name: 'Imagen', index: 'Imagen', width: 55, editable: true, resizable: false, sortable: false, align: 'center', formatter: ShowImageDetalle },
                { name: 'MarcaProducto', index: 'MarcaProducto', width: 80, editable: true, resizable: false, hidden: true },
                { name: 'Options', index: 'Options', width: 40, editable: true, sortable: false, align: 'center', resizable: false, formatter: ShowActionsDetalle }
            ],
            jsonReader:
            {
                root: "rows",
                page: "page",
                total: "total",
                records: "records",
                repeatitems: true,
                cell: "cell",
                id: "id"
            },
            pager: jQuery('#pagerShowRoomDetalle'),
            loadtext: 'Cargando datos...',
            recordtext: "{0} - {1} de {2} Registros",
            emptyrecords: 'No hay resultados',
            rowNum: 10,
            scrollOffset: 0,
            rowList: [10, 20, 30, 40, 50],
            sortname: 'Nombre',
            sortorder: 'asc',
            viewrecords: true,
            multiselect: false,
            height: 'auto',
            width: 840,
            pgtext: 'Pág: {0} de {1}',
            altRows: true,
            altclass: 'jQGridAltRowClass',
            loadComplete: function () {
            },
            gridComplete: function () {
            }
        });
        jQuery("#listShowRoomDetalle").jqGrid('navGrid', "#pagerShowRoomDetalle", { edit: false, add: false, refresh: false, del: false, search: false });
        jQuery("#listShowRoomDetalle").setGridParam({ datatype: 'json', page: 1 }).trigger('reloadGrid');
    }

    function ShowActions(cellvalue, options, rowObject) {
        var id = options.rowId;
        var imagenProducto = rowObject[16];
        var imagenMini = rowObject[17];
        var cuv = rowObject[2];
        var campaniaId = rowObject[10];
        var flagHabilitarProducto = rowObject[12];

        var edit = "&nbsp;<a href='javascript:;' onclick=\"return jQuery('#list').Editar('" + id + "','" + imagenProducto + "','" + imagenMini + "');\" >" + "<img src='" + imagenEdit + "' alt='Editar Oferta Show Room' title='Editar Oferta Show Room' border='0' /></a>";
        var del = "&nbsp;<a href='javascript:;' onclick=\"return jQuery('#list').Eliminar('" + id + "','" + cuv + "','" + campaniaId + "');\" >" + "<img src='" + imagenDeshabilitar + "' alt='Deshabilitar Oferta Show Room' title='Deshabilitar Oferta Show Room' border='0' /></a>";
        var remove = "&nbsp;<a href='javascript:;' onclick=\"return jQuery('#list').Remover('" + id + "','" + cuv + "','" + campaniaId + "');\" >" + "<img src='" + imagenEliminar + "' alt='Eliminar Oferta Show Room' title='Eliminar Oferta Show Room' border='0' /></a>";

        var resultado = edit;

        if (flagHabilitarProducto == "True")
            resultado += del;

        resultado += remove;

        return resultado;
    }

    function ShowActionsProductos(cellvalue, options, rowObject) {
        var id = options.rowId;
        var campaniaId = rowObject[15];
        var cuv = rowObject[2];

        var edit = "&nbsp;<a href='javascript:;' onclick=\"return jQuery('#list').EditarProducto('" + id + "','" + campaniaId + "','" + cuv + "');\" >" + "<img src='" + imagenEdit + "' alt='Editar Productos Oferta Show Room' title='Editar Productos Oferta Show Room' border='0' /></a>";
        var remove = "&nbsp;<a href='javascript:;' onclick=\"return jQuery('#list').EliminarProducto('" + id + "','" + campaniaId + "','" + cuv + "');\" >" + "<img src='" + imagenEliminar + "' alt='Eliminar Productos Oferta Show Room' title='Eliminar Productos Oferta Show Room' border='0' /></a>";

        return edit + remove;
    }

    function ShowActionsDetalle(cellvalue, options, rowObject) {
        var id = options.rowId;
        var campaniaId = rowObject[1];
        var cuv = rowObject[2];
        var imagen = rowObject[7];

        var edit = "&nbsp;<a href='javascript:;' onclick=\"return jQuery('#listShowRoomDetalle').EditarProductoDetalle('" + id + "','" + campaniaId + "','" + cuv + "','" + imagen + "');\" >" + "<img src='" + imagenEdit + "' alt='Editar Productos Oferta Show Room Detalle' title='Editar Productos Oferta Show Room Detalle' border='0' /></a>";
        var remove = "&nbsp;<a href='javascript:;' onclick=\"return jQuery('#listShowRoomDetalle').EliminarProductoDetalle('" + id + "','" + campaniaId + "','" + cuv + "');\" >" + "<img src='" + imagenEliminar + "' alt='Eliminar Productos Oferta Show Room Detalle' title='Eliminar Productos Oferta Show Room Detalle' border='0' /></a>";

        return edit + remove;
    }

    function ShowImage(cellvalue, options, rowObject) {
        var image = "";
        if (rowObject[16] != "") {
            image = '<img src="' + rowObject[16] + '" alt="" width="70px" height="60px" title="" border="0" />';
        } else {
            image = '<img src="' + imagenProductoVacio + '" alt="" width="60px" height="60px" title="" border="0" />';
        }
        return image;
    }

    function ShowImageDetalle(cellvalue, options, rowObject) {
        var image = "";
        if (rowObject[7] != "") {
            image = '<img src="' + rowObject[7] + '" alt="" width="70px" height="60px" title="" border="0" />';
        } else {
            image = '<img src="' + imagenProductoVacio + '" alt="" width="60px" height="60px" title="" border="0" />';
        }
        return image;
    }

    function RegistrarOfertaShowRoomDetalle() {
        var accion;

        if ($("#hdOfertaShowRoomDetalleID").val() == "0")
            accion = urlInsertOfertaShowRoomDetalle;
        else
            accion = urlUpdateOfertaShowRoomDetalle;

        var item = {
            OfertaShowRoomDetalleID: $("#hdOfertaShowRoomDetalleID").val(),
            CampaniaID: $("#txtCampaniaDetalle").val(),
            CUV: $("#txtCUVDetalle").val(),
            NombreProducto: $("#txtNombreProductoDetalle").val(),
            Descripcion1: $("#txtDescripcion1Detalle").val(),
            Descripcion2: $("#txtDescripcion2Detalle").val(),
            Descripcion3: $("#txtDescripcion3Detalle").val(),
            MarcaProducto: $("#txtMarcaProductoDetalle").val(),
            Imagen: $("#hdImagenDetalle").val(),
            ImagenAnterior: $("#hdImagenDetalleAnterior").val()
        };

        waitingDialog({ title: "Procesando" });
        jQuery.ajax({
            type: 'POST',
            url: accion,
            dataType: 'json',
            contentType: 'application/json; charset=utf-8',
            data: JSON.stringify(item),
            async: true,
            success: function (data) {
                if (checkTimeout(data)) {
                    closeWaitingDialog();
                    if (data.success == true) {
                        alert(data.message);
                        HideDialog("DialogRegistroOfertaShowRoomDetalleEditar");
                        LimpiarDatos();
                        jQuery("#listShowRoomDetalle").setGridParam({ datatype: 'json', page: 1 }).trigger('reloadGrid');
                    }
                    else {
                        alert(data.message);
                    }
                }
            },
            error: function (data, error) {
                if (checkTimeout(data)) {
                    closeWaitingDialog();
                    alert(data.message);
                    HideDialog("DialogRegistroOfertaShowRoomDetalleEditar");
                }
            }
        });
    }

    $.jgrid.extend({
        Editar: function(ID, ImagenProducto, ImagenMini) {
            if (ID) {
                LimpiarDatos();

                var ofertaShowRoomID = jQuery("#list").jqGrid('getCell', ID, 'OfertaShowRoomID');

                if (ofertaShowRoomID != "0")
                    $("#FlagTransaccion").val("1");

                $.ajaxSetup({
                    cache: false
                });

                $('#hdCampaniaID').val(jQuery("#list").jqGrid('getCell', ID, 'CampaniaID'));
                $('#hdConfiguracionOfertaID').val(jQuery("#list").jqGrid('getCell', ID, 'ConfiguracionOfertaID'));
                $('#hdStockProducto').val(jQuery("#list").jqGrid('getCell', ID, 'Stock'));
                $("#txtPaisModal").val(paisNombre);
                $('#txtCampaniaModal').val(jQuery("#list").jqGrid('getCell', ID, 'CodigoCampania'));
                $('#txtCUVModal').val(jQuery("#list").jqGrid('getCell', ID, 'CUV'));
                $('#txtDescripcionModal').val(jQuery("#list").jqGrid('getCell', ID, 'Descripcion'));
                $('#txtPrecioValorizadoModal').val(jQuery("#list").jqGrid('getCell', ID, 'PrecioValorizado'));
                $('#txtPrecioOfertaModal').val(jQuery("#list").jqGrid('getCell', ID, 'PrecioOferta'));
                $('#hdCodigoOferta').val(jQuery("#list").jqGrid('getCell', ID, 'CodigoTipoOferta'));

                if (jQuery("#list").jqGrid('getCell', ID, 'UnidadesPermitidas') == "0")
                    $("#txtUnidadesPermitidasModal").val("1");
                else
                    $("#txtUnidadesPermitidasModal").val(jQuery("#list").jqGrid('getCell', ID, 'UnidadesPermitidas'));

                var imagen = ImagenProducto.replace(/^.*[\\\/]/, '');

                if (imagen != "prod_grilla_vacio.png") {
                    $('#hdImagenProductoAnterior').val(imagen);
                    $('#hdImagenProducto').val(imagen);
                    $('#imgProducto').attr('src', ImagenProducto);
                } else {
                    $('#hdImagenProductoAnterior').val("");
                    $('#hdImagenProducto').val("");
                    $('#imgProducto').attr('src', imagenProductoVacio);
                }

                var imagenMini = ImagenMini.replace(/^.*[\\\/]/, '');

                if (imagenMini != "prod_grilla_vacio.png") {
                    $('#hdImagenMiniAnterior').val(imagenMini);
                    $('#hdImagenMini').val(imagenMini);
                    $('#imgMini').attr('src', ImagenMini);
                } else {
                    $('#hdImagenMiniAnterior').val("");
                    $('#hdImagenMini').val("");
                    $('#imgMini').attr('src', imagenProductoVacio);
                }
                
                if (jQuery("#list").jqGrid('getCell', ID, 'FlagHabilitarProducto') == "True")
                    $('#chkHabilitarOferta').attr('checked', true);
                else
                    $('#chkHabilitarOferta').removeAttr('checked');

                if(jQuery("#list").jqGrid('getCell', ID, 'EsSubCampania') == "True")
                    $('#chkEsSubCampania').attr('checked', true);
                else
                    $('#chkEsSubCampania').removeAttr('checked');

                showDialog("DialogRegistroOfertaShowRoom");

            } else {
                alert("Debe seleccionar un Producto, verifique");
            }
            return false;
        },
        Eliminar: function(ID, CUV, CampaniaID) {
            var elimina = confirm('¿ Está seguro que desea deshabilitar el producto seleccionado?');
            if (!elimina)
                return false;

            var Item = {
                CampaniaID: CampaniaID,
                CUV: CUV,
                PaisID: paisID
            };

            waitingDialog({});
            jQuery.ajax({
                type: 'POST',
                url: urlDeshabilitarOfertaShowRoom,
                dataType: 'json',
                contentType: 'application/json; charset=utf-8',
                data: JSON.stringify(Item),
                async: true,
                success: function(data) {
                    if (checkTimeout(data)) {
                        closeWaitingDialog();
                        LimpiarDatos();
                        if (data.success == true) {
                            alert(data.message);
                            jQuery("#list").setGridParam({ datatype: 'json', page: 1 }).trigger('reloadGrid');
                        } else
                            alert(data.message);
                    }
                },
                error: function(data, error) {
                    if (checkTimeout(data)) {
                        closeWaitingDialog();
                        alert("ERROR");
                    }
                }
            });
            return false;
        },
        Remover: function(ID, CUV, CampaniaID) {
            var elimina = confirm('¿ Está seguro que desea eliminar el producto seleccionado?');
            if (!elimina)
                return false;

            var Item = {
                CampaniaID: CampaniaID,
                CUV: CUV,
                PaisID: paisID
            };

            waitingDialog({});
            jQuery.ajax({
                type: 'POST',
                url: urlRemoverOfertaShowRoom,
                dataType: 'json',
                contentType: 'application/json; charset=utf-8',
                data: JSON.stringify(Item),
                async: true,
                success: function(data) {
                    if (checkTimeout(data)) {
                        closeWaitingDialog();
                        LimpiarDatos();
                        if (data.success == true) {
                            alert(data.message);
                            jQuery("#list").setGridParam({ datatype: 'json', page: 1 }).trigger('reloadGrid');
                        } else
                            alert(data.message);
                    }
                },
                error: function(data, error) {
                    if (checkTimeout(data)) {
                        closeWaitingDialog();
                        alert("ERROR");
                    }
                }
            });
            return false;
        },
        EditarEvento: function (ID, campaniaID, estado, tieneCategoria, tieneCompraXCompra, tieneSubCampania, tienePersonalizacion) {
            $("#txtEventoPaisID").val(paisNombre);
            $("#txtEventoCampaniaID").val(campaniaID);
            $('#txtEventoNombre').val(jQuery("#listEvento").jqGrid('getCell', ID, 'Nombre'));
            $('#txtEventoTema').val(jQuery("#listEvento").jqGrid('getCell', ID, 'Tema'));
            $('#txtEventoDiasAntes').val(jQuery("#listEvento").jqGrid('getCell', ID, 'DiasAntes'));
            $('#txtEventoDiasDespues').val(jQuery("#listEvento").jqGrid('getCell', ID, 'DiasDespues'));
            $('#txtEventoNumeroPerfiles').val(jQuery("#listEvento").jqGrid('getCell', ID, 'NumeroPerfiles'));
            $('#txtEventoRutaShowRoomPopup').val(jQuery("#listEvento").jqGrid('getCell', ID, 'RutaShowRoomPopup'));
            $('#txtEventoRutaShowRoomBannerLateral').val(jQuery("#listEvento").jqGrid('getCell', ID, 'RutaShowRoomBannerLateral'));

            $("#chkEventoEstado").prop('checked', estado == "1");            
            $("#chkEventoTieneCategoria").prop('checked', tieneCategoria == "True");
            $("#chkEventocompraXcompra").prop('checked', tieneCompraXCompra == "True");
            $("#chkEventoTieneSubCampania").prop('checked', tieneSubCampania == "True");
            
            $("#chkEventoTienePersonalizacion").prop('checked', tienePersonalizacion);

            $("#divEventoEstado").css("display", "");

            showDialog("DialogDatosShowRoom");
        },
        DeshabilitarEvento: function(ID, CampaniaID) {
            var deshabilitar = confirm('¿ Está seguro que desea deshabilitar el evento?');
            if (!deshabilitar)
                return false;

            var item = {
                campaniaID: CampaniaID,
                eventoID: ID
            };

            waitingDialog({});
            jQuery.ajax({
                type: 'POST',
                url: urlDeshabilitarShowRoomEvento,
                dataType: 'json',
                contentType: 'application/json; charset=utf-8',
                data: JSON.stringify(item),
                async: true,
                success: function(data) {
                    if (checkTimeout(data)) {
                        closeWaitingDialog();

                        if (data.success == true) {
                            alert(data.message);
                            jQuery("#listEvento").setGridParam({ datatype: 'json', page: 1 }).trigger('reloadGrid');
                        } else
                            alert(data.message);
                    }
                },
                error: function(data, error) {
                    if (checkTimeout(data)) {
                        closeWaitingDialog();
                        alert("ERROR");
                    }
                }
            });
            return false;
        },
        EliminarEvento: function(ID, CampaniaID) {
            var eliminar = confirm('¿ Está seguro que desea eliminar el evento?');
            if (!eliminar)
                return false;

            $("#divShowRoomPerfil").css("display", "none");

            var item = {
                campaniaID: CampaniaID,
                eventoID: ID
            };

            waitingDialog({});
            jQuery.ajax({
                type: 'POST',
                url: urlEliminarShowRoomEvento,
                dataType: 'json',
                contentType: 'application/json; charset=utf-8',
                data: JSON.stringify(item),
                async: true,
                success: function(data) {
                    if (checkTimeout(data)) {
                        closeWaitingDialog();

                        if (data.success == true) {
                            $("#divCargaArchivos").css("display", "none");
                            $("#divOfertasShowRoom").css("display", "none");
                            LimpiarDatosEventoShowRoom();
                            alert(data.message);
                            jQuery("#listEvento").setGridParam({ datatype: 'json', page: 1 }).trigger('reloadGrid');
                        } else
                            alert(data.message);
                    }
                },
                error: function(data, error) {
                    if (checkTimeout(data)) {
                        closeWaitingDialog();
                        alert("ERROR");
                    }
                }
            });
            return false;
        },
        EditarProducto: function (ID, CampaniaID, CUV) {
            LimpiarDatosShowRoomDetalle();

            $("#txtPaisDetalle").val(paisNombre);
            $("#txtCampaniaDetalle").val(jQuery("#list").jqGrid('getCell', ID, 'CodigoCampania'));
            $("#txtTipoOfertaDetalle").val(jQuery("#list").jqGrid('getCell', ID, 'TipoOferta'));
            $("#txtCUVDetalle").val(jQuery("#list").jqGrid('getCell', ID, 'CUV'));
            $("#txtDescripcionDetalle").val(jQuery("#list").jqGrid('getCell', ID, 'Descripcion'));
            $("#txtPrecioValorizadoDetalle").val(jQuery("#list").jqGrid('getCell', ID, 'PrecioValorizado'));

            showDialog("DialogRegistroOfertaShowRoomDetalle");

            fnGrillaOfertaShowRoomDetalle(CampaniaID, CUV);
        },
        EliminarProducto: function(ID, CampaniaID, CUV) {
            var eliminar = confirm('¿ Está seguro que desea eliminar todos los productos del set ?');
            if (!eliminar)
                return false;

            var item = {
                campaniaID: CampaniaID,
                cuv: CUV
            };

            waitingDialog({});
            jQuery.ajax({
                type: 'POST',
                url: urlEliminarOfertaShowRoomDetalleAll,
                dataType: 'json',
                contentType: 'application/json; charset=utf-8',
                data: JSON.stringify(item),
                async: true,
                success: function (data) {
                    if (checkTimeout(data)) {
                        closeWaitingDialog();

                        if (data.success == true) {
                            alert(data.message);
                        } else
                            alert(data.message);
                    }
                },
                error: function (data, error) {
                    if (checkTimeout(data)) {
                        closeWaitingDialog();
                        alert("ERROR");
                    }
                }
            });
        },
        EditarProductoDetalle: function(ID, CampaniaID, CUV, Imagen) {
            $('#hdOfertaShowRoomDetalleID').val(jQuery("#listShowRoomDetalle").jqGrid('getCell', ID, 'OfertaShowRoomDetalleID'));
            $('#txtNombreProductoDetalle').val(jQuery("#listShowRoomDetalle").jqGrid('getCell', ID, 'NombreProducto'));
            $('#txtDescripcion1Detalle').val(jQuery("#listShowRoomDetalle").jqGrid('getCell', ID, 'Descripcion1'));
            $('#txtDescripcion2Detalle').val(jQuery("#listShowRoomDetalle").jqGrid('getCell', ID, 'Descripcion2'));
            $('#txtDescripcion3Detalle').val(jQuery("#listShowRoomDetalle").jqGrid('getCell', ID, 'Descripcion3'));
            $('#txtMarcaProductoDetalle').val(jQuery("#listShowRoomDetalle").jqGrid('getCell', ID, 'MarcaProducto'));

            var imagen = Imagen.replace(/^.*[\\\/]/, '');

            if (imagen != "prod_grilla_vacio.png") {
                $('#hdImagenDetalle').val(imagen);
                $('#hdImagenDetalleAnterior').val(imagen);
                $('#imgProductoDetalle').attr('src', Imagen);
            } else {
                $('#hdImagenDetalle').val("");
                $('#hdImagenDetalleAnterior').val("");
                $('#imgProductoDetalle').attr('src', imagenProductoVacio);
            }

            showDialog("DialogRegistroOfertaShowRoomDetalleEditar");
        },
        EliminarProductoDetalle: function (ID, CampaniaID, CUV) {
            var eliminar = confirm('¿ Está seguro que desea eliminar el producto ?');
            if (!eliminar)
                return false;

            var item = {
                ofertaShowRoomDetalleID: ID,
                campaniaID: CampaniaID,
                cuv: CUV
            };

            waitingDialog({});
            jQuery.ajax({
                type: 'POST',
                url: urlEliminarOfertaShowRoomDetalle,
                dataType: 'json',
                contentType: 'application/json; charset=utf-8',
                data: JSON.stringify(item),
                async: true,
                success: function (data) {
                    if (checkTimeout(data)) {
                        closeWaitingDialog();

                        if (data.success == true) {
                            alert(data.message);
                            jQuery("#listShowRoomDetalle").setGridParam({ datatype: 'json', page: 1 }).trigger('reloadGrid');
                        } else
                            alert(data.message);
                    }
                },
                error: function (data, error) {
                    if (checkTimeout(data)) {
                        closeWaitingDialog();
                        alert("ERROR");
                    }
                }
            });
        },
        EditarTipoOferta: function (ID, Codigo, Descripcion) {
            $("#hdIdTipoOferta").val(ID);
            $("#txtCodigoTipoOferta").val(Codigo);
            $("#txtDescripcionTipoOferta").val(Descripcion);

            $("#btnAgregarTipoOferta").val("Modificar");
            $("#txtCodigoTipoOferta").attr("readonly", "readonly");
        },
        HabilitarTipoOferta: function (ID, estaHabilitar) {
            var mensajeDescriocion = estaHabilitar == 1 ? "Desactivar" : "Activar";
            var confirmar = confirm('¿ Está seguro que desea ' + mensajeDescriocion + ' el producto seleccionado?');
            if (!confirmar)
                return false;

            var item = {
                TipoOfertaID: ID,
                Activo: estaHabilitar != 1
            }

            waitingDialog({});
            jQuery.ajax({
                type: 'POST',
                url: urlHabilitarShowRoomTipoOferta,
                dataType: 'json',
                contentType: 'application/json; charset=utf-8',
                data: JSON.stringify(item),
                async: true,
                success: function (data) {
                    if (checkTimeout(data)) {
                        closeWaitingDialog();

                        if (data.success == true) {
                            alert(data.message);
                            jQuery("#listShowRoomTipoOferta").setGridParam({ datatype: 'json', page: 1 }).trigger('reloadGrid');
                        } else
                            alert(data.message);
                    }
                },
                error: function (data, error) {
                    if (checkTimeout(data)) {
                        closeWaitingDialog();
                        alert("ERROR");
                    }
                }
            });
            return false;
        }
    });

    function LimpiarDatosEventoShowRoom() {
        $("#txtEventoNombre").val("");
        $("#txtEventoTema").val("");
        $("#txtEventoDiasAntes").val("");
        $("#txtEventoDiasDespues").val("");
        $("#txtEventoNumeroPerfiles").val("");
        $("#txtEventoRutaShowRoomPopup").val("");
        $("#txtEventoRutaShowRoomBannerLateral").val("");

        $("#divPopupWebFondo").html("");
        $("#divPopupVentaImagenSet").html("");
        $("#divPopupWebImagenSet").html("");
        $("#divPopupTagLateralVentaImagenSet").html("");
        $("#divCabeceraPaginaProductos").html("");
        $("#divPestaniaNombreShowRoom").html("");
        $("#divPopupImagenPreventaDigital").html("");

        $("#chkEventoTieneCategoria, #chkEventoTieneSubCampania, #chkEventocompraXcompra, #chkEventoTienePersonalizacion").attr('checked', false);
    }

    function LimpiarDatos() {
        $('#hdCampaniaID').val("");
        $('#txtPaisModal').val("");
        $('#txtCUVModal').val("");
        $('#txtDescripcionModal').val("");
        $('#txtPrecioValorizadoModal').val("");
        $('#txtPrecioOfertaModal').val("");
        $('#chkHabilitarOferta').removeAttr('checked');
        $("#FlagTransaccion").val("0");
        $("#hdCodigoOferta").val("");
        $("#hdStockProducto").val("0");
        $('#txtUnidadesPermitidasModal').val("");
        $("#chkEsSubCampania").removeAttr('checked');
    }

    function LimpiarDatosShowRoomDetalle() {
        $("#txtPaisDetalle").val('');
        $("#txtCampaniaDetalle").val('');
        $("#txtTipoOfertaDetalle").val('');
        $("#txtCUVDetalle").val('');
        $("#txtDescripcionDetalle").val('');
        $("#txtPrecioValorizadoDetalle").val('');
    }

    function LimpiarDatosEventoShowRoomDetalle() {
        $("#hdOfertaShowRoomDetalleID").val("0");
        $("#txtNombreProductoDetalle").val("");
        $("#txtDescripcion1Detalle").val("");
        $("#txtDescripcion2Detalle").val("");
        $("#txtDescripcion3Detalle").val("");
        $("#txtMarcaProductoDetalle").val("");
        $('#imgProductoDetalle').attr('src', imagenProductoVacio);
        $("#hdImagenDetalle").val("");
        $("#hdImagenDetalleAnterior").val("");
    }

    function LimpiarCargaStock() {
        var divcontainer = $('#flStock').closest('div');
        divcontainer.html(divcontainer.html());
    }

    function LimpiarCargaConsultoras() {
        var divcontainer = $('#flCargarConsultoras').closest('div');
        divcontainer.html(divcontainer.html());
    }

    function LimpiarCargaDescripcionSets() {
        var divcontainer = $('#flDescripcionSets').closest('div');
        divcontainer.html(divcontainer.html());
    }

    function LimpiarCargaProductoCpc() {
        var divcontainer = $('#flCargarProductoCpc').closest('div');
        divcontainer.html(divcontainer.html());
    }

    function LimpiarDependencias(Id) {
        var ddlCampania = $('#ddlCampania');
        ddlCampania.empty();
        ddlCampania.append($('<option/>', {
            value: "",
            text: "-- Seleccionar --"
        }));
        
        $("#list").jqGrid("clearGridData", true).trigger("reloadGrid");
    }

    function alert_msg(message) {
        $('#DialogMensajes .message_text').html(message);
        $('#DialogMensajes').dialog('open');
    }

    function InsertarImagenPersonalizacion(personalizacionId) {
        var elementoPadre = $('.div-3[data-idpersonalizacion="' + personalizacionId + '"]');
            var elementoAgregarImagen = $(elementoPadre).find('.fpPopupImagenPersonalizacion')[0];
            var elementoDivVerImagen = $(elementoPadre).find('.divPopupImagenPersonalizacion')[0];
            var elementoHiddenValor = $(elementoPadre).find('.hdValor')[0];
        $.ajaxSetup({ cache: false });
        var uploader = new qq.FileUploader({
            allowedExtensions: ['jpg', 'png', 'jpeg', 'gif'],
            element: elementoAgregarImagen,
            action: urlImageMatrizUpload,
            onComplete: function (id, fileName, responseJSON) {
                if (checkTimeout(responseJSON)) {
                    $(".qq-upload-list").css("display", "none");
                    if (responseJSON.success) {
                        var rutaImagen = rutaImagenTemporal + responseJSON.name;
                        
                        $(elementoHiddenValor).val(responseJSON.name);

                        var html = '<img  alt="" src="' + rutaImagen + '" style="width: auto; height: 60px; max-width: 300px !important;"/>';
                        $(elementoDivVerImagen).html(html);
                    } else {
                        alert(responseJSON.message);
                    }
                }
            },
            onSubmit: function (id, fileName) { $(".qq-upload-list").css("display", "none"); },
            onProgress: function (id, fileName, loaded, total) { $(".qq-upload-list").css("display", "none"); },
            onCancel: function (id, fileName) { $(".qq-upload-list").css("display", "none"); }
        });
    }

    function RegistrarShowRoomPersonalizacionNivel(eventoId, nivelId) {
        var lista = $("#DialogPersonalizacionDetalle .div-3[data-idpersonalizacion]");
        var array = new Array();

        $.each(lista, function (index, value) {
            var personalizacionNivelId = $(value).find(".hdPersonalizacionNivelId").val();
            var personalizacionId = $(value).attr("data-idpersonalizacion");
            var atributo = $(value).find(".hdAtributo").val();

            var valor = "";
            var esImagen = false;
            var tipoAtributo = $(value).find(".hdTipoAtributo").val();

            if (tipoAtributo == "IMAGEN") {
                valor = $(value).find(".hdValor").val();
                esImagen = true;
            } else {
                valor = $(value).find(".txtAtributoPersonalizacion").val();
            }

            var item = {
                PersonalizacionNivelId: personalizacionNivelId,
                PersonalizacionId: personalizacionId,
                EventoId: eventoId,
                NivelId: nivelId,
                CategoriaId: 0,
                Atributo: atributo,
                Valor: valor,
                ValorAnterior: $(value).find(".hdValorAnterior").val(),
                EsImagen: esImagen
            };

            array.push(item);
        });

        jQuery.ajax({
            type: 'POST',
            url: urlGuardarPersonalizacionNivelShowRoom,
            dataType: 'json',
            contentType: 'application/json; charset=utf-8',
            data: JSON.stringify(array),
            async: true,
            success: function (data) {
                if (checkTimeout(data)) {
                    closeWaitingDialog();
                    if (data.success == true) {
                        alert(data.message);
                        
                        HideDialog("DialogPersonalizacionDetalle");
                    }
                    else {
                        alert(data.message);
                    }
                }
            },
            error: function (data, error) {
                if (checkTimeout(data)) {
                    closeWaitingDialog();
                    alert(data.message);
                }
            }
        });
    }

    function UpdateDescripcionCategoria(categoriaId) {
        var descripcion = $("#txtDescripcionCategoria").val();
        var item = {
            CategoriaId: categoriaId,
            Descripcion: descripcion
        };

        jQuery.ajax({
            type: 'POST',
            url: urlUpdateShowRoomDescripcionCategoria,
            dataType: 'json',
            contentType: 'application/json; charset=utf-8',
            data: JSON.stringify(item),
            async: true,
            success: function (data) {
                if (checkTimeout(data)) {
                }
            },
            error: function (data, error) {
                if (checkTimeout(data)) {
                    closeWaitingDialog();
                    alert("ERROR");
                }
            }
        });
    }

    function RegistrarShowRoomPersonalizacionCategoria(eventoId, categoriaId) {
        var lista = $("#DialogPersonalizacionCategoriaDetalle .div-3[data-idpersonalizacion]");
        var array = new Array();

        $.each(lista, function (index, value) {
            var personalizacionNivelId = $(value).find(".hdPersonalizacionNivelId").val();
            var personalizacionId = $(value).attr("data-idpersonalizacion");
            var atributo = $(value).find(".hdAtributo").val();

            var valor = "";
            var esImagen = false;
            var tipoAtributo = $(value).find(".hdTipoAtributo").val();

            if (tipoAtributo == "IMAGEN") {
                valor = $(value).find(".hdValor").val();
                esImagen = true;
            } else {
                valor = $(value).find(".txtAtributoPersonalizacion").val();
            }

            var item = {
                PersonalizacionNivelId: personalizacionNivelId,
                PersonalizacionId: personalizacionId,
                EventoId: eventoId,
                NivelId: 0,
                CategoriaId: categoriaId,
                Atributo: atributo,
                Valor: valor,
                ValorAnterior: $(value).find(".hdValorAnterior").val(),
                EsImagen: esImagen
            };

            array.push(item);
        });

        jQuery.ajax({
            type: 'POST',
            url: urlGuardarPersonalizacionNivelShowRoom,
            dataType: 'json',
            contentType: 'application/json; charset=utf-8',
            data: JSON.stringify(array),
            async: true,
            success: function (data) {
                if (checkTimeout(data)) {
                    closeWaitingDialog();
                    if (data.success == true) {
                        alert(data.message);

                        HideDialog("DialogPersonalizacionCategoriaDetalle");
                    }
                    else {
                        alert(data.message);
                    }
                }
            },
            error: function (data, error) {
                if (checkTimeout(data)) {
                    closeWaitingDialog();
                    alert(data.message);
                }
            }
        });
    }

    function GuardarImagenPersonalizacion(rutaImagen, nombreImagen, elementoDivVerImagen, elementoHiddenImagen, personalizacionNivelId,
        personalizacionId, eventoId, nivelId, atributo) {
        var html = '<img  alt="" src="' + rutaImagen + '" style="max-width: 100% !important;"/>';
        $("#" + elementoDivVerImagen).html(html);

        $("#" + elementoHiddenImagen).val(nombreImagen);
    }

    function fnGrillaTiposOferta() {
        jQuery("#listShowRoomTipoOferta").jqGrid({
            url: urlConsultarTiposOferta,
            hidegrid: false,
            datatype: 'json',
            mtype: 'GET',
            contentType: "application/json; charset=utf-8",
            colNames: ['ID', 'Código', 'Descripción', 'Acciones'],
            colModel: [
                { name: 'TipoOfertaID', index: 'TipoOfertaID', width: 50, editable: true, resizable: false, hidden: true },
                { name: 'Codigo', index: 'Codigo', width: 50, editable: true, resizable: false },
                { name: 'Descripcion', index: 'Descripcion', width: 60, editable: true, resizable: false },                
                { name: 'Options', index: 'Options', width: 60, editable: true, sortable: false, align: 'center', resizable: false, formatter: ShowActionsTiposOferta }
            ],
            jsonReader:
            {
                root: "rows",
                page: "page",
                total: "total",
                records: "records",
                repeatitems: true,
                cell: "cell",
                id: "id"
            },
            pager: jQuery('#pagerShowRoomTipoOferta'),
            loadtext: 'Cargando datos...',
            recordtext: "{0} - {1} de {2} Registros",
            emptyrecords: 'No hay resultados',
            rowNum: 10,
            scrollOffset: 0,
            rowList: [10, 20, 30, 40, 50],
            sortname: 'Nombre',
            sortorder: 'asc',
            viewrecords: true,
            multiselect: false,
            height: 'auto',
            width: 630,
            pgtext: 'Pág: {0} de {1}',
            altRows: true,
            altclass: 'jQGridAltRowClass',
            loadComplete: function () {
            },
            gridComplete: function () {
            }
        });
        jQuery("#listShowRoomTipoOferta").jqGrid('navGrid', "#pagerShowRoomTipoOferta", { edit: false, add: false, refresh: false, del: false, search: false });
        jQuery("#listShowRoomTipoOferta").setGridParam({ datatype: 'json', page: 1 }).trigger('reloadGrid');
    }

    function ShowActionsTiposOferta(cellvalue, options, rowObject) {
        var mensajeHabilitar = "Desactivar";
        var estadoHabilitar = 1;

        if (rowObject[3] != "True") {
            mensajeHabilitar = "Activar";
            estadoHabilitar = 0;
        }

        var editar = "&nbsp;<a href='javascript:;' onclick=\"return jQuery('#listShowRoomTipoOferta').EditarTipoOferta('" + options.rowId + "','" + rowObject[1] + "','" + rowObject[2] + "');\" >" + "Editar</a>";
        var habilitar = "&nbsp;<a href='javascript:;' onclick=\"return jQuery('#listShowRoomTipoOferta').HabilitarTipoOferta('" + options.rowId + "','" + estadoHabilitar + "');\" >" + mensajeHabilitar + "</a>";

        var resultado = '';

        if (estadoHabilitar == 1)
            resultado += editar + " | ";

        resultado += habilitar;

        return resultado;
    }

    function ExisteTipoOferta(tipoOfertaId, codigo, descripcion) {
        var resultado = -1;

        var item = {
            TipoOfertaId: tipoOfertaId,
            Codigo: codigo,
            Descripcion: descripcion
        };

        jQuery.ajax({
            type: 'POST',
            url: urlExisteTipoOferta,
            dataType: 'json',
            contentType: 'application/json; charset=utf-8',
            data: JSON.stringify(item),
            async: false,
            success: function (data) {
                if (checkTimeout(data)) {
                    if (data.success == true) {
                        resultado = data.resultado;

                        if (resultado != 0)
                            alert_msg(data.message);
                    }
                    else {
                        alert_msg(data.message);
                    }
                }
            },
            error: function (data, error) {
                if (checkTimeout(data)) {
                    alert(data.message);
                }
            }
        });

        return resultado;
    }

    function GuardarTipoOferta(item) {
        waitingDialog({ title: "Procesando" });
        jQuery.ajax({
            type: 'POST',
            url: urlGuardarShowRoomTipoOferta,
            dataType: 'json',
            contentType: 'application/json; charset=utf-8',
            data: JSON.stringify(item),
            async: true,
            success: function (response) {
                if (checkTimeout(response)) {
                    if (response.success) {
                        closeWaitingDialog();
                        
                        jQuery("#listShowRoomTipoOferta").setGridParam({ datatype: 'json', page: 1 }).trigger('reloadGrid');

                        $("#hdIdTipoOferta").val("");
                        $("#txtCodigoTipoOferta").val("");
                        $("#txtDescripcionTipoOferta").val("");

                        $("#btnAgregarTipoOferta").val("Agregar");

                        $("#txtCodigoTipoOferta").removeAttr("readonly");

                        alert_msg(response.message);
                    } else {
                        alert_msg(response.message);
                    }
                }
            },
            error: function (response, error) {
                if (checkTimeout(response)) {
                    alert_msg(response.message);
                    closeWaitingDialog();
                }
            }
        });
    }
</script>